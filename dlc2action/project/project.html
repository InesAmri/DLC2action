<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>dlc2action.project.project API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../project.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;dlc2action.project</a>

            <img src="https://i.ibb.co/NstG5hz/03.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Project">Project</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Project.__init__">Project</a>
                        </li>
                        <li>
                                <a class="variable" href="#Project.project_path">project_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#Project.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Project.data_type">data_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#Project.annotation_type">annotation_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#Project.data_path">data_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#Project.annotation_path">annotation_path</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.run_episode">run_episode</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.run_episodes">run_episodes</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.continue_episode">continue_episode</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.run_default_hyperparameter_search">run_default_hyperparameter_search</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.run_hyperparameter_search">run_hyperparameter_search</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.run_prediction">run_prediction</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.evaluate_prediction">evaluate_prediction</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.evaluate">evaluate</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.list_episodes">list_episodes</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.list_predictions">list_predictions</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.list_searches">list_searches</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.get_best_parameters">get_best_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.list_best_parameters">list_best_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.plot_episodes">plot_episodes</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.update_parameters">update_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.get_summary">get_summary</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.remove_project">remove_project</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.remove_saved_features">remove_saved_features</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.remove_extra_checkpoints">remove_extra_checkpoints</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.remove_search">remove_search</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.remove_prediction">remove_prediction</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.remove_episode">remove_episode</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.prune_unfinished">prune_unfinished</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.prediction_path">prediction_path</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.print_data_types">print_data_types</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.print_annotation_types">print_annotation_types</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.data_types">data_types</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.annotation_types">annotation_types</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.set_main_parameters">set_main_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.help">help</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.list_blanks">list_blanks</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.list_basic_parameters">list_basic_parameters</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.count_classes">count_classes</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.plot_class_distribution">plot_class_distribution</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.plot_confusion_matrix">plot_confusion_matrix</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.plot_predictions">plot_predictions</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.create_metadata_backup">create_metadata_backup</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.load_metadata_backup">load_metadata_backup</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.get_behavior_dictionary">get_behavior_dictionary</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.import_episodes">import_episodes</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.export_episodes">export_episodes</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.get_results_table">get_results_table</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.episode_exists">episode_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.search_exists">search_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.prediction_exists">prediction_exists</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.project_name_available">project_name_available</a>
                        </li>
                        <li>
                                <a class="function" href="#Project.rename_episode">rename_episode</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../dlc2action.html">dlc2action</a><wbr>.<a href="./../project.html">project</a><wbr>.project    </h1>

                        <div class="docstring"><p>Project interface</p>
</div>

                        <input id="mod-project-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-project-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1">#</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1"># Copyright 2020-present by A. Mathis Group and contributors. All rights reserved.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="c1">#</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="c1"># This project and all its files are licensed under GNU AGPLv3 or later version. A copy is included in dlc2action/LICENSE.AGPL.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="c1">#</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">Project interface</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">copy</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span> <span class="nn">email.policy</span> <span class="kn">import</span> <span class="n">default</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">search</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span> <span class="nn">shutil</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ndarray</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">from</span> <span class="nn">ruamel.yaml</span> <span class="kn">import</span> <span class="n">YAML</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">from</span> <span class="nn">dlc2action.data.dataset</span> <span class="kn">import</span> <span class="n">BehaviorDataset</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">from</span> <span class="nn">dlc2action.utils</span> <span class="kn">import</span> <span class="n">apply_threshold</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Mapping</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">from</span> <span class="nn">dlc2action.task.task_dispatcher</span> <span class="kn">import</span> <span class="n">TaskDispatcher</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span><span class="p">,</span> <span class="n">copy</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="kn">import</span> <span class="nn">optuna</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="kn">import</span> <span class="nn">plotly</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="kn">from</span> <span class="nn">dlc2action</span> <span class="kn">import</span> <span class="n">options</span><span class="p">,</span> <span class="n">__version__</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="kn">from</span> <span class="nn">ruamel.yaml.comments</span> <span class="kn">import</span> <span class="n">CommentedMap</span><span class="p">,</span> <span class="n">CommentedSet</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="kn">from</span> <span class="nn">dlc2action.project.meta</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>    <span class="n">Searches</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>    <span class="n">SavedStores</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>    <span class="n">Run</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>    <span class="n">SavedRuns</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>    <span class="n">DecisionThresholds</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="p">)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="k">class</span> <span class="nc">Project</span><span class="p">:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">    A class to create and maintain the project files + keep track of experiments</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>        <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>        <span class="n">annotation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>        <span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>        <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">        Parameters</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">        ----------</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">        name : str</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">            name of the project</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">        data_type : str, optional</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">            data type (run Project.data_types() to see available options; has to be provided if the project is being</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">            created)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">        annotation_type : str, default &#39;none&#39;</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">            annotation type (run Project.annotation_types() to see available options)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">        projects_path : str, optional</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">            path to the projects folder (is filled with ~/DLC2Action by default)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">            path to the folder containing input files for the project (has to be provided if the project is being</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">            created)</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">        annotation_path : str, optional</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">            path to the folder containing annotation files for the project</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">        copy : bool, default False</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">            if True, the files from annotation_path and data_path will be copied to the projects folder;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">            otherwise they will be moved</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>        <span class="k">if</span> <span class="n">projects_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>            <span class="n">projects_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()),</span> <span class="s2">&quot;DLC2Action&quot;</span><span class="p">)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">projects_path</span><span class="p">):</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">projects_path</span><span class="p">)</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span> <span class="o">=</span> <span class="n">annotation_type</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">data_path</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span> <span class="o">=</span> <span class="n">annotation_path</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">):</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>            <span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>                    <span class="s2">&quot;The data_type parameter is necessary when creating a new project!&quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>                <span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_project</span><span class="p">(</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>                <span class="n">data_type</span><span class="p">,</span> <span class="n">annotation_type</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">annotation_path</span><span class="p">,</span> <span class="n">copy</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>            <span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_types</span><span class="p">()</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="k">if</span> <span class="n">data_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="ow">and</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>                    <span class="sa">f</span><span class="s2">&quot;The project has already been initialized with data_type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>                <span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>            <span class="k">if</span> <span class="n">annotation_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span> <span class="ow">and</span> <span class="n">annotation_type</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>                    <span class="sa">f</span><span class="s2">&quot;The project has already been initialized with annotation_type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>                <span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">data_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_paths</span><span class="p">()</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">data_path</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>            <span class="c1"># if data_path != self.data_path and data_path is not None:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>            <span class="c1">#     raise ValueError(</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>            <span class="c1">#         f&quot;The project has already been initialized with data_path={self.data_path}!&quot;</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>            <span class="c1">#     )</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>            <span class="k">if</span> <span class="n">annotation_path</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span> <span class="ow">and</span> <span class="n">annotation_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>                    <span class="sa">f</span><span class="s2">&quot;The project has already been initialized with annotation_path=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>                <span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_configs</span><span class="p">()</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>    <span class="k">def</span> <span class="nf">_aggregate_predictions</span><span class="p">(</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>        <span class="n">evaluate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>        <span class="n">embedding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TaskDispatcher</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">        Generate a prediction</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>        <span class="k">if</span> <span class="n">load_epochs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>            <span class="n">load_epochs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)))</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="n">cnt</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)))</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>        <span class="n">behs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_dictionary</span><span class="p">(</span><span class="n">episode_names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>            <span class="p">[</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>                <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_dictionary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">==</span> <span class="n">behs</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">episode_names</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>            <span class="p">]</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>        <span class="p">):</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The behavior sets are different in </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>        <span class="n">behaviors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">episode_names</span><span class="p">):</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">data_mode</span><span class="p">,</span> <span class="n">new_pred</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_prediction</span><span class="p">(</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>                <span class="n">prediction_name</span><span class="p">,</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>                <span class="n">episode_names</span><span class="o">=</span><span class="p">[</span><span class="n">episode_name</span><span class="p">],</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>                <span class="n">load_epochs</span><span class="o">=</span><span class="p">[</span><span class="n">load_epochs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>                <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>                <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>                <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>                <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>                <span class="n">evaluate</span><span class="o">=</span><span class="n">evaluate</span><span class="p">,</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>                <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>                <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>            <span class="p">)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>            <span class="n">new_pred</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">data_mode</span><span class="p">)</span><span class="o">.</span><span class="n">generate_full_length_prediction</span><span class="p">(</span><span class="n">new_pred</span><span class="p">)</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>            <span class="n">beh_dict</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>            <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">video_values</span> <span class="ow">in</span> <span class="n">new_pred</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>                <span class="k">for</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">clip_prediction</span> <span class="ow">in</span> <span class="n">video_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>                    <span class="k">for</span> <span class="n">beh_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">clip_prediction</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>                        <span class="n">prediction</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>                            <span class="n">beh_dict</span><span class="p">[</span><span class="n">beh_i</span><span class="p">]</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>                        <span class="p">]</span> <span class="o">+=</span> <span class="n">clip_prediction</span><span class="p">[</span><span class="n">beh_i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>                        <span class="n">cnt</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="n">beh_dict</span><span class="p">[</span><span class="n">beh_i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>                        <span class="n">behaviors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">beh_dict</span><span class="p">[</span><span class="n">beh_i</span><span class="p">])</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="c1"># behaviors = sorted(behaviors)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="n">behavior_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>            <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="p">)</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>        <span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">behavior_indices</span><span class="p">]</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>        <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">video_values</span> <span class="ow">in</span> <span class="n">prediction</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>            <span class="k">for</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">clip_values</span> <span class="ow">in</span> <span class="n">video_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>                <span class="n">pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>                    <span class="p">[</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>                        <span class="n">clip_values</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span> <span class="o">/</span> <span class="n">cnt</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="n">beh</span><span class="p">]</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>                        <span class="k">for</span> <span class="n">beh</span> <span class="ow">in</span> <span class="n">behaviors</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>                    <span class="p">],</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>                    <span class="mi">0</span><span class="p">,</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>                <span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>                <span class="n">output</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="k">return</span> <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">data_mode</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">output</span><span class="p">),</span> <span class="kc">None</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>    <span class="k">def</span> <span class="nf">_make_prediction</span><span class="p">(</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>        <span class="n">evaluate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>        <span class="n">embedding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TaskDispatcher</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">        Generate a prediction</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>        <span class="n">epochs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="k">if</span> <span class="n">load_epochs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>            <span class="n">load_epochs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">load_epochs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">episode_names</span><span class="p">):</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>                <span class="sa">f</span><span class="s2">&quot;The length of load_epochs and the length of episode_names should be the same!&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>            <span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">episode_names</span><span class="p">):</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>            <span class="n">names</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>            <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">load_epochs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;None of the episodes </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2"> exist!&quot;</span><span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>        <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>            <span class="n">episodes</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="p">]</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="n">overlaps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>            <span class="n">episodes</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="p">]</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">==</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Episodes </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2"> have different segment lengths&quot;</span><span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">==</span> <span class="n">overlaps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">overlaps</span><span class="p">]):</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Episodes </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2"> have different overlaps&quot;</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>        <span class="n">load_epochs</span> <span class="o">=</span> <span class="n">epochs</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>        <span class="n">decision_thresholds</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>        <span class="n">time_total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>        <span class="n">behavior_dicts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_dictionary</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">names</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>        <span class="p">]</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>            <span class="p">[</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>                <span class="nb">set</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">behavior_dicts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">behavior_dicts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>            <span class="p">]</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>        <span class="p">):</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>                <span class="sa">f</span><span class="s2">&quot;Episodes </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2"> have different sets of behaviors!&quot;</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>            <span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>        <span class="n">behavior_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">behavior_dicts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span><span class="n">behavior_dicts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">behavior_indices</span><span class="p">]</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="n">cnt</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="n">behavior_probs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>        <span class="k">for</span> <span class="n">episode_name</span><span class="p">,</span> <span class="n">load_epoch</span><span class="p">,</span> <span class="n">behavior_dict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>            <span class="n">names</span><span class="p">,</span> <span class="n">load_epochs</span><span class="p">,</span> <span class="n">behavior_dicts</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>        <span class="p">):</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;episode </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">data_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>                <span class="n">prediction_name</span><span class="o">=</span><span class="n">prediction_name</span><span class="p">,</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>                <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>                <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>                <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>                <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>                <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>                <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>                <span class="n">decision_thresholds</span><span class="o">=</span><span class="n">decision_thresholds</span><span class="p">,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>            <span class="p">)</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>            <span class="n">behavior_indices_cur</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">behavior_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>            <span class="n">behaviors_cur</span> <span class="o">=</span> <span class="p">[</span><span class="n">behavior_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">behavior_indices_cur</span><span class="p">]</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>            <span class="c1"># data_mode = &quot;train&quot; if mode == &quot;all&quot; else mode</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>            <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>            <span class="n">new_pred</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>                <span class="n">data_mode</span><span class="p">,</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>                <span class="n">raw_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>                <span class="n">apply_primary_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>                <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>                <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>            <span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">beh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">behaviors_cur</span><span class="p">):</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                <span class="n">cnt</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                <span class="n">behavior_probs</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_pred</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>            <span class="c1"># indices = [</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>            <span class="c1">#     behaviors.index(behavior_dict[i]) for i in range(new_pred.shape[1])</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>            <span class="c1"># ]</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>            <span class="c1"># new_pred = new_pred[:, indices, :]</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>            <span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>            <span class="n">time_total</span> <span class="o">+=</span> <span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>            <span class="k">if</span> <span class="n">evaluate</span><span class="p">:</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">evaluate_prediction</span><span class="p">(</span><span class="n">new_pred</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_mode</span><span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span><span class="p">:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_metrics</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>            <span class="c1"># if prediction is None:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>            <span class="c1">#     prediction = new_pred</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>            <span class="c1"># else:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>            <span class="c1">#     prediction += new_pred</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">behavior_probs</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span> <span class="o">/</span> <span class="n">cnt</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span> <span class="k">for</span> <span class="n">beh</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>        <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>        <span class="n">time_total</span> <span class="o">-=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>        <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>        <span class="n">time_total</span> <span class="o">-=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>        <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span><span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>        <span class="n">inference_time</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">minutes</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">seconds</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>        <span class="c1"># prediction /= len(names)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>        <span class="k">return</span> <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">data_mode</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">inference_time</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>    <span class="k">def</span> <span class="nf">_make_task_prediction</span><span class="p">(</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>        <span class="n">decision_thresholds</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TaskDispatcher</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">        Make a `TaskDispatcher` object that will be used to generate a prediction</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>        <span class="n">parameters_update_second</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span> <span class="ow">or</span> <span class="n">data_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">file_paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>            <span class="n">parameters_update_second</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                <span class="s2">&quot;val_frac&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                <span class="s2">&quot;test_frac&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>                <span class="s2">&quot;partition_method&quot;</span><span class="p">:</span> <span class="s2">&quot;random&quot;</span><span class="p">,</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>                <span class="s2">&quot;save_split&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                <span class="s2">&quot;split_path&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>            <span class="p">}</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>        <span class="k">if</span> <span class="n">decision_thresholds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">decision_thresholds</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>                <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">load_episode</span><span class="p">)</span><span class="o">.</span><span class="n">get_num_classes</span><span class="p">()</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>            <span class="p">):</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>                <span class="n">parameters_update_second</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                    <span class="s2">&quot;threshold_value&quot;</span><span class="p">:</span> <span class="n">decision_thresholds</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>                <span class="p">}</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>                    <span class="sa">f</span><span class="s2">&quot;The length of the decision thresholds </span><span class="si">{</span><span class="n">decision_thresholds</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>                    <span class="sa">f</span><span class="s2">&quot;must be equal to the length of the behaviors dictionary &quot;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">load_episode</span><span class="p">)</span><span class="o">.</span><span class="n">get_behaviors_dict</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>                <span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="n">data_param_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="k">if</span> <span class="n">data_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>            <span class="n">data_param_update</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data_path&quot;</span><span class="p">:</span> <span class="n">data_path</span><span class="p">}</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>        <span class="k">if</span> <span class="n">file_paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>            <span class="n">data_param_update</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data_path&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;file_paths&quot;</span><span class="p">:</span> <span class="n">file_paths</span><span class="p">}</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters_update</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data_param_update</span><span class="p">})</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="k">if</span> <span class="n">data_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">file_paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>            <span class="n">general_update</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                <span class="s2">&quot;annotation_type&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                <span class="s2">&quot;only_load_annotated&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>            <span class="p">}</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>            <span class="n">general_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>        <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters_update</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="n">general_update</span><span class="p">})</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task</span><span class="p">(</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>            <span class="n">episode_name</span><span class="o">=</span><span class="n">prediction_name</span><span class="p">,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>            <span class="n">parameters_update_second</span><span class="o">=</span><span class="n">parameters_update_second</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>            <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_dictionary</span><span class="p">(</span><span class="n">load_episode</span><span class="p">),</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        <span class="p">)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>        <span class="c1"># if data_path is not None or file_paths is not None:</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="c1">#     print(&#39;SETTING&#39;)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="c1">#     task.set_behaviors(self.get_behavior_dictionary(load_episode))</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>            <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">):</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>            <span class="k">elif</span> <span class="n">task</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">):</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="k">return</span> <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>    <span class="k">def</span> <span class="nf">_make_task_training</span><span class="p">(</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="n">continuing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>        <span class="n">throwaway</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TaskDispatcher</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">        Make a `TaskDispatcher` object that will be used to generate a prediction</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="k">if</span> <span class="n">continuing</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>            <span class="n">purpose</span> <span class="o">=</span> <span class="s2">&quot;continuing&quot;</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>            <span class="n">purpose</span> <span class="o">=</span> <span class="s2">&quot;training&quot;</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="k">if</span> <span class="n">mask_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>            <span class="n">mask_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_path</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">.pickle&quot;</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="n">parameters_update_second</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;real_lens&quot;</span><span class="p">:</span> <span class="n">mask_name</span><span class="p">}}</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>        <span class="k">if</span> <span class="n">throwaway</span><span class="p">:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>                <span class="n">parameters_update</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;normalize&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;cpu&quot;</span><span class="p">}}</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>            <span class="p">)</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task</span><span class="p">(</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>            <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>            <span class="n">parameters_update_second</span><span class="p">,</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>            <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>            <span class="n">load_search</span><span class="p">,</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>            <span class="n">load_parameters</span><span class="p">,</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>            <span class="n">round_to_binary</span><span class="p">,</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>            <span class="n">purpose</span><span class="p">,</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>            <span class="n">task</span><span class="p">,</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>        <span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>    <span class="k">def</span> <span class="nf">_make_parameters</span><span class="p">(</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>        <span class="n">parameters_update_second</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>        <span class="n">purpose</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>    <span class="p">):</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="sd">        Construct a parameters dictionary</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>        <span class="n">pars_update</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters_update</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>        <span class="k">if</span> <span class="n">parameters_update_second</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>            <span class="n">parameters_update_second</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="k">if</span> <span class="n">purpose</span> <span class="o">==</span> <span class="s2">&quot;prediction&quot;</span> <span class="ow">and</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot change model parameters after training!&quot;</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        <span class="k">if</span> <span class="n">purpose</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;continuing&quot;</span><span class="p">,</span> <span class="s2">&quot;prediction&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">load_episode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>            <span class="n">read_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">load_episode</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>                <span class="n">read_parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">],</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ssl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>                <span class="n">read_parameters</span><span class="p">[</span><span class="s2">&quot;ssl&quot;</span><span class="p">],</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ssl&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>            <span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>        <span class="k">if</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">pars_update</span><span class="p">:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>            <span class="n">model_params</span> <span class="o">=</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>            <span class="n">model_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="k">if</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">pars_update</span><span class="p">:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>            <span class="n">feat_params</span> <span class="o">=</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>            <span class="n">feat_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>        <span class="k">if</span> <span class="s2">&quot;augmentations&quot;</span> <span class="ow">in</span> <span class="n">pars_update</span><span class="p">:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>            <span class="n">aug_params</span> <span class="o">=</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;augmentations&quot;</span><span class="p">)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>            <span class="n">aug_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">pars_update</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="k">if</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_name&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>            <span class="n">model_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>            <span class="p">)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="k">if</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>            <span class="n">feat_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feat_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>                <span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>            <span class="p">)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>            <span class="n">aug_name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">extractor_to_transformer</span><span class="p">[</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>            <span class="p">]</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aug_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                <span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>            <span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="k">if</span> <span class="n">model_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">model_params</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="k">if</span> <span class="n">feat_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">feat_params</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="k">if</span> <span class="n">aug_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">],</span> <span class="n">aug_params</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>            <span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>        <span class="k">if</span> <span class="n">load_search</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_with_search</span><span class="p">(</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>                <span class="n">parameters</span><span class="p">,</span> <span class="n">load_search</span><span class="p">,</span> <span class="n">load_parameters</span><span class="p">,</span> <span class="n">round_to_binary</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>            <span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span><span class="p">(</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>            <span class="n">only_load_model</span><span class="o">=</span><span class="p">(</span><span class="n">purpose</span> <span class="o">!=</span> <span class="s2">&quot;continuing&quot;</span><span class="p">),</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>            <span class="n">continuing</span><span class="o">=</span><span class="p">(</span><span class="n">purpose</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;continuing&quot;</span><span class="p">]),</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>            <span class="n">enforce_split_parameters</span><span class="o">=</span><span class="p">(</span><span class="n">purpose</span> <span class="o">==</span> <span class="s2">&quot;prediction&quot;</span><span class="p">),</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>        <span class="p">)</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">parameters_update_second</span><span class="p">)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>        <span class="k">return</span> <span class="n">parameters</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>    <span class="k">def</span> <span class="nf">_make_task</span><span class="p">(</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>        <span class="n">parameters_update_second</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>        <span class="n">purpose</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TaskDispatcher</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">CommentedMap</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]:</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">        Make a `TaskDispatcher` object</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        The task parameters are read from the config files and then updated with the</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">        parameters_update dictionary. The model can be either initialized from scratch or loaded from one of the</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">        previous experiments. All parameters and results are saved in the meta files and can be accessed with the</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        list_episodes() function. The train/test/validation split is saved and loaded from a file whenever the</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">        same split parameters are used. The pre-computed datasets are also saved and loaded whenever the same</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">        data parameters are used.</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">        Parameters</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">        ----------</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">        episode_name : str</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">            the name of the episode</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="sd">            the (previously run) episode name to load the model from</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">            the dictionary used to update the parameters from the config</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">        parameters_update_second : dict, optional</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a><span class="sd">            the dictionary used to update the parameters after the automatic fill-out</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a><span class="sd">            the epoch to load (if load_episodes is not None); if not provided, the last epoch is used</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">        load_search : str, optional</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a><span class="sd">            the hyperparameter search result to load</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a><span class="sd">        load_parameters : list, optional</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="sd">            a list of string names of the parameters to load from load_search (if not provided, all parameters</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="sd">            are loaded)</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="sd">        round_to_binary : list, optional</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="sd">            a list of string names of the loaded parameters that should be rounded to the nearest power of two</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="sd">        purpose : {&quot;train&quot;, &quot;continuing&quot;, &quot;prediction&quot;}</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">            the purpose of the task object (`&quot;train&quot;` for training from scratch, `&quot;continuing&quot;` for continuing</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">            the training of an interrupted episode, `&quot;prediction&quot;` for generating a prediction)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">        task : TaskDispatcher, optional</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">            a pre-existing task; if provided, the method will update the task instead of creating a new one</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">            (this might save time, mainly on dataset loading)</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">        Returns</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">        -------</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">        task : TaskDispatcher</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">            the `TaskDispatcher` instance</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">        parameters : dict</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">            the parameters dictionary that describes the task</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_parameters</span><span class="p">(</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>            <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>            <span class="n">parameters_update_second</span><span class="p">,</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>            <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>            <span class="n">load_search</span><span class="p">,</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>            <span class="n">load_parameters</span><span class="p">,</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>            <span class="n">round_to_binary</span><span class="p">,</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>            <span class="n">purpose</span><span class="p">,</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="p">)</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotation_type&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                <span class="n">parameters</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;behavior_dictionary&quot;</span><span class="p">:</span> <span class="n">behaviors</span><span class="p">}}</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>            <span class="p">)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="k">if</span> <span class="n">task</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="n">TaskDispatcher</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>            <span class="n">task</span><span class="o">.</span><span class="n">update_task</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="k">return</span> <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>    <span class="k">def</span> <span class="nf">run_episode</span><span class="p">(</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>        <span class="n">n_seeds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="n">suppress_name_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="n">autostop_metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="n">autostop_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>        <span class="n">autostop_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="n">loading_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>        <span class="n">trial</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskDispatcher</span><span class="p">:</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">        Run an episode</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="sd">        The task parameters are read from the config files and then updated with the</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">        parameters_update dictionary. The model can be either initialized from scratch or loaded from one of the</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">        previous experiments. All parameters and results are saved in the meta files and can be accessed with the</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">        list_episodes() function. The train/test/validation split is saved and loaded from a file whenever the</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">        same split parameters are used. The pre-computed datasets are also saved and loaded whenever the same</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">        data parameters are used.</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">        You can use the autostop parameters to finish training when the parameters are not improving. It will be</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">        stopped if the average value of `autostop_metric` over the last `autostop_interval` epochs is smaller than</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        the average over the previous `autostop_interval` epochs + `autostop_threshold`. For example, if the</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">        current epoch is 120 and `autostop_interval` is 50, the averages over epochs 70-120 and 20-70 will be compared.</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a><span class="sd">        Parameters</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd">        ----------</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a><span class="sd">        episode_name : str</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="sd">            the episode name</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="sd">            the (previously run) episode name to load the model from; if the episode has multiple runs,</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a><span class="sd">            the new episode will have the same number of runs, each starting with one of the pre-trained models</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">            the dictionary used to update the parameters from the config files</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">        task : TaskDispatcher, optional</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">            a pre-existing `TaskDispatcher` object (if provided, the method will update it instead of creating</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">            a new instance)</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">            the epoch to load (if load_episodes is not None); if not provided, the last epoch is used</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">        load_search : str, optional</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">            the hyperparameter search result to load</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">        load_parameters : list, optional</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">            a list of string names of the parameters to load from load_search (if not provided, all parameters</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="sd">            are loaded)</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="sd">        round_to_binary : list, optional</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">            a list of string names of the loaded parameters that should be rounded to the nearest power of two</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">        load_strict : bool, default True</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">            if `False`, matching weights will be loaded from `load_episode` and differences in parameter name lists and</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">            weight shapes will be ignored; otherwise mismatches will prompt a `RuntimeError`</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        n_seeds : int, default 1</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">            the number of runs to perform with different random seeds; if `n_seeds &gt; 1`, the episodes will be named</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">            `episode_name#seed_index`, e.g. `test_episode#0` and `test_episode#1`</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">        force : bool, default False</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">            if `True` and an episode with name `episode_name` already exists, it will be overwritten (use with caution!)</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">        suppress_name_check : bool, default False</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">            if `True`, episode names with a double colon are allowed (please don&#39;t use this option unless you understand</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">            why they are usually forbidden)</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="sd">            if `True`, the dataset will be deleted after training</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">        mask_name : str, optional</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="sd">            the name of the real_lens to apply</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">        autostop_interval : int, default 50</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">            the number of epochs to average the autostop metric over</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="sd">        autostop_threshold : float, default 0.001</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">            the autostop difference threshold</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">        autostop_metric : str, optional</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">            the autostop metric (can be any one of the tracked metrics of `&#39;loss&#39;`)</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span> <span class="ow">or</span> <span class="n">n_seeds</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>                <span class="sa">f</span><span class="s2">&quot;The n_seeds parameter has to be an integer larger than 0; got </span><span class="si">{</span><span class="n">n_seeds</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>            <span class="p">)</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>        <span class="k">if</span> <span class="n">n_seeds</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mask_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot apply a real_lens with n_seeds &gt; 1&quot;</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_episode_validity</span><span class="p">(</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>            <span class="n">episode_name</span><span class="p">,</span> <span class="n">allow_doublecolon</span><span class="o">=</span><span class="n">suppress_name_check</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>        <span class="p">)</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>        <span class="n">load_runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">load_episode</span><span class="p">)</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">load_runs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_episodes</span><span class="p">(</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>                <span class="n">episode_names</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s1">#</span><span class="si">{</span><span class="n">run</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">load_runs</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                <span class="p">],</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                <span class="n">load_episodes</span><span class="o">=</span><span class="n">load_runs</span><span class="p">,</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                <span class="n">parameters_updates</span><span class="o">=</span><span class="p">[</span><span class="n">parameters_update</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                <span class="n">load_epochs</span><span class="o">=</span><span class="p">[</span><span class="n">load_epoch</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                <span class="n">load_searches</span><span class="o">=</span><span class="p">[</span><span class="n">load_search</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>                <span class="n">load_parameters</span><span class="o">=</span><span class="p">[</span><span class="n">load_parameters</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>                <span class="n">round_to_binary</span><span class="o">=</span><span class="p">[</span><span class="n">round_to_binary</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>                <span class="n">load_strict</span><span class="o">=</span><span class="p">[</span><span class="n">load_strict</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>                <span class="n">suppress_name_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>                <span class="n">remove_saved_features</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>            <span class="p">)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>            <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>                    <span class="p">{</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>                        <span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">general_parameters</span><span class="p">,</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>                        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">data_parameters</span><span class="p">,</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>                        <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">feature_parameters</span><span class="p">,</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>                    <span class="p">}</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>                <span class="p">)</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>            <span class="k">if</span> <span class="n">n_seeds</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>                    <span class="sa">f</span><span class="s2">&quot;The n_seeds parameter is disregarded since load_episode=</span><span class="si">{</span><span class="n">load_episode</span><span class="si">}</span><span class="s2"> has multiple runs&quot;</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>                <span class="p">)</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="k">elif</span> <span class="n">n_seeds</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_episodes</span><span class="p">(</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>                <span class="n">episode_names</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>                <span class="n">load_episodes</span><span class="o">=</span><span class="p">[</span><span class="n">load_episode</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>                <span class="n">parameters_updates</span><span class="o">=</span><span class="p">[</span><span class="n">parameters_update</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>                <span class="n">load_epochs</span><span class="o">=</span><span class="p">[</span><span class="n">load_epoch</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>                <span class="n">load_searches</span><span class="o">=</span><span class="p">[</span><span class="n">load_search</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>                <span class="n">load_parameters</span><span class="o">=</span><span class="p">[</span><span class="n">load_parameters</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>                <span class="n">round_to_binary</span><span class="o">=</span><span class="p">[</span><span class="n">round_to_binary</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>                <span class="n">load_strict</span><span class="o">=</span><span class="p">[</span><span class="n">load_strict</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>                <span class="n">suppress_name_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>                <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAINING </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>                <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>                    <span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>                    <span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>                    <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>                    <span class="n">load_search</span><span class="p">,</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>                    <span class="n">load_parameters</span><span class="p">,</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>                    <span class="n">round_to_binary</span><span class="p">,</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>                    <span class="n">continuing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>                    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>                    <span class="n">mask_name</span><span class="o">=</span><span class="n">mask_name</span><span class="p">,</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>                    <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>                <span class="p">)</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_save_episode</span><span class="p">(</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>                    <span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>                    <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">(),</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>                    <span class="n">norm_stats</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">get_normalization_stats</span><span class="p">(),</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>                <span class="p">)</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>                <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>                <span class="k">if</span> <span class="n">trial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>                    <span class="n">trial</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="n">trial</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>                    <span class="n">trial</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>                <span class="n">logs</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>                    <span class="n">autostop_metric</span><span class="o">=</span><span class="n">autostop_metric</span><span class="p">,</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>                    <span class="n">autostop_interval</span><span class="o">=</span><span class="n">autostop_interval</span><span class="p">,</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                    <span class="n">autostop_threshold</span><span class="o">=</span><span class="n">autostop_threshold</span><span class="p">,</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>                    <span class="n">loading_bar</span><span class="o">=</span><span class="n">loading_bar</span><span class="p">,</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>                    <span class="n">trial</span><span class="o">=</span><span class="n">trial</span><span class="p">,</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>                    <span class="n">optimized_metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>                <span class="p">)</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>                <span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>                <span class="n">time_total</span> <span class="o">=</span> <span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>                <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>                <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>                <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>                <span class="n">training_time</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">minutes</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">seconds</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_results</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">logs</span><span class="p">,</span> <span class="n">training_time</span><span class="p">)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>                <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>                <span class="k">return</span> <span class="n">task</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">optuna</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">TrialPruned</span><span class="p">):</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                    <span class="c1"># if str(e) != f&quot;The {episode_name} episode name is already in use!&quot;:</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>                    <span class="c1">#     self.remove_episode(episode_name)</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Episode </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> could not run&quot;</span><span class="p">)</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>    <span class="k">def</span> <span class="nf">run_episodes</span><span class="p">(</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>        <span class="n">load_episodes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>        <span class="n">parameters_updates</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="n">load_searches</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>        <span class="n">suppress_name_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskDispatcher</span><span class="p">:</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">        Run multiple episodes in sequence (and re-use previously loaded information)</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">        For each episode, the task parameters are read from the config files and then updated with the</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">        parameter_update dictionary. The model can be either initialized from scratch or loaded from one of the</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">        previous experiments. All parameters and results are saved in the meta files and can be accessed with the</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">        list_episodes() function. The train/test/validation split is saved and loaded from a file whenever the</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">        same split parameters are used. The pre-computed datasets are also saved and loaded whenever the same</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">        data parameters are used.</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a><span class="sd">        Parameters</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="sd">        ----------</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="sd">        episode_names : list</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">            a list of strings of episode names</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">        load_episodes : list, optional</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">            a list of strings of (previously run) episode names to load the model from; if the episode has multiple runs,</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="sd">            the new episode will have the same number of runs, each starting with one of the pre-trained models</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="sd">        parameters_updates : list, optional</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="sd">            a list of dictionaries used to update the parameters from the config</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">        load_epochs : list, optional</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">            a list of integers used to specify the epoch to load (if load_episodes is not None)</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">        load_searches : list, optional</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">            a list of strings of hyperparameter search results to load</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">        load_parameters : list, optional</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">            a list of lists of string names of the parameters to load from the searches</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">        round_to_binary : list, optional</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">            a list of string names of the loaded parameters that should be rounded to the nearest power of two</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">        load_strict : list, optional</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">            a list of boolean values specifying weight loading policy: if `False`, matching weights will be loaded from</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">            the corresponding episode and differences in parameter name lists and</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">            weight shapes will be ignored; otherwise mismatches will prompt a `RuntimeError` (by default `True` for</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">            every episode)</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">        force : bool, default False</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">            if `True` and an episode name is already taken, it will be overwritten (use with caution!)</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">        suppress_name_check : bool, default False</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">            if `True`, episode names with a double colon are allowed (please don&#39;t use this option unless you understand</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">            why they are usually forbidden)</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">            if `True`, the dataset will be deleted after training</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>        <span class="n">task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>        <span class="k">if</span> <span class="n">load_searches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>            <span class="n">load_searches</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="k">if</span> <span class="n">load_episodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>            <span class="n">load_episodes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>        <span class="k">if</span> <span class="n">parameters_updates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>            <span class="n">parameters_updates</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>        <span class="k">if</span> <span class="n">load_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>            <span class="n">load_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="k">if</span> <span class="n">load_epochs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>            <span class="n">load_epochs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="k">if</span> <span class="n">load_strict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>            <span class="n">load_strict</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="k">for</span> <span class="p">(</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>            <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>            <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>            <span class="n">load_search</span><span class="p">,</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>            <span class="n">load_parameters_list</span><span class="p">,</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>            <span class="n">load_strict_value</span><span class="p">,</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>        <span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>            <span class="n">parameters_updates</span><span class="p">,</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>            <span class="n">episode_names</span><span class="p">,</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>            <span class="n">load_episodes</span><span class="p">,</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="n">load_searches</span><span class="p">,</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>            <span class="n">load_parameters</span><span class="p">,</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>            <span class="n">load_strict</span><span class="p">,</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>        <span class="p">):</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_episode</span><span class="p">(</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>                <span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>                <span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>                <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>                <span class="n">task</span><span class="p">,</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>                <span class="n">load_search</span><span class="p">,</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                <span class="n">load_parameters_list</span><span class="p">,</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>                <span class="n">round_to_binary</span><span class="p">,</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>                <span class="n">load_strict_value</span><span class="p">,</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>                <span class="n">suppress_name_check</span><span class="o">=</span><span class="n">suppress_name_check</span><span class="p">,</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>                <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>            <span class="p">)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>        <span class="k">return</span> <span class="n">task</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>    <span class="k">def</span> <span class="nf">continue_episode</span><span class="p">(</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>        <span class="n">num_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>        <span class="n">n_seeds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="n">num_cpus</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskDispatcher</span><span class="p">:</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        Load an older episode and continue running from the latest checkpoint</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">        All parameters as well as the model and optimizer state dictionaries are loaded from the episode.</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">        Parameters</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">        ----------</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">        episode_name : str</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">            the name of the episode to continue</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="sd">        num_epochs : int, optional</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">            the new number of epochs</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="sd">        task : TaskDispatcher, optional</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">            a pre-existing task; if provided, the method will update the task instead of creating a new one</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">            (this might save time, mainly on dataset loading)</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">        result_average_interval : int, default 5</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">            the metric are averaged over the last result_average_interval to be stored in the episodes meta file</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">            and displayed by list_episodes() function (the full log is still always available)</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">        n_seeds : int, default 1</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">            the number of runs to perform; if `n_seeds &gt; 1`, the episodes will be named `episode_name#run_index`, e.g.</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">            `test_episode#0` and `test_episode#1`</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">            if `True`, pre-computed features will be deleted after the run</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="sd">        device : str, default &quot;cuda&quot;</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">            the torch device to use</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAINING </span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>            <span class="k">if</span> <span class="n">num_epochs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">unfinished</span><span class="p">():</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>                <span class="k">continue</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>                <span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                    <span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="n">num_epochs</span><span class="p">,</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>                    <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>                <span class="p">},</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>                <span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;num_cpus&quot;</span><span class="p">:</span> <span class="n">num_cpus</span><span class="p">},</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>            <span class="p">}</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>                <span class="n">run</span><span class="p">,</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>                <span class="n">load_episode</span><span class="o">=</span><span class="n">run</span><span class="p">,</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>                <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>                <span class="n">continuing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>                <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="p">)</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>            <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="n">logs</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>            <span class="n">old_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_training_time</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">old_time</span><span class="p">):</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                <span class="n">time_end</span> <span class="o">+=</span> <span class="n">old_time</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                <span class="n">time_total</span> <span class="o">=</span> <span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>                <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>                <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span><span class="p">)</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>                <span class="n">training_time</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">minutes</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">seconds</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>                <span class="n">training_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_episode</span><span class="p">(</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>                <span class="n">run</span><span class="p">,</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>                <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>                <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">(),</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>                <span class="n">suppress_validation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>                <span class="n">training_time</span><span class="o">=</span><span class="n">training_time</span><span class="p">,</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>                <span class="n">norm_stats</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">get_normalization_stats</span><span class="p">(),</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>            <span class="p">)</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_results</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">logs</span><span class="p">)</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_seeds</span><span class="p">:</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">),</span> <span class="n">n_seeds</span><span class="p">):</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">run_episode</span><span class="p">(</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                    <span class="n">parameters_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>                    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>                    <span class="n">suppress_name_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>                <span class="p">)</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>        <span class="k">return</span> <span class="n">task</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>    <span class="k">def</span> <span class="nf">run_default_hyperparameter_search</span><span class="p">(</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="n">best_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;maximize&quot;</span><span class="p">,</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>        <span class="n">num_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="n">test_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="n">n_trials</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>    <span class="p">):</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="sd">        Run an optuna hyperparameter search with default parameters for a model</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">        For the vast majority of cases, optimizing the default parameters should be enough.</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="sd">        Check out `dlc2action.options.model_hyperparameters` for the lists of parameters.</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="sd">        There are also options to set overlap, test fraction and number of epochs parameters for the search without</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="sd">        modifying the project config files. However, if you want something more complex, look into</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="sd">        `Project.run_hyperparameter_search`.</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">        The task parameters are read from the config files and updated with the parameters_update dictionary.</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">        The model can be either initialized from scratch or loaded from a previously run episode.</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">        For each trial, the objective metric is averaged over a few best epochs.</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">        Parameters</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">        ----------</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">        search_name : str</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">            the name of the search to store it in the meta files and load in run_episode</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">        model_name : str, optional</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">            the name of the model (by default loaded from the project settings, see `project.help(&#39;models&#39;)` for options)</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">        metric : str, default f1</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">            the metric to maximize/minimize (see direction); if the metric has an `&quot;average&quot;` parameter and it is set to</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">            `&quot;none&quot;` in the config files, it will be reset to `&quot;macro&quot;` for the search; see `project.help(&#39;metrics&#39;)` for options</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">        n_trials : int, default 20</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">            the number of optimization trials to run</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a><span class="sd">        best_n : int, default 1</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">            the number of epochs to average the metric; if 0, the last value is taken</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a><span class="sd">            the parameters update dictionary</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a><span class="sd">        direction : {&#39;maximize&#39;, &#39;minimize&#39;}</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a><span class="sd">            optimization direction</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a><span class="sd">            the name of the episode to load the model from</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a><span class="sd">            the epoch to load the model from (if not provided, the last checkpoint is used)</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a><span class="sd">        prune : bool, default False</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="sd">            if `True`, experiments where the optimized metric is improving too slowly will be terminated</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a><span class="sd">            (with optuna HyperBand pruner)</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="sd">        force : bool, default False</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a><span class="sd">            if `True`, existing searches with the same name will be overwritten</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="sd">            if `True`, pre-computed features will be deleted after each run (if the data parameters change)</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a><span class="sd">        device : str, optional</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a><span class="sd">            cuda:{i} or cpu, if not given it is read from the default parameters</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a><span class="sd">        Returns</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a><span class="sd">        -------</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a><span class="sd">        dict</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">            a dictionary of best parameters</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>            <span class="n">model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">model_hyperparameters</span><span class="p">:</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                <span class="sa">f</span><span class="s2">&quot;There is no default search space for </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">! Please choose from </span><span class="si">{</span><span class="n">options</span><span class="o">.</span><span class="n">model_hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2"> or try project.run_hyperparameter_search()&quot;</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>            <span class="p">)</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>        <span class="n">pars</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>            <span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>                <span class="s2">&quot;overlap&quot;</span><span class="p">:</span> <span class="n">overlap</span><span class="p">,</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>                <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>                <span class="s2">&quot;metric_functions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">metric</span><span class="p">},</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>            <span class="p">},</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>            <span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="n">num_epochs</span><span class="p">},</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="p">}</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>        <span class="k">if</span> <span class="n">test_frac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;test_frac&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_frac</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">metric</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>            <span class="n">project_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>            <span class="k">if</span> <span class="n">project_pars</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;average&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>                <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">metric</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="s2">&quot;macro&quot;</span><span class="p">}}</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;device&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_hyperparameter_search</span><span class="p">(</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>            <span class="n">search_name</span><span class="o">=</span><span class="n">search_name</span><span class="p">,</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>            <span class="n">search_space</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">model_hyperparameters</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>            <span class="n">best_n</span><span class="o">=</span><span class="n">best_n</span><span class="p">,</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">pars</span><span class="p">,</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>            <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>            <span class="n">prune</span><span class="o">=</span><span class="n">prune</span><span class="p">,</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>            <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>            <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>        <span class="p">)</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>    <span class="k">def</span> <span class="nf">run_hyperparameter_search</span><span class="p">(</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>        <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>        <span class="n">n_trials</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>        <span class="n">best_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;maximize&quot;</span><span class="p">,</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>        <span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="sd">        Run an optuna hyperparameter search</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">        For a simpler function that fits most use cases, check out `Project.run_default_hyperparameter_search()`.</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">        To use a default search space with this method, import `dlc2action.options.model_hyperparameters`. It is</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a><span class="sd">        a dictionary where keys are model names and values are default search spaces.</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">        The task parameters are read from the config files and updated with the parameters_update dictionary.</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">        The model can be either initialized from scratch or loaded from a previously run episode.</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">        For each trial, the objective metric is averaged over a few best epochs.</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">        Parameters</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">        ----------</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">        search_name : str</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">            the name of the search to store it in the meta files and load in run_episode</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">        search_space : dict</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="sd">            a dictionary representing the search space; of this general structure:</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">            {&#39;group/param_name&#39;: (&#39;float/int/float_log/int_log&#39;, start, end),</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a><span class="sd">            &#39;group/param_name&#39;: (&#39;categorical&#39;, [choices])}, e.g.</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">            {&#39;data/overlap&#39;: (&#39;int&#39;, 5, 100), &#39;training/lr&#39;: (&#39;float_log&#39;, 1e-4, 1e-2),</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="sd">            &#39;data/feature_extraction&#39;: (&#39;categorical&#39;, [&#39;kinematic&#39;, &#39;bones&#39;])};</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a><span class="sd">        metric : str, default f1</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a><span class="sd">            the metric to maximize/minimize (see direction)</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a><span class="sd">        n_trials : int, default 20</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">            the number of optimization trials to run</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="sd">        best_n : int, default 1</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="sd">            the number of epochs to average the metric; if 0, the last value is taken</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a><span class="sd">            the parameters update dictionary</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">        direction : {&#39;maximize&#39;, &#39;minimize&#39;}</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a><span class="sd">            optimization direction</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="sd">            the name of the episode to load the model from</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">            the epoch to load the model from (if not provided, the last checkpoint is used)</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">        prune : bool, default False</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">            if `True`, experiments where the optimized metric is improving too slowly will be terminated</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">            (with optuna HyperBand pruner)</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">        force : bool, default False</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a><span class="sd">            if `True`, existing searches with the same name will be overwritten</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a><span class="sd">            if `True`, pre-computed features will be deleted after each run (if the data parameters change)</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="sd">        Returns</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">        -------</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="sd">        dict</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a><span class="sd">            a dictionary of best parameters</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_search_validity</span><span class="p">(</span><span class="n">search_name</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SEARCH </span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>        <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>            <span class="n">parameters_update</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;metric_functions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">metric</span><span class="p">}}}</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>        <span class="p">)</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_parameters</span><span class="p">(</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>            <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>            <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>            <span class="n">parameters_update_second</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model_save_path&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}},</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>        <span class="p">)</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>        <span class="n">task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>        <span class="k">if</span> <span class="n">prune</span><span class="p">:</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>            <span class="n">pruner</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">pruners</span><span class="o">.</span><span class="n">HyperbandPruner</span><span class="p">()</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>            <span class="n">pruner</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">pruners</span><span class="o">.</span><span class="n">NopPruner</span><span class="p">()</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>        <span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span> <span class="n">pruner</span><span class="o">=</span><span class="n">pruner</span><span class="p">)</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>        <span class="n">runner</span> <span class="o">=</span> <span class="n">_Runner</span><span class="p">(</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>            <span class="n">search_space</span><span class="o">=</span><span class="n">search_space</span><span class="p">,</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>            <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>            <span class="n">average</span><span class="o">=</span><span class="n">best_n</span><span class="p">,</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>            <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>            <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>            <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>            <span class="n">search_name</span><span class="o">=</span><span class="n">search_name</span><span class="p">,</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>        <span class="p">)</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>        <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">parameters</span><span class="p">),</span> <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">)</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>        <span class="n">search_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_path</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">search_path</span><span class="p">)</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_contour</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>        <span class="n">plotly</span><span class="o">.</span><span class="n">offline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">_contour.html&quot;</span><span class="p">)</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>        <span class="p">)</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_param_importances</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>        <span class="n">plotly</span><span class="o">.</span><span class="n">offline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">_importances.html&quot;</span><span class="p">)</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>        <span class="p">)</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>        <span class="n">best_params</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>        <span class="n">best_value</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_value</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_search</span><span class="p">(</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>            <span class="n">search_name</span><span class="p">,</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>            <span class="n">n_trials</span><span class="p">,</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>            <span class="n">best_params</span><span class="p">,</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>            <span class="n">best_value</span><span class="p">,</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>            <span class="n">metric</span><span class="p">,</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>            <span class="n">search_space</span><span class="p">,</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>        <span class="p">)</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>        <span class="n">runner</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;best parameters: </span><span class="si">{</span><span class="n">best_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>        <span class="k">return</span> <span class="n">best_params</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>    <span class="k">def</span> <span class="nf">run_prediction</span><span class="p">(</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>        <span class="n">submission</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>        <span class="n">frame_number_map_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>        <span class="n">embedding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">        Load models from previously run episodes to generate a prediction</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="sd">        The probabilities predicted by the models are averaged.</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="sd">        Unless `submission` is `True`, the prediction results are saved as a pickled dictionary in the project_name/results/predictions folder</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a><span class="sd">        under the {episode_name}_{load_epoch}.pickle name. The file is a nested dictionary where the first-level</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a><span class="sd">        keys are the video ids, the second-level keys are the clip ids (like individual names) and the values</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a><span class="sd">        are the prediction arrays.</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a><span class="sd">        Parameters</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a><span class="sd">        ----------</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a><span class="sd">        prediction_name : str</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a><span class="sd">            the name of the prediction</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a><span class="sd">        episode_names : list</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a><span class="sd">            a list of string episode names to load the models from</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a><span class="sd">        load_epochs : list, optional</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a><span class="sd">            a list of integer epoch indices to load the model from; if None, the last ones are used</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a><span class="sd">            a dictionary of parameter updates</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="sd">        augment_n : int, default 10</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">            the number of augmentations to average over</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">            the data path to run the prediction for</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a><span class="sd">        mode : {&#39;all&#39;, &#39;test&#39;, &#39;val&#39;, &#39;train&#39;}</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None)</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a><span class="sd">            a set of string file paths (data with all prefixes + feature files, in any order) to run the prediction</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">            for</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">            if `True`, pre-computed features will be deleted</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a><span class="sd">        submission : bool, default False</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">            if `True`, a MABe-22 style submission file is generated</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="sd">        frame_number_map_file : str, optional</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="sd">            path to the frame number map file</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">        force : bool, default False</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">            if `True`, existing prediction with this name will be overwritten</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_prediction_validity</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PREDICTION </span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>        <span class="k">if</span> <span class="n">submission</span><span class="p">:</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>            <span class="c1"># TODO: add submission option to _make_prediction</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>            <span class="n">predicted</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">generate_submission</span><span class="p">(</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>                <span class="n">frame_number_map_file</span><span class="o">=</span><span class="n">frame_number_map_file</span><span class="p">,</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>                <span class="n">dataset</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>                <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>            <span class="p">)</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>            <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>                <span class="s2">&quot;results&quot;</span><span class="p">,</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>                <span class="s2">&quot;predictions&quot;</span><span class="p">,</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>            <span class="p">)</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">predicted</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>                <span class="p">(</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_prediction</span><span class="p">(</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>                    <span class="n">prediction_name</span><span class="p">,</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>                    <span class="n">data_path</span><span class="p">,</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>                    <span class="n">file_paths</span><span class="p">,</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>                    <span class="n">augment_n</span><span class="p">,</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>                    <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>                <span class="p">)</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>                <span class="n">predicted</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span><span class="o">.</span><span class="n">generate_full_length_prediction</span><span class="p">(</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>                    <span class="n">prediction</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>                <span class="p">)</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>                <span class="p">(</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>                    <span class="n">predicted</span><span class="p">,</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_predictions</span><span class="p">(</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>                    <span class="n">prediction_name</span><span class="p">,</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>                    <span class="n">data_path</span><span class="p">,</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>                    <span class="n">file_paths</span><span class="p">,</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>                    <span class="n">augment_n</span><span class="p">,</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>                    <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>                <span class="p">)</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>            <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_path</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">)</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>            <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">predicted</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>                        <span class="n">folder</span><span class="p">,</span> <span class="n">video_id</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">_prediction.pickle&quot;</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>                    <span class="p">),</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>                    <span class="s2">&quot;wb&quot;</span><span class="p">,</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>                    <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;min_frames&quot;</span><span class="p">],</span> <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;max_frames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>                        <span class="n">mode</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">get_min_max_frames</span><span class="p">(</span><span class="n">video_id</span><span class="p">)</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>                    <span class="n">behavior_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>                        <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>                    <span class="p">)</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>                    <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;behaviors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>                        <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">behavior_indices</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>                    <span class="p">]</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_prediction</span><span class="p">(</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>            <span class="n">prediction_name</span><span class="p">,</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>            <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">(),</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>            <span class="n">embedding</span><span class="p">,</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>            <span class="n">inference_time</span><span class="p">,</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>        <span class="p">)</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>    <span class="k">def</span> <span class="nf">evaluate_prediction</span><span class="p">(</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;predictions&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">.pickle&quot;</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>            <span class="p">),</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>            <span class="s2">&quot;rb&quot;</span><span class="p">,</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>            <span class="n">prediction</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>        <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">),</span> <span class="n">parameters_update</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>        <span class="p">)</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>        <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>            <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>            <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>        <span class="p">)</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">evaluate_prediction</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>        <span class="n">multiple_episode_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;average&quot;</span><span class="p">,</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>        <span class="n">skip_updating_meta</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">        Load one or several models from previously run episodes to make an evaluation</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">        By default it will run on the test (or validation, if there is no test) subset of the project dataset.</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">        Parameters</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">        ----------</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">        episode_names : list</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">            a list of string episode names to load the models from</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">        load_epochs : list, optional</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">            a list of integer epoch indices to load the model from; if None, the last ones are used</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a><span class="sd">        augment_n : int, default 0</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="sd">            the number of augmentations to average over</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a><span class="sd">            the data path to run the prediction for</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a><span class="sd">            a set of files to run the prediction for</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a><span class="sd">        mode : {&#39;test&#39;, &#39;val&#39;, &#39;train&#39;, &#39;all&#39;}</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None;</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a><span class="sd">            by default &#39;test&#39; if test subset is not empty and &#39;val&#39; otherwise)</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a><span class="sd">            a dictionary with parameter updates (cannot change model parameters)</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a><span class="sd">            if `True`, the dataset will be deleted</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a><span class="sd">        Returns</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a><span class="sd">        -------</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a><span class="sd">        metric : dict</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a><span class="sd">            a dictionary of average values of metric functions</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>            <span class="n">names</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">episode_names</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVALUATION </span><span class="si">{</span><span class="n">episode_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVALUATION </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>            <span class="n">evaluate</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>            <span class="n">evaluate</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>        <span class="k">if</span> <span class="n">multiple_episode_policy</span> <span class="o">==</span> <span class="s2">&quot;average&quot;</span><span class="p">:</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>                <span class="p">(</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_prediction</span><span class="p">(</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>                    <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>                    <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a>                    <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>                    <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="n">evaluate</span><span class="p">,</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>                <span class="p">)</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>                <span class="p">(</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_predictions</span><span class="p">(</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>                    <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>                    <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>                    <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>                    <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="n">evaluate</span><span class="p">,</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>                <span class="p">)</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AGGREGATED:&quot;</span><span class="p">)</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">evaluate_prediction</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skip_updating_meta</span><span class="p">:</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_metrics</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">results</span><span class="p">)</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>        <span class="k">elif</span> <span class="n">multiple_episode_policy</span> <span class="o">==</span> <span class="s2">&quot;statistics&quot;</span><span class="p">:</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>                <span class="p">(</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_prediction</span><span class="p">(</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>                    <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>                    <span class="p">[</span><span class="n">name</span><span class="p">],</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>                    <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>                    <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>                    <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="n">evaluate</span><span class="p">,</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>                    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>                <span class="p">)</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">evaluate_prediction</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skip_updating_meta</span><span class="p">:</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_metrics</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>            <span class="n">mean_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>            <span class="n">std_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>                <span class="n">mean_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>                <span class="n">std_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MEAN:&quot;</span><span class="p">)</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">mean_string</span><span class="p">)</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STD:&quot;</span><span class="p">)</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">std_string</span><span class="p">)</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">multiple_episode_policy</span><span class="si">}</span><span class="s2"> multiple episode policy is not recognized; please choose &quot;</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>                <span class="sa">f</span><span class="s2">&quot;from [&#39;average&#39;, &#39;statistics&#39;]&quot;</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>            <span class="p">)</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inference time: </span><span class="si">{</span><span class="n">inference_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>    <span class="k">def</span> <span class="nf">_generate_similarity_score</span><span class="p">(</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>        <span class="n">target_video_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>        <span class="n">target_clip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>        <span class="n">target_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>        <span class="n">target_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>                <span class="s2">&quot;results&quot;</span><span class="p">,</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>                <span class="s2">&quot;predictions&quot;</span><span class="p">,</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">.pickle&quot;</span><span class="p">,</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>            <span class="p">),</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>            <span class="s2">&quot;rb&quot;</span><span class="p">,</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>            <span class="n">prediction</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="n">target_video_id</span><span class="p">][</span><span class="n">target_clip</span><span class="p">][:,</span> <span class="n">target_start</span><span class="p">:</span><span class="n">target_end</span><span class="p">]</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>        <span class="n">score_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">prediction</span><span class="p">:</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">prediction</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>                <span class="n">score_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>                    <span class="n">target</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">prediction</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">score_dict</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>        <span class="k">return</span> <span class="n">score_dict</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>    <span class="k">def</span> <span class="nf">_suggest_intervals_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">score_dict</span><span class="p">,</span> <span class="n">min_length</span><span class="p">,</span> <span class="n">n_intervals</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>        <span class="n">interval_address</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>        <span class="n">interval_value</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>        <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">video_dict</span> <span class="ow">in</span> <span class="n">score_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>            <span class="k">for</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">video_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>                <span class="n">s</span> <span class="o">+=</span> <span class="n">value</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>        <span class="n">mean_value</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="n">n</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.75</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>            <span class="nb">id</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>            <span class="n">interval_address</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>            <span class="n">interval_value</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>            <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">video_dict</span> <span class="ow">in</span> <span class="n">score_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>                <span class="k">for</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">video_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>                    <span class="n">res_indices_start</span><span class="p">,</span> <span class="n">res_indices_end</span> <span class="o">=</span> <span class="n">apply_threshold</span><span class="p">(</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>                        <span class="n">value</span><span class="p">,</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>                        <span class="n">threshold</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.9</span><span class="o">**</span><span class="n">it</span><span class="p">))</span> <span class="o">*</span> <span class="n">mean_value</span><span class="p">,</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>                        <span class="n">low</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>                        <span class="n">error_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>                        <span class="n">min_frames</span><span class="o">=</span><span class="n">min_length</span><span class="p">,</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>                        <span class="n">smooth_interval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>                    <span class="p">)</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">res_indices_start</span><span class="p">,</span> <span class="n">res_indices_end</span><span class="p">):</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>                        <span class="n">interval_address</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">]</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>                        <span class="n">interval_value</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">score_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>                            <span class="n">start</span><span class="p">:</span><span class="n">end</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>                        <span class="nb">id</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">interval_address</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">n_intervals</span><span class="p">:</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>                <span class="k">break</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">interval_address</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_intervals</span><span class="p">:</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>                <span class="sa">f</span><span class="s2">&quot;Could not get </span><span class="si">{</span><span class="n">n_intervals</span><span class="si">}</span><span class="s2"> intervals from the data, saving the result with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">interval_address</span><span class="p">)</span><span class="si">}</span><span class="s2"> intervals&quot;</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>            <span class="p">)</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>        <span class="n">sorted_intervals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>            <span class="n">interval_value</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>        <span class="p">)</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>        <span class="n">output_intervals</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>            <span class="n">interval_address</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sorted_intervals</span><span class="p">[:</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_intervals</span><span class="p">),</span> <span class="n">n_intervals</span><span class="p">)]</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>        <span class="p">]</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>        <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">output_intervals</span><span class="p">:</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>            <span class="n">output</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">])</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>        <span class="k">return</span> <span class="n">output</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>    <span class="k">def</span> <span class="nf">list_episodes</span><span class="p">(</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>        <span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>        <span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>        <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a><span class="sd">        Get a filtered pandas dataframe with episode metadata</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a><span class="sd">        Parameters</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a><span class="sd">        ----------</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a><span class="sd">        episode_names : list</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a><span class="sd">            a list of strings of episode names</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a><span class="sd">        value_filter : str</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a><span class="sd">            a string of filters to apply; of this general structure:</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a><span class="sd">            &#39;group_name1/par_name1::(&lt;/&gt;/&lt;=/&gt;=/=)value1,group_name2/par_name2::(&lt;/&gt;/&lt;=/&gt;=/=)value2&#39;, e.g.</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a><span class="sd">            &#39;data/overlap::=50,results/recall::&gt;0.5,data/feature_extraction::=kinematic,meta/training_time::&gt;=00:00:10&#39;</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a><span class="sd">        display_parameters : list</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a><span class="sd">            list of parameters to display (e.g. [&#39;data/overlap&#39;, &#39;results/recall&#39;])</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a><span class="sd">        Returns</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a><span class="sd">        -------</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a><span class="sd">            the filtered dataframe</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>            <span class="n">episode_names</span><span class="p">,</span> <span class="n">value_filter</span><span class="p">,</span> <span class="n">display_parameters</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>        <span class="p">)</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TRAINING EPISODES&quot;</span><span class="p">)</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">episodes</span><span class="p">)</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>        <span class="k">return</span> <span class="n">episodes</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>    <span class="k">def</span> <span class="nf">list_predictions</span><span class="p">(</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>        <span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>        <span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a>        <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a><span class="sd">        Get a filtered pandas dataframe with prediction metadata</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a><span class="sd">        Parameters</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a><span class="sd">        ----------</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a><span class="sd">        episode_names : list</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a><span class="sd">            a list of strings of episode names</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a><span class="sd">        value_filter : str</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a><span class="sd">            a string of filters to apply; of this general structure:</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a><span class="sd">            &#39;group_name1/par_name1:(&lt;&gt;=)value1,group_name2/par_name2:(&lt;&gt;=)value2&#39;, e.g.</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a><span class="sd">            &#39;data/overlap:=50,results/recall:&gt;0.5,data/feature_extraction:=kinematic&#39;</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a><span class="sd">        display_parameters : list</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a><span class="sd">            list of parameters to display (e.g. [&#39;data/overlap&#39;, &#39;results/recall&#39;])</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a><span class="sd">        Returns</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a><span class="sd">        -------</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a><span class="sd">            the filtered dataframe</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>            <span class="n">episode_names</span><span class="p">,</span> <span class="n">value_filter</span><span class="p">,</span> <span class="n">display_parameters</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>        <span class="p">)</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PREDICTIONS&quot;</span><span class="p">)</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>        <span class="k">return</span> <span class="n">predictions</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>    <span class="k">def</span> <span class="nf">list_searches</span><span class="p">(</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>        <span class="n">search_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>        <span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>        <span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>        <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a><span class="sd">        Get a filtered pandas dataframe with hyperparameter search metadata</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a><span class="sd">        Parameters</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a><span class="sd">        ----------</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a><span class="sd">        search_names : list</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a><span class="sd">            a list of strings of search names</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a><span class="sd">        value_filter : str</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a><span class="sd">            a string of filters to apply; of this general structure:</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a><span class="sd">            &#39;group_name1/par_name1:(&lt;&gt;=)value1,group_name2/par_name2:(&lt;&gt;=)value2&#39;, e.g.</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a><span class="sd">            &#39;data/overlap:=50,results/recall:&gt;0.5,data/feature_extraction:=kinematic&#39;</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a><span class="sd">        display_parameters : list</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a><span class="sd">            list of parameters to display (e.g. [&#39;data/overlap&#39;, &#39;results/recall&#39;])</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a><span class="sd">        Returns</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a><span class="sd">        -------</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a><span class="sd">            the filtered dataframe</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>        <span class="n">searches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>            <span class="n">search_names</span><span class="p">,</span> <span class="n">value_filter</span><span class="p">,</span> <span class="n">display_parameters</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>        <span class="p">)</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SEARCHES&quot;</span><span class="p">)</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">searches</span><span class="p">)</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>        <span class="k">return</span> <span class="n">searches</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>    <span class="k">def</span> <span class="nf">get_best_parameters</span><span class="p">(</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>    <span class="p">):</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>        <span class="n">params</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">get_best_params</span><span class="p">(</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>            <span class="n">search_name</span><span class="p">,</span> <span class="n">round_to_binary</span><span class="o">=</span><span class="n">round_to_binary</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>        <span class="p">)</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">}})</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>        <span class="k">return</span> <span class="n">params</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>    <span class="k">def</span> <span class="nf">list_best_parameters</span><span class="p">(</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a><span class="sd">        Get the raw dictionary of best parameters found by a search</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a><span class="sd">        Parameters</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a><span class="sd">        ----------</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a><span class="sd">        search_name : str</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a><span class="sd">            the name of the search</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a><span class="sd">        Returns</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a><span class="sd">        -------</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a><span class="sd">        best_params : dict</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a><span class="sd">            a dictionary of the best parameters where the keys are in &#39;{group}/{name}&#39; format</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">get_best_params_raw</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SEARCH RESULTS </span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>        <span class="k">return</span> <span class="n">params</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>    <span class="k">def</span> <span class="nf">plot_episodes</span><span class="p">(</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>        <span class="n">modes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>        <span class="n">episode_labels</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>        <span class="n">add_hlines</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a>        <span class="n">epoch_limits</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>        <span class="n">colors</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>        <span class="n">add_highpoint_hlines</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a><span class="sd">        Plot episode training curves</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a><span class="sd">        Parameters</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a><span class="sd">        ----------</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a><span class="sd">        episode_names : list</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a><span class="sd">            a list of episode names to plot; to plot to episodes in one line combine them in a list</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a><span class="sd">            (e.g. [&#39;episode1&#39;, [&#39;episode2&#39;, &#39;episode3&#39;]] to plot episode2 and episode3 as one experiment)</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a><span class="sd">        metrics : list</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a><span class="sd">            a list of metric to plot</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a><span class="sd">        modes : list, optional</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a><span class="sd">            a list of modes to plot (&#39;train&#39; and/or &#39;val&#39;; `[&#39;val&#39;]` by default)</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a><span class="sd">        title : str, optional</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a><span class="sd">            title for the plot</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a><span class="sd">        episode_labels : list, optional</span>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a><span class="sd">            a list of strings used to label the curves (has to be the same length as episode_names)</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a><span class="sd">        save_path : str, optional</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a><span class="sd">            the path to save the resulting plot</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a><span class="sd">        add_hlines : list, optional</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a><span class="sd">            a list of float values (or (value, label) tuples) to mark with horizontal lines</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a><span class="sd">        colors: list, optional</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a><span class="sd">            a list of matplotlib colors</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a><span class="sd">        add_highpoint_hlines : bool, default False</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a><span class="sd">            if `True`, horizontal lines will be added at the highest value of each episode</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>        <span class="k">if</span> <span class="n">modes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>            <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>        <span class="k">if</span> <span class="n">add_hlines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>            <span class="n">add_hlines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>        <span class="n">logs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>        <span class="n">epochs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>        <span class="k">if</span> <span class="n">episode_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">episode_labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">episode_names</span><span class="p">)</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>        <span class="k">for</span> <span class="n">name_i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">episode_names</span><span class="p">):</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>            <span class="n">log_params</span> <span class="o">=</span> <span class="n">product</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">modes</span><span class="p">)</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>            <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">log_params</span><span class="p">:</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>                <span class="k">if</span> <span class="n">episode_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="n">episode_labels</span><span class="p">[</span><span class="n">name_i</span><span class="p">]</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>                    <span class="n">label</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>                    <span class="n">label</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>                    <span class="n">epoch_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>                    <span class="n">multi_logs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>                        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>                            <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>                                <span class="n">index</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>                                <span class="k">if</span> <span class="n">multi_logs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>                                    <span class="k">if</span> <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>                                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>                                            <span class="s2">&quot;The run indices are not consistent across episodes!&quot;</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>                                        <span class="p">)</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>                                        <span class="n">multi_logs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>                                <span class="n">multi_logs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>                                <span class="p">)</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>                                <span class="n">start</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>                                    <span class="mi">0</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>                                    <span class="k">else</span> <span class="n">epoch_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>                                <span class="p">)</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>                                <span class="n">epoch_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>                                    <span class="n">x</span> <span class="o">+</span> <span class="n">start</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>                                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>                                <span class="p">]</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>                            <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_logs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>                                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>                                    <span class="s2">&quot;Cannot plot a single-run episode after a multi-run episode!&quot;</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>                                <span class="p">)</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>                            <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>                            <span class="p">)</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>                            <span class="n">start</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>                                <span class="mi">0</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>                                <span class="k">else</span> <span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>                            <span class="p">)</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>                            <span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>                                <span class="n">x</span> <span class="o">+</span> <span class="n">start</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>                            <span class="p">]</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_logs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">])</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">multi_logs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;null&quot;</span><span class="p">])</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>                            <span class="nb">tuple</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">epoch_list</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;null&quot;</span><span class="p">])</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>                        <span class="p">)</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>                    <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>                        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>                            <span class="n">tracked_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">()</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>                            <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>                                    <span class="nb">list</span><span class="p">(</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>                                    <span class="p">)</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>                                <span class="p">)</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>                                <span class="n">relevant</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>                                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>                                    <span class="n">m_split</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>                                    <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>                                        <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m_split</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">metric</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>                                        <span class="ow">and</span> <span class="n">m_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>                                    <span class="p">):</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>                                        <span class="n">relevant</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>                                        <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> metric was not tracked at </span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>                                    <span class="p">)</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>                                <span class="n">arr</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>                                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>                                    <span class="n">arr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>                                <span class="n">arr</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>                            <span class="nb">tuple</span><span class="p">(</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>                                <span class="p">[</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>                                    <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>                                <span class="p">]</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>                            <span class="p">)</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>                        <span class="p">)</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>                        <span class="n">tracked_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">()</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>                        <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>                            <span class="n">log</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">))</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>                            <span class="n">relevant</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a>                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>                                <span class="n">m_split</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>                                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>                                    <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m_split</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">metric</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>                                    <span class="ow">and</span> <span class="n">m_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>                                <span class="p">):</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>                                    <span class="n">relevant</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>                                    <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> metric was not tracked at </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>                                <span class="p">)</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>                            <span class="n">arr</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>                                <span class="n">arr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>                            <span class="n">arr</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>                            <span class="n">log</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>                <span class="n">logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>        <span class="c1"># if episode_labels is not None:</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>        <span class="c1">#     print(f&#39;{len(episode_labels)=}, {len(logs)=}&#39;)</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>        <span class="c1">#     if len(episode_labels) != len(logs):</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>        <span class="c1">#         raise ValueError(</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>        <span class="c1">#             f&quot;The length of episode_labels ({len(episode_labels)}) has to be equal to the length of &quot;</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>        <span class="c1">#             f&quot;curves ({len(logs)})!&quot;</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>        <span class="c1">#         )</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>        <span class="c1">#     else:</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>        <span class="c1">#         labels = episode_labels</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>            <span class="n">colors</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">logs</span><span class="p">)))</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">logs</span><span class="p">):</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>                <span class="s2">&quot;The length of colors has to be equal to the length of curves (metrics * modes * episode_names)!&quot;</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>            <span class="p">)</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>        <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>        <span class="k">for</span> <span class="n">log</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">epoch_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">logs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">epochs</span><span class="p">):</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>                    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>                    <span class="n">epoch_list</span><span class="p">,</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>                    <span class="n">log</span><span class="p">,</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>                    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>                <span class="p">)</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>                <span class="k">if</span> <span class="n">add_highpoint_hlines</span><span class="p">:</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">log</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>                <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">xx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">epoch_list</span><span class="p">):</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>                        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>                        <span class="n">xx</span><span class="p">,</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>                        <span class="n">l</span><span class="p">,</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>                        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>                    <span class="p">)</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">log</span><span class="p">]):</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>                        <span class="sa">f</span><span class="s2">&quot;Got logs with unequal lengths in parallel runs for </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>                    <span class="p">)</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>                    <span class="n">log</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>                    <span class="n">epoch_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">)</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">):</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>                        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>                            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a>                                <span class="n">y_ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a>                                <span class="n">to_remove</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">y_ind</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>                        <span class="n">epoch_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>                            <span class="n">y</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_remove</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>                        <span class="p">]</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>                        <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">]</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>                    <span class="n">length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">log</span><span class="p">])</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)):</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a>                        <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="n">length</span><span class="p">]</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>                        <span class="n">epoch_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoch_list</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="n">length</span><span class="p">]</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">==</span> <span class="n">epoch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">epoch_list</span><span class="p">]):</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a>                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a>                            <span class="sa">f</span><span class="s2">&quot;Got different epoch indices in parallel runs for </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>                        <span class="p">)</span>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>                <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">log</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>                    <span class="n">epoch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a>                    <span class="n">mean</span><span class="p">,</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>                    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a>                <span class="p">)</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a>                <span class="k">if</span> <span class="n">add_highpoint_hlines</span><span class="p">:</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mean</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">add_hlines</span><span class="p">:</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;epochs&quot;</span><span class="p">)</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">episode_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">episode_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a>        <span class="k">if</span> <span class="n">epoch_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">epoch_limits</span><span class="p">)</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a>        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a>    <span class="k">def</span> <span class="nf">update_parameters</span><span class="p">(</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a><span class="sd">        Update the parameters in the project config files</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a><span class="sd">        Parameters</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a><span class="sd">        ----------</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a><span class="sd">            a dictionary of parameter updates</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a><span class="sd">        load_search : str, optional</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a><span class="sd">            the name of hyperparameter search results to load to config</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a><span class="sd">        load_parameters : list, optional</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a><span class="sd">            a list of lists of string names of the parameters to load from the searches</span>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a><span class="sd">        round_to_binary : list, optional</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a><span class="sd">            a list of string names of the loaded parameters that should be rounded to the nearest power of two</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>            <span class="s2">&quot;general&quot;</span><span class="p">,</span>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>            <span class="s2">&quot;losses&quot;</span><span class="p">,</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>            <span class="s2">&quot;metrics&quot;</span><span class="p">,</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>            <span class="s2">&quot;ssl&quot;</span><span class="p">,</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>            <span class="s2">&quot;training&quot;</span><span class="p">,</span>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a>        <span class="p">]</span>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">(</span><span class="n">catch_blanks</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a>            <span class="k">if</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">parameters_update</span><span class="p">:</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a>                <span class="n">model_params</span> <span class="o">=</span> <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a>                <span class="n">model_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a>            <span class="k">if</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">parameters_update</span><span class="p">:</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a>                <span class="n">feat_params</span> <span class="o">=</span> <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a>                <span class="n">feat_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a>            <span class="k">if</span> <span class="s2">&quot;augmentations&quot;</span> <span class="ow">in</span> <span class="n">parameters_update</span><span class="p">:</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a>                <span class="n">aug_params</span> <span class="o">=</span> <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;augmentations&quot;</span><span class="p">)</span>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a>                <span class="n">aug_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">parameters_update</span><span class="p">)</span>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a>            <span class="n">model_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a>            <span class="p">)</span>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a>            <span class="k">if</span> <span class="n">model_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">model_params</span><span class="p">)</span>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a>            <span class="n">feat_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feat_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a>                <span class="p">)</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a>            <span class="p">)</span>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a>            <span class="k">if</span> <span class="n">feat_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">feat_params</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a>                <span class="p">)</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a>            <span class="n">aug_name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">extractor_to_transformer</span><span class="p">[</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a>            <span class="p">]</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aug_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>                <span class="p">)</span>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>            <span class="p">)</span>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>            <span class="k">if</span> <span class="n">aug_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">],</span> <span class="n">aug_params</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>                <span class="p">)</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a>        <span class="k">if</span> <span class="n">load_search</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>            <span class="n">parameters_update</span><span class="p">,</span> <span class="n">model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">get_best_params</span><span class="p">(</span>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a>                <span class="n">load_search</span><span class="p">,</span> <span class="n">load_parameters</span><span class="p">,</span> <span class="n">round_to_binary</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>            <span class="p">)</span>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_name</span>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a>            <span class="p">)</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">parameters_update</span><span class="p">)</span>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a>                <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a>        <span class="n">model_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a>        <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a>        <span class="p">)</span>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a>            <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a>        <span class="n">features_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a>        <span class="n">features_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">features_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a>        <span class="p">)</span>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">features_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a>            <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a>        <span class="n">aug_name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">extractor_to_transformer</span><span class="p">[</span><span class="n">features_name</span><span class="p">]</span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a>        <span class="n">aug_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aug_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a>        <span class="p">)</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">aug_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a>            <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a>    <span class="k">def</span> <span class="nf">get_summary</span><span class="p">(</span>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a>        <span class="n">average</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a>        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a><span class="sd">        Get a summary of episode statistics</span>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a><span class="sd">        If the episode has multiple runs, the statistics will be aggregated over all of them.</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a><span class="sd">        Parameters</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a><span class="sd">        ----------</span>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a><span class="sd">        episode_name : str</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a><span class="sd">            the name of the episode</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a><span class="sd">        method : [&quot;best&quot;, &quot;last&quot;]</span>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a><span class="sd">            the method for choosing the epochs</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a><span class="sd">        average : int, default 1</span>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a><span class="sd">            the number of epochs to average over (for each run)</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a><span class="sd">        metrics : list, optional</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a><span class="sd">            a list of metrics</span>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a><span class="sd">        Returns</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a><span class="sd">        -------</span>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a><span class="sd">        statistics : dict</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a><span class="sd">            a nested dictionary where first-level keys are metric names and second-level keys are &#39;mean&#39; for the mean</span>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a><span class="sd">            and &#39;std&#39; for the standard deviation</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>            <span class="n">runs_ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs_ep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a>                    <span class="sa">f</span><span class="s2">&quot;There is no </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> episode in the project memory&quot;</span>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a>                <span class="p">)</span>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a>            <span class="n">runs</span> <span class="o">+=</span> <span class="n">runs_ep</span>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a>        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">()</span>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a>        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">}</span>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a>            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a>                <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;best&quot;</span><span class="p">:</span>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>                    <span class="n">log</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="o">-</span><span class="n">average</span><span class="p">:])</span>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>                        <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>                        <span class="k">if</span> <span class="n">average</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>                            <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">episodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">run</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">)]]</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Did not find </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2"> metric for </span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2"> run&quot;</span><span class="p">)</span>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="o">-</span><span class="n">average</span><span class="p">:])</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>                <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;epoch&quot;</span><span class="p">):</span>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a>                    <span class="n">epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">method</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a>                    <span class="n">pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a>                    <span class="n">step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;validation_interval&quot;</span><span class="p">])</span>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">log</span><span class="p">[</span><span class="n">epoch</span> <span class="o">//</span> <span class="n">step</span><span class="p">]]</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a>                        <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> method is not recognized! Please choose from [&#39;last&#39;, &#39;best&#39;, &#39;epoch...&#39;]&quot;</span>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a>                    <span class="p">)</span>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a>        <span class="n">statistics</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a>        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a>            <span class="n">statistics</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a>            <span class="n">statistics</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SUMMARY </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a>        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">statistics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">: mean </span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">statistics</span><span class="p">)</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a>    <span class="k">def</span> <span class="nf">remove_project</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a><span class="sd">        Remove all project files and experiment records and results</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a>        <span class="k">if</span> <span class="n">projects_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a>            <span class="n">projects_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()),</span> <span class="s2">&quot;DLC2Action&quot;</span><span class="p">)</span>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a>        <span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a>    <span class="k">def</span> <span class="nf">remove_saved_features</span><span class="p">(</span>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a>        <span class="n">dataset_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a>        <span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a>        <span class="n">remove_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a><span class="sd">        Remove saved pre-computed dataset files</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a><span class="sd">        By default, all pre-computed features will be deleted.</span>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a><span class="sd">        No essential information can get lost, storing them only saves time. Be careful with deleting datasets</span>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a><span class="sd">        while training or inference is happening though.</span>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a><span class="sd">        Parameters</span>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a><span class="sd">        ----------</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a><span class="sd">        dataset_names : list, optional</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a><span class="sd">            a list of dataset names to delete (by default all names are added)</span>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a><span class="sd">        exceptions : list, optional</span>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a><span class="sd">            a list of dataset names to not be deleted</span>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a><span class="sd">        remove_active : bool, default False</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a><span class="sd">            if `False`, datasets used by unfinished episodes will not be deleted</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing datasets...&quot;</span><span class="p">)</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a>        <span class="k">if</span> <span class="n">dataset_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a>            <span class="n">dataset_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a>        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a>            <span class="n">exceptions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">remove_active</span><span class="p">:</span>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a>            <span class="n">exceptions</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_active_datasets</span><span class="p">()</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a>        <span class="n">dataset_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;saved_datasets&quot;</span><span class="p">)</span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">):</span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a>            <span class="k">if</span> <span class="n">dataset_names</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a>                <span class="n">dataset_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">)])</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a>            <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>                <span class="n">x</span>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset_names</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a>            <span class="p">]</span>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_remove</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a>                <span class="n">to_remove</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">to_remove</span><span class="p">)</span>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a>            <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">dataset</span><span class="p">))</span>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a>            <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.pickle&quot;</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset_names</span>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.pickle&quot;</span><span class="p">))</span>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a>                <span class="ow">and</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>            <span class="p">]</span>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a>            <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">dataset</span><span class="p">))</span>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets</span><span class="p">()</span><span class="o">.</span><span class="n">dataset_names</span><span class="p">()</span>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>    <span class="k">def</span> <span class="nf">remove_extra_checkpoints</span><span class="p">(</span>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a><span class="sd">        Remove intermediate model checkpoint files (only leave the results of the last epoch)</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a><span class="sd">        By default, all intermediate checkpoints will be deleted.</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a><span class="sd">        Files in the model folder that are not associated with any record in the meta files are also deleted.</span>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a><span class="sd">        Parameters</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a><span class="sd">        ----------</span>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a><span class="sd">        episode_names : list, optional</span>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a><span class="sd">            a list of episode names to clean (by default all names are added)</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a><span class="sd">        exceptions : list, optional</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a><span class="sd">            a list of episode names to not clean</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a>        <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a>            <span class="n">all_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a>            <span class="n">all_names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a>        <span class="k">if</span> <span class="n">episode_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a>            <span class="n">episode_names</span> <span class="o">=</span> <span class="n">all_names</span>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a>        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a>            <span class="n">exceptions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a>        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">episode_names</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">]</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a>        <span class="n">folders</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a>            <span class="k">if</span> <span class="n">folder</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_names</span><span class="p">:</span>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a>            <span class="k">elif</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a>    <span class="k">def</span> <span class="nf">remove_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a><span class="sd">        Remove a hyperparameter search record</span>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a><span class="sd">        Parameters</span>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a><span class="sd">        ----------</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a><span class="sd">        search_name : str</span>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a><span class="sd">            the name of the search to remove</span>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a>        <span class="n">graph_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;searches&quot;</span><span class="p">,</span> <span class="n">search_name</span><span class="p">)</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">graph_path</span><span class="p">):</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">graph_path</span><span class="p">)</span>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a>    <span class="k">def</span> <span class="nf">remove_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a><span class="sd">        Remove a prediction record</span>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a><span class="sd">        Parameters</span>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a><span class="sd">        ----------</span>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a><span class="sd">        prediction_name : str</span>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a><span class="sd">            the name of the prediction to remove</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">)</span>
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a>        <span class="n">prediction_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;predictions&quot;</span><span class="p">,</span> <span class="n">prediction_name</span>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a>        <span class="p">)</span>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">prediction_path</span><span class="p">):</span>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">prediction_path</span><span class="p">)</span>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a>    <span class="k">def</span> <span class="nf">remove_episode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a><span class="sd">        Remove all model, logs and metafile records related to an episode</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a><span class="sd">        Parameters</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a><span class="sd">        ----------</span>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a><span class="sd">        episode_name : str</span>
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a><span class="sd">            the name of the episode to remove</span>
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a>        <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a>            <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span><span class="p">):</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a>            <span class="n">log_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">log_path</span><span class="p">):</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">log_path</span><span class="p">)</span>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a>    <span class="k">def</span> <span class="nf">prune_unfinished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a><span class="sd">        Remove all interrupted episodes</span>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a><span class="sd">        Remove all episodes that either don&#39;t have a log file or have less epochs in the log file than in</span>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a><span class="sd">        the training parameters or have a model folder but not a record. Note that it can remove episodes that are</span>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a><span class="sd">        currently running!</span>
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a><span class="sd">        Parameters</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a><span class="sd">        ----------</span>
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a><span class="sd">        exceptions : list</span>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a><span class="sd">            the episodes to keep even if they are interrupted</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a><span class="sd">        Returns</span>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a><span class="sd">        -------</span>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a><span class="sd">        pruned : list</span>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a><span class="sd">            a list of the episode names that were pruned</span>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a>        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a>            <span class="n">exceptions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a>        <span class="n">unfinished</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">unfinished_episodes</span><span class="p">()</span>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a>        <span class="n">unfinished</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unfinished</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">]</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a>        <span class="n">model_folders</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">))</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>        <span class="n">unfinished</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">model_folders</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a>        <span class="p">]</span>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PRUNING </span><span class="si">{</span><span class="n">unfinished</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">unfinished</span><span class="p">:</span>
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>        <span class="k">return</span> <span class="n">unfinished</span>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a>    <span class="k">def</span> <span class="nf">prediction_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a><span class="sd">        Get the path where prediction files are saved</span>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a><span class="sd">        Parameters</span>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a><span class="sd">        ----------</span>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a><span class="sd">        prediction_name : str</span>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a><span class="sd">            name of the prediction</span>
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a><span class="sd">        Returns</span>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a><span class="sd">        -------</span>
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a><span class="sd">        prediction_path : str</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a><span class="sd">            the file path</span>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;predictions&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a>        <span class="p">)</span>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a>    <span class="k">def</span> <span class="nf">print_data_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DATA TYPES:&quot;</span><span class="p">)</span>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">data_types</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a>    <span class="k">def</span> <span class="nf">print_annotation_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ANNOTATION TYPES:&quot;</span><span class="p">)</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">annotation_types</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a>    <span class="k">def</span> <span class="nf">data_types</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a><span class="sd">        Get available data types</span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a>
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a><span class="sd">        Returns</span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a><span class="sd">        -------</span>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a><span class="sd">        list</span>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a><span class="sd">            available data types</span>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a>        <span class="k">return</span> <span class="n">options</span><span class="o">.</span><span class="n">input_stores</span>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a>    <span class="k">def</span> <span class="nf">annotation_types</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a><span class="sd">        Get available annotation types</span>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a><span class="sd">        Returns</span>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a><span class="sd">        -------</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a><span class="sd">        list</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a><span class="sd">            available annotation types</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a>        <span class="k">return</span> <span class="n">options</span><span class="o">.</span><span class="n">annotation_stores</span>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a>    <span class="k">def</span> <span class="nf">_save_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a><span class="sd">        Save a mask file</span>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_path</span><span class="p">()):</span>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_path</span><span class="p">())</span>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_path</span><span class="p">(),</span> <span class="n">mask_name</span> <span class="o">+</span> <span class="s2">&quot;.pickle&quot;</span><span class="p">),</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>    <span class="k">def</span> <span class="nf">_load_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a><span class="sd">        Load a mask file</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_path</span><span class="p">(),</span> <span class="n">mask_name</span> <span class="o">+</span> <span class="s2">&quot;.pickle&quot;</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>    <span class="k">def</span> <span class="nf">_thresholds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DecisionThresholds</span><span class="p">:</span>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a><span class="sd">        Get the decision thresholds meta object</span>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>        <span class="k">return</span> <span class="n">DecisionThresholds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_thresholds_path</span><span class="p">())</span>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>    <span class="k">def</span> <span class="nf">_episodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SavedRuns</span><span class="p">:</span>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a><span class="sd">        Get the episodes meta object</span>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a><span class="sd">        Returns</span>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a><span class="sd">        -------</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a><span class="sd">        episodes : SavedRuns</span>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a><span class="sd">            the episodes meta object</span>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>            <span class="k">return</span> <span class="n">SavedRuns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a>            <span class="k">return</span> <span class="n">SavedRuns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a>    <span class="k">def</span> <span class="nf">_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SavedRuns</span><span class="p">:</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a><span class="sd">        Get the predictions meta object</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a><span class="sd">        Returns</span>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a><span class="sd">        -------</span>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a><span class="sd">        predictions : SavedRuns</span>
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a><span class="sd">            the predictions meta object</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a>            <span class="k">return</span> <span class="n">SavedRuns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a>            <span class="k">return</span> <span class="n">SavedRuns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a>    <span class="k">def</span> <span class="nf">_saved_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SavedStores</span><span class="p">:</span>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a><span class="sd">        Get the datasets meta object</span>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a><span class="sd">        Returns</span>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a><span class="sd">        -------</span>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a><span class="sd">        datasets : SavedStores</span>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a><span class="sd">            the datasets meta object</span>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a>            <span class="k">return</span> <span class="n">SavedStores</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets_path</span><span class="p">())</span>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a>            <span class="k">return</span> <span class="n">SavedStores</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets_path</span><span class="p">())</span>
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>    <span class="k">def</span> <span class="nf">_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Run</span><span class="p">:</span>
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a><span class="sd">        Get a prediction meta object</span>
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a><span class="sd">        Parameters</span>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a><span class="sd">        ----------</span>
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a><span class="sd">        name : str</span>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a><span class="sd">            episode name</span>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a>
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a><span class="sd">        Returns</span>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a><span class="sd">        -------</span>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a><span class="sd">        prediction : Run</span>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a><span class="sd">            the prediction meta object</span>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a>            <span class="k">return</span> <span class="n">Run</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">meta_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">())</span>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a>            <span class="k">return</span> <span class="n">Run</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">meta_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">())</span>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a>    <span class="k">def</span> <span class="nf">_episode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Run</span><span class="p">:</span>
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a><span class="sd">        Get an episode meta object</span>
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a><span class="sd">        Parameters</span>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a><span class="sd">        ----------</span>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a><span class="sd">        name : str</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a><span class="sd">            episode name</span>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a>
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a><span class="sd">        Returns</span>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a><span class="sd">        -------</span>
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a><span class="sd">        episode : Run</span>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a><span class="sd">            the episode meta object</span>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a>            <span class="k">return</span> <span class="n">Run</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">meta_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes_path</span><span class="p">())</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a>            <span class="k">return</span> <span class="n">Run</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">meta_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes_path</span><span class="p">())</span>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a>    <span class="k">def</span> <span class="nf">_searches</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Searches</span><span class="p">:</span>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a><span class="sd">        Get the hyperparameter search meta object</span>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a><span class="sd">        Returns</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a><span class="sd">        -------</span>
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a><span class="sd">        searches : Searches</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a><span class="sd">            the searches meta object</span>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a>            <span class="k">return</span> <span class="n">Searches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_searches_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a>            <span class="k">return</span> <span class="n">Searches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_searches_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a>    <span class="k">def</span> <span class="nf">_update_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a><span class="sd">        Update the project config files with newly added files and parameters</span>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a>
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;data_path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">}})</span>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a>        <span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]</span>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a>        <span class="n">original_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;config&quot;</span>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a>        <span class="p">)</span>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a>        <span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a>        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">original_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;yaml&quot;</span><span class="p">)]</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a>            <span class="n">filenames</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">original_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a>            <span class="p">]</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a>        <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">))</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a>            <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">))</span>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a>            <span class="n">filepath_original</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">original_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a>            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;annotation&quot;</span><span class="p">):</span>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a>            <span class="n">filepath_project</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath_project</span><span class="p">):</span>
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">filepath_original</span><span class="p">,</span> <span class="n">filepath_project</span><span class="p">)</span>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a>                <span class="n">original_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span><span class="n">filepath_original</span><span class="p">)</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a>                <span class="n">project_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span><span class="n">filepath_project</span><span class="p">)</span>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a>                <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">project_pars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_pars</span><span class="p">:</span>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a>                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">,</span> <span class="s2">&quot;annotation_type&quot;</span><span class="p">]:</span>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a>                            <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a>                    <span class="n">project_pars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a>                <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">original_pars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">project_pars</span><span class="p">:</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a>                        <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a>                    <span class="n">original_pars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a>                <span class="n">project_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">project_pars</span><span class="p">,</span> <span class="n">original_pars</span><span class="p">)</span>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath_project</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a>                    <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">project_pars</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a>    <span class="k">def</span> <span class="nf">_update_project</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a><span class="sd">        Update project files with the current version</span>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a>        <span class="n">version_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_path</span><span class="p">()</span>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a>        <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">version_file</span><span class="p">):</span>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a>            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">version_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a>                <span class="n">project_version</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a>            <span class="k">if</span> <span class="n">project_version</span> <span class="o">&lt;</span> <span class="n">__version__</span><span class="p">:</span>
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a>                <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a>            <span class="k">elif</span> <span class="n">project_version</span> <span class="o">&gt;</span> <span class="n">__version__</span><span class="p">:</span>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a>                    <span class="sa">f</span><span class="s2">&quot;The project expects a higher dlc2action version (</span><span class="si">{</span><span class="n">project_version</span><span class="si">}</span><span class="s2">), please update!&quot;</span>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a>                <span class="p">)</span>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a>            <span class="n">project_config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a>            <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__path__</span><span class="p">)),</span> <span class="s2">&quot;config&quot;</span>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a>            <span class="p">)</span>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a>            <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a>            <span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]</span>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a>            <span class="n">project_annotation_configs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span>
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">)</span>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a>            <span class="p">)</span>
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a>            <span class="n">annotation_configs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">))</span>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a>            <span class="k">for</span> <span class="n">ann_config</span> <span class="ow">in</span> <span class="n">annotation_configs</span><span class="p">:</span>
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a>                <span class="k">if</span> <span class="n">ann_config</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">project_annotation_configs</span><span class="p">:</span>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="n">ann_config</span><span class="p">),</span>
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="n">ann_config</span><span class="p">),</span>
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a>                        <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a>                    <span class="p">)</span>
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a>                    <span class="n">project_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="n">ann_config</span><span class="p">)</span>
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a>                    <span class="p">)</span>
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a>                    <span class="n">pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="n">ann_config</span><span class="p">)</span>
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a>                    <span class="p">)</span>
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a>                    <span class="n">new_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">project_pars</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a>                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">new_keys</span><span class="p">:</span>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a>                        <span class="n">project_pars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a>                        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a>                        <span class="n">project_pars</span><span class="o">.</span><span class="n">yaml_add_eol_comment</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a>                        <span class="n">episodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a>                            <span class="n">condition</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;general/annotation_type::=</span><span class="si">{</span><span class="n">ann_config</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a>                            <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;data/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">pars</span><span class="p">[</span><span class="n">key</span><span class="p">]},</span>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a>                        <span class="p">)</span>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a>    <span class="k">def</span> <span class="nf">_initialize_project</span><span class="p">(</span>
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a>        <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a>        <span class="n">annotation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a>        <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a><span class="sd">        Initialize a new project</span>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a>        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_types</span><span class="p">():</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a>                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2"> data type is not available. &quot;</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a>                <span class="sa">f</span><span class="s2">&quot;Please choose from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_types</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a>            <span class="p">)</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a>        <span class="k">if</span> <span class="n">annotation_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_types</span><span class="p">():</span>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a>                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2"> annotation type is not available. &quot;</span>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a>                <span class="sa">f</span><span class="s2">&quot;Please choose from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_types</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a>            <span class="p">)</span>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a>        <span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;saved_datasets&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">]</span>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a>        <span class="n">results_subfolders</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a>            <span class="s2">&quot;model&quot;</span><span class="p">,</span>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a>            <span class="s2">&quot;logs&quot;</span><span class="p">,</span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a>            <span class="s2">&quot;predictions&quot;</span><span class="p">,</span>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a>            <span class="s2">&quot;splits&quot;</span><span class="p">,</span>
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a>            <span class="s2">&quot;searches&quot;</span><span class="p">,</span>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a>        <span class="p">]</span>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a>        <span class="k">for</span> <span class="n">sf</span> <span class="ow">in</span> <span class="n">results_subfolders</span><span class="p">:</span>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">sf</span><span class="p">))</span>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a>        <span class="k">if</span> <span class="n">data_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a>            <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">))</span>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a>                    <span class="n">data_path</span><span class="p">,</span>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a>                    <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a>                <span class="p">)</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a>                <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a>        <span class="k">if</span> <span class="n">annotation_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a>            <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">))</span>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a>                    <span class="n">annotation_path</span><span class="p">,</span>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">),</span>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a>                    <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a>                <span class="p">)</span>
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a>                <span class="n">annotation_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">)</span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_config</span><span class="p">(</span>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a>            <span class="n">data_type</span><span class="p">,</span>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a>            <span class="n">annotation_type</span><span class="p">,</span>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a>            <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a>        <span class="p">)</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_meta</span><span class="p">()</span>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>    <span class="k">def</span> <span class="nf">_read_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a><span class="sd">        Get data type and annotation type from existing project files</span>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a>        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;general.yaml&quot;</span><span class="p">)</span>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a>            <span class="n">pars</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a>        <span class="n">data_type</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a>        <span class="n">annotation_type</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;annotation_type&quot;</span><span class="p">]</span>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a>        <span class="k">return</span> <span class="n">annotation_type</span><span class="p">,</span> <span class="n">data_type</span>
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a>    <span class="k">def</span> <span class="nf">_read_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a><span class="sd">        Get data type and annotation type from existing project files</span>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a>        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;data.yaml&quot;</span><span class="p">)</span>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a>            <span class="n">pars</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a>        <span class="n">data_path</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data_path&quot;</span><span class="p">]</span>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a>        <span class="n">annotation_path</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;annotation_path&quot;</span><span class="p">]</span>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a>        <span class="k">return</span> <span class="n">annotation_path</span><span class="p">,</span> <span class="n">data_path</span>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a>
</span><span id="L-2812"><a href="#L-2812"><span class="linenos">2812</span></a>    <span class="k">def</span> <span class="nf">_generate_config</span><span class="p">(</span>
</span><span id="L-2813"><a href="#L-2813"><span class="linenos">2813</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">annotation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">annotation_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-2814"><a href="#L-2814"><span class="linenos">2814</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2815"><a href="#L-2815"><span class="linenos">2815</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2816"><a href="#L-2816"><span class="linenos">2816</span></a><span class="sd">        Initialize the config files</span>
</span><span id="L-2817"><a href="#L-2817"><span class="linenos">2817</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2818"><a href="#L-2818"><span class="linenos">2818</span></a>
</span><span id="L-2819"><a href="#L-2819"><span class="linenos">2819</span></a>        <span class="n">default_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2820"><a href="#L-2820"><span class="linenos">2820</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;config&quot;</span>
</span><span id="L-2821"><a href="#L-2821"><span class="linenos">2821</span></a>        <span class="p">)</span>
</span><span id="L-2822"><a href="#L-2822"><span class="linenos">2822</span></a>        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span>
</span><span id="L-2823"><a href="#L-2823"><span class="linenos">2823</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">,</span> <span class="s2">&quot;metrics&quot;</span><span class="p">,</span> <span class="s2">&quot;ssl&quot;</span><span class="p">,</span> <span class="s2">&quot;training&quot;</span><span class="p">]</span>
</span><span id="L-2824"><a href="#L-2824"><span class="linenos">2824</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="L-2825"><a href="#L-2825"><span class="linenos">2825</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">),</span> <span class="n">config_path</span><span class="p">)</span>
</span><span id="L-2826"><a href="#L-2826"><span class="linenos">2826</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="L-2827"><a href="#L-2827"><span class="linenos">2827</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="L-2828"><a href="#L-2828"><span class="linenos">2828</span></a>        <span class="p">)</span>
</span><span id="L-2829"><a href="#L-2829"><span class="linenos">2829</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="L-2830"><a href="#L-2830"><span class="linenos">2830</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">),</span>
</span><span id="L-2831"><a href="#L-2831"><span class="linenos">2831</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">),</span>
</span><span id="L-2832"><a href="#L-2832"><span class="linenos">2832</span></a>        <span class="p">)</span>
</span><span id="L-2833"><a href="#L-2833"><span class="linenos">2833</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="L-2834"><a href="#L-2834"><span class="linenos">2834</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">),</span>
</span><span id="L-2835"><a href="#L-2835"><span class="linenos">2835</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">),</span>
</span><span id="L-2836"><a href="#L-2836"><span class="linenos">2836</span></a>        <span class="p">)</span>
</span><span id="L-2837"><a href="#L-2837"><span class="linenos">2837</span></a>        <span class="n">yaml</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span>
</span><span id="L-2838"><a href="#L-2838"><span class="linenos">2838</span></a>        <span class="n">data_param_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="L-2839"><a href="#L-2839"><span class="linenos">2839</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_param_path</span><span class="p">):</span>
</span><span id="L-2840"><a href="#L-2840"><span class="linenos">2840</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_param_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2841"><a href="#L-2841"><span class="linenos">2841</span></a>                <span class="n">data_params</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-2842"><a href="#L-2842"><span class="linenos">2842</span></a>        <span class="k">if</span> <span class="n">data_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2843"><a href="#L-2843"><span class="linenos">2843</span></a>            <span class="n">data_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2844"><a href="#L-2844"><span class="linenos">2844</span></a>        <span class="k">if</span> <span class="n">annotation_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2845"><a href="#L-2845"><span class="linenos">2845</span></a>            <span class="n">ann_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2846"><a href="#L-2846"><span class="linenos">2846</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2847"><a href="#L-2847"><span class="linenos">2847</span></a>            <span class="n">ann_param_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2848"><a href="#L-2848"><span class="linenos">2848</span></a>                <span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="L-2849"><a href="#L-2849"><span class="linenos">2849</span></a>            <span class="p">)</span>
</span><span id="L-2850"><a href="#L-2850"><span class="linenos">2850</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ann_param_path</span><span class="p">):</span>
</span><span id="L-2851"><a href="#L-2851"><span class="linenos">2851</span></a>                <span class="n">ann_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span><span class="n">ann_param_path</span><span class="p">)</span>
</span><span id="L-2852"><a href="#L-2852"><span class="linenos">2852</span></a>            <span class="k">elif</span> <span class="n">annotation_type</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="L-2853"><a href="#L-2853"><span class="linenos">2853</span></a>                <span class="n">ann_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2854"><a href="#L-2854"><span class="linenos">2854</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2855"><a href="#L-2855"><span class="linenos">2855</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2856"><a href="#L-2856"><span class="linenos">2856</span></a>                    <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2"> data type is not available. &quot;</span>
</span><span id="L-2857"><a href="#L-2857"><span class="linenos">2857</span></a>                    <span class="sa">f</span><span class="s2">&quot;Please choose from </span><span class="si">{</span><span class="n">BehaviorDataset</span><span class="o">.</span><span class="n">annotation_types</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-2858"><a href="#L-2858"><span class="linenos">2858</span></a>                <span class="p">)</span>
</span><span id="L-2859"><a href="#L-2859"><span class="linenos">2859</span></a>        <span class="k">if</span> <span class="n">ann_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2860"><a href="#L-2860"><span class="linenos">2860</span></a>            <span class="n">ann_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2861"><a href="#L-2861"><span class="linenos">2861</span></a>        <span class="n">data_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">data_params</span><span class="p">,</span> <span class="n">ann_params</span><span class="p">)</span>
</span><span id="L-2862"><a href="#L-2862"><span class="linenos">2862</span></a>        <span class="n">data_params</span><span class="p">[</span><span class="s2">&quot;data_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_path</span>
</span><span id="L-2863"><a href="#L-2863"><span class="linenos">2863</span></a>        <span class="n">data_params</span><span class="p">[</span><span class="s2">&quot;annotation_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">annotation_path</span>
</span><span id="L-2864"><a href="#L-2864"><span class="linenos">2864</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;data.yaml&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2865"><a href="#L-2865"><span class="linenos">2865</span></a>            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data_params</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-2866"><a href="#L-2866"><span class="linenos">2866</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;general.yaml&quot;</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2867"><a href="#L-2867"><span class="linenos">2867</span></a>            <span class="n">general_params</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-2868"><a href="#L-2868"><span class="linenos">2868</span></a>        <span class="n">general_params</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_type</span>
</span><span id="L-2869"><a href="#L-2869"><span class="linenos">2869</span></a>        <span class="n">general_params</span><span class="p">[</span><span class="s2">&quot;annotation_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">annotation_type</span>
</span><span id="L-2870"><a href="#L-2870"><span class="linenos">2870</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;general.yaml&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2871"><a href="#L-2871"><span class="linenos">2871</span></a>            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">general_params</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-2872"><a href="#L-2872"><span class="linenos">2872</span></a>
</span><span id="L-2873"><a href="#L-2873"><span class="linenos">2873</span></a>    <span class="k">def</span> <span class="nf">_generate_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2874"><a href="#L-2874"><span class="linenos">2874</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2875"><a href="#L-2875"><span class="linenos">2875</span></a><span class="sd">        Initialize the meta files</span>
</span><span id="L-2876"><a href="#L-2876"><span class="linenos">2876</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2877"><a href="#L-2877"><span class="linenos">2877</span></a>
</span><span id="L-2878"><a href="#L-2878"><span class="linenos">2878</span></a>        <span class="n">config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span>
</span><span id="L-2879"><a href="#L-2879"><span class="linenos">2879</span></a>        <span class="n">meta_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="L-2880"><a href="#L-2880"><span class="linenos">2880</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">meta_fields</span><span class="p">]</span>
</span><span id="L-2881"><a href="#L-2881"><span class="linenos">2881</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span>
</span><span id="L-2882"><a href="#L-2882"><span class="linenos">2882</span></a>        <span class="n">episodes</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes_path</span><span class="p">())</span>
</span><span id="L-2883"><a href="#L-2883"><span class="linenos">2883</span></a>        <span class="n">meta_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;objective&quot;</span><span class="p">]</span>
</span><span id="L-2884"><a href="#L-2884"><span class="linenos">2884</span></a>        <span class="n">result_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;best_params&quot;</span><span class="p">,</span> <span class="s2">&quot;best_value&quot;</span><span class="p">]</span>
</span><span id="L-2885"><a href="#L-2885"><span class="linenos">2885</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">meta_fields</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
</span><span id="L-2886"><a href="#L-2886"><span class="linenos">2886</span></a>            <span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">result_fields</span>
</span><span id="L-2887"><a href="#L-2887"><span class="linenos">2887</span></a>        <span class="p">]</span>
</span><span id="L-2888"><a href="#L-2888"><span class="linenos">2888</span></a>        <span class="n">searches</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span>
</span><span id="L-2889"><a href="#L-2889"><span class="linenos">2889</span></a>        <span class="n">searches</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_searches_path</span><span class="p">())</span>
</span><span id="L-2890"><a href="#L-2890"><span class="linenos">2890</span></a>        <span class="n">meta_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="L-2891"><a href="#L-2891"><span class="linenos">2891</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">meta_fields</span><span class="p">]</span>
</span><span id="L-2892"><a href="#L-2892"><span class="linenos">2892</span></a>        <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span>
</span><span id="L-2893"><a href="#L-2893"><span class="linenos">2893</span></a>        <span class="n">predictions</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">())</span>
</span><span id="L-2894"><a href="#L-2894"><span class="linenos">2894</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s2">&quot;data.yaml&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2895"><a href="#L-2895"><span class="linenos">2895</span></a>            <span class="n">data_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-2896"><a href="#L-2896"><span class="linenos">2896</span></a>        <span class="n">saved_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">data_keys</span><span class="p">)</span>
</span><span id="L-2897"><a href="#L-2897"><span class="linenos">2897</span></a>        <span class="n">saved_data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets_path</span><span class="p">())</span>
</span><span id="L-2898"><a href="#L-2898"><span class="linenos">2898</span></a>        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_thresholds_path</span><span class="p">())</span>
</span><span id="L-2899"><a href="#L-2899"><span class="linenos">2899</span></a>        <span class="c1"># with open(self._version_path()) as f:</span>
</span><span id="L-2900"><a href="#L-2900"><span class="linenos">2900</span></a>        <span class="c1">#     f.write(__version__)</span>
</span><span id="L-2901"><a href="#L-2901"><span class="linenos">2901</span></a>
</span><span id="L-2902"><a href="#L-2902"><span class="linenos">2902</span></a>    <span class="k">def</span> <span class="nf">_open_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommentedMap</span><span class="p">:</span>
</span><span id="L-2903"><a href="#L-2903"><span class="linenos">2903</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2904"><a href="#L-2904"><span class="linenos">2904</span></a><span class="sd">        Load a parameter dictionary from a .yaml file</span>
</span><span id="L-2905"><a href="#L-2905"><span class="linenos">2905</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2906"><a href="#L-2906"><span class="linenos">2906</span></a>
</span><span id="L-2907"><a href="#L-2907"><span class="linenos">2907</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-2908"><a href="#L-2908"><span class="linenos">2908</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-2909"><a href="#L-2909"><span class="linenos">2909</span></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2910"><a href="#L-2910"><span class="linenos">2910</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2911"><a href="#L-2911"><span class="linenos">2911</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-2912"><a href="#L-2912"><span class="linenos">2912</span></a>
</span><span id="L-2913"><a href="#L-2913"><span class="linenos">2913</span></a>    <span class="k">def</span> <span class="nf">_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">allow_diff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">):</span>
</span><span id="L-2914"><a href="#L-2914"><span class="linenos">2914</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2915"><a href="#L-2915"><span class="linenos">2915</span></a><span class="sd">        Compare nested dictionaries with &#39;almost equal&#39; condition</span>
</span><span id="L-2916"><a href="#L-2916"><span class="linenos">2916</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2917"><a href="#L-2917"><span class="linenos">2917</span></a>
</span><span id="L-2918"><a href="#L-2918"><span class="linenos">2918</span></a>        <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2919"><a href="#L-2919"><span class="linenos">2919</span></a>        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">!=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-2920"><a href="#L-2920"><span class="linenos">2920</span></a>            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2921"><a href="#L-2921"><span class="linenos">2921</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2922"><a href="#L-2922"><span class="linenos">2922</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2923"><a href="#L-2923"><span class="linenos">2923</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="L-2924"><a href="#L-2924"><span class="linenos">2924</span></a>                    <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">allow_diff</span><span class="o">=</span><span class="n">allow_diff</span><span class="p">)</span>
</span><span id="L-2925"><a href="#L-2925"><span class="linenos">2925</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2926"><a href="#L-2926"><span class="linenos">2926</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-2927"><a href="#L-2927"><span class="linenos">2927</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-2928"><a href="#L-2928"><span class="linenos">2928</span></a>                            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2929"><a href="#L-2929"><span class="linenos">2929</span></a>                        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-2930"><a href="#L-2930"><span class="linenos">2930</span></a>                            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2931"><a href="#L-2931"><span class="linenos">2931</span></a>                        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">allow_diff</span><span class="p">:</span>
</span><span id="L-2932"><a href="#L-2932"><span class="linenos">2932</span></a>                            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2933"><a href="#L-2933"><span class="linenos">2933</span></a>                    <span class="k">elif</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
</span><span id="L-2934"><a href="#L-2934"><span class="linenos">2934</span></a>                        <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2935"><a href="#L-2935"><span class="linenos">2935</span></a>        <span class="k">return</span> <span class="n">ok</span>
</span><span id="L-2936"><a href="#L-2936"><span class="linenos">2936</span></a>
</span><span id="L-2937"><a href="#L-2937"><span class="linenos">2937</span></a>    <span class="k">def</span> <span class="nf">_check_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment_sequence</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-2938"><a href="#L-2938"><span class="linenos">2938</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2939"><a href="#L-2939"><span class="linenos">2939</span></a><span class="sd">        Check if a comment already exists in a ruamel.yaml comment sequence</span>
</span><span id="L-2940"><a href="#L-2940"><span class="linenos">2940</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2941"><a href="#L-2941"><span class="linenos">2941</span></a>
</span><span id="L-2942"><a href="#L-2942"><span class="linenos">2942</span></a>        <span class="k">if</span> <span class="n">comment_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2943"><a href="#L-2943"><span class="linenos">2943</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-2944"><a href="#L-2944"><span class="linenos">2944</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">comment_sequence</span><span class="p">)</span>
</span><span id="L-2945"><a href="#L-2945"><span class="linenos">2945</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-2946"><a href="#L-2946"><span class="linenos">2946</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-2947"><a href="#L-2947"><span class="linenos">2947</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2948"><a href="#L-2948"><span class="linenos">2948</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-2949"><a href="#L-2949"><span class="linenos">2949</span></a>
</span><span id="L-2950"><a href="#L-2950"><span class="linenos">2950</span></a>    <span class="k">def</span> <span class="nf">_get_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment_sequence</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-2951"><a href="#L-2951"><span class="linenos">2951</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2952"><a href="#L-2952"><span class="linenos">2952</span></a><span class="sd">        Get the comment string from a ruamel.yaml comment sequence</span>
</span><span id="L-2953"><a href="#L-2953"><span class="linenos">2953</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2954"><a href="#L-2954"><span class="linenos">2954</span></a>
</span><span id="L-2955"><a href="#L-2955"><span class="linenos">2955</span></a>        <span class="k">if</span> <span class="n">comment_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2956"><a href="#L-2956"><span class="linenos">2956</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-2957"><a href="#L-2957"><span class="linenos">2957</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-2958"><a href="#L-2958"><span class="linenos">2958</span></a>        <span class="k">for</span> <span class="n">cm</span> <span class="ow">in</span> <span class="n">comment_sequence</span><span class="p">:</span>
</span><span id="L-2959"><a href="#L-2959"><span class="linenos">2959</span></a>            <span class="k">if</span> <span class="n">cm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2960"><a href="#L-2960"><span class="linenos">2960</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
</span><span id="L-2961"><a href="#L-2961"><span class="linenos">2961</span></a>                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cm</span><span class="p">:</span>
</span><span id="L-2962"><a href="#L-2962"><span class="linenos">2962</span></a>                        <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2963"><a href="#L-2963"><span class="linenos">2963</span></a>                            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-2964"><a href="#L-2964"><span class="linenos">2964</span></a>                            <span class="k">break</span>
</span><span id="L-2965"><a href="#L-2965"><span class="linenos">2965</span></a>                    <span class="k">break</span>
</span><span id="L-2966"><a href="#L-2966"><span class="linenos">2966</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2967"><a href="#L-2967"><span class="linenos">2967</span></a>                    <span class="n">c</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-2968"><a href="#L-2968"><span class="linenos">2968</span></a>                    <span class="k">break</span>
</span><span id="L-2969"><a href="#L-2969"><span class="linenos">2969</span></a>        <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
</span><span id="L-2970"><a href="#L-2970"><span class="linenos">2970</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-2971"><a href="#L-2971"><span class="linenos">2971</span></a>        <span class="k">return</span> <span class="n">c</span>
</span><span id="L-2972"><a href="#L-2972"><span class="linenos">2972</span></a>
</span><span id="L-2973"><a href="#L-2973"><span class="linenos">2973</span></a>    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CommentedMap</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">u</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CommentedMap</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]):</span>
</span><span id="L-2974"><a href="#L-2974"><span class="linenos">2974</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2975"><a href="#L-2975"><span class="linenos">2975</span></a><span class="sd">        Update a nested dictionary</span>
</span><span id="L-2976"><a href="#L-2976"><span class="linenos">2976</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2977"><a href="#L-2977"><span class="linenos">2977</span></a>
</span><span id="L-2978"><a href="#L-2978"><span class="linenos">2978</span></a>        <span class="k">if</span> <span class="s2">&quot;general&quot;</span> <span class="ow">in</span> <span class="n">u</span> <span class="ow">and</span> <span class="s2">&quot;model_name&quot;</span> <span class="ow">in</span> <span class="n">u</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
</span><span id="L-2979"><a href="#L-2979"><span class="linenos">2979</span></a>            <span class="n">model_name</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="L-2980"><a href="#L-2980"><span class="linenos">2980</span></a>            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">model_name</span><span class="p">:</span>
</span><span id="L-2981"><a href="#L-2981"><span class="linenos">2981</span></a>                <span class="n">d</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-2982"><a href="#L-2982"><span class="linenos">2982</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-2983"><a href="#L-2983"><span class="linenos">2983</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="L-2984"><a href="#L-2984"><span class="linenos">2984</span></a>                    <span class="p">)</span>
</span><span id="L-2985"><a href="#L-2985"><span class="linenos">2985</span></a>                <span class="p">)</span>
</span><span id="L-2986"><a href="#L-2986"><span class="linenos">2986</span></a>        <span class="n">d_copied</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span><span id="L-2987"><a href="#L-2987"><span class="linenos">2987</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2988"><a href="#L-2988"><span class="linenos">2988</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-2989"><a href="#L-2989"><span class="linenos">2989</span></a>                <span class="n">k</span> <span class="ow">in</span> <span class="n">d_copied</span>
</span><span id="L-2990"><a href="#L-2990"><span class="linenos">2990</span></a>                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="L-2991"><a href="#L-2991"><span class="linenos">2991</span></a>                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">)</span>
</span><span id="L-2992"><a href="#L-2992"><span class="linenos">2992</span></a>                <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
</span><span id="L-2993"><a href="#L-2993"><span class="linenos">2993</span></a>            <span class="p">):</span>
</span><span id="L-2994"><a href="#L-2994"><span class="linenos">2994</span></a>                <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2995"><a href="#L-2995"><span class="linenos">2995</span></a>                    <span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">vv</span>
</span><span id="L-2996"><a href="#L-2996"><span class="linenos">2996</span></a>            <span class="k">elif</span> <span class="p">(</span>
</span><span id="L-2997"><a href="#L-2997"><span class="linenos">2997</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">)</span>
</span><span id="L-2998"><a href="#L-2998"><span class="linenos">2998</span></a>                <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d_copied</span>
</span><span id="L-2999"><a href="#L-2999"><span class="linenos">2999</span></a>                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">)</span>
</span><span id="L-3000"><a href="#L-3000"><span class="linenos">3000</span></a>            <span class="p">):</span>
</span><span id="L-3001"><a href="#L-3001"><span class="linenos">3001</span></a>                <span class="k">if</span> <span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3002"><a href="#L-3002"><span class="linenos">3002</span></a>                    <span class="n">d_k</span> <span class="o">=</span> <span class="n">CommentedMap</span><span class="p">()</span>
</span><span id="L-3003"><a href="#L-3003"><span class="linenos">3003</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-3004"><a href="#L-3004"><span class="linenos">3004</span></a>                    <span class="n">d_k</span> <span class="o">=</span> <span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-3005"><a href="#L-3005"><span class="linenos">3005</span></a>                <span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">d_k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="L-3006"><a href="#L-3006"><span class="linenos">3006</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3007"><a href="#L-3007"><span class="linenos">3007</span></a>                <span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="L-3008"><a href="#L-3008"><span class="linenos">3008</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">CommentedMap</span><span class="p">)</span> <span class="ow">and</span> <span class="n">u</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3009"><a href="#L-3009"><span class="linenos">3009</span></a>                    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">strip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3010"><a href="#L-3010"><span class="linenos">3010</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d_copied</span><span class="p">,</span> <span class="n">CommentedMap</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_comment</span><span class="p">(</span>
</span><span id="L-3011"><a href="#L-3011"><span class="linenos">3011</span></a>                        <span class="n">d_copied</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-3012"><a href="#L-3012"><span class="linenos">3012</span></a>                    <span class="p">):</span>
</span><span id="L-3013"><a href="#L-3013"><span class="linenos">3013</span></a>                        <span class="n">d_copied</span><span class="o">.</span><span class="n">yaml_add_eol_comment</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-3014"><a href="#L-3014"><span class="linenos">3014</span></a>        <span class="k">return</span> <span class="n">d_copied</span>
</span><span id="L-3015"><a href="#L-3015"><span class="linenos">3015</span></a>
</span><span id="L-3016"><a href="#L-3016"><span class="linenos">3016</span></a>    <span class="k">def</span> <span class="nf">_update_with_search</span><span class="p">(</span>
</span><span id="L-3017"><a href="#L-3017"><span class="linenos">3017</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3018"><a href="#L-3018"><span class="linenos">3018</span></a>        <span class="n">d</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-3019"><a href="#L-3019"><span class="linenos">3019</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3020"><a href="#L-3020"><span class="linenos">3020</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3021"><a href="#L-3021"><span class="linenos">3021</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3022"><a href="#L-3022"><span class="linenos">3022</span></a>    <span class="p">):</span>
</span><span id="L-3023"><a href="#L-3023"><span class="linenos">3023</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3024"><a href="#L-3024"><span class="linenos">3024</span></a><span class="sd">        Update a dictionary with best parameters from a hyperparameter search</span>
</span><span id="L-3025"><a href="#L-3025"><span class="linenos">3025</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3026"><a href="#L-3026"><span class="linenos">3026</span></a>
</span><span id="L-3027"><a href="#L-3027"><span class="linenos">3027</span></a>        <span class="n">u</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">get_best_params</span><span class="p">(</span>
</span><span id="L-3028"><a href="#L-3028"><span class="linenos">3028</span></a>            <span class="n">search_name</span><span class="p">,</span> <span class="n">load_parameters</span><span class="p">,</span> <span class="n">round_to_binary</span>
</span><span id="L-3029"><a href="#L-3029"><span class="linenos">3029</span></a>        <span class="p">)</span>
</span><span id="L-3030"><a href="#L-3030"><span class="linenos">3030</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</span><span id="L-3031"><a href="#L-3031"><span class="linenos">3031</span></a>
</span><span id="L-3032"><a href="#L-3032"><span class="linenos">3032</span></a>    <span class="k">def</span> <span class="nf">_read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catch_blanks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-3033"><a href="#L-3033"><span class="linenos">3033</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3034"><a href="#L-3034"><span class="linenos">3034</span></a><span class="sd">        Compose a parameter dictionary to create a task from the config files</span>
</span><span id="L-3035"><a href="#L-3035"><span class="linenos">3035</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3036"><a href="#L-3036"><span class="linenos">3036</span></a>
</span><span id="L-3037"><a href="#L-3037"><span class="linenos">3037</span></a>        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span>
</span><span id="L-3038"><a href="#L-3038"><span class="linenos">3038</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3039"><a href="#L-3039"><span class="linenos">3039</span></a>            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
</span><span id="L-3040"><a href="#L-3040"><span class="linenos">3040</span></a>            <span class="s2">&quot;general&quot;</span><span class="p">,</span>
</span><span id="L-3041"><a href="#L-3041"><span class="linenos">3041</span></a>            <span class="s2">&quot;losses&quot;</span><span class="p">,</span>
</span><span id="L-3042"><a href="#L-3042"><span class="linenos">3042</span></a>            <span class="s2">&quot;metrics&quot;</span><span class="p">,</span>
</span><span id="L-3043"><a href="#L-3043"><span class="linenos">3043</span></a>            <span class="s2">&quot;ssl&quot;</span><span class="p">,</span>
</span><span id="L-3044"><a href="#L-3044"><span class="linenos">3044</span></a>            <span class="s2">&quot;training&quot;</span><span class="p">,</span>
</span><span id="L-3045"><a href="#L-3045"><span class="linenos">3045</span></a>        <span class="p">]</span>
</span><span id="L-3046"><a href="#L-3046"><span class="linenos">3046</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-3047"><a href="#L-3047"><span class="linenos">3047</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="L-3048"><a href="#L-3048"><span class="linenos">3048</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">))</span>
</span><span id="L-3049"><a href="#L-3049"><span class="linenos">3049</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="L-3050"><a href="#L-3050"><span class="linenos">3050</span></a>        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-3051"><a href="#L-3051"><span class="linenos">3051</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">features</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="L-3052"><a href="#L-3052"><span class="linenos">3052</span></a>        <span class="p">)</span>
</span><span id="L-3053"><a href="#L-3053"><span class="linenos">3053</span></a>        <span class="n">transformer</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">extractor_to_transformer</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
</span><span id="L-3054"><a href="#L-3054"><span class="linenos">3054</span></a>        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-3055"><a href="#L-3055"><span class="linenos">3055</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">transformer</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="L-3056"><a href="#L-3056"><span class="linenos">3056</span></a>        <span class="p">)</span>
</span><span id="L-3057"><a href="#L-3057"><span class="linenos">3057</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="L-3058"><a href="#L-3058"><span class="linenos">3058</span></a>        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="L-3059"><a href="#L-3059"><span class="linenos">3059</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="L-3060"><a href="#L-3060"><span class="linenos">3060</span></a>        <span class="p">)</span>
</span><span id="L-3061"><a href="#L-3061"><span class="linenos">3061</span></a>        <span class="c1"># input = parameters[&quot;general&quot;][&quot;input&quot;]</span>
</span><span id="L-3062"><a href="#L-3062"><span class="linenos">3062</span></a>        <span class="c1"># parameters[&quot;model&quot;] = self._open_yaml(</span>
</span><span id="L-3063"><a href="#L-3063"><span class="linenos">3063</span></a>        <span class="c1">#     os.path.join(config_path, &quot;model&quot;, f&quot;{model}.yaml&quot;)</span>
</span><span id="L-3064"><a href="#L-3064"><span class="linenos">3064</span></a>        <span class="c1"># )</span>
</span><span id="L-3065"><a href="#L-3065"><span class="linenos">3065</span></a>        <span class="k">if</span> <span class="n">catch_blanks</span><span class="p">:</span>
</span><span id="L-3066"><a href="#L-3066"><span class="linenos">3066</span></a>            <span class="n">blanks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_blanks</span><span class="p">()</span>
</span><span id="L-3067"><a href="#L-3067"><span class="linenos">3067</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blanks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3068"><a href="#L-3068"><span class="linenos">3068</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">list_blanks</span><span class="p">()</span>
</span><span id="L-3069"><a href="#L-3069"><span class="linenos">3069</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3070"><a href="#L-3070"><span class="linenos">3070</span></a>                    <span class="sa">f</span><span class="s2">&quot;Please fill in all the blanks before running experiments&quot;</span>
</span><span id="L-3071"><a href="#L-3071"><span class="linenos">3071</span></a>                <span class="p">)</span>
</span><span id="L-3072"><a href="#L-3072"><span class="linenos">3072</span></a>        <span class="k">return</span> <span class="n">parameters</span>
</span><span id="L-3073"><a href="#L-3073"><span class="linenos">3073</span></a>
</span><span id="L-3074"><a href="#L-3074"><span class="linenos">3074</span></a>    <span class="k">def</span> <span class="nf">set_main_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-3075"><a href="#L-3075"><span class="linenos">3075</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3076"><a href="#L-3076"><span class="linenos">3076</span></a><span class="sd">        Select the model and the metrics</span>
</span><span id="L-3077"><a href="#L-3077"><span class="linenos">3077</span></a>
</span><span id="L-3078"><a href="#L-3078"><span class="linenos">3078</span></a><span class="sd">        Parameters</span>
</span><span id="L-3079"><a href="#L-3079"><span class="linenos">3079</span></a><span class="sd">        ----------</span>
</span><span id="L-3080"><a href="#L-3080"><span class="linenos">3080</span></a><span class="sd">        model_name : str, optional</span>
</span><span id="L-3081"><a href="#L-3081"><span class="linenos">3081</span></a><span class="sd">            model name; run `project.help(&quot;model&quot;) to find out more</span>
</span><span id="L-3082"><a href="#L-3082"><span class="linenos">3082</span></a><span class="sd">        metric_names : list, optional</span>
</span><span id="L-3083"><a href="#L-3083"><span class="linenos">3083</span></a><span class="sd">            a list of metric function names; run `project.help(&quot;metrics&quot;) to find out more</span>
</span><span id="L-3084"><a href="#L-3084"><span class="linenos">3084</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3085"><a href="#L-3085"><span class="linenos">3085</span></a>
</span><span id="L-3086"><a href="#L-3086"><span class="linenos">3086</span></a>        <span class="n">pars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="L-3087"><a href="#L-3087"><span class="linenos">3087</span></a>        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3088"><a href="#L-3088"><span class="linenos">3088</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">models</span>
</span><span id="L-3089"><a href="#L-3089"><span class="linenos">3089</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_name</span>
</span><span id="L-3090"><a href="#L-3090"><span class="linenos">3090</span></a>        <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3091"><a href="#L-3091"><span class="linenos">3091</span></a>            <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
</span><span id="L-3092"><a href="#L-3092"><span class="linenos">3092</span></a>                <span class="k">assert</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">metrics</span>
</span><span id="L-3093"><a href="#L-3093"><span class="linenos">3093</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;metric_functions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_names</span>
</span><span id="L-3094"><a href="#L-3094"><span class="linenos">3094</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
</span><span id="L-3095"><a href="#L-3095"><span class="linenos">3095</span></a>
</span><span id="L-3096"><a href="#L-3096"><span class="linenos">3096</span></a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-3097"><a href="#L-3097"><span class="linenos">3097</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3098"><a href="#L-3098"><span class="linenos">3098</span></a><span class="sd">        Get information on available options</span>
</span><span id="L-3099"><a href="#L-3099"><span class="linenos">3099</span></a>
</span><span id="L-3100"><a href="#L-3100"><span class="linenos">3100</span></a><span class="sd">        Parameters</span>
</span><span id="L-3101"><a href="#L-3101"><span class="linenos">3101</span></a><span class="sd">        ----------</span>
</span><span id="L-3102"><a href="#L-3102"><span class="linenos">3102</span></a><span class="sd">        keyword : str, optional</span>
</span><span id="L-3103"><a href="#L-3103"><span class="linenos">3103</span></a><span class="sd">            the keyword for options (run without arguments to see which keywords are available)</span>
</span><span id="L-3104"><a href="#L-3104"><span class="linenos">3104</span></a>
</span><span id="L-3105"><a href="#L-3105"><span class="linenos">3105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3106"><a href="#L-3106"><span class="linenos">3106</span></a>
</span><span id="L-3107"><a href="#L-3107"><span class="linenos">3107</span></a>        <span class="k">if</span> <span class="n">keyword</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3108"><a href="#L-3108"><span class="linenos">3108</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AVAILABLE HELP FUNCTIONS:&quot;</span><span class="p">)</span>
</span><span id="L-3109"><a href="#L-3109"><span class="linenos">3109</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Try running `project.help(keyword)` with the following keywords:&quot;</span><span class="p">)</span>
</span><span id="L-3110"><a href="#L-3110"><span class="linenos">3110</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - model: to get more information on available models,&quot;</span><span class="p">)</span>
</span><span id="L-3111"><a href="#L-3111"><span class="linenos">3111</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3112"><a href="#L-3112"><span class="linenos">3112</span></a>                <span class="s2">&quot;    - features: to get more information on available feature extraction modes,&quot;</span>
</span><span id="L-3113"><a href="#L-3113"><span class="linenos">3113</span></a>            <span class="p">)</span>
</span><span id="L-3114"><a href="#L-3114"><span class="linenos">3114</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3115"><a href="#L-3115"><span class="linenos">3115</span></a>                <span class="s2">&quot;    - partition_method: to get more information on available train/test/val partitioning methods,&quot;</span>
</span><span id="L-3116"><a href="#L-3116"><span class="linenos">3116</span></a>            <span class="p">)</span>
</span><span id="L-3117"><a href="#L-3117"><span class="linenos">3117</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - metrics: to see a list of available metric functions.&quot;</span><span class="p">)</span>
</span><span id="L-3118"><a href="#L-3118"><span class="linenos">3118</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - data: to see help for expected data structure&quot;</span><span class="p">)</span>
</span><span id="L-3119"><a href="#L-3119"><span class="linenos">3119</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3120"><a href="#L-3120"><span class="linenos">3120</span></a>                <span class="s2">&quot;- To start working with this project, first run `project.list_blanks()` to check which parameters need to be filled in.&quot;</span>
</span><span id="L-3121"><a href="#L-3121"><span class="linenos">3121</span></a>            <span class="p">)</span>
</span><span id="L-3122"><a href="#L-3122"><span class="linenos">3122</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3123"><a href="#L-3123"><span class="linenos">3123</span></a>                <span class="s2">&quot;- After a model and metrics are set, run `project.list_basic_parameters()` to see a list of the most important parameters that you might want to modify&quot;</span>
</span><span id="L-3124"><a href="#L-3124"><span class="linenos">3124</span></a>            <span class="p">)</span>
</span><span id="L-3125"><a href="#L-3125"><span class="linenos">3125</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3126"><a href="#L-3126"><span class="linenos">3126</span></a>                <span class="sa">f</span><span class="s2">&quot;- If you want to dig deeper, get the full dictionary with project._read_parameters() (it is a `ruamel.yaml.comments.CommentedMap` instance).&quot;</span>
</span><span id="L-3127"><a href="#L-3127"><span class="linenos">3127</span></a>            <span class="p">)</span>
</span><span id="L-3128"><a href="#L-3128"><span class="linenos">3128</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span>
</span><span id="L-3129"><a href="#L-3129"><span class="linenos">3129</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MODELS:&quot;</span><span class="p">)</span>
</span><span id="L-3130"><a href="#L-3130"><span class="linenos">3130</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3131"><a href="#L-3131"><span class="linenos">3131</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="L-3132"><a href="#L-3132"><span class="linenos">3132</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="L-3133"><a href="#L-3133"><span class="linenos">3133</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span>
</span><span id="L-3134"><a href="#L-3134"><span class="linenos">3134</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FEATURE EXTRACTORS:&quot;</span><span class="p">)</span>
</span><span id="L-3135"><a href="#L-3135"><span class="linenos">3135</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">extractor</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">feature_extractors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3136"><a href="#L-3136"><span class="linenos">3136</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="L-3137"><a href="#L-3137"><span class="linenos">3137</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">extractor</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="L-3138"><a href="#L-3138"><span class="linenos">3138</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;partition_method&quot;</span><span class="p">:</span>
</span><span id="L-3139"><a href="#L-3139"><span class="linenos">3139</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PARTITION METHODS:&quot;</span><span class="p">)</span>
</span><span id="L-3140"><a href="#L-3140"><span class="linenos">3140</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3141"><a href="#L-3141"><span class="linenos">3141</span></a>                <span class="n">BehaviorDataset</span><span class="o">.</span><span class="n">partition_train_test_val</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
</span><span id="L-3142"><a href="#L-3142"><span class="linenos">3142</span></a>                    <span class="s2">&quot;The partitioning method:&quot;</span>
</span><span id="L-3143"><a href="#L-3143"><span class="linenos">3143</span></a>                <span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;val_frac :&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3144"><a href="#L-3144"><span class="linenos">3144</span></a>            <span class="p">)</span>
</span><span id="L-3145"><a href="#L-3145"><span class="linenos">3145</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;metrics&quot;</span><span class="p">:</span>
</span><span id="L-3146"><a href="#L-3146"><span class="linenos">3146</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;METRICS:&quot;</span><span class="p">)</span>
</span><span id="L-3147"><a href="#L-3147"><span class="linenos">3147</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3148"><a href="#L-3148"><span class="linenos">3148</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="L-3149"><a href="#L-3149"><span class="linenos">3149</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="L-3150"><a href="#L-3150"><span class="linenos">3150</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
</span><span id="L-3151"><a href="#L-3151"><span class="linenos">3151</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DATA:&quot;</span><span class="p">)</span>
</span><span id="L-3152"><a href="#L-3152"><span class="linenos">3152</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video data: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3153"><a href="#L-3153"><span class="linenos">3153</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">input_stores</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">]</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="L-3154"><a href="#L-3154"><span class="linenos">3154</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Annotation data: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3155"><a href="#L-3155"><span class="linenos">3155</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">annotation_stores</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="p">]</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="L-3156"><a href="#L-3156"><span class="linenos">3156</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3157"><a href="#L-3157"><span class="linenos">3157</span></a>                <span class="s2">&quot;Annotation path and data path don&#39;t have to be separate, you can keep everything in one folder.&quot;</span>
</span><span id="L-3158"><a href="#L-3158"><span class="linenos">3158</span></a>            <span class="p">)</span>
</span><span id="L-3159"><a href="#L-3159"><span class="linenos">3159</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3160"><a href="#L-3160"><span class="linenos">3160</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="s2"> keyword is not recognized&quot;</span><span class="p">)</span>
</span><span id="L-3161"><a href="#L-3161"><span class="linenos">3161</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3162"><a href="#L-3162"><span class="linenos">3162</span></a>
</span><span id="L-3163"><a href="#L-3163"><span class="linenos">3163</span></a>    <span class="k">def</span> <span class="nf">_process_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="L-3164"><a href="#L-3164"><span class="linenos">3164</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-3165"><a href="#L-3165"><span class="linenos">3165</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
</span><span id="L-3166"><a href="#L-3166"><span class="linenos">3166</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">CommentedSet</span><span class="p">):</span>
</span><span id="L-3167"><a href="#L-3167"><span class="linenos">3167</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">}</span>
</span><span id="L-3168"><a href="#L-3168"><span class="linenos">3168</span></a>        <span class="k">return</span> <span class="n">value</span>
</span><span id="L-3169"><a href="#L-3169"><span class="linenos">3169</span></a>
</span><span id="L-3170"><a href="#L-3170"><span class="linenos">3170</span></a>    <span class="k">def</span> <span class="nf">_get_blanks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3171"><a href="#L-3171"><span class="linenos">3171</span></a>        <span class="n">caught</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3172"><a href="#L-3172"><span class="linenos">3172</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">(</span><span class="n">catch_blanks</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3173"><a href="#L-3173"><span class="linenos">3173</span></a>        <span class="k">for</span> <span class="n">big_key</span><span class="p">,</span> <span class="n">big_value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3174"><a href="#L-3174"><span class="linenos">3174</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">big_value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3175"><a href="#L-3175"><span class="linenos">3175</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;???&quot;</span><span class="p">:</span>
</span><span id="L-3176"><a href="#L-3176"><span class="linenos">3176</span></a>                    <span class="n">caught</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-3177"><a href="#L-3177"><span class="linenos">3177</span></a>                        <span class="p">(</span><span class="n">big_key</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">big_value</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
</span><span id="L-3178"><a href="#L-3178"><span class="linenos">3178</span></a>                    <span class="p">)</span>
</span><span id="L-3179"><a href="#L-3179"><span class="linenos">3179</span></a>        <span class="k">return</span> <span class="n">caught</span>
</span><span id="L-3180"><a href="#L-3180"><span class="linenos">3180</span></a>
</span><span id="L-3181"><a href="#L-3181"><span class="linenos">3181</span></a>    <span class="k">def</span> <span class="nf">list_blanks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blanks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-3182"><a href="#L-3182"><span class="linenos">3182</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3183"><a href="#L-3183"><span class="linenos">3183</span></a><span class="sd">        List parameters that need to be filled in</span>
</span><span id="L-3184"><a href="#L-3184"><span class="linenos">3184</span></a>
</span><span id="L-3185"><a href="#L-3185"><span class="linenos">3185</span></a><span class="sd">        Parameters</span>
</span><span id="L-3186"><a href="#L-3186"><span class="linenos">3186</span></a><span class="sd">        ----------</span>
</span><span id="L-3187"><a href="#L-3187"><span class="linenos">3187</span></a><span class="sd">        blanks : list, optional</span>
</span><span id="L-3188"><a href="#L-3188"><span class="linenos">3188</span></a><span class="sd">            a list of the parameters to list, if already known</span>
</span><span id="L-3189"><a href="#L-3189"><span class="linenos">3189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3190"><a href="#L-3190"><span class="linenos">3190</span></a>
</span><span id="L-3191"><a href="#L-3191"><span class="linenos">3191</span></a>        <span class="k">if</span> <span class="n">blanks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3192"><a href="#L-3192"><span class="linenos">3192</span></a>            <span class="n">blanks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_blanks</span><span class="p">()</span>
</span><span id="L-3193"><a href="#L-3193"><span class="linenos">3193</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blanks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3194"><a href="#L-3194"><span class="linenos">3194</span></a>            <span class="n">to_update</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="L-3195"><a href="#L-3195"><span class="linenos">3195</span></a>            <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">blanks</span><span class="p">:</span>
</span><span id="L-3196"><a href="#L-3196"><span class="linenos">3196</span></a>                <span class="n">to_update</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</span><span id="L-3197"><a href="#L-3197"><span class="linenos">3197</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before running experiments, please update all the blanks.&quot;</span><span class="p">)</span>
</span><span id="L-3198"><a href="#L-3198"><span class="linenos">3198</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To do that, you can run this.&quot;</span><span class="p">)</span>
</span><span id="L-3199"><a href="#L-3199"><span class="linenos">3199</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="L-3200"><a href="#L-3200"><span class="linenos">3200</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;project.update_parameters(&quot;</span><span class="p">)</span>
</span><span id="L-3201"><a href="#L-3201"><span class="linenos">3201</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="se">{{</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3202"><a href="#L-3202"><span class="linenos">3202</span></a>            <span class="k">for</span> <span class="n">big_key</span><span class="p">,</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">to_update</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3203"><a href="#L-3203"><span class="linenos">3203</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;        &quot;</span><span class="si">{</span><span class="n">big_key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-3204"><a href="#L-3204"><span class="linenos">3204</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="L-3205"><a href="#L-3205"><span class="linenos">3205</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: ..., </span><span class="si">{</span><span class="n">comment</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-3206"><a href="#L-3206"><span class="linenos">3206</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="se">}}</span><span class="s2">,&quot;</span><span class="p">)</span>
</span><span id="L-3207"><a href="#L-3207"><span class="linenos">3207</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="se">}}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3208"><a href="#L-3208"><span class="linenos">3208</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="L-3209"><a href="#L-3209"><span class="linenos">3209</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="L-3210"><a href="#L-3210"><span class="linenos">3210</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Replace ... with relevant values.&quot;</span><span class="p">)</span>
</span><span id="L-3211"><a href="#L-3211"><span class="linenos">3211</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3212"><a href="#L-3212"><span class="linenos">3212</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no blanks left!&quot;</span><span class="p">)</span>
</span><span id="L-3213"><a href="#L-3213"><span class="linenos">3213</span></a>
</span><span id="L-3214"><a href="#L-3214"><span class="linenos">3214</span></a>    <span class="k">def</span> <span class="nf">list_basic_parameters</span><span class="p">(</span>
</span><span id="L-3215"><a href="#L-3215"><span class="linenos">3215</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3216"><a href="#L-3216"><span class="linenos">3216</span></a>    <span class="p">):</span>
</span><span id="L-3217"><a href="#L-3217"><span class="linenos">3217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3218"><a href="#L-3218"><span class="linenos">3218</span></a><span class="sd">        Get a list of most relevant parameters and code to modify them</span>
</span><span id="L-3219"><a href="#L-3219"><span class="linenos">3219</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3220"><a href="#L-3220"><span class="linenos">3220</span></a>
</span><span id="L-3221"><a href="#L-3221"><span class="linenos">3221</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="L-3222"><a href="#L-3222"><span class="linenos">3222</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BASIC PARAMETERS:&quot;</span><span class="p">)</span>
</span><span id="L-3223"><a href="#L-3223"><span class="linenos">3223</span></a>        <span class="n">model_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="L-3224"><a href="#L-3224"><span class="linenos">3224</span></a>        <span class="n">metric_names</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;metric_functions&quot;</span><span class="p">]</span>
</span><span id="L-3225"><a href="#L-3225"><span class="linenos">3225</span></a>        <span class="n">loss_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;loss_function&quot;</span><span class="p">]</span>
</span><span id="L-3226"><a href="#L-3226"><span class="linenos">3226</span></a>        <span class="n">feature_extraction</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="L-3227"><a href="#L-3227"><span class="linenos">3227</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Here is a list of current parameters.&quot;</span><span class="p">)</span>
</span><span id="L-3228"><a href="#L-3228"><span class="linenos">3228</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3229"><a href="#L-3229"><span class="linenos">3229</span></a>            <span class="s2">&quot;You can copy this code, change the parameters you want to set and run it to update the project config.&quot;</span>
</span><span id="L-3230"><a href="#L-3230"><span class="linenos">3230</span></a>        <span class="p">)</span>
</span><span id="L-3231"><a href="#L-3231"><span class="linenos">3231</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="L-3232"><a href="#L-3232"><span class="linenos">3232</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;project.update_parameters(&quot;</span><span class="p">)</span>
</span><span id="L-3233"><a href="#L-3233"><span class="linenos">3233</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    {&quot;</span><span class="p">)</span>
</span><span id="L-3234"><a href="#L-3234"><span class="linenos">3234</span></a>        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;training&quot;</span><span class="p">]:</span>
</span><span id="L-3235"><a href="#L-3235"><span class="linenos">3235</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;        &quot;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-3236"><a href="#L-3236"><span class="linenos">3236</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>
</span><span id="L-3237"><a href="#L-3237"><span class="linenos">3237</span></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>
</span><span id="L-3238"><a href="#L-3238"><span class="linenos">3238</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3239"><a href="#L-3239"><span class="linenos">3239</span></a>                        <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-3240"><a href="#L-3240"><span class="linenos">3240</span></a>                    <span class="p">)</span>
</span><span id="L-3241"><a href="#L-3241"><span class="linenos">3241</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="L-3242"><a href="#L-3242"><span class="linenos">3242</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;losses&quot;: {&#39;</span><span class="p">)</span>
</span><span id="L-3243"><a href="#L-3243"><span class="linenos">3243</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">loss_name</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-3244"><a href="#L-3244"><span class="linenos">3244</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">]:</span>
</span><span id="L-3245"><a href="#L-3245"><span class="linenos">3245</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">]:</span>
</span><span id="L-3246"><a href="#L-3246"><span class="linenos">3246</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3247"><a href="#L-3247"><span class="linenos">3247</span></a>                    <span class="sa">f</span><span class="s1">&#39;                &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-3248"><a href="#L-3248"><span class="linenos">3248</span></a>                <span class="p">)</span>
</span><span id="L-3249"><a href="#L-3249"><span class="linenos">3249</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;            },&quot;</span><span class="p">)</span>
</span><span id="L-3250"><a href="#L-3250"><span class="linenos">3250</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="L-3251"><a href="#L-3251"><span class="linenos">3251</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;metrics&quot;: {&#39;</span><span class="p">)</span>
</span><span id="L-3252"><a href="#L-3252"><span class="linenos">3252</span></a>        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
</span><span id="L-3253"><a href="#L-3253"><span class="linenos">3253</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-3254"><a href="#L-3254"><span class="linenos">3254</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]:</span>
</span><span id="L-3255"><a href="#L-3255"><span class="linenos">3255</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3256"><a href="#L-3256"><span class="linenos">3256</span></a>                    <span class="sa">f</span><span class="s1">&#39;                &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-3257"><a href="#L-3257"><span class="linenos">3257</span></a>                <span class="p">)</span>
</span><span id="L-3258"><a href="#L-3258"><span class="linenos">3258</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;            },&quot;</span><span class="p">)</span>
</span><span id="L-3259"><a href="#L-3259"><span class="linenos">3259</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="L-3260"><a href="#L-3260"><span class="linenos">3260</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;model&quot;: {&#39;</span><span class="p">)</span>
</span><span id="L-3261"><a href="#L-3261"><span class="linenos">3261</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="n">model_name</span><span class="p">]:</span>
</span><span id="L-3262"><a href="#L-3262"><span class="linenos">3262</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]:</span>
</span><span id="L-3263"><a href="#L-3263"><span class="linenos">3263</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3264"><a href="#L-3264"><span class="linenos">3264</span></a>                    <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-3265"><a href="#L-3265"><span class="linenos">3265</span></a>                <span class="p">)</span>
</span><span id="L-3266"><a href="#L-3266"><span class="linenos">3266</span></a>
</span><span id="L-3267"><a href="#L-3267"><span class="linenos">3267</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="L-3268"><a href="#L-3268"><span class="linenos">3268</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;features&quot;: {&#39;</span><span class="p">)</span>
</span><span id="L-3269"><a href="#L-3269"><span class="linenos">3269</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="n">feature_extraction</span><span class="p">]:</span>
</span><span id="L-3270"><a href="#L-3270"><span class="linenos">3270</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]:</span>
</span><span id="L-3271"><a href="#L-3271"><span class="linenos">3271</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3272"><a href="#L-3272"><span class="linenos">3272</span></a>                    <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-3273"><a href="#L-3273"><span class="linenos">3273</span></a>                <span class="p">)</span>
</span><span id="L-3274"><a href="#L-3274"><span class="linenos">3274</span></a>
</span><span id="L-3275"><a href="#L-3275"><span class="linenos">3275</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="L-3276"><a href="#L-3276"><span class="linenos">3276</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;augmentations&quot;: {&#39;</span><span class="p">)</span>
</span><span id="L-3277"><a href="#L-3277"><span class="linenos">3277</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">][</span><span class="n">feature_extraction</span><span class="p">]:</span>
</span><span id="L-3278"><a href="#L-3278"><span class="linenos">3278</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]:</span>
</span><span id="L-3279"><a href="#L-3279"><span class="linenos">3279</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3280"><a href="#L-3280"><span class="linenos">3280</span></a>                    <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-3281"><a href="#L-3281"><span class="linenos">3281</span></a>                <span class="p">)</span>
</span><span id="L-3282"><a href="#L-3282"><span class="linenos">3282</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="L-3283"><a href="#L-3283"><span class="linenos">3283</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    },&quot;</span><span class="p">)</span>
</span><span id="L-3284"><a href="#L-3284"><span class="linenos">3284</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="L-3285"><a href="#L-3285"><span class="linenos">3285</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="L-3286"><a href="#L-3286"><span class="linenos">3286</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3287"><a href="#L-3287"><span class="linenos">3287</span></a>
</span><span id="L-3288"><a href="#L-3288"><span class="linenos">3288</span></a>    <span class="k">def</span> <span class="nf">_create_record</span><span class="p">(</span>
</span><span id="L-3289"><a href="#L-3289"><span class="linenos">3289</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3290"><a href="#L-3290"><span class="linenos">3290</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3291"><a href="#L-3291"><span class="linenos">3291</span></a>        <span class="n">behaviors_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-3292"><a href="#L-3292"><span class="linenos">3292</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3293"><a href="#L-3293"><span class="linenos">3293</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3294"><a href="#L-3294"><span class="linenos">3294</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3295"><a href="#L-3295"><span class="linenos">3295</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3296"><a href="#L-3296"><span class="linenos">3296</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3297"><a href="#L-3297"><span class="linenos">3297</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3298"><a href="#L-3298"><span class="linenos">3298</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3299"><a href="#L-3299"><span class="linenos">3299</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-3300"><a href="#L-3300"><span class="linenos">3300</span></a>        <span class="n">n_seeds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-3301"><a href="#L-3301"><span class="linenos">3301</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskDispatcher</span><span class="p">:</span>
</span><span id="L-3302"><a href="#L-3302"><span class="linenos">3302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3303"><a href="#L-3303"><span class="linenos">3303</span></a><span class="sd">        Create a meta data episode record</span>
</span><span id="L-3304"><a href="#L-3304"><span class="linenos">3304</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3305"><a href="#L-3305"><span class="linenos">3305</span></a>
</span><span id="L-3306"><a href="#L-3306"><span class="linenos">3306</span></a>        <span class="k">if</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="L-3307"><a href="#L-3307"><span class="linenos">3307</span></a>            <span class="k">return</span>
</span><span id="L-3308"><a href="#L-3308"><span class="linenos">3308</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span> <span class="ow">or</span> <span class="n">n_seeds</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-3309"><a href="#L-3309"><span class="linenos">3309</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3310"><a href="#L-3310"><span class="linenos">3310</span></a>                <span class="sa">f</span><span class="s2">&quot;The n_seeds parameter has to be an integer larger than 0; got </span><span class="si">{</span><span class="n">n_seeds</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3311"><a href="#L-3311"><span class="linenos">3311</span></a>            <span class="p">)</span>
</span><span id="L-3312"><a href="#L-3312"><span class="linenos">3312</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3313"><a href="#L-3313"><span class="linenos">3313</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-3314"><a href="#L-3314"><span class="linenos">3314</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="L-3315"><a href="#L-3315"><span class="linenos">3315</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">parameters_update</span><span class="p">)</span>
</span><span id="L-3316"><a href="#L-3316"><span class="linenos">3316</span></a>        <span class="k">if</span> <span class="n">load_search</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3317"><a href="#L-3317"><span class="linenos">3317</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_with_search</span><span class="p">(</span>
</span><span id="L-3318"><a href="#L-3318"><span class="linenos">3318</span></a>                <span class="n">parameters</span><span class="p">,</span> <span class="n">load_search</span><span class="p">,</span> <span class="n">load_parameters</span><span class="p">,</span> <span class="n">round_to_binary</span>
</span><span id="L-3319"><a href="#L-3319"><span class="linenos">3319</span></a>            <span class="p">)</span>
</span><span id="L-3320"><a href="#L-3320"><span class="linenos">3320</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span><span class="p">(</span>
</span><span id="L-3321"><a href="#L-3321"><span class="linenos">3321</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-3322"><a href="#L-3322"><span class="linenos">3322</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-3323"><a href="#L-3323"><span class="linenos">3323</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-3324"><a href="#L-3324"><span class="linenos">3324</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-3325"><a href="#L-3325"><span class="linenos">3325</span></a>            <span class="n">only_load_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-3326"><a href="#L-3326"><span class="linenos">3326</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="L-3327"><a href="#L-3327"><span class="linenos">3327</span></a>            <span class="n">continuing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-3328"><a href="#L-3328"><span class="linenos">3328</span></a>        <span class="p">)</span>
</span><span id="L-3329"><a href="#L-3329"><span class="linenos">3329</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">behaviors_dict</span><span class="p">)</span>
</span><span id="L-3330"><a href="#L-3330"><span class="linenos">3330</span></a>        <span class="k">return</span> <span class="n">task</span>
</span><span id="L-3331"><a href="#L-3331"><span class="linenos">3331</span></a>
</span><span id="L-3332"><a href="#L-3332"><span class="linenos">3332</span></a>    <span class="k">def</span> <span class="nf">_save_thresholds</span><span class="p">(</span>
</span><span id="L-3333"><a href="#L-3333"><span class="linenos">3333</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3334"><a href="#L-3334"><span class="linenos">3334</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-3335"><a href="#L-3335"><span class="linenos">3335</span></a>        <span class="n">metric_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3336"><a href="#L-3336"><span class="linenos">3336</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-3337"><a href="#L-3337"><span class="linenos">3337</span></a>        <span class="n">thresholds</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-3338"><a href="#L-3338"><span class="linenos">3338</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-3339"><a href="#L-3339"><span class="linenos">3339</span></a>    <span class="p">):</span>
</span><span id="L-3340"><a href="#L-3340"><span class="linenos">3340</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3341"><a href="#L-3341"><span class="linenos">3341</span></a><span class="sd">        Save optimal decision thresholds in the meta records</span>
</span><span id="L-3342"><a href="#L-3342"><span class="linenos">3342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3343"><a href="#L-3343"><span class="linenos">3343</span></a>
</span><span id="L-3344"><a href="#L-3344"><span class="linenos">3344</span></a>        <span class="n">metric_parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span>
</span><span id="L-3345"><a href="#L-3345"><span class="linenos">3345</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_thresholds</span><span class="p">()</span><span class="o">.</span><span class="n">save_thresholds</span><span class="p">(</span>
</span><span id="L-3346"><a href="#L-3346"><span class="linenos">3346</span></a>            <span class="n">episode_names</span><span class="p">,</span> <span class="n">load_epochs</span><span class="p">,</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">,</span> <span class="n">thresholds</span>
</span><span id="L-3347"><a href="#L-3347"><span class="linenos">3347</span></a>        <span class="p">)</span>
</span><span id="L-3348"><a href="#L-3348"><span class="linenos">3348</span></a>
</span><span id="L-3349"><a href="#L-3349"><span class="linenos">3349</span></a>    <span class="k">def</span> <span class="nf">_save_episode</span><span class="p">(</span>
</span><span id="L-3350"><a href="#L-3350"><span class="linenos">3350</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3351"><a href="#L-3351"><span class="linenos">3351</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3352"><a href="#L-3352"><span class="linenos">3352</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-3353"><a href="#L-3353"><span class="linenos">3353</span></a>        <span class="n">behaviors_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-3354"><a href="#L-3354"><span class="linenos">3354</span></a>        <span class="n">suppress_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3355"><a href="#L-3355"><span class="linenos">3355</span></a>        <span class="n">training_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3356"><a href="#L-3356"><span class="linenos">3356</span></a>        <span class="n">norm_stats</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3357"><a href="#L-3357"><span class="linenos">3357</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3358"><a href="#L-3358"><span class="linenos">3358</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3359"><a href="#L-3359"><span class="linenos">3359</span></a><span class="sd">        Save an episode in the meta files</span>
</span><span id="L-3360"><a href="#L-3360"><span class="linenos">3360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3361"><a href="#L-3361"><span class="linenos">3361</span></a>
</span><span id="L-3362"><a href="#L-3362"><span class="linenos">3362</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3363"><a href="#L-3363"><span class="linenos">3363</span></a>            <span class="n">split_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_info_from_filename</span><span class="p">(</span>
</span><span id="L-3364"><a href="#L-3364"><span class="linenos">3364</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span>
</span><span id="L-3365"><a href="#L-3365"><span class="linenos">3365</span></a>            <span class="p">)</span>
</span><span id="L-3366"><a href="#L-3366"><span class="linenos">3366</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span>
</span><span id="L-3367"><a href="#L-3367"><span class="linenos">3367</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-3368"><a href="#L-3368"><span class="linenos">3368</span></a>            <span class="k">pass</span>
</span><span id="L-3369"><a href="#L-3369"><span class="linenos">3369</span></a>        <span class="k">if</span> <span class="n">norm_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3370"><a href="#L-3370"><span class="linenos">3370</span></a>            <span class="n">norm_stats</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">norm_stats</span><span class="p">)</span>
</span><span id="L-3371"><a href="#L-3371"><span class="linenos">3371</span></a>        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm_stats</span>
</span><span id="L-3372"><a href="#L-3372"><span class="linenos">3372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">save_episode</span><span class="p">(</span>
</span><span id="L-3373"><a href="#L-3373"><span class="linenos">3373</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-3374"><a href="#L-3374"><span class="linenos">3374</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-3375"><a href="#L-3375"><span class="linenos">3375</span></a>            <span class="n">behaviors_dict</span><span class="p">,</span>
</span><span id="L-3376"><a href="#L-3376"><span class="linenos">3376</span></a>            <span class="n">suppress_validation</span><span class="o">=</span><span class="n">suppress_validation</span><span class="p">,</span>
</span><span id="L-3377"><a href="#L-3377"><span class="linenos">3377</span></a>            <span class="n">training_time</span><span class="o">=</span><span class="n">training_time</span><span class="p">,</span>
</span><span id="L-3378"><a href="#L-3378"><span class="linenos">3378</span></a>        <span class="p">)</span>
</span><span id="L-3379"><a href="#L-3379"><span class="linenos">3379</span></a>
</span><span id="L-3380"><a href="#L-3380"><span class="linenos">3380</span></a>    <span class="k">def</span> <span class="nf">_update_episode_results</span><span class="p">(</span>
</span><span id="L-3381"><a href="#L-3381"><span class="linenos">3381</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3382"><a href="#L-3382"><span class="linenos">3382</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3383"><a href="#L-3383"><span class="linenos">3383</span></a>        <span class="n">logs</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span>
</span><span id="L-3384"><a href="#L-3384"><span class="linenos">3384</span></a>        <span class="n">training_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3385"><a href="#L-3385"><span class="linenos">3385</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3386"><a href="#L-3386"><span class="linenos">3386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3387"><a href="#L-3387"><span class="linenos">3387</span></a><span class="sd">        Save the results of a run in the meta files</span>
</span><span id="L-3388"><a href="#L-3388"><span class="linenos">3388</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3389"><a href="#L-3389"><span class="linenos">3389</span></a>
</span><span id="L-3390"><a href="#L-3390"><span class="linenos">3390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">update_episode_results</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">logs</span><span class="p">,</span> <span class="n">training_time</span><span class="p">)</span>
</span><span id="L-3391"><a href="#L-3391"><span class="linenos">3391</span></a>
</span><span id="L-3392"><a href="#L-3392"><span class="linenos">3392</span></a>    <span class="k">def</span> <span class="nf">_save_prediction</span><span class="p">(</span>
</span><span id="L-3393"><a href="#L-3393"><span class="linenos">3393</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3394"><a href="#L-3394"><span class="linenos">3394</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3395"><a href="#L-3395"><span class="linenos">3395</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-3396"><a href="#L-3396"><span class="linenos">3396</span></a>        <span class="n">behaviors_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-3397"><a href="#L-3397"><span class="linenos">3397</span></a>        <span class="n">embedding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3398"><a href="#L-3398"><span class="linenos">3398</span></a>        <span class="n">inference_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3399"><a href="#L-3399"><span class="linenos">3399</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3400"><a href="#L-3400"><span class="linenos">3400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3401"><a href="#L-3401"><span class="linenos">3401</span></a><span class="sd">        Save a prediction in the meta files</span>
</span><span id="L-3402"><a href="#L-3402"><span class="linenos">3402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3403"><a href="#L-3403"><span class="linenos">3403</span></a>
</span><span id="L-3404"><a href="#L-3404"><span class="linenos">3404</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="L-3405"><a href="#L-3405"><span class="linenos">3405</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-3406"><a href="#L-3406"><span class="linenos">3406</span></a>            <span class="p">{</span><span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;embedding&quot;</span><span class="p">:</span> <span class="n">embedding</span><span class="p">,</span> <span class="s2">&quot;inference_time&quot;</span><span class="p">:</span> <span class="n">inference_time</span><span class="p">}},</span>
</span><span id="L-3407"><a href="#L-3407"><span class="linenos">3407</span></a>        <span class="p">)</span>
</span><span id="L-3408"><a href="#L-3408"><span class="linenos">3408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">save_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">behaviors_dict</span><span class="p">)</span>
</span><span id="L-3409"><a href="#L-3409"><span class="linenos">3409</span></a>
</span><span id="L-3410"><a href="#L-3410"><span class="linenos">3410</span></a>    <span class="k">def</span> <span class="nf">_save_search</span><span class="p">(</span>
</span><span id="L-3411"><a href="#L-3411"><span class="linenos">3411</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3412"><a href="#L-3412"><span class="linenos">3412</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3413"><a href="#L-3413"><span class="linenos">3413</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-3414"><a href="#L-3414"><span class="linenos">3414</span></a>        <span class="n">n_trials</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-3415"><a href="#L-3415"><span class="linenos">3415</span></a>        <span class="n">best_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-3416"><a href="#L-3416"><span class="linenos">3416</span></a>        <span class="n">best_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-3417"><a href="#L-3417"><span class="linenos">3417</span></a>        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3418"><a href="#L-3418"><span class="linenos">3418</span></a>        <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-3419"><a href="#L-3419"><span class="linenos">3419</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3420"><a href="#L-3420"><span class="linenos">3420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3421"><a href="#L-3421"><span class="linenos">3421</span></a><span class="sd">        Save a hyperparameter search in the meta files</span>
</span><span id="L-3422"><a href="#L-3422"><span class="linenos">3422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3423"><a href="#L-3423"><span class="linenos">3423</span></a>
</span><span id="L-3424"><a href="#L-3424"><span class="linenos">3424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">save_search</span><span class="p">(</span>
</span><span id="L-3425"><a href="#L-3425"><span class="linenos">3425</span></a>            <span class="n">search_name</span><span class="p">,</span>
</span><span id="L-3426"><a href="#L-3426"><span class="linenos">3426</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="L-3427"><a href="#L-3427"><span class="linenos">3427</span></a>            <span class="n">n_trials</span><span class="p">,</span>
</span><span id="L-3428"><a href="#L-3428"><span class="linenos">3428</span></a>            <span class="n">best_params</span><span class="p">,</span>
</span><span id="L-3429"><a href="#L-3429"><span class="linenos">3429</span></a>            <span class="n">best_value</span><span class="p">,</span>
</span><span id="L-3430"><a href="#L-3430"><span class="linenos">3430</span></a>            <span class="n">metric</span><span class="p">,</span>
</span><span id="L-3431"><a href="#L-3431"><span class="linenos">3431</span></a>            <span class="n">search_space</span><span class="p">,</span>
</span><span id="L-3432"><a href="#L-3432"><span class="linenos">3432</span></a>        <span class="p">)</span>
</span><span id="L-3433"><a href="#L-3433"><span class="linenos">3433</span></a>
</span><span id="L-3434"><a href="#L-3434"><span class="linenos">3434</span></a>    <span class="k">def</span> <span class="nf">_save_stores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3435"><a href="#L-3435"><span class="linenos">3435</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3436"><a href="#L-3436"><span class="linenos">3436</span></a><span class="sd">        Save a pickled dataset in the meta files</span>
</span><span id="L-3437"><a href="#L-3437"><span class="linenos">3437</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3438"><a href="#L-3438"><span class="linenos">3438</span></a>
</span><span id="L-3439"><a href="#L-3439"><span class="linenos">3439</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">])</span>
</span><span id="L-3440"><a href="#L-3440"><span class="linenos">3440</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets</span><span class="p">()</span><span class="o">.</span><span class="n">save_store</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_pars</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</span><span id="L-3441"><a href="#L-3441"><span class="linenos">3441</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_metadata_backup</span><span class="p">()</span>
</span><span id="L-3442"><a href="#L-3442"><span class="linenos">3442</span></a>
</span><span id="L-3443"><a href="#L-3443"><span class="linenos">3443</span></a>    <span class="k">def</span> <span class="nf">_remove_stores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">remove_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3444"><a href="#L-3444"><span class="linenos">3444</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3445"><a href="#L-3445"><span class="linenos">3445</span></a><span class="sd">        Remove the pre-computed features folder</span>
</span><span id="L-3446"><a href="#L-3446"><span class="linenos">3446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3447"><a href="#L-3447"><span class="linenos">3447</span></a>
</span><span id="L-3448"><a href="#L-3448"><span class="linenos">3448</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">])</span>
</span><span id="L-3449"><a href="#L-3449"><span class="linenos">3449</span></a>        <span class="k">if</span> <span class="n">remove_active</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_active_datasets</span><span class="p">():</span>
</span><span id="L-3450"><a href="#L-3450"><span class="linenos">3450</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_saved_features</span><span class="p">([</span><span class="n">name</span><span class="p">])</span>
</span><span id="L-3451"><a href="#L-3451"><span class="linenos">3451</span></a>
</span><span id="L-3452"><a href="#L-3452"><span class="linenos">3452</span></a>    <span class="k">def</span> <span class="nf">_check_episode_validity</span><span class="p">(</span>
</span><span id="L-3453"><a href="#L-3453"><span class="linenos">3453</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allow_doublecolon</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3454"><a href="#L-3454"><span class="linenos">3454</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3455"><a href="#L-3455"><span class="linenos">3455</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3456"><a href="#L-3456"><span class="linenos">3456</span></a><span class="sd">        Check whether the episode name is valid</span>
</span><span id="L-3457"><a href="#L-3457"><span class="linenos">3457</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3458"><a href="#L-3458"><span class="linenos">3458</span></a>
</span><span id="L-3459"><a href="#L-3459"><span class="linenos">3459</span></a>        <span class="k">if</span> <span class="n">episode_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
</span><span id="L-3460"><a href="#L-3460"><span class="linenos">3460</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3461"><a href="#L-3461"><span class="linenos">3461</span></a>                <span class="s2">&quot;Names starting with an underscore are reserved by dlc2action and cannot be used!&quot;</span>
</span><span id="L-3462"><a href="#L-3462"><span class="linenos">3462</span></a>            <span class="p">)</span>
</span><span id="L-3463"><a href="#L-3463"><span class="linenos">3463</span></a>        <span class="k">elif</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">episode_name</span><span class="p">:</span>
</span><span id="L-3464"><a href="#L-3464"><span class="linenos">3464</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Names containing &#39;.&#39; cannot be used!&quot;</span><span class="p">)</span>
</span><span id="L-3465"><a href="#L-3465"><span class="linenos">3465</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_doublecolon</span> <span class="ow">and</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">episode_name</span><span class="p">:</span>
</span><span id="L-3466"><a href="#L-3466"><span class="linenos">3466</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3467"><a href="#L-3467"><span class="linenos">3467</span></a>                <span class="s2">&quot;Names containing &#39;#&#39; are reserved by dlc2action and cannot be used!&quot;</span>
</span><span id="L-3468"><a href="#L-3468"><span class="linenos">3468</span></a>            <span class="p">)</span>
</span><span id="L-3469"><a href="#L-3469"><span class="linenos">3469</span></a>        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-3470"><a href="#L-3470"><span class="linenos">3470</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-3471"><a href="#L-3471"><span class="linenos">3471</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">episode_name</span><span class="p">):</span>
</span><span id="L-3472"><a href="#L-3472"><span class="linenos">3472</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3473"><a href="#L-3473"><span class="linenos">3473</span></a>                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> name is already taken! Set force=True to overwrite.&quot;</span>
</span><span id="L-3474"><a href="#L-3474"><span class="linenos">3474</span></a>            <span class="p">)</span>
</span><span id="L-3475"><a href="#L-3475"><span class="linenos">3475</span></a>
</span><span id="L-3476"><a href="#L-3476"><span class="linenos">3476</span></a>    <span class="k">def</span> <span class="nf">_check_search_validity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3477"><a href="#L-3477"><span class="linenos">3477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3478"><a href="#L-3478"><span class="linenos">3478</span></a><span class="sd">        Check whether the search name is valid</span>
</span><span id="L-3479"><a href="#L-3479"><span class="linenos">3479</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3480"><a href="#L-3480"><span class="linenos">3480</span></a>
</span><span id="L-3481"><a href="#L-3481"><span class="linenos">3481</span></a>        <span class="k">if</span> <span class="n">search_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
</span><span id="L-3482"><a href="#L-3482"><span class="linenos">3482</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3483"><a href="#L-3483"><span class="linenos">3483</span></a>                <span class="s2">&quot;Names starting with an underscore are reserved by dlc2action and cannot be used!&quot;</span>
</span><span id="L-3484"><a href="#L-3484"><span class="linenos">3484</span></a>            <span class="p">)</span>
</span><span id="L-3485"><a href="#L-3485"><span class="linenos">3485</span></a>        <span class="k">elif</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">search_name</span><span class="p">:</span>
</span><span id="L-3486"><a href="#L-3486"><span class="linenos">3486</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Names containing &#39;.&#39; cannot be used!&quot;</span><span class="p">)</span>
</span><span id="L-3487"><a href="#L-3487"><span class="linenos">3487</span></a>        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-3488"><a href="#L-3488"><span class="linenos">3488</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_search</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="L-3489"><a href="#L-3489"><span class="linenos">3489</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">search_name</span><span class="p">):</span>
</span><span id="L-3490"><a href="#L-3490"><span class="linenos">3490</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2"> name is already taken!&quot;</span><span class="p">)</span>
</span><span id="L-3491"><a href="#L-3491"><span class="linenos">3491</span></a>
</span><span id="L-3492"><a href="#L-3492"><span class="linenos">3492</span></a>    <span class="k">def</span> <span class="nf">_check_prediction_validity</span><span class="p">(</span>
</span><span id="L-3493"><a href="#L-3493"><span class="linenos">3493</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3494"><a href="#L-3494"><span class="linenos">3494</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3495"><a href="#L-3495"><span class="linenos">3495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3496"><a href="#L-3496"><span class="linenos">3496</span></a><span class="sd">        Check whether the prediction name is valid</span>
</span><span id="L-3497"><a href="#L-3497"><span class="linenos">3497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3498"><a href="#L-3498"><span class="linenos">3498</span></a>
</span><span id="L-3499"><a href="#L-3499"><span class="linenos">3499</span></a>        <span class="k">if</span> <span class="n">prediction_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
</span><span id="L-3500"><a href="#L-3500"><span class="linenos">3500</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3501"><a href="#L-3501"><span class="linenos">3501</span></a>                <span class="s2">&quot;Names starting with an underscore are reserved by dlc2action and cannot be used!&quot;</span>
</span><span id="L-3502"><a href="#L-3502"><span class="linenos">3502</span></a>            <span class="p">)</span>
</span><span id="L-3503"><a href="#L-3503"><span class="linenos">3503</span></a>        <span class="k">elif</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">prediction_name</span><span class="p">:</span>
</span><span id="L-3504"><a href="#L-3504"><span class="linenos">3504</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Names containing &#39;.&#39; cannot be used!&quot;</span><span class="p">)</span>
</span><span id="L-3505"><a href="#L-3505"><span class="linenos">3505</span></a>        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-3506"><a href="#L-3506"><span class="linenos">3506</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_prediction</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">)</span>
</span><span id="L-3507"><a href="#L-3507"><span class="linenos">3507</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">):</span>
</span><span id="L-3508"><a href="#L-3508"><span class="linenos">3508</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2"> name is already taken!&quot;</span><span class="p">)</span>
</span><span id="L-3509"><a href="#L-3509"><span class="linenos">3509</span></a>
</span><span id="L-3510"><a href="#L-3510"><span class="linenos">3510</span></a>    <span class="k">def</span> <span class="nf">_training_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-3511"><a href="#L-3511"><span class="linenos">3511</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3512"><a href="#L-3512"><span class="linenos">3512</span></a><span class="sd">        Get the training time of an episode in seconds</span>
</span><span id="L-3513"><a href="#L-3513"><span class="linenos">3513</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3514"><a href="#L-3514"><span class="linenos">3514</span></a>
</span><span id="L-3515"><a href="#L-3515"><span class="linenos">3515</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span><span class="o">.</span><span class="n">training_time</span><span class="p">()</span>
</span><span id="L-3516"><a href="#L-3516"><span class="linenos">3516</span></a>
</span><span id="L-3517"><a href="#L-3517"><span class="linenos">3517</span></a>    <span class="k">def</span> <span class="nf">_mask_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3518"><a href="#L-3518"><span class="linenos">3518</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3519"><a href="#L-3519"><span class="linenos">3519</span></a><span class="sd">        Get the path to the masks folder</span>
</span><span id="L-3520"><a href="#L-3520"><span class="linenos">3520</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3521"><a href="#L-3521"><span class="linenos">3521</span></a>
</span><span id="L-3522"><a href="#L-3522"><span class="linenos">3522</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">)</span>
</span><span id="L-3523"><a href="#L-3523"><span class="linenos">3523</span></a>
</span><span id="L-3524"><a href="#L-3524"><span class="linenos">3524</span></a>    <span class="k">def</span> <span class="nf">_thresholds_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3525"><a href="#L-3525"><span class="linenos">3525</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3526"><a href="#L-3526"><span class="linenos">3526</span></a><span class="sd">        Get the path to the thresholds meta file</span>
</span><span id="L-3527"><a href="#L-3527"><span class="linenos">3527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3528"><a href="#L-3528"><span class="linenos">3528</span></a>
</span><span id="L-3529"><a href="#L-3529"><span class="linenos">3529</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;thresholds.pickle&quot;</span><span class="p">)</span>
</span><span id="L-3530"><a href="#L-3530"><span class="linenos">3530</span></a>
</span><span id="L-3531"><a href="#L-3531"><span class="linenos">3531</span></a>    <span class="k">def</span> <span class="nf">_episodes_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3532"><a href="#L-3532"><span class="linenos">3532</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3533"><a href="#L-3533"><span class="linenos">3533</span></a><span class="sd">        Get the path to the episodes meta file</span>
</span><span id="L-3534"><a href="#L-3534"><span class="linenos">3534</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3535"><a href="#L-3535"><span class="linenos">3535</span></a>
</span><span id="L-3536"><a href="#L-3536"><span class="linenos">3536</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;episodes.pickle&quot;</span><span class="p">)</span>
</span><span id="L-3537"><a href="#L-3537"><span class="linenos">3537</span></a>
</span><span id="L-3538"><a href="#L-3538"><span class="linenos">3538</span></a>    <span class="k">def</span> <span class="nf">_saved_datasets_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3539"><a href="#L-3539"><span class="linenos">3539</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3540"><a href="#L-3540"><span class="linenos">3540</span></a><span class="sd">        Get the path to the datasets meta file</span>
</span><span id="L-3541"><a href="#L-3541"><span class="linenos">3541</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3542"><a href="#L-3542"><span class="linenos">3542</span></a>
</span><span id="L-3543"><a href="#L-3543"><span class="linenos">3543</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;saved_datasets.pickle&quot;</span><span class="p">)</span>
</span><span id="L-3544"><a href="#L-3544"><span class="linenos">3544</span></a>
</span><span id="L-3545"><a href="#L-3545"><span class="linenos">3545</span></a>    <span class="k">def</span> <span class="nf">_predictions_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3546"><a href="#L-3546"><span class="linenos">3546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3547"><a href="#L-3547"><span class="linenos">3547</span></a><span class="sd">        Get the path to the predictions meta file</span>
</span><span id="L-3548"><a href="#L-3548"><span class="linenos">3548</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3549"><a href="#L-3549"><span class="linenos">3549</span></a>
</span><span id="L-3550"><a href="#L-3550"><span class="linenos">3550</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;predictions.pickle&quot;</span><span class="p">)</span>
</span><span id="L-3551"><a href="#L-3551"><span class="linenos">3551</span></a>
</span><span id="L-3552"><a href="#L-3552"><span class="linenos">3552</span></a>    <span class="k">def</span> <span class="nf">_dataset_store_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3553"><a href="#L-3553"><span class="linenos">3553</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3554"><a href="#L-3554"><span class="linenos">3554</span></a><span class="sd">        Get the path to a specific pickled dataset</span>
</span><span id="L-3555"><a href="#L-3555"><span class="linenos">3555</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3556"><a href="#L-3556"><span class="linenos">3556</span></a>
</span><span id="L-3557"><a href="#L-3557"><span class="linenos">3557</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;saved_datasets&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.pickle&quot;</span><span class="p">)</span>
</span><span id="L-3558"><a href="#L-3558"><span class="linenos">3558</span></a>
</span><span id="L-3559"><a href="#L-3559"><span class="linenos">3559</span></a>    <span class="k">def</span> <span class="nf">_searches_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3560"><a href="#L-3560"><span class="linenos">3560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3561"><a href="#L-3561"><span class="linenos">3561</span></a><span class="sd">        Get the path to the hyperparameter search meta file</span>
</span><span id="L-3562"><a href="#L-3562"><span class="linenos">3562</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3563"><a href="#L-3563"><span class="linenos">3563</span></a>
</span><span id="L-3564"><a href="#L-3564"><span class="linenos">3564</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;searches.pickle&quot;</span><span class="p">)</span>
</span><span id="L-3565"><a href="#L-3565"><span class="linenos">3565</span></a>
</span><span id="L-3566"><a href="#L-3566"><span class="linenos">3566</span></a>    <span class="k">def</span> <span class="nf">_search_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3567"><a href="#L-3567"><span class="linenos">3567</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3568"><a href="#L-3568"><span class="linenos">3568</span></a><span class="sd">        Get the default path to the graph folder for a specific hyperparameter search</span>
</span><span id="L-3569"><a href="#L-3569"><span class="linenos">3569</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3570"><a href="#L-3570"><span class="linenos">3570</span></a>
</span><span id="L-3571"><a href="#L-3571"><span class="linenos">3571</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;searches&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-3572"><a href="#L-3572"><span class="linenos">3572</span></a>
</span><span id="L-3573"><a href="#L-3573"><span class="linenos">3573</span></a>    <span class="k">def</span> <span class="nf">_version_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-3574"><a href="#L-3574"><span class="linenos">3574</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3575"><a href="#L-3575"><span class="linenos">3575</span></a><span class="sd">        Get the path to the version file</span>
</span><span id="L-3576"><a href="#L-3576"><span class="linenos">3576</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3577"><a href="#L-3577"><span class="linenos">3577</span></a>
</span><span id="L-3578"><a href="#L-3578"><span class="linenos">3578</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;version.txt&quot;</span><span class="p">)</span>
</span><span id="L-3579"><a href="#L-3579"><span class="linenos">3579</span></a>
</span><span id="L-3580"><a href="#L-3580"><span class="linenos">3580</span></a>    <span class="k">def</span> <span class="nf">_default_split_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-3581"><a href="#L-3581"><span class="linenos">3581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3582"><a href="#L-3582"><span class="linenos">3582</span></a><span class="sd">        Generate a path to a split file from split parameters</span>
</span><span id="L-3583"><a href="#L-3583"><span class="linenos">3583</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3584"><a href="#L-3584"><span class="linenos">3584</span></a>
</span><span id="L-3585"><a href="#L-3585"><span class="linenos">3585</span></a>        <span class="k">if</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">):</span>
</span><span id="L-3586"><a href="#L-3586"><span class="linenos">3586</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-3587"><a href="#L-3587"><span class="linenos">3587</span></a>        <span class="n">val_frac</span> <span class="o">=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;val_frac&quot;</span><span class="p">]</span>
</span><span id="L-3588"><a href="#L-3588"><span class="linenos">3588</span></a>        <span class="n">test_frac</span> <span class="o">=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;test_frac&quot;</span><span class="p">]</span>
</span><span id="L-3589"><a href="#L-3589"><span class="linenos">3589</span></a>        <span class="n">split_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_val</span><span class="si">{</span><span class="n">val_frac</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s1">%_test</span><span class="si">{</span><span class="n">test_frac</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s1">%_len</span><span class="si">{</span><span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_overlap</span><span class="si">{</span><span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-3590"><a href="#L-3590"><span class="linenos">3590</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;only_load_annotated&quot;</span><span class="p">]:</span>
</span><span id="L-3591"><a href="#L-3591"><span class="linenos">3591</span></a>            <span class="n">split_name</span> <span class="o">+=</span> <span class="s2">&quot;_all&quot;</span>
</span><span id="L-3592"><a href="#L-3592"><span class="linenos">3592</span></a>        <span class="n">split_name</span> <span class="o">+=</span> <span class="s2">&quot;.txt&quot;</span>
</span><span id="L-3593"><a href="#L-3593"><span class="linenos">3593</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;splits&quot;</span><span class="p">,</span> <span class="n">split_name</span><span class="p">)</span>
</span><span id="L-3594"><a href="#L-3594"><span class="linenos">3594</span></a>
</span><span id="L-3595"><a href="#L-3595"><span class="linenos">3595</span></a>    <span class="k">def</span> <span class="nf">_split_info_from_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-3596"><a href="#L-3596"><span class="linenos">3596</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3597"><a href="#L-3597"><span class="linenos">3597</span></a><span class="sd">        Get split parameters from default path to a split file</span>
</span><span id="L-3598"><a href="#L-3598"><span class="linenos">3598</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3599"><a href="#L-3599"><span class="linenos">3599</span></a>
</span><span id="L-3600"><a href="#L-3600"><span class="linenos">3600</span></a>        <span class="k">if</span> <span class="n">split_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3601"><a href="#L-3601"><span class="linenos">3601</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="L-3602"><a href="#L-3602"><span class="linenos">3602</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3603"><a href="#L-3603"><span class="linenos">3603</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">split_name</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="L-3604"><a href="#L-3604"><span class="linenos">3604</span></a>            <span class="n">split</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="L-3605"><a href="#L-3605"><span class="linenos">3605</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
</span><span id="L-3606"><a href="#L-3606"><span class="linenos">3606</span></a>                <span class="n">only_load_annotated</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3607"><a href="#L-3607"><span class="linenos">3607</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3608"><a href="#L-3608"><span class="linenos">3608</span></a>                <span class="n">only_load_annotated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3609"><a href="#L-3609"><span class="linenos">3609</span></a>            <span class="n">len_segment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">:])</span>
</span><span id="L-3610"><a href="#L-3610"><span class="linenos">3610</span></a>            <span class="n">overlap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">7</span><span class="p">:])</span>
</span><span id="L-3611"><a href="#L-3611"><span class="linenos">3611</span></a>            <span class="n">method</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">split</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</span><span id="L-3612"><a href="#L-3612"><span class="linenos">3612</span></a>            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span>
</span><span id="L-3613"><a href="#L-3613"><span class="linenos">3613</span></a>            <span class="n">test</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span>
</span><span id="L-3614"><a href="#L-3614"><span class="linenos">3614</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-3615"><a href="#L-3615"><span class="linenos">3615</span></a>                <span class="s2">&quot;partition_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
</span><span id="L-3616"><a href="#L-3616"><span class="linenos">3616</span></a>                <span class="s2">&quot;val_frac&quot;</span><span class="p">:</span> <span class="n">val</span><span class="p">,</span>
</span><span id="L-3617"><a href="#L-3617"><span class="linenos">3617</span></a>                <span class="s2">&quot;test_frac&quot;</span><span class="p">:</span> <span class="n">test</span><span class="p">,</span>
</span><span id="L-3618"><a href="#L-3618"><span class="linenos">3618</span></a>                <span class="s2">&quot;only_load_annotated&quot;</span><span class="p">:</span> <span class="n">only_load_annotated</span><span class="p">,</span>
</span><span id="L-3619"><a href="#L-3619"><span class="linenos">3619</span></a>                <span class="s2">&quot;len_segment&quot;</span><span class="p">:</span> <span class="n">len_segment</span><span class="p">,</span>
</span><span id="L-3620"><a href="#L-3620"><span class="linenos">3620</span></a>                <span class="s2">&quot;overlap&quot;</span><span class="p">:</span> <span class="n">overlap</span><span class="p">,</span>
</span><span id="L-3621"><a href="#L-3621"><span class="linenos">3621</span></a>            <span class="p">}</span>
</span><span id="L-3622"><a href="#L-3622"><span class="linenos">3622</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-3623"><a href="#L-3623"><span class="linenos">3623</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;partition_method&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">}</span>
</span><span id="L-3624"><a href="#L-3624"><span class="linenos">3624</span></a>
</span><span id="L-3625"><a href="#L-3625"><span class="linenos">3625</span></a>    <span class="k">def</span> <span class="nf">_fill</span><span class="p">(</span>
</span><span id="L-3626"><a href="#L-3626"><span class="linenos">3626</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3627"><a href="#L-3627"><span class="linenos">3627</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-3628"><a href="#L-3628"><span class="linenos">3628</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3629"><a href="#L-3629"><span class="linenos">3629</span></a>        <span class="n">load_experiment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3630"><a href="#L-3630"><span class="linenos">3630</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3631"><a href="#L-3631"><span class="linenos">3631</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-3632"><a href="#L-3632"><span class="linenos">3632</span></a>        <span class="n">only_load_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3633"><a href="#L-3633"><span class="linenos">3633</span></a>        <span class="n">continuing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3634"><a href="#L-3634"><span class="linenos">3634</span></a>        <span class="n">enforce_split_parameters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3635"><a href="#L-3635"><span class="linenos">3635</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-3636"><a href="#L-3636"><span class="linenos">3636</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3637"><a href="#L-3637"><span class="linenos">3637</span></a><span class="sd">        Update the parameters from the config files with project specific information</span>
</span><span id="L-3638"><a href="#L-3638"><span class="linenos">3638</span></a>
</span><span id="L-3639"><a href="#L-3639"><span class="linenos">3639</span></a><span class="sd">        Fill in the constant file path parameters and generate a unique log file and a model folder.</span>
</span><span id="L-3640"><a href="#L-3640"><span class="linenos">3640</span></a><span class="sd">        Fill in the split file if the same split has been run before in the project and change partition method to</span>
</span><span id="L-3641"><a href="#L-3641"><span class="linenos">3641</span></a><span class="sd">        from_file.</span>
</span><span id="L-3642"><a href="#L-3642"><span class="linenos">3642</span></a><span class="sd">        Fill in saved data path if a dataset with the same data parameters already exists in the project.</span>
</span><span id="L-3643"><a href="#L-3643"><span class="linenos">3643</span></a><span class="sd">        If load_experiment is not None, fill in the checkpoint path as well.</span>
</span><span id="L-3644"><a href="#L-3644"><span class="linenos">3644</span></a><span class="sd">        The only_load_model training parameter is defined by the corresponding argument.</span>
</span><span id="L-3645"><a href="#L-3645"><span class="linenos">3645</span></a><span class="sd">        If continuing is True, new files are not created and all information is loaded from load_experiment.</span>
</span><span id="L-3646"><a href="#L-3646"><span class="linenos">3646</span></a><span class="sd">        If prediction is True, log and model files are not created.</span>
</span><span id="L-3647"><a href="#L-3647"><span class="linenos">3647</span></a><span class="sd">        The enforce_split_parameters parameter is used to resolve conflicts</span>
</span><span id="L-3648"><a href="#L-3648"><span class="linenos">3648</span></a><span class="sd">        between split file path and split parameters when they arise.</span>
</span><span id="L-3649"><a href="#L-3649"><span class="linenos">3649</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3650"><a href="#L-3650"><span class="linenos">3650</span></a>
</span><span id="L-3651"><a href="#L-3651"><span class="linenos">3651</span></a>        <span class="n">pars</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-3652"><a href="#L-3652"><span class="linenos">3652</span></a>        <span class="k">if</span> <span class="n">episode_name</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
</span><span id="L-3653"><a href="#L-3653"><span class="linenos">3653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="L-3654"><a href="#L-3654"><span class="linenos">3654</span></a>        <span class="n">log</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>
</span><span id="L-3655"><a href="#L-3655"><span class="linenos">3655</span></a>        <span class="n">model_save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-3656"><a href="#L-3656"><span class="linenos">3656</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">episode_name</span>
</span><span id="L-3657"><a href="#L-3657"><span class="linenos">3657</span></a>        <span class="p">)</span>
</span><span id="L-3658"><a href="#L-3658"><span class="linenos">3658</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">continuing</span> <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_save_path</span><span class="p">)):</span>
</span><span id="L-3659"><a href="#L-3659"><span class="linenos">3659</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3660"><a href="#L-3660"><span class="linenos">3660</span></a>                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> episode name is already in use! Set force=True to overwrite.&quot;</span>
</span><span id="L-3661"><a href="#L-3661"><span class="linenos">3661</span></a>            <span class="p">)</span>
</span><span id="L-3662"><a href="#L-3662"><span class="linenos">3662</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;val_frac&quot;</span><span class="p">,</span> <span class="s2">&quot;test_frac&quot;</span><span class="p">,</span> <span class="s2">&quot;partition_method&quot;</span><span class="p">]</span>
</span><span id="L-3663"><a href="#L-3663"><span class="linenos">3663</span></a>        <span class="k">if</span> <span class="s2">&quot;len_segment&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;len_segment&quot;</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
</span><span id="L-3664"><a href="#L-3664"><span class="linenos">3664</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span>
</span><span id="L-3665"><a href="#L-3665"><span class="linenos">3665</span></a>        <span class="k">if</span> <span class="s2">&quot;overlap&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;overlap&quot;</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
</span><span id="L-3666"><a href="#L-3666"><span class="linenos">3666</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span>
</span><span id="L-3667"><a href="#L-3667"><span class="linenos">3667</span></a>        <span class="k">if</span> <span class="s2">&quot;len_segment&quot;</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
</span><span id="L-3668"><a href="#L-3668"><span class="linenos">3668</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;len_segment&quot;</span><span class="p">)</span>
</span><span id="L-3669"><a href="#L-3669"><span class="linenos">3669</span></a>        <span class="k">if</span> <span class="s2">&quot;overlap&quot;</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
</span><span id="L-3670"><a href="#L-3670"><span class="linenos">3670</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;overlap&quot;</span><span class="p">)</span>
</span><span id="L-3671"><a href="#L-3671"><span class="linenos">3671</span></a>        <span class="n">split_info</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">}</span>
</span><span id="L-3672"><a href="#L-3672"><span class="linenos">3672</span></a>        <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;only_load_annotated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;only_load_annotated&quot;</span><span class="p">]</span>
</span><span id="L-3673"><a href="#L-3673"><span class="linenos">3673</span></a>        <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span>
</span><span id="L-3674"><a href="#L-3674"><span class="linenos">3674</span></a>        <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span>
</span><span id="L-3675"><a href="#L-3675"><span class="linenos">3675</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;log_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span>
</span><span id="L-3676"><a href="#L-3676"><span class="linenos">3676</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">model_save_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-3677"><a href="#L-3677"><span class="linenos">3677</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;model_save_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_save_path</span>
</span><span id="L-3678"><a href="#L-3678"><span class="linenos">3678</span></a>        <span class="k">if</span> <span class="n">load_experiment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3679"><a href="#L-3679"><span class="linenos">3679</span></a>            <span class="k">if</span> <span class="n">load_experiment</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="L-3680"><a href="#L-3680"><span class="linenos">3680</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">load_experiment</span><span class="si">}</span><span class="s2"> episode does not exist!&quot;</span><span class="p">)</span>
</span><span id="L-3681"><a href="#L-3681"><span class="linenos">3681</span></a>            <span class="n">old_episode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">load_experiment</span><span class="p">)</span>
</span><span id="L-3682"><a href="#L-3682"><span class="linenos">3682</span></a>            <span class="n">old_file</span> <span class="o">=</span> <span class="n">old_episode</span><span class="o">.</span><span class="n">split_file</span><span class="p">()</span>
</span><span id="L-3683"><a href="#L-3683"><span class="linenos">3683</span></a>            <span class="n">old_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_info_from_filename</span><span class="p">(</span><span class="n">old_file</span><span class="p">)</span>
</span><span id="L-3684"><a href="#L-3684"><span class="linenos">3684</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3685"><a href="#L-3685"><span class="linenos">3685</span></a>                <span class="n">old_info</span> <span class="o">=</span> <span class="n">old_episode</span><span class="o">.</span><span class="n">split_info</span><span class="p">()</span>
</span><span id="L-3686"><a href="#L-3686"><span class="linenos">3686</span></a>            <span class="k">if</span> <span class="n">enforce_split_parameters</span><span class="p">:</span>
</span><span id="L-3687"><a href="#L-3687"><span class="linenos">3687</span></a>                <span class="k">if</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
</span><span id="L-3688"><a href="#L-3688"><span class="linenos">3688</span></a>                    <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_split_file</span><span class="p">(</span>
</span><span id="L-3689"><a href="#L-3689"><span class="linenos">3689</span></a>                        <span class="n">split_info</span>
</span><span id="L-3690"><a href="#L-3690"><span class="linenos">3690</span></a>                    <span class="p">)</span>
</span><span id="L-3691"><a href="#L-3691"><span class="linenos">3691</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3692"><a href="#L-3692"><span class="linenos">3692</span></a>                <span class="n">equal</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3693"><a href="#L-3693"><span class="linenos">3693</span></a>                <span class="k">if</span> <span class="n">old_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]:</span>
</span><span id="L-3694"><a href="#L-3694"><span class="linenos">3694</span></a>                    <span class="n">equal</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3695"><a href="#L-3695"><span class="linenos">3695</span></a>                <span class="k">if</span> <span class="n">old_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
</span><span id="L-3696"><a href="#L-3696"><span class="linenos">3696</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="L-3697"><a href="#L-3697"><span class="linenos">3697</span></a>                        <span class="n">old_info</span><span class="p">[</span><span class="s2">&quot;val_frac&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;val_frac&quot;</span><span class="p">]</span>
</span><span id="L-3698"><a href="#L-3698"><span class="linenos">3698</span></a>                        <span class="ow">or</span> <span class="n">old_info</span><span class="p">[</span><span class="s2">&quot;test_frac&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;test_frac&quot;</span><span class="p">]</span>
</span><span id="L-3699"><a href="#L-3699"><span class="linenos">3699</span></a>                    <span class="p">):</span>
</span><span id="L-3700"><a href="#L-3700"><span class="linenos">3700</span></a>                        <span class="n">equal</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3701"><a href="#L-3701"><span class="linenos">3701</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">continuing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">equal</span><span class="p">:</span>
</span><span id="L-3702"><a href="#L-3702"><span class="linenos">3702</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-3703"><a href="#L-3703"><span class="linenos">3703</span></a>                        <span class="sa">f</span><span class="s2">&quot;The partitioning parameters in the loaded experiment (</span><span class="si">{</span><span class="n">old_info</span><span class="si">}</span><span class="s2">) &quot;</span>
</span><span id="L-3704"><a href="#L-3704"><span class="linenos">3704</span></a>                        <span class="sa">f</span><span class="s2">&quot;are not equal to the current partitioning parameters (</span><span class="si">{</span><span class="n">split_info</span><span class="si">}</span><span class="s2">). &quot;</span>
</span><span id="L-3705"><a href="#L-3705"><span class="linenos">3705</span></a>                        <span class="sa">f</span><span class="s2">&quot;The current parameters are replaced.&quot;</span>
</span><span id="L-3706"><a href="#L-3706"><span class="linenos">3706</span></a>                    <span class="p">)</span>
</span><span id="L-3707"><a href="#L-3707"><span class="linenos">3707</span></a>                <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_file</span>
</span><span id="L-3708"><a href="#L-3708"><span class="linenos">3708</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;checkpoint_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_episode</span><span class="o">.</span><span class="n">model_file</span><span class="p">(</span><span class="n">load_epoch</span><span class="p">)</span>
</span><span id="L-3709"><a href="#L-3709"><span class="linenos">3709</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;load_strict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_strict</span>
</span><span id="L-3710"><a href="#L-3710"><span class="linenos">3710</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3711"><a href="#L-3711"><span class="linenos">3711</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;checkpoint_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3712"><a href="#L-3712"><span class="linenos">3712</span></a>            <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
</span><span id="L-3713"><a href="#L-3713"><span class="linenos">3713</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-3714"><a href="#L-3714"><span class="linenos">3714</span></a>                    <span class="s2">&quot;split_path&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">]</span>
</span><span id="L-3715"><a href="#L-3715"><span class="linenos">3715</span></a>                    <span class="ow">or</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-3716"><a href="#L-3716"><span class="linenos">3716</span></a>                <span class="p">):</span>
</span><span id="L-3717"><a href="#L-3717"><span class="linenos">3717</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3718"><a href="#L-3718"><span class="linenos">3718</span></a>                        <span class="s2">&quot;The partition_method parameter is set to file but the &quot;</span>
</span><span id="L-3719"><a href="#L-3719"><span class="linenos">3719</span></a>                        <span class="s2">&quot;split_path parameter is not set!&quot;</span>
</span><span id="L-3720"><a href="#L-3720"><span class="linenos">3720</span></a>                    <span class="p">)</span>
</span><span id="L-3721"><a href="#L-3721"><span class="linenos">3721</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]):</span>
</span><span id="L-3722"><a href="#L-3722"><span class="linenos">3722</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3723"><a href="#L-3723"><span class="linenos">3723</span></a>                        <span class="sa">f</span><span class="s1">&#39;The </span><span class="si">{</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> split file does not exist&#39;</span>
</span><span id="L-3724"><a href="#L-3724"><span class="linenos">3724</span></a>                    <span class="p">)</span>
</span><span id="L-3725"><a href="#L-3725"><span class="linenos">3725</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3726"><a href="#L-3726"><span class="linenos">3726</span></a>                <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_split_file</span><span class="p">(</span><span class="n">split_info</span><span class="p">)</span>
</span><span id="L-3727"><a href="#L-3727"><span class="linenos">3727</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;only_load_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">only_load_model</span>
</span><span id="L-3728"><a href="#L-3728"><span class="linenos">3728</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;saved_data_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3729"><a href="#L-3729"><span class="linenos">3729</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3730"><a href="#L-3730"><span class="linenos">3730</span></a>        <span class="n">pars_data_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_pars</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
</span><span id="L-3731"><a href="#L-3731"><span class="linenos">3731</span></a>        <span class="n">saved_data_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets</span><span class="p">()</span><span class="o">.</span><span class="n">find_name</span><span class="p">(</span><span class="n">pars_data_copy</span><span class="p">)</span>
</span><span id="L-3732"><a href="#L-3732"><span class="linenos">3732</span></a>        <span class="k">if</span> <span class="n">saved_data_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3733"><a href="#L-3733"><span class="linenos">3733</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;saved_data_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_store_path</span><span class="p">(</span><span class="n">saved_data_name</span><span class="p">)</span>
</span><span id="L-3734"><a href="#L-3734"><span class="linenos">3734</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_store_path</span><span class="p">(</span>
</span><span id="L-3735"><a href="#L-3735"><span class="linenos">3735</span></a>                <span class="n">saved_data_name</span>
</span><span id="L-3736"><a href="#L-3736"><span class="linenos">3736</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3737"><a href="#L-3737"><span class="linenos">3737</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3738"><a href="#L-3738"><span class="linenos">3738</span></a>            <span class="n">dataset_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_store_path</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-3739"><a href="#L-3739"><span class="linenos">3739</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">):</span>
</span><span id="L-3740"><a href="#L-3740"><span class="linenos">3740</span></a>                <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">dataset_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="L-3741"><a href="#L-3741"><span class="linenos">3741</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3742"><a href="#L-3742"><span class="linenos">3742</span></a>                <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="L-3743"><a href="#L-3743"><span class="linenos">3743</span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-3744"><a href="#L-3744"><span class="linenos">3744</span></a>                <span class="n">dataset_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-3745"><a href="#L-3745"><span class="linenos">3745</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;saved_data_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_path</span>
</span><span id="L-3746"><a href="#L-3746"><span class="linenos">3746</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3747"><a href="#L-3747"><span class="linenos">3747</span></a>        <span class="n">split_split</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="L-3748"><a href="#L-3748"><span class="linenos">3748</span></a>        <span class="n">random</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3749"><a href="#L-3749"><span class="linenos">3749</span></a>        <span class="k">for</span> <span class="n">partition_method</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">partition_methods</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">]:</span>
</span><span id="L-3750"><a href="#L-3750"><span class="linenos">3750</span></a>            <span class="n">method_split</span> <span class="o">=</span> <span class="n">partition_method</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="L-3751"><a href="#L-3751"><span class="linenos">3751</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_split</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">method_split</span><span class="p">):</span>
</span><span id="L-3752"><a href="#L-3752"><span class="linenos">3752</span></a>                <span class="k">continue</span>
</span><span id="L-3753"><a href="#L-3753"><span class="linenos">3753</span></a>            <span class="n">equal</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3754"><a href="#L-3754"><span class="linenos">3754</span></a>            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">split_split</span><span class="p">,</span> <span class="n">method_split</span><span class="p">):</span>
</span><span id="L-3755"><a href="#L-3755"><span class="linenos">3755</span></a>                <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">):</span>
</span><span id="L-3756"><a href="#L-3756"><span class="linenos">3756</span></a>                    <span class="k">continue</span>
</span><span id="L-3757"><a href="#L-3757"><span class="linenos">3757</span></a>                <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">y</span><span class="p">:</span>
</span><span id="L-3758"><a href="#L-3758"><span class="linenos">3758</span></a>                    <span class="n">equal</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3759"><a href="#L-3759"><span class="linenos">3759</span></a>                    <span class="k">break</span>
</span><span id="L-3760"><a href="#L-3760"><span class="linenos">3760</span></a>            <span class="k">if</span> <span class="n">equal</span><span class="p">:</span>
</span><span id="L-3761"><a href="#L-3761"><span class="linenos">3761</span></a>                <span class="n">random</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3762"><a href="#L-3762"><span class="linenos">3762</span></a>                <span class="k">break</span>
</span><span id="L-3763"><a href="#L-3763"><span class="linenos">3763</span></a>        <span class="k">if</span> <span class="n">random</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]):</span>
</span><span id="L-3764"><a href="#L-3764"><span class="linenos">3764</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;file&quot;</span>
</span><span id="L-3765"><a href="#L-3765"><span class="linenos">3765</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;save_dataset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3766"><a href="#L-3766"><span class="linenos">3766</span></a>        <span class="k">return</span> <span class="n">pars</span>
</span><span id="L-3767"><a href="#L-3767"><span class="linenos">3767</span></a>
</span><span id="L-3768"><a href="#L-3768"><span class="linenos">3768</span></a>    <span class="k">def</span> <span class="nf">_get_data_pars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-3769"><a href="#L-3769"><span class="linenos">3769</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3770"><a href="#L-3770"><span class="linenos">3770</span></a><span class="sd">        Get a complete description of the data from a general parameters dictionary</span>
</span><span id="L-3771"><a href="#L-3771"><span class="linenos">3771</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3772"><a href="#L-3772"><span class="linenos">3772</span></a>
</span><span id="L-3773"><a href="#L-3773"><span class="linenos">3773</span></a>        <span class="n">pars_data_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
</span><span id="L-3774"><a href="#L-3774"><span class="linenos">3774</span></a>        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-3775"><a href="#L-3775"><span class="linenos">3775</span></a>            <span class="s2">&quot;only_load_annotated&quot;</span><span class="p">,</span>
</span><span id="L-3776"><a href="#L-3776"><span class="linenos">3776</span></a>            <span class="s2">&quot;exclusive&quot;</span><span class="p">,</span>
</span><span id="L-3777"><a href="#L-3777"><span class="linenos">3777</span></a>            <span class="s2">&quot;feature_extraction&quot;</span><span class="p">,</span>
</span><span id="L-3778"><a href="#L-3778"><span class="linenos">3778</span></a>            <span class="s2">&quot;ignored_clips&quot;</span><span class="p">,</span>
</span><span id="L-3779"><a href="#L-3779"><span class="linenos">3779</span></a>            <span class="s2">&quot;len_segment&quot;</span><span class="p">,</span>
</span><span id="L-3780"><a href="#L-3780"><span class="linenos">3780</span></a>            <span class="s2">&quot;overlap&quot;</span><span class="p">,</span>
</span><span id="L-3781"><a href="#L-3781"><span class="linenos">3781</span></a>        <span class="p">]:</span>
</span><span id="L-3782"><a href="#L-3782"><span class="linenos">3782</span></a>            <span class="n">pars_data_copy</span><span class="p">[</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-3783"><a href="#L-3783"><span class="linenos">3783</span></a>        <span class="n">pars_data_copy</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">])</span>
</span><span id="L-3784"><a href="#L-3784"><span class="linenos">3784</span></a>        <span class="k">return</span> <span class="n">pars_data_copy</span>
</span><span id="L-3785"><a href="#L-3785"><span class="linenos">3785</span></a>
</span><span id="L-3786"><a href="#L-3786"><span class="linenos">3786</span></a>    <span class="k">def</span> <span class="nf">count_classes</span><span class="p">(</span>
</span><span id="L-3787"><a href="#L-3787"><span class="linenos">3787</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3788"><a href="#L-3788"><span class="linenos">3788</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3789"><a href="#L-3789"><span class="linenos">3789</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3790"><a href="#L-3790"><span class="linenos">3790</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3791"><a href="#L-3791"><span class="linenos">3791</span></a>        <span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-3792"><a href="#L-3792"><span class="linenos">3792</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-3793"><a href="#L-3793"><span class="linenos">3793</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3794"><a href="#L-3794"><span class="linenos">3794</span></a><span class="sd">        Get a dictionary of class counts in different modes</span>
</span><span id="L-3795"><a href="#L-3795"><span class="linenos">3795</span></a>
</span><span id="L-3796"><a href="#L-3796"><span class="linenos">3796</span></a><span class="sd">        Parameters</span>
</span><span id="L-3797"><a href="#L-3797"><span class="linenos">3797</span></a><span class="sd">        ----------</span>
</span><span id="L-3798"><a href="#L-3798"><span class="linenos">3798</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="L-3799"><a href="#L-3799"><span class="linenos">3799</span></a><span class="sd">            the episode settings to load</span>
</span><span id="L-3800"><a href="#L-3800"><span class="linenos">3800</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-3801"><a href="#L-3801"><span class="linenos">3801</span></a><span class="sd">            a dictionary of parameter updates (only for &quot;data&quot; and &quot;general&quot; categories)</span>
</span><span id="L-3802"><a href="#L-3802"><span class="linenos">3802</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="L-3803"><a href="#L-3803"><span class="linenos">3803</span></a><span class="sd">            if `True`, the dataset that is used for computation is then deleted</span>
</span><span id="L-3804"><a href="#L-3804"><span class="linenos">3804</span></a><span class="sd">        bouts : bool, default False</span>
</span><span id="L-3805"><a href="#L-3805"><span class="linenos">3805</span></a><span class="sd">            if `True`, instead of frame counts segment counts are returned</span>
</span><span id="L-3806"><a href="#L-3806"><span class="linenos">3806</span></a>
</span><span id="L-3807"><a href="#L-3807"><span class="linenos">3807</span></a><span class="sd">        Returns</span>
</span><span id="L-3808"><a href="#L-3808"><span class="linenos">3808</span></a><span class="sd">        -------</span>
</span><span id="L-3809"><a href="#L-3809"><span class="linenos">3809</span></a><span class="sd">        class_counts : dict</span>
</span><span id="L-3810"><a href="#L-3810"><span class="linenos">3810</span></a><span class="sd">            a dictionary where first-level keys are &quot;train&quot;, &quot;val&quot; and &quot;test&quot;, second-level keys are</span>
</span><span id="L-3811"><a href="#L-3811"><span class="linenos">3811</span></a><span class="sd">            class names and values are class counts (in frames)</span>
</span><span id="L-3812"><a href="#L-3812"><span class="linenos">3812</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3813"><a href="#L-3813"><span class="linenos">3813</span></a>
</span><span id="L-3814"><a href="#L-3814"><span class="linenos">3814</span></a>        <span class="k">if</span> <span class="n">load_episode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3815"><a href="#L-3815"><span class="linenos">3815</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="L-3816"><a href="#L-3816"><span class="linenos">3816</span></a>                <span class="n">episode_name</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span> <span class="n">throwaway</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-3817"><a href="#L-3817"><span class="linenos">3817</span></a>            <span class="p">)</span>
</span><span id="L-3818"><a href="#L-3818"><span class="linenos">3818</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3819"><a href="#L-3819"><span class="linenos">3819</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="L-3820"><a href="#L-3820"><span class="linenos">3820</span></a>                <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="L-3821"><a href="#L-3821"><span class="linenos">3821</span></a>                <span class="n">load_episode</span><span class="o">=</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-3822"><a href="#L-3822"><span class="linenos">3822</span></a>                <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-3823"><a href="#L-3823"><span class="linenos">3823</span></a>            <span class="p">)</span>
</span><span id="L-3824"><a href="#L-3824"><span class="linenos">3824</span></a>        <span class="n">class_counts</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">count_classes</span><span class="p">(</span><span class="n">bouts</span><span class="o">=</span><span class="n">bouts</span><span class="p">)</span>
</span><span id="L-3825"><a href="#L-3825"><span class="linenos">3825</span></a>        <span class="n">behaviors</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span>
</span><span id="L-3826"><a href="#L-3826"><span class="linenos">3826</span></a>        <span class="n">class_counts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-3827"><a href="#L-3827"><span class="linenos">3827</span></a>            <span class="n">kk</span><span class="p">:</span> <span class="p">{</span><span class="n">behaviors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-3828"><a href="#L-3828"><span class="linenos">3828</span></a>            <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-3829"><a href="#L-3829"><span class="linenos">3829</span></a>        <span class="p">}</span>
</span><span id="L-3830"><a href="#L-3830"><span class="linenos">3830</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="L-3831"><a href="#L-3831"><span class="linenos">3831</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-3832"><a href="#L-3832"><span class="linenos">3832</span></a>        <span class="k">return</span> <span class="n">class_counts</span>
</span><span id="L-3833"><a href="#L-3833"><span class="linenos">3833</span></a>
</span><span id="L-3834"><a href="#L-3834"><span class="linenos">3834</span></a>    <span class="k">def</span> <span class="nf">plot_class_distribution</span><span class="p">(</span>
</span><span id="L-3835"><a href="#L-3835"><span class="linenos">3835</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3836"><a href="#L-3836"><span class="linenos">3836</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3837"><a href="#L-3837"><span class="linenos">3837</span></a>        <span class="n">frame_cutoff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-3838"><a href="#L-3838"><span class="linenos">3838</span></a>        <span class="n">bout_cutoff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-3839"><a href="#L-3839"><span class="linenos">3839</span></a>        <span class="n">print_full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3840"><a href="#L-3840"><span class="linenos">3840</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3841"><a href="#L-3841"><span class="linenos">3841</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3842"><a href="#L-3842"><span class="linenos">3842</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3843"><a href="#L-3843"><span class="linenos">3843</span></a><span class="sd">        Make a class distribution plot</span>
</span><span id="L-3844"><a href="#L-3844"><span class="linenos">3844</span></a>
</span><span id="L-3845"><a href="#L-3845"><span class="linenos">3845</span></a><span class="sd">        You can either specify the parameters, choose an existing dataset or do neither (in that case a dataset</span>
</span><span id="L-3846"><a href="#L-3846"><span class="linenos">3846</span></a><span class="sd">        is created or laoded for the computation with the default parameters).</span>
</span><span id="L-3847"><a href="#L-3847"><span class="linenos">3847</span></a>
</span><span id="L-3848"><a href="#L-3848"><span class="linenos">3848</span></a><span class="sd">        Parameters</span>
</span><span id="L-3849"><a href="#L-3849"><span class="linenos">3849</span></a><span class="sd">        ----------</span>
</span><span id="L-3850"><a href="#L-3850"><span class="linenos">3850</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-3851"><a href="#L-3851"><span class="linenos">3851</span></a><span class="sd">            a dictionary of parameter updates (only for &quot;data&quot; and &quot;general&quot; categories)</span>
</span><span id="L-3852"><a href="#L-3852"><span class="linenos">3852</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="L-3853"><a href="#L-3853"><span class="linenos">3853</span></a><span class="sd">            if `True`, the dataset that is used for computation is then deleted</span>
</span><span id="L-3854"><a href="#L-3854"><span class="linenos">3854</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3855"><a href="#L-3855"><span class="linenos">3855</span></a>
</span><span id="L-3856"><a href="#L-3856"><span class="linenos">3856</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="L-3857"><a href="#L-3857"><span class="linenos">3857</span></a>            <span class="n">episode_name</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span> <span class="n">throwaway</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-3858"><a href="#L-3858"><span class="linenos">3858</span></a>        <span class="p">)</span>
</span><span id="L-3859"><a href="#L-3859"><span class="linenos">3859</span></a>        <span class="n">cutoff</span> <span class="o">=</span> <span class="p">{</span><span class="kc">True</span><span class="p">:</span> <span class="n">bout_cutoff</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="n">frame_cutoff</span><span class="p">}</span>
</span><span id="L-3860"><a href="#L-3860"><span class="linenos">3860</span></a>        <span class="k">for</span> <span class="n">bouts</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
</span><span id="L-3861"><a href="#L-3861"><span class="linenos">3861</span></a>            <span class="n">class_counts</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">count_classes</span><span class="p">(</span><span class="n">bouts</span><span class="o">=</span><span class="n">bouts</span><span class="p">)</span>
</span><span id="L-3862"><a href="#L-3862"><span class="linenos">3862</span></a>            <span class="k">if</span> <span class="n">print_full</span><span class="p">:</span>
</span><span id="L-3863"><a href="#L-3863"><span class="linenos">3863</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bouts:&quot;</span> <span class="k">if</span> <span class="n">bouts</span> <span class="k">else</span> <span class="s2">&quot;Frames:&quot;</span><span class="p">)</span>
</span><span id="L-3864"><a href="#L-3864"><span class="linenos">3864</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3865"><a href="#L-3865"><span class="linenos">3865</span></a>                    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3866"><a href="#L-3866"><span class="linenos">3866</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="L-3867"><a href="#L-3867"><span class="linenos">3867</span></a>                        <span class="n">values</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-3868"><a href="#L-3868"><span class="linenos">3868</span></a>                            <span class="o">*</span><span class="p">[</span>
</span><span id="L-3869"><a href="#L-3869"><span class="linenos">3869</span></a>                                <span class="n">x</span>
</span><span id="L-3870"><a href="#L-3870"><span class="linenos">3870</span></a>                                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-3871"><a href="#L-3871"><span class="linenos">3871</span></a>                                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="L-3872"><a href="#L-3872"><span class="linenos">3872</span></a>                            <span class="p">]</span>
</span><span id="L-3873"><a href="#L-3873"><span class="linenos">3873</span></a>                        <span class="p">)</span>
</span><span id="L-3874"><a href="#L-3874"><span class="linenos">3874</span></a>                        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
</span><span id="L-3875"><a href="#L-3875"><span class="linenos">3875</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">kk</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">vv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3876"><a href="#L-3876"><span class="linenos">3876</span></a>            <span class="n">class_counts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-3877"><a href="#L-3877"><span class="linenos">3877</span></a>                <span class="n">kk</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">cutoff</span><span class="p">[</span><span class="n">bouts</span><span class="p">]}</span>
</span><span id="L-3878"><a href="#L-3878"><span class="linenos">3878</span></a>                <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-3879"><a href="#L-3879"><span class="linenos">3879</span></a>            <span class="p">}</span>
</span><span id="L-3880"><a href="#L-3880"><span class="linenos">3880</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3881"><a href="#L-3881"><span class="linenos">3881</span></a>                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3882"><a href="#L-3882"><span class="linenos">3882</span></a>                    <span class="n">values</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-3883"><a href="#L-3883"><span class="linenos">3883</span></a>                        <span class="o">*</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="L-3884"><a href="#L-3884"><span class="linenos">3884</span></a>                    <span class="p">)</span>
</span><span id="L-3885"><a href="#L-3885"><span class="linenos">3885</span></a>                    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
</span><span id="L-3886"><a href="#L-3886"><span class="linenos">3886</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-3887"><a href="#L-3887"><span class="linenos">3887</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-3888"><a href="#L-3888"><span class="linenos">3888</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="L-3889"><a href="#L-3889"><span class="linenos">3889</span></a>                    <span class="k">if</span> <span class="n">bouts</span><span class="p">:</span>
</span><span id="L-3890"><a href="#L-3890"><span class="linenos">3890</span></a>                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;bouts&quot;</span><span class="p">)</span>
</span><span id="L-3891"><a href="#L-3891"><span class="linenos">3891</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-3892"><a href="#L-3892"><span class="linenos">3892</span></a>                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;frames&quot;</span><span class="p">)</span>
</span><span id="L-3893"><a href="#L-3893"><span class="linenos">3893</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-3894"><a href="#L-3894"><span class="linenos">3894</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-3895"><a href="#L-3895"><span class="linenos">3895</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="L-3896"><a href="#L-3896"><span class="linenos">3896</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-3897"><a href="#L-3897"><span class="linenos">3897</span></a>
</span><span id="L-3898"><a href="#L-3898"><span class="linenos">3898</span></a>    <span class="k">def</span> <span class="nf">_generate_mask</span><span class="p">(</span>
</span><span id="L-3899"><a href="#L-3899"><span class="linenos">3899</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3900"><a href="#L-3900"><span class="linenos">3900</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3901"><a href="#L-3901"><span class="linenos">3901</span></a>        <span class="n">perc_annotated</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="L-3902"><a href="#L-3902"><span class="linenos">3902</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3903"><a href="#L-3903"><span class="linenos">3903</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3904"><a href="#L-3904"><span class="linenos">3904</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3905"><a href="#L-3905"><span class="linenos">3905</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3906"><a href="#L-3906"><span class="linenos">3906</span></a><span class="sd">        Generate a real_lens for active learning simulation</span>
</span><span id="L-3907"><a href="#L-3907"><span class="linenos">3907</span></a>
</span><span id="L-3908"><a href="#L-3908"><span class="linenos">3908</span></a><span class="sd">        Parameters</span>
</span><span id="L-3909"><a href="#L-3909"><span class="linenos">3909</span></a><span class="sd">        ----------</span>
</span><span id="L-3910"><a href="#L-3910"><span class="linenos">3910</span></a><span class="sd">        mask_name : str</span>
</span><span id="L-3911"><a href="#L-3911"><span class="linenos">3911</span></a><span class="sd">            the name of the real_lens</span>
</span><span id="L-3912"><a href="#L-3912"><span class="linenos">3912</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3913"><a href="#L-3913"><span class="linenos">3913</span></a>
</span><span id="L-3914"><a href="#L-3914"><span class="linenos">3914</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GENERATING </span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3915"><a href="#L-3915"><span class="linenos">3915</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="L-3916"><a href="#L-3916"><span class="linenos">3916</span></a>            <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span> <span class="n">throwaway</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-3917"><a href="#L-3917"><span class="linenos">3917</span></a>        <span class="p">)</span>
</span><span id="L-3918"><a href="#L-3918"><span class="linenos">3918</span></a>        <span class="n">val_intervals</span><span class="p">,</span> <span class="n">val_ids</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_intervals</span><span class="p">()</span>  <span class="c1"># 1</span>
</span><span id="L-3919"><a href="#L-3919"><span class="linenos">3919</span></a>        <span class="n">unannotated_intervals</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_unannotated_intervals</span><span class="p">()</span>  <span class="c1"># 2</span>
</span><span id="L-3920"><a href="#L-3920"><span class="linenos">3920</span></a>        <span class="n">unannotated_intervals</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_unannotated_intervals</span><span class="p">(</span>
</span><span id="L-3921"><a href="#L-3921"><span class="linenos">3921</span></a>            <span class="n">first_intervals</span><span class="o">=</span><span class="n">unannotated_intervals</span>
</span><span id="L-3922"><a href="#L-3922"><span class="linenos">3922</span></a>        <span class="p">)</span>
</span><span id="L-3923"><a href="#L-3923"><span class="linenos">3923</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_ids</span><span class="p">()</span>
</span><span id="L-3924"><a href="#L-3924"><span class="linenos">3924</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="p">{</span><span class="n">video_id</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">}</span>
</span><span id="L-3925"><a href="#L-3925"><span class="linenos">3925</span></a>        <span class="n">total_all</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3926"><a href="#L-3926"><span class="linenos">3926</span></a>        <span class="n">total_masked</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3927"><a href="#L-3927"><span class="linenos">3927</span></a>        <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">clip_ids</span> <span class="ow">in</span> <span class="n">ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3928"><a href="#L-3928"><span class="linenos">3928</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">clip_ids</span><span class="p">:</span>
</span><span id="L-3929"><a href="#L-3929"><span class="linenos">3929</span></a>                <span class="n">frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_len</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">))</span>
</span><span id="L-3930"><a href="#L-3930"><span class="linenos">3930</span></a>                <span class="k">if</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">val_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-3931"><a href="#L-3931"><span class="linenos">3931</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">val_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="L-3932"><a href="#L-3932"><span class="linenos">3932</span></a>                        <span class="n">frames</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3933"><a href="#L-3933"><span class="linenos">3933</span></a>                <span class="k">if</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">unannotated_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-3934"><a href="#L-3934"><span class="linenos">3934</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">unannotated_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="L-3935"><a href="#L-3935"><span class="linenos">3935</span></a>                        <span class="n">frames</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3936"><a href="#L-3936"><span class="linenos">3936</span></a>                <span class="n">annotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">frames</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3937"><a href="#L-3937"><span class="linenos">3937</span></a>                <span class="n">total_all</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">annotated</span><span class="p">)</span>
</span><span id="L-3938"><a href="#L-3938"><span class="linenos">3938</span></a>                <span class="n">masked</span> <span class="o">=</span> <span class="n">annotated</span><span class="p">[</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">annotated</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">perc_annotated</span><span class="p">))</span> <span class="p">:]</span>
</span><span id="L-3939"><a href="#L-3939"><span class="linenos">3939</span></a>                <span class="n">total_masked</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">masked</span><span class="p">)</span>
</span><span id="L-3940"><a href="#L-3940"><span class="linenos">3940</span></a>                <span class="n">mask</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_intervals</span><span class="p">(</span><span class="n">masked</span><span class="p">)</span>
</span><span id="L-3941"><a href="#L-3941"><span class="linenos">3941</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-3942"><a href="#L-3942"><span class="linenos">3942</span></a>            <span class="s2">&quot;masked&quot;</span><span class="p">:</span> <span class="n">mask</span><span class="p">,</span>
</span><span id="L-3943"><a href="#L-3943"><span class="linenos">3943</span></a>            <span class="s2">&quot;val_intervals&quot;</span><span class="p">:</span> <span class="n">val_intervals</span><span class="p">,</span>
</span><span id="L-3944"><a href="#L-3944"><span class="linenos">3944</span></a>            <span class="s2">&quot;val_ids&quot;</span><span class="p">:</span> <span class="n">val_ids</span><span class="p">,</span>
</span><span id="L-3945"><a href="#L-3945"><span class="linenos">3945</span></a>            <span class="s2">&quot;unannotated&quot;</span><span class="p">:</span> <span class="n">unannotated_intervals</span><span class="p">,</span>
</span><span id="L-3946"><a href="#L-3946"><span class="linenos">3946</span></a>        <span class="p">}</span>
</span><span id="L-3947"><a href="#L-3947"><span class="linenos">3947</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_mask</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">)</span>
</span><span id="L-3948"><a href="#L-3948"><span class="linenos">3948</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="L-3949"><a href="#L-3949"><span class="linenos">3949</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-3950"><a href="#L-3950"><span class="linenos">3950</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3951"><a href="#L-3951"><span class="linenos">3951</span></a>        <span class="c1"># print(f&#39;Unmasked: {sum([(vv == 0).sum() for v in real_lens.values() for vv in v.values()])} frames&#39;)</span>
</span><span id="L-3952"><a href="#L-3952"><span class="linenos">3952</span></a>
</span><span id="L-3953"><a href="#L-3953"><span class="linenos">3953</span></a>    <span class="k">def</span> <span class="nf">_get_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-3954"><a href="#L-3954"><span class="linenos">3954</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3955"><a href="#L-3955"><span class="linenos">3955</span></a><span class="sd">        Get a list of intervals from a list of frame indices</span>
</span><span id="L-3956"><a href="#L-3956"><span class="linenos">3956</span></a>
</span><span id="L-3957"><a href="#L-3957"><span class="linenos">3957</span></a><span class="sd">        Example: `[0, 1, 2, 5, 6, 8] -&gt; [[0, 3], [5, 7], [8, 9]]`.</span>
</span><span id="L-3958"><a href="#L-3958"><span class="linenos">3958</span></a>
</span><span id="L-3959"><a href="#L-3959"><span class="linenos">3959</span></a><span class="sd">        Parameters</span>
</span><span id="L-3960"><a href="#L-3960"><span class="linenos">3960</span></a><span class="sd">        ----------</span>
</span><span id="L-3961"><a href="#L-3961"><span class="linenos">3961</span></a><span class="sd">        frame_indices : np.ndarray</span>
</span><span id="L-3962"><a href="#L-3962"><span class="linenos">3962</span></a><span class="sd">            a list of frame indices</span>
</span><span id="L-3963"><a href="#L-3963"><span class="linenos">3963</span></a>
</span><span id="L-3964"><a href="#L-3964"><span class="linenos">3964</span></a><span class="sd">        Returns</span>
</span><span id="L-3965"><a href="#L-3965"><span class="linenos">3965</span></a><span class="sd">        -------</span>
</span><span id="L-3966"><a href="#L-3966"><span class="linenos">3966</span></a><span class="sd">        intervals : list</span>
</span><span id="L-3967"><a href="#L-3967"><span class="linenos">3967</span></a><span class="sd">            a list of interval boundaries</span>
</span><span id="L-3968"><a href="#L-3968"><span class="linenos">3968</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3969"><a href="#L-3969"><span class="linenos">3969</span></a>
</span><span id="L-3970"><a href="#L-3970"><span class="linenos">3970</span></a>        <span class="n">masked_intervals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3971"><a href="#L-3971"><span class="linenos">3971</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3972"><a href="#L-3972"><span class="linenos">3972</span></a>            <span class="n">breaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frame_indices</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3973"><a href="#L-3973"><span class="linenos">3973</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="n">frame_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-3974"><a href="#L-3974"><span class="linenos">3974</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">breaks</span><span class="p">:</span>
</span><span id="L-3975"><a href="#L-3975"><span class="linenos">3975</span></a>                <span class="n">masked_intervals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">frame_indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-3976"><a href="#L-3976"><span class="linenos">3976</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">frame_indices</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-3977"><a href="#L-3977"><span class="linenos">3977</span></a>            <span class="n">masked_intervals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">frame_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-3978"><a href="#L-3978"><span class="linenos">3978</span></a>        <span class="k">return</span> <span class="n">masked_intervals</span>
</span><span id="L-3979"><a href="#L-3979"><span class="linenos">3979</span></a>
</span><span id="L-3980"><a href="#L-3980"><span class="linenos">3980</span></a>    <span class="k">def</span> <span class="nf">_update_mask_with_uncertainty</span><span class="p">(</span>
</span><span id="L-3981"><a href="#L-3981"><span class="linenos">3981</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3982"><a href="#L-3982"><span class="linenos">3982</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-3983"><a href="#L-3983"><span class="linenos">3983</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="L-3984"><a href="#L-3984"><span class="linenos">3984</span></a>        <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-3985"><a href="#L-3985"><span class="linenos">3985</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3986"><a href="#L-3986"><span class="linenos">3986</span></a>        <span class="n">n_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
</span><span id="L-3987"><a href="#L-3987"><span class="linenos">3987</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;least_confidence&quot;</span><span class="p">,</span>
</span><span id="L-3988"><a href="#L-3988"><span class="linenos">3988</span></a>        <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="L-3989"><a href="#L-3989"><span class="linenos">3989</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-3990"><a href="#L-3990"><span class="linenos">3990</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-3991"><a href="#L-3991"><span class="linenos">3991</span></a>    <span class="p">):</span>
</span><span id="L-3992"><a href="#L-3992"><span class="linenos">3992</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3993"><a href="#L-3993"><span class="linenos">3993</span></a><span class="sd">        Update real_lens with frame-wise uncertainty scores for active learning</span>
</span><span id="L-3994"><a href="#L-3994"><span class="linenos">3994</span></a>
</span><span id="L-3995"><a href="#L-3995"><span class="linenos">3995</span></a><span class="sd">        Parameters</span>
</span><span id="L-3996"><a href="#L-3996"><span class="linenos">3996</span></a><span class="sd">        ----------</span>
</span><span id="L-3997"><a href="#L-3997"><span class="linenos">3997</span></a><span class="sd">        mask_name : str</span>
</span><span id="L-3998"><a href="#L-3998"><span class="linenos">3998</span></a><span class="sd">            the name of the real_lens</span>
</span><span id="L-3999"><a href="#L-3999"><span class="linenos">3999</span></a><span class="sd">        episode_name : str</span>
</span><span id="L-4000"><a href="#L-4000"><span class="linenos">4000</span></a><span class="sd">            the name of the episode to load</span>
</span><span id="L-4001"><a href="#L-4001"><span class="linenos">4001</span></a><span class="sd">        classes : list</span>
</span><span id="L-4002"><a href="#L-4002"><span class="linenos">4002</span></a><span class="sd">            a list of class names or indices; their uncertainty scores will be computed separately and stacked</span>
</span><span id="L-4003"><a href="#L-4003"><span class="linenos">4003</span></a><span class="sd">        n_frames : int, default 10000</span>
</span><span id="L-4004"><a href="#L-4004"><span class="linenos">4004</span></a><span class="sd">            the number of frames to &quot;annotate&quot;</span>
</span><span id="L-4005"><a href="#L-4005"><span class="linenos">4005</span></a><span class="sd">        method : {&quot;least_confidence&quot;, &quot;entropy&quot;}</span>
</span><span id="L-4006"><a href="#L-4006"><span class="linenos">4006</span></a><span class="sd">            the method used to calculate the scores from the probability predictions (`&quot;least_confidence&quot;`: `1 - p_i` if</span>
</span><span id="L-4007"><a href="#L-4007"><span class="linenos">4007</span></a><span class="sd">            `p_i &gt; 0.5` or `p_i` if `p_i &lt; 0.5`; `&quot;entropy&quot;`: `- p_i * log(p_i) - (1 - p_i) * log(1 - p_i)`)</span>
</span><span id="L-4008"><a href="#L-4008"><span class="linenos">4008</span></a><span class="sd">        min_length : int</span>
</span><span id="L-4009"><a href="#L-4009"><span class="linenos">4009</span></a><span class="sd">            the minimum length (in frames) of the annotated intervals</span>
</span><span id="L-4010"><a href="#L-4010"><span class="linenos">4010</span></a><span class="sd">        augment_n : int, default 0</span>
</span><span id="L-4011"><a href="#L-4011"><span class="linenos">4011</span></a><span class="sd">            the number of augmentations to average over</span>
</span><span id="L-4012"><a href="#L-4012"><span class="linenos">4012</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-4013"><a href="#L-4013"><span class="linenos">4013</span></a><span class="sd">            the dictionary used to update the parameters from the config</span>
</span><span id="L-4014"><a href="#L-4014"><span class="linenos">4014</span></a>
</span><span id="L-4015"><a href="#L-4015"><span class="linenos">4015</span></a><span class="sd">        Returns</span>
</span><span id="L-4016"><a href="#L-4016"><span class="linenos">4016</span></a><span class="sd">        -------</span>
</span><span id="L-4017"><a href="#L-4017"><span class="linenos">4017</span></a><span class="sd">        score_dicts : dict</span>
</span><span id="L-4018"><a href="#L-4018"><span class="linenos">4018</span></a><span class="sd">            a nested dictionary where first level keys are video ids, second level keys are clip ids and values</span>
</span><span id="L-4019"><a href="#L-4019"><span class="linenos">4019</span></a><span class="sd">            are score tensors</span>
</span><span id="L-4020"><a href="#L-4020"><span class="linenos">4020</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4021"><a href="#L-4021"><span class="linenos">4021</span></a>
</span><span id="L-4022"><a href="#L-4022"><span class="linenos">4022</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATING </span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-4023"><a href="#L-4023"><span class="linenos">4023</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="L-4024"><a href="#L-4024"><span class="linenos">4024</span></a>            <span class="n">prediction_name</span><span class="o">=</span><span class="n">mask_name</span><span class="p">,</span>
</span><span id="L-4025"><a href="#L-4025"><span class="linenos">4025</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-4026"><a href="#L-4026"><span class="linenos">4026</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-4027"><a href="#L-4027"><span class="linenos">4027</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-4028"><a href="#L-4028"><span class="linenos">4028</span></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span>
</span><span id="L-4029"><a href="#L-4029"><span class="linenos">4029</span></a>        <span class="p">)</span>
</span><span id="L-4030"><a href="#L-4030"><span class="linenos">4030</span></a>        <span class="n">score_tensors</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">generate_uncertainty_score</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">augment_n</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
</span><span id="L-4031"><a href="#L-4031"><span class="linenos">4031</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_mask</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">,</span> <span class="n">score_tensors</span><span class="p">,</span> <span class="n">n_frames</span><span class="p">,</span> <span class="n">min_length</span><span class="p">)</span>
</span><span id="L-4032"><a href="#L-4032"><span class="linenos">4032</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-4033"><a href="#L-4033"><span class="linenos">4033</span></a>
</span><span id="L-4034"><a href="#L-4034"><span class="linenos">4034</span></a>    <span class="k">def</span> <span class="nf">_update_mask_with_BALD</span><span class="p">(</span>
</span><span id="L-4035"><a href="#L-4035"><span class="linenos">4035</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-4036"><a href="#L-4036"><span class="linenos">4036</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-4037"><a href="#L-4037"><span class="linenos">4037</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-4038"><a href="#L-4038"><span class="linenos">4038</span></a>        <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-4039"><a href="#L-4039"><span class="linenos">4039</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4040"><a href="#L-4040"><span class="linenos">4040</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-4041"><a href="#L-4041"><span class="linenos">4041</span></a>        <span class="n">n_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
</span><span id="L-4042"><a href="#L-4042"><span class="linenos">4042</span></a>        <span class="n">num_models</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-4043"><a href="#L-4043"><span class="linenos">4043</span></a>        <span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
</span><span id="L-4044"><a href="#L-4044"><span class="linenos">4044</span></a>        <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="L-4045"><a href="#L-4045"><span class="linenos">4045</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4046"><a href="#L-4046"><span class="linenos">4046</span></a>    <span class="p">):</span>
</span><span id="L-4047"><a href="#L-4047"><span class="linenos">4047</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4048"><a href="#L-4048"><span class="linenos">4048</span></a><span class="sd">        Update real_lens with frame-wise Bayesian Active Learning by Disagreement scores for active learning</span>
</span><span id="L-4049"><a href="#L-4049"><span class="linenos">4049</span></a>
</span><span id="L-4050"><a href="#L-4050"><span class="linenos">4050</span></a><span class="sd">        Parameters</span>
</span><span id="L-4051"><a href="#L-4051"><span class="linenos">4051</span></a><span class="sd">        ----------</span>
</span><span id="L-4052"><a href="#L-4052"><span class="linenos">4052</span></a><span class="sd">        mask_name : str</span>
</span><span id="L-4053"><a href="#L-4053"><span class="linenos">4053</span></a><span class="sd">            the name of the real_lens</span>
</span><span id="L-4054"><a href="#L-4054"><span class="linenos">4054</span></a><span class="sd">        episode_name : str</span>
</span><span id="L-4055"><a href="#L-4055"><span class="linenos">4055</span></a><span class="sd">            the name of the episode to load</span>
</span><span id="L-4056"><a href="#L-4056"><span class="linenos">4056</span></a><span class="sd">        classes : list</span>
</span><span id="L-4057"><a href="#L-4057"><span class="linenos">4057</span></a><span class="sd">            a list of class names or indices; their uncertainty scores will be computed separately and stacked</span>
</span><span id="L-4058"><a href="#L-4058"><span class="linenos">4058</span></a><span class="sd">        augment_n : int, default 0</span>
</span><span id="L-4059"><a href="#L-4059"><span class="linenos">4059</span></a><span class="sd">            the number of augmentations to average over</span>
</span><span id="L-4060"><a href="#L-4060"><span class="linenos">4060</span></a><span class="sd">        n_frames : int, default 10000</span>
</span><span id="L-4061"><a href="#L-4061"><span class="linenos">4061</span></a><span class="sd">            the number of frames to &quot;annotate&quot;</span>
</span><span id="L-4062"><a href="#L-4062"><span class="linenos">4062</span></a><span class="sd">        num_models : int, default 10</span>
</span><span id="L-4063"><a href="#L-4063"><span class="linenos">4063</span></a><span class="sd">            the number of dropout masks to apply</span>
</span><span id="L-4064"><a href="#L-4064"><span class="linenos">4064</span></a><span class="sd">        kernel_size : int, default 11</span>
</span><span id="L-4065"><a href="#L-4065"><span class="linenos">4065</span></a><span class="sd">            the size of the smoothing gaussian kernel</span>
</span><span id="L-4066"><a href="#L-4066"><span class="linenos">4066</span></a><span class="sd">        min_length : int</span>
</span><span id="L-4067"><a href="#L-4067"><span class="linenos">4067</span></a><span class="sd">            the minimum length (in frames) of the annotated intervals</span>
</span><span id="L-4068"><a href="#L-4068"><span class="linenos">4068</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-4069"><a href="#L-4069"><span class="linenos">4069</span></a><span class="sd">            the dictionary used to update the parameters from the config</span>
</span><span id="L-4070"><a href="#L-4070"><span class="linenos">4070</span></a>
</span><span id="L-4071"><a href="#L-4071"><span class="linenos">4071</span></a><span class="sd">        Returns</span>
</span><span id="L-4072"><a href="#L-4072"><span class="linenos">4072</span></a><span class="sd">        -------</span>
</span><span id="L-4073"><a href="#L-4073"><span class="linenos">4073</span></a><span class="sd">        score_dicts : dict</span>
</span><span id="L-4074"><a href="#L-4074"><span class="linenos">4074</span></a><span class="sd">            a nested dictionary where first level keys are video ids, second level keys are clip ids and values</span>
</span><span id="L-4075"><a href="#L-4075"><span class="linenos">4075</span></a><span class="sd">            are score tensors</span>
</span><span id="L-4076"><a href="#L-4076"><span class="linenos">4076</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4077"><a href="#L-4077"><span class="linenos">4077</span></a>
</span><span id="L-4078"><a href="#L-4078"><span class="linenos">4078</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATING </span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-4079"><a href="#L-4079"><span class="linenos">4079</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="L-4080"><a href="#L-4080"><span class="linenos">4080</span></a>            <span class="n">mask_name</span><span class="p">,</span>
</span><span id="L-4081"><a href="#L-4081"><span class="linenos">4081</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-4082"><a href="#L-4082"><span class="linenos">4082</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-4083"><a href="#L-4083"><span class="linenos">4083</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-4084"><a href="#L-4084"><span class="linenos">4084</span></a>        <span class="p">)</span>
</span><span id="L-4085"><a href="#L-4085"><span class="linenos">4085</span></a>        <span class="n">score_tensors</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">generate_bald_score</span><span class="p">(</span>
</span><span id="L-4086"><a href="#L-4086"><span class="linenos">4086</span></a>            <span class="n">classes</span><span class="p">,</span> <span class="n">augment_n</span><span class="p">,</span> <span class="n">num_models</span><span class="p">,</span> <span class="n">kernel_size</span>
</span><span id="L-4087"><a href="#L-4087"><span class="linenos">4087</span></a>        <span class="p">)</span>
</span><span id="L-4088"><a href="#L-4088"><span class="linenos">4088</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_mask</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">,</span> <span class="n">score_tensors</span><span class="p">,</span> <span class="n">n_frames</span><span class="p">,</span> <span class="n">min_length</span><span class="p">)</span>
</span><span id="L-4089"><a href="#L-4089"><span class="linenos">4089</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-4090"><a href="#L-4090"><span class="linenos">4090</span></a>
</span><span id="L-4091"><a href="#L-4091"><span class="linenos">4091</span></a>    <span class="k">def</span> <span class="nf">_suggest_intervals</span><span class="p">(</span>
</span><span id="L-4092"><a href="#L-4092"><span class="linenos">4092</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-4093"><a href="#L-4093"><span class="linenos">4093</span></a>        <span class="n">dataset</span><span class="p">:</span> <span class="n">BehaviorDataset</span><span class="p">,</span>
</span><span id="L-4094"><a href="#L-4094"><span class="linenos">4094</span></a>        <span class="n">score_tensors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-4095"><a href="#L-4095"><span class="linenos">4095</span></a>        <span class="n">n_frames</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-4096"><a href="#L-4096"><span class="linenos">4096</span></a>        <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-4097"><a href="#L-4097"><span class="linenos">4097</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-4098"><a href="#L-4098"><span class="linenos">4098</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4099"><a href="#L-4099"><span class="linenos">4099</span></a><span class="sd">        Suggest intervals with highest score of total length `n_frames`</span>
</span><span id="L-4100"><a href="#L-4100"><span class="linenos">4100</span></a>
</span><span id="L-4101"><a href="#L-4101"><span class="linenos">4101</span></a><span class="sd">        Parameters</span>
</span><span id="L-4102"><a href="#L-4102"><span class="linenos">4102</span></a><span class="sd">        ----------</span>
</span><span id="L-4103"><a href="#L-4103"><span class="linenos">4103</span></a><span class="sd">        dataset : BehaviorDataset</span>
</span><span id="L-4104"><a href="#L-4104"><span class="linenos">4104</span></a><span class="sd">            the dataset</span>
</span><span id="L-4105"><a href="#L-4105"><span class="linenos">4105</span></a><span class="sd">        score_tensors : dict</span>
</span><span id="L-4106"><a href="#L-4106"><span class="linenos">4106</span></a><span class="sd">            a dictionary where keys are clip ids and values are framewise score tensors</span>
</span><span id="L-4107"><a href="#L-4107"><span class="linenos">4107</span></a><span class="sd">        n_frames : int</span>
</span><span id="L-4108"><a href="#L-4108"><span class="linenos">4108</span></a><span class="sd">            the number of frames to &quot;annotate&quot;</span>
</span><span id="L-4109"><a href="#L-4109"><span class="linenos">4109</span></a><span class="sd">        min_length : int</span>
</span><span id="L-4110"><a href="#L-4110"><span class="linenos">4110</span></a>
</span><span id="L-4111"><a href="#L-4111"><span class="linenos">4111</span></a><span class="sd">        Returns</span>
</span><span id="L-4112"><a href="#L-4112"><span class="linenos">4112</span></a><span class="sd">        -------</span>
</span><span id="L-4113"><a href="#L-4113"><span class="linenos">4113</span></a><span class="sd">        active_learning_intervals : Dict</span>
</span><span id="L-4114"><a href="#L-4114"><span class="linenos">4114</span></a><span class="sd">            active learning dictionary with suggested intervals</span>
</span><span id="L-4115"><a href="#L-4115"><span class="linenos">4115</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4116"><a href="#L-4116"><span class="linenos">4116</span></a>
</span><span id="L-4117"><a href="#L-4117"><span class="linenos">4117</span></a>        <span class="n">video_intervals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_intervals</span><span class="p">()</span>
</span><span id="L-4118"><a href="#L-4118"><span class="linenos">4118</span></a>        <span class="n">taken</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-4119"><a href="#L-4119"><span class="linenos">4119</span></a>            <span class="n">video_id</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span> <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-4120"><a href="#L-4120"><span class="linenos">4120</span></a>        <span class="p">}</span>
</span><span id="L-4121"><a href="#L-4121"><span class="linenos">4121</span></a>        <span class="n">annotated</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_annotated_intervals</span><span class="p">()</span>
</span><span id="L-4122"><a href="#L-4122"><span class="linenos">4122</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">:</span>
</span><span id="L-4123"><a href="#L-4123"><span class="linenos">4123</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-4124"><a href="#L-4124"><span class="linenos">4124</span></a>                <span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="L-4125"><a href="#L-4125"><span class="linenos">4125</span></a>                    <span class="n">dataset</span><span class="o">.</span><span class="n">get_len</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">)</span>
</span><span id="L-4126"><a href="#L-4126"><span class="linenos">4126</span></a>                <span class="p">)</span>
</span><span id="L-4127"><a href="#L-4127"><span class="linenos">4127</span></a>                <span class="k">if</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">annotated</span> <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">annotated</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-4128"><a href="#L-4128"><span class="linenos">4128</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">annotated</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="L-4129"><a href="#L-4129"><span class="linenos">4129</span></a>                        <span class="n">score_tensors</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
</span><span id="L-4130"><a href="#L-4130"><span class="linenos">4130</span></a>                        <span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-4131"><a href="#L-4131"><span class="linenos">4131</span></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-4132"><a href="#L-4132"><span class="linenos">4132</span></a>            <span class="nb">sum</span><span class="p">([(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">taken</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</span><span id="L-4133"><a href="#L-4133"><span class="linenos">4133</span></a>            <span class="o">+</span> <span class="n">n_frames</span>
</span><span id="L-4134"><a href="#L-4134"><span class="linenos">4134</span></a>        <span class="p">)</span>
</span><span id="L-4135"><a href="#L-4135"><span class="linenos">4135</span></a>        <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-4136"><a href="#L-4136"><span class="linenos">4136</span></a>        <span class="n">threshold_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="L-4137"><a href="#L-4137"><span class="linenos">4137</span></a>            <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-4138"><a href="#L-4138"><span class="linenos">4138</span></a>                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="L-4139"><a href="#L-4139"><span class="linenos">4139</span></a>                    <span class="p">[</span>
</span><span id="L-4140"><a href="#L-4140"><span class="linenos">4140</span></a>                        <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-4141"><a href="#L-4141"><span class="linenos">4141</span></a>                            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</span><span id="L-4142"><a href="#L-4142"><span class="linenos">4142</span></a>                        <span class="p">)</span>
</span><span id="L-4143"><a href="#L-4143"><span class="linenos">4143</span></a>                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">score_tensors</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="L-4144"><a href="#L-4144"><span class="linenos">4144</span></a>                    <span class="p">]</span>
</span><span id="L-4145"><a href="#L-4145"><span class="linenos">4145</span></a>                <span class="p">)</span>
</span><span id="L-4146"><a href="#L-4146"><span class="linenos">4146</span></a>            <span class="p">)</span>
</span><span id="L-4147"><a href="#L-4147"><span class="linenos">4147</span></a>        <span class="p">)</span>
</span><span id="L-4148"><a href="#L-4148"><span class="linenos">4148</span></a>        <span class="k">while</span> <span class="p">(</span>
</span><span id="L-4149"><a href="#L-4149"><span class="linenos">4149</span></a>            <span class="nb">sum</span><span class="p">([(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">taken</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</span><span id="L-4150"><a href="#L-4150"><span class="linenos">4150</span></a>            <span class="o">&lt;</span> <span class="n">n_frames</span>
</span><span id="L-4151"><a href="#L-4151"><span class="linenos">4151</span></a>        <span class="p">):</span>
</span><span id="L-4152"><a href="#L-4152"><span class="linenos">4152</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold_start</span> <span class="o">*</span> <span class="n">factor</span>
</span><span id="L-4153"><a href="#L-4153"><span class="linenos">4153</span></a>            <span class="n">intervals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-4154"><a href="#L-4154"><span class="linenos">4154</span></a>            <span class="n">interval_scores</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-4155"><a href="#L-4155"><span class="linenos">4155</span></a>            <span class="n">key1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">score_tensors</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-4156"><a href="#L-4156"><span class="linenos">4156</span></a>            <span class="n">key2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">score_tensors</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-4157"><a href="#L-4157"><span class="linenos">4157</span></a>            <span class="n">num_scores</span> <span class="o">=</span> <span class="n">score_tensors</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-4158"><a href="#L-4158"><span class="linenos">4158</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_scores</span><span class="p">):</span>
</span><span id="L-4159"><a href="#L-4159"><span class="linenos">4159</span></a>                <span class="n">v_dict</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">find_valleys</span><span class="p">(</span>
</span><span id="L-4160"><a href="#L-4160"><span class="linenos">4160</span></a>                    <span class="n">predicted</span><span class="o">=</span><span class="n">score_tensors</span><span class="p">,</span>
</span><span id="L-4161"><a href="#L-4161"><span class="linenos">4161</span></a>                    <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
</span><span id="L-4162"><a href="#L-4162"><span class="linenos">4162</span></a>                    <span class="n">min_frames</span><span class="o">=</span><span class="n">min_length</span><span class="p">,</span>
</span><span id="L-4163"><a href="#L-4163"><span class="linenos">4163</span></a>                    <span class="n">main_class</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="L-4164"><a href="#L-4164"><span class="linenos">4164</span></a>                    <span class="n">low</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-4165"><a href="#L-4165"><span class="linenos">4165</span></a>                <span class="p">)</span>
</span><span id="L-4166"><a href="#L-4166"><span class="linenos">4166</span></a>                <span class="k">for</span> <span class="n">v_id</span><span class="p">,</span> <span class="n">interval_list</span> <span class="ow">in</span> <span class="n">v_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-4167"><a href="#L-4167"><span class="linenos">4167</span></a>                    <span class="n">intervals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">[</span><span class="n">v_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">interval_list</span><span class="p">]</span>
</span><span id="L-4168"><a href="#L-4168"><span class="linenos">4168</span></a>                    <span class="n">interval_scores</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-4169"><a href="#L-4169"><span class="linenos">4169</span></a>                        <span class="nb">float</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">score_tensors</span><span class="p">[</span><span class="n">v_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]))</span>
</span><span id="L-4170"><a href="#L-4170"><span class="linenos">4170</span></a>                        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">interval_list</span>
</span><span id="L-4171"><a href="#L-4171"><span class="linenos">4171</span></a>                    <span class="p">]</span>
</span><span id="L-4172"><a href="#L-4172"><span class="linenos">4172</span></a>            <span class="n">intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intervals</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">interval_scores</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-4173"><a href="#L-4173"><span class="linenos">4173</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-4174"><a href="#L-4174"><span class="linenos">4174</span></a>            <span class="k">while</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="L-4175"><a href="#L-4175"><span class="linenos">4175</span></a>                <span class="p">[(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">taken</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span><span id="L-4176"><a href="#L-4176"><span class="linenos">4176</span></a>            <span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_frames</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
</span><span id="L-4177"><a href="#L-4177"><span class="linenos">4177</span></a>                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">video_id</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-4178"><a href="#L-4178"><span class="linenos">4178</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-4179"><a href="#L-4179"><span class="linenos">4179</span></a>                <span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-4180"><a href="#L-4180"><span class="linenos">4180</span></a>            <span class="n">factor</span> <span class="o">*=</span> <span class="mf">0.9</span>
</span><span id="L-4181"><a href="#L-4181"><span class="linenos">4181</span></a>            <span class="k">if</span> <span class="n">factor</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
</span><span id="L-4182"><a href="#L-4182"><span class="linenos">4182</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find enough frames!&quot;</span><span class="p">)</span>
</span><span id="L-4183"><a href="#L-4183"><span class="linenos">4183</span></a>                <span class="k">break</span>
</span><span id="L-4184"><a href="#L-4184"><span class="linenos">4184</span></a>        <span class="n">active_learning_intervals</span> <span class="o">=</span> <span class="p">{</span><span class="n">video_id</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">}</span>
</span><span id="L-4185"><a href="#L-4185"><span class="linenos">4185</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">taken</span><span class="p">:</span>
</span><span id="L-4186"><a href="#L-4186"><span class="linenos">4186</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-4187"><a href="#L-4187"><span class="linenos">4187</span></a>                <span class="k">if</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">annotated</span> <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">annotated</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-4188"><a href="#L-4188"><span class="linenos">4188</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">annotated</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="L-4189"><a href="#L-4189"><span class="linenos">4189</span></a>                        <span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-4190"><a href="#L-4190"><span class="linenos">4190</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-4191"><a href="#L-4191"><span class="linenos">4191</span></a>                    <span class="k">continue</span>
</span><span id="L-4192"><a href="#L-4192"><span class="linenos">4192</span></a>                <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-4193"><a href="#L-4193"><span class="linenos">4193</span></a>                <span class="n">boundaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_intervals</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
</span><span id="L-4194"><a href="#L-4194"><span class="linenos">4194</span></a>                <span class="n">active_learning_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-4195"><a href="#L-4195"><span class="linenos">4195</span></a>                    <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">boundaries</span>
</span><span id="L-4196"><a href="#L-4196"><span class="linenos">4196</span></a>                <span class="p">]</span>
</span><span id="L-4197"><a href="#L-4197"><span class="linenos">4197</span></a>        <span class="k">return</span> <span class="n">active_learning_intervals</span>
</span><span id="L-4198"><a href="#L-4198"><span class="linenos">4198</span></a>
</span><span id="L-4199"><a href="#L-4199"><span class="linenos">4199</span></a>    <span class="k">def</span> <span class="nf">_update_mask</span><span class="p">(</span>
</span><span id="L-4200"><a href="#L-4200"><span class="linenos">4200</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-4201"><a href="#L-4201"><span class="linenos">4201</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span><span class="p">,</span>
</span><span id="L-4202"><a href="#L-4202"><span class="linenos">4202</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-4203"><a href="#L-4203"><span class="linenos">4203</span></a>        <span class="n">score_tensors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-4204"><a href="#L-4204"><span class="linenos">4204</span></a>        <span class="n">n_frames</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-4205"><a href="#L-4205"><span class="linenos">4205</span></a>        <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-4206"><a href="#L-4206"><span class="linenos">4206</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4207"><a href="#L-4207"><span class="linenos">4207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4208"><a href="#L-4208"><span class="linenos">4208</span></a><span class="sd">        Update the real_lens with intervals with the highest score of total length `n_frames`</span>
</span><span id="L-4209"><a href="#L-4209"><span class="linenos">4209</span></a>
</span><span id="L-4210"><a href="#L-4210"><span class="linenos">4210</span></a><span class="sd">        Parameters</span>
</span><span id="L-4211"><a href="#L-4211"><span class="linenos">4211</span></a><span class="sd">        ----------</span>
</span><span id="L-4212"><a href="#L-4212"><span class="linenos">4212</span></a><span class="sd">        mask_name : str</span>
</span><span id="L-4213"><a href="#L-4213"><span class="linenos">4213</span></a><span class="sd">            the name of the real_lens</span>
</span><span id="L-4214"><a href="#L-4214"><span class="linenos">4214</span></a><span class="sd">        score_tensors : dict</span>
</span><span id="L-4215"><a href="#L-4215"><span class="linenos">4215</span></a><span class="sd">            a dictionary where keys are clip ids and values are framewise score tensors</span>
</span><span id="L-4216"><a href="#L-4216"><span class="linenos">4216</span></a><span class="sd">        n_frames : int</span>
</span><span id="L-4217"><a href="#L-4217"><span class="linenos">4217</span></a><span class="sd">            the number of frames to &quot;annotate&quot;</span>
</span><span id="L-4218"><a href="#L-4218"><span class="linenos">4218</span></a><span class="sd">        min_length : int</span>
</span><span id="L-4219"><a href="#L-4219"><span class="linenos">4219</span></a><span class="sd">            the minimum length of the annotated intervals</span>
</span><span id="L-4220"><a href="#L-4220"><span class="linenos">4220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4221"><a href="#L-4221"><span class="linenos">4221</span></a>
</span><span id="L-4222"><a href="#L-4222"><span class="linenos">4222</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_mask</span><span class="p">(</span><span class="n">mask_name</span><span class="p">)</span>
</span><span id="L-4223"><a href="#L-4223"><span class="linenos">4223</span></a>        <span class="n">video_intervals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_intervals</span><span class="p">()</span>
</span><span id="L-4224"><a href="#L-4224"><span class="linenos">4224</span></a>        <span class="n">masked</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-4225"><a href="#L-4225"><span class="linenos">4225</span></a>            <span class="n">video_id</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span> <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-4226"><a href="#L-4226"><span class="linenos">4226</span></a>        <span class="p">}</span>
</span><span id="L-4227"><a href="#L-4227"><span class="linenos">4227</span></a>        <span class="n">total_masked</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-4228"><a href="#L-4228"><span class="linenos">4228</span></a>        <span class="n">total_all</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-4229"><a href="#L-4229"><span class="linenos">4229</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">:</span>
</span><span id="L-4230"><a href="#L-4230"><span class="linenos">4230</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-4231"><a href="#L-4231"><span class="linenos">4231</span></a>                <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="L-4232"><a href="#L-4232"><span class="linenos">4232</span></a>                    <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_len</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">)</span>
</span><span id="L-4233"><a href="#L-4233"><span class="linenos">4233</span></a>                <span class="p">)</span>
</span><span id="L-4234"><a href="#L-4234"><span class="linenos">4234</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-4235"><a href="#L-4235"><span class="linenos">4235</span></a>                    <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">]</span>
</span><span id="L-4236"><a href="#L-4236"><span class="linenos">4236</span></a>                    <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]</span>
</span><span id="L-4237"><a href="#L-4237"><span class="linenos">4237</span></a>                <span class="p">):</span>
</span><span id="L-4238"><a href="#L-4238"><span class="linenos">4238</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="L-4239"><a href="#L-4239"><span class="linenos">4239</span></a>                        <span class="n">score_tensors</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
</span><span id="L-4240"><a href="#L-4240"><span class="linenos">4240</span></a>                        <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-4241"><a href="#L-4241"><span class="linenos">4241</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-4242"><a href="#L-4242"><span class="linenos">4242</span></a>                    <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">]</span>
</span><span id="L-4243"><a href="#L-4243"><span class="linenos">4243</span></a>                    <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]</span>
</span><span id="L-4244"><a href="#L-4244"><span class="linenos">4244</span></a>                <span class="p">):</span>
</span><span id="L-4245"><a href="#L-4245"><span class="linenos">4245</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="L-4246"><a href="#L-4246"><span class="linenos">4246</span></a>                        <span class="n">score_tensors</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
</span><span id="L-4247"><a href="#L-4247"><span class="linenos">4247</span></a>                        <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-4248"><a href="#L-4248"><span class="linenos">4248</span></a>                <span class="n">total_all</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-4249"><a href="#L-4249"><span class="linenos">4249</span></a>                <span class="k">if</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-4250"><a href="#L-4250"><span class="linenos">4250</span></a>                    <span class="c1"># print(f&#39;{real_lens[&quot;masked&quot;][video_id][clip_id]=}&#39;)</span>
</span><span id="L-4251"><a href="#L-4251"><span class="linenos">4251</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="L-4252"><a href="#L-4252"><span class="linenos">4252</span></a>                        <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-4253"><a href="#L-4253"><span class="linenos">4253</span></a>                        <span class="n">total_masked</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="L-4254"><a href="#L-4254"><span class="linenos">4254</span></a>        <span class="n">old_n_frames</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="L-4255"><a href="#L-4255"><span class="linenos">4255</span></a>            <span class="p">[(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">masked</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span><span id="L-4256"><a href="#L-4256"><span class="linenos">4256</span></a>        <span class="p">)</span>
</span><span id="L-4257"><a href="#L-4257"><span class="linenos">4257</span></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="n">old_n_frames</span> <span class="o">+</span> <span class="n">n_frames</span>
</span><span id="L-4258"><a href="#L-4258"><span class="linenos">4258</span></a>        <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-4259"><a href="#L-4259"><span class="linenos">4259</span></a>        <span class="k">while</span> <span class="p">(</span>
</span><span id="L-4260"><a href="#L-4260"><span class="linenos">4260</span></a>            <span class="nb">sum</span><span class="p">([(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">masked</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</span><span id="L-4261"><a href="#L-4261"><span class="linenos">4261</span></a>            <span class="o">&lt;</span> <span class="n">n_frames</span>
</span><span id="L-4262"><a href="#L-4262"><span class="linenos">4262</span></a>        <span class="p">):</span>
</span><span id="L-4263"><a href="#L-4263"><span class="linenos">4263</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="L-4264"><a href="#L-4264"><span class="linenos">4264</span></a>                <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-4265"><a href="#L-4265"><span class="linenos">4265</span></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="L-4266"><a href="#L-4266"><span class="linenos">4266</span></a>                        <span class="p">[</span>
</span><span id="L-4267"><a href="#L-4267"><span class="linenos">4267</span></a>                            <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-4268"><a href="#L-4268"><span class="linenos">4268</span></a>                                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</span><span id="L-4269"><a href="#L-4269"><span class="linenos">4269</span></a>                            <span class="p">)</span>
</span><span id="L-4270"><a href="#L-4270"><span class="linenos">4270</span></a>                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">score_tensors</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="L-4271"><a href="#L-4271"><span class="linenos">4271</span></a>                        <span class="p">]</span>
</span><span id="L-4272"><a href="#L-4272"><span class="linenos">4272</span></a>                    <span class="p">)</span>
</span><span id="L-4273"><a href="#L-4273"><span class="linenos">4273</span></a>                <span class="p">)</span>
</span><span id="L-4274"><a href="#L-4274"><span class="linenos">4274</span></a>            <span class="p">)</span>
</span><span id="L-4275"><a href="#L-4275"><span class="linenos">4275</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">factor</span>
</span><span id="L-4276"><a href="#L-4276"><span class="linenos">4276</span></a>            <span class="n">intervals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-4277"><a href="#L-4277"><span class="linenos">4277</span></a>            <span class="n">interval_scores</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-4278"><a href="#L-4278"><span class="linenos">4278</span></a>            <span class="n">key1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">score_tensors</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-4279"><a href="#L-4279"><span class="linenos">4279</span></a>            <span class="n">key2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">score_tensors</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-4280"><a href="#L-4280"><span class="linenos">4280</span></a>            <span class="n">num_scores</span> <span class="o">=</span> <span class="n">score_tensors</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-4281"><a href="#L-4281"><span class="linenos">4281</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_scores</span><span class="p">):</span>
</span><span id="L-4282"><a href="#L-4282"><span class="linenos">4282</span></a>                <span class="n">v_dict</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_valleys</span><span class="p">(</span>
</span><span id="L-4283"><a href="#L-4283"><span class="linenos">4283</span></a>                    <span class="n">predicted</span><span class="o">=</span><span class="n">score_tensors</span><span class="p">,</span>
</span><span id="L-4284"><a href="#L-4284"><span class="linenos">4284</span></a>                    <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
</span><span id="L-4285"><a href="#L-4285"><span class="linenos">4285</span></a>                    <span class="n">min_frames</span><span class="o">=</span><span class="n">min_length</span><span class="p">,</span>
</span><span id="L-4286"><a href="#L-4286"><span class="linenos">4286</span></a>                    <span class="n">main_class</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="L-4287"><a href="#L-4287"><span class="linenos">4287</span></a>                    <span class="n">low</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-4288"><a href="#L-4288"><span class="linenos">4288</span></a>                <span class="p">)</span>
</span><span id="L-4289"><a href="#L-4289"><span class="linenos">4289</span></a>                <span class="k">for</span> <span class="n">v_id</span><span class="p">,</span> <span class="n">interval_list</span> <span class="ow">in</span> <span class="n">v_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-4290"><a href="#L-4290"><span class="linenos">4290</span></a>                    <span class="n">intervals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">[</span><span class="n">v_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">interval_list</span><span class="p">]</span>
</span><span id="L-4291"><a href="#L-4291"><span class="linenos">4291</span></a>                    <span class="n">interval_scores</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-4292"><a href="#L-4292"><span class="linenos">4292</span></a>                        <span class="nb">float</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">score_tensors</span><span class="p">[</span><span class="n">v_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]))</span>
</span><span id="L-4293"><a href="#L-4293"><span class="linenos">4293</span></a>                        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">interval_list</span>
</span><span id="L-4294"><a href="#L-4294"><span class="linenos">4294</span></a>                    <span class="p">]</span>
</span><span id="L-4295"><a href="#L-4295"><span class="linenos">4295</span></a>            <span class="n">intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intervals</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">interval_scores</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-4296"><a href="#L-4296"><span class="linenos">4296</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-4297"><a href="#L-4297"><span class="linenos">4297</span></a>            <span class="k">while</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="L-4298"><a href="#L-4298"><span class="linenos">4298</span></a>                <span class="p">[(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">masked</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span><span id="L-4299"><a href="#L-4299"><span class="linenos">4299</span></a>            <span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_frames</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
</span><span id="L-4300"><a href="#L-4300"><span class="linenos">4300</span></a>                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">video_id</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-4301"><a href="#L-4301"><span class="linenos">4301</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-4302"><a href="#L-4302"><span class="linenos">4302</span></a>                <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-4303"><a href="#L-4303"><span class="linenos">4303</span></a>            <span class="n">factor</span> <span class="o">*=</span> <span class="mf">0.9</span>
</span><span id="L-4304"><a href="#L-4304"><span class="linenos">4304</span></a>            <span class="k">if</span> <span class="n">factor</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
</span><span id="L-4305"><a href="#L-4305"><span class="linenos">4305</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find enough frames!&quot;</span><span class="p">)</span>
</span><span id="L-4306"><a href="#L-4306"><span class="linenos">4306</span></a>                <span class="k">break</span>
</span><span id="L-4307"><a href="#L-4307"><span class="linenos">4307</span></a>        <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">video_id</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">}</span>
</span><span id="L-4308"><a href="#L-4308"><span class="linenos">4308</span></a>        <span class="n">total_masked_new</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-4309"><a href="#L-4309"><span class="linenos">4309</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">masked</span><span class="p">:</span>
</span><span id="L-4310"><a href="#L-4310"><span class="linenos">4310</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-4311"><a href="#L-4311"><span class="linenos">4311</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-4312"><a href="#L-4312"><span class="linenos">4312</span></a>                    <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">]</span>
</span><span id="L-4313"><a href="#L-4313"><span class="linenos">4313</span></a>                    <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]</span>
</span><span id="L-4314"><a href="#L-4314"><span class="linenos">4314</span></a>                <span class="p">):</span>
</span><span id="L-4315"><a href="#L-4315"><span class="linenos">4315</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="L-4316"><a href="#L-4316"><span class="linenos">4316</span></a>                        <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-4317"><a href="#L-4317"><span class="linenos">4317</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-4318"><a href="#L-4318"><span class="linenos">4318</span></a>                    <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">]</span>
</span><span id="L-4319"><a href="#L-4319"><span class="linenos">4319</span></a>                    <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]</span>
</span><span id="L-4320"><a href="#L-4320"><span class="linenos">4320</span></a>                <span class="p">):</span>
</span><span id="L-4321"><a href="#L-4321"><span class="linenos">4321</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="L-4322"><a href="#L-4322"><span class="linenos">4322</span></a>                        <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-4323"><a href="#L-4323"><span class="linenos">4323</span></a>                <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-4324"><a href="#L-4324"><span class="linenos">4324</span></a>                <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_intervals</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
</span><span id="L-4325"><a href="#L-4325"><span class="linenos">4325</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">]:</span>
</span><span id="L-4326"><a href="#L-4326"><span class="linenos">4326</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-4327"><a href="#L-4327"><span class="linenos">4327</span></a>                <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="L-4328"><a href="#L-4328"><span class="linenos">4328</span></a>                    <span class="n">total_masked_new</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="L-4329"><a href="#L-4329"><span class="linenos">4329</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">)</span>
</span><span id="L-4330"><a href="#L-4330"><span class="linenos">4330</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="L-4331"><a href="#L-4331"><span class="linenos">4331</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;a&quot;</span>
</span><span id="L-4332"><a href="#L-4332"><span class="linenos">4332</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-4333"><a href="#L-4333"><span class="linenos">4333</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">total_masked</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">total_masked_new</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">total_all</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-4334"><a href="#L-4334"><span class="linenos">4334</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unmasked from </span><span class="si">{</span><span class="n">total_masked</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">total_masked_new</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">total_all</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-4335"><a href="#L-4335"><span class="linenos">4335</span></a>
</span><span id="L-4336"><a href="#L-4336"><span class="linenos">4336</span></a>    <span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span>
</span><span id="L-4337"><a href="#L-4337"><span class="linenos">4337</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-4338"><a href="#L-4338"><span class="linenos">4338</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-4339"><a href="#L-4339"><span class="linenos">4339</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4340"><a href="#L-4340"><span class="linenos">4340</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4341"><a href="#L-4341"><span class="linenos">4341</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span>
</span><span id="L-4342"><a href="#L-4342"><span class="linenos">4342</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
</span><span id="L-4343"><a href="#L-4343"><span class="linenos">4343</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-4344"><a href="#L-4344"><span class="linenos">4344</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">]:</span>
</span><span id="L-4345"><a href="#L-4345"><span class="linenos">4345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4346"><a href="#L-4346"><span class="linenos">4346</span></a><span class="sd">        Make a confusion matrix plot and return the data</span>
</span><span id="L-4347"><a href="#L-4347"><span class="linenos">4347</span></a>
</span><span id="L-4348"><a href="#L-4348"><span class="linenos">4348</span></a><span class="sd">        If the annotation is non-exclusive, only false positive labels are considered.</span>
</span><span id="L-4349"><a href="#L-4349"><span class="linenos">4349</span></a>
</span><span id="L-4350"><a href="#L-4350"><span class="linenos">4350</span></a><span class="sd">        Parameters</span>
</span><span id="L-4351"><a href="#L-4351"><span class="linenos">4351</span></a><span class="sd">        ----------</span>
</span><span id="L-4352"><a href="#L-4352"><span class="linenos">4352</span></a><span class="sd">        episode_name : str</span>
</span><span id="L-4353"><a href="#L-4353"><span class="linenos">4353</span></a><span class="sd">            the name of the episode to load</span>
</span><span id="L-4354"><a href="#L-4354"><span class="linenos">4354</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="L-4355"><a href="#L-4355"><span class="linenos">4355</span></a><span class="sd">            the index of the epoch to load (by default the last one is loaded)</span>
</span><span id="L-4356"><a href="#L-4356"><span class="linenos">4356</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-4357"><a href="#L-4357"><span class="linenos">4357</span></a><span class="sd">            a dictionary of parameter updates (only for &quot;data&quot; and &quot;general&quot; categories)</span>
</span><span id="L-4358"><a href="#L-4358"><span class="linenos">4358</span></a><span class="sd">        mode : {&#39;val&#39;, &#39;all&#39;, &#39;test&#39;, &#39;train&#39;}</span>
</span><span id="L-4359"><a href="#L-4359"><span class="linenos">4359</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None)</span>
</span><span id="L-4360"><a href="#L-4360"><span class="linenos">4360</span></a><span class="sd">        type : {&quot;recall&quot;, &quot;precision&quot;}</span>
</span><span id="L-4361"><a href="#L-4361"><span class="linenos">4361</span></a><span class="sd">            for datasets with non-exclusive annotation, if `type` is `&quot;recall&quot;`, only false positives are taken</span>
</span><span id="L-4362"><a href="#L-4362"><span class="linenos">4362</span></a><span class="sd">            into account, and if `type` is `&quot;precision&quot;`, only false negatives</span>
</span><span id="L-4363"><a href="#L-4363"><span class="linenos">4363</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="L-4364"><a href="#L-4364"><span class="linenos">4364</span></a><span class="sd">            if `True`, the dataset that is used for computation is then deleted</span>
</span><span id="L-4365"><a href="#L-4365"><span class="linenos">4365</span></a>
</span><span id="L-4366"><a href="#L-4366"><span class="linenos">4366</span></a><span class="sd">        Returns</span>
</span><span id="L-4367"><a href="#L-4367"><span class="linenos">4367</span></a><span class="sd">        -------</span>
</span><span id="L-4368"><a href="#L-4368"><span class="linenos">4368</span></a><span class="sd">        confusion_matrix : np.ndarray</span>
</span><span id="L-4369"><a href="#L-4369"><span class="linenos">4369</span></a><span class="sd">            a confusion matrix of shape `(#classes, #classes)` where `A[i, j] = F_ij/N_i`, `F_ij` is the number of</span>
</span><span id="L-4370"><a href="#L-4370"><span class="linenos">4370</span></a><span class="sd">            frames that have the i-th label in the ground truth and a false positive j-th label in the prediction,</span>
</span><span id="L-4371"><a href="#L-4371"><span class="linenos">4371</span></a><span class="sd">            `N_i` is the number of frames that have the i-th label in the ground truth</span>
</span><span id="L-4372"><a href="#L-4372"><span class="linenos">4372</span></a><span class="sd">        classes : list</span>
</span><span id="L-4373"><a href="#L-4373"><span class="linenos">4373</span></a><span class="sd">            a list of labels</span>
</span><span id="L-4374"><a href="#L-4374"><span class="linenos">4374</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4375"><a href="#L-4375"><span class="linenos">4375</span></a>
</span><span id="L-4376"><a href="#L-4376"><span class="linenos">4376</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="L-4377"><a href="#L-4377"><span class="linenos">4377</span></a>            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="L-4378"><a href="#L-4378"><span class="linenos">4378</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-4379"><a href="#L-4379"><span class="linenos">4379</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-4380"><a href="#L-4380"><span class="linenos">4380</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-4381"><a href="#L-4381"><span class="linenos">4381</span></a>            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-4382"><a href="#L-4382"><span class="linenos">4382</span></a>        <span class="p">)</span>
</span><span id="L-4383"><a href="#L-4383"><span class="linenos">4383</span></a>        <span class="n">dataset</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="L-4384"><a href="#L-4384"><span class="linenos">4384</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">raw_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-4385"><a href="#L-4385"><span class="linenos">4385</span></a>        <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_confusion_matrix</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="L-4386"><a href="#L-4386"><span class="linenos">4386</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="L-4387"><a href="#L-4387"><span class="linenos">4387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-4388"><a href="#L-4388"><span class="linenos">4388</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)))</span>
</span><span id="L-4389"><a href="#L-4389"><span class="linenos">4389</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">)</span>
</span><span id="L-4390"><a href="#L-4390"><span class="linenos">4390</span></a>        <span class="c1"># Show all ticks and label them with the respective list entries</span>
</span><span id="L-4391"><a href="#L-4391"><span class="linenos">4391</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)))</span>
</span><span id="L-4392"><a href="#L-4392"><span class="linenos">4392</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
</span><span id="L-4393"><a href="#L-4393"><span class="linenos">4393</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)))</span>
</span><span id="L-4394"><a href="#L-4394"><span class="linenos">4394</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
</span><span id="L-4395"><a href="#L-4395"><span class="linenos">4395</span></a>        <span class="c1"># Rotate the tick labels and set their alignment.</span>
</span><span id="L-4396"><a href="#L-4396"><span class="linenos">4396</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>
</span><span id="L-4397"><a href="#L-4397"><span class="linenos">4397</span></a>        <span class="c1"># Loop over data dimensions and create text annotations.</span>
</span><span id="L-4398"><a href="#L-4398"><span class="linenos">4398</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
</span><span id="L-4399"><a href="#L-4399"><span class="linenos">4399</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
</span><span id="L-4400"><a href="#L-4400"><span class="linenos">4400</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="L-4401"><a href="#L-4401"><span class="linenos">4401</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="L-4402"><a href="#L-4402"><span class="linenos">4402</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="L-4403"><a href="#L-4403"><span class="linenos">4403</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-4404"><a href="#L-4404"><span class="linenos">4404</span></a>                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="L-4405"><a href="#L-4405"><span class="linenos">4405</span></a>                    <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="L-4406"><a href="#L-4406"><span class="linenos">4406</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
</span><span id="L-4407"><a href="#L-4407"><span class="linenos">4407</span></a>                <span class="p">)</span>
</span><span id="L-4408"><a href="#L-4408"><span class="linenos">4408</span></a>        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4409"><a href="#L-4409"><span class="linenos">4409</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-4410"><a href="#L-4410"><span class="linenos">4410</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4411"><a href="#L-4411"><span class="linenos">4411</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-4412"><a href="#L-4412"><span class="linenos">4412</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-4413"><a href="#L-4413"><span class="linenos">4413</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-4414"><a href="#L-4414"><span class="linenos">4414</span></a>        <span class="k">return</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classes</span>
</span><span id="L-4415"><a href="#L-4415"><span class="linenos">4415</span></a>
</span><span id="L-4416"><a href="#L-4416"><span class="linenos">4416</span></a>    <span class="k">def</span> <span class="nf">plot_predictions</span><span class="p">(</span>
</span><span id="L-4417"><a href="#L-4417"><span class="linenos">4417</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-4418"><a href="#L-4418"><span class="linenos">4418</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-4419"><a href="#L-4419"><span class="linenos">4419</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4420"><a href="#L-4420"><span class="linenos">4420</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4421"><a href="#L-4421"><span class="linenos">4421</span></a>        <span class="n">add_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-4422"><a href="#L-4422"><span class="linenos">4422</span></a>        <span class="n">ground_truth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-4423"><a href="#L-4423"><span class="linenos">4423</span></a>        <span class="n">colormap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
</span><span id="L-4424"><a href="#L-4424"><span class="linenos">4424</span></a>        <span class="n">hide_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-4425"><a href="#L-4425"><span class="linenos">4425</span></a>        <span class="n">min_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-4426"><a href="#L-4426"><span class="linenos">4426</span></a>        <span class="n">width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-4427"><a href="#L-4427"><span class="linenos">4427</span></a>        <span class="n">whole_video</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-4428"><a href="#L-4428"><span class="linenos">4428</span></a>        <span class="n">transparent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-4429"><a href="#L-4429"><span class="linenos">4429</span></a>        <span class="n">drop_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4430"><a href="#L-4430"><span class="linenos">4430</span></a>        <span class="n">search_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4431"><a href="#L-4431"><span class="linenos">4431</span></a>        <span class="n">num_plots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-4432"><a href="#L-4432"><span class="linenos">4432</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-4433"><a href="#L-4433"><span class="linenos">4433</span></a>        <span class="n">smooth_interval_prediction</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-4434"><a href="#L-4434"><span class="linenos">4434</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4435"><a href="#L-4435"><span class="linenos">4435</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4436"><a href="#L-4436"><span class="linenos">4436</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
</span><span id="L-4437"><a href="#L-4437"><span class="linenos">4437</span></a>        <span class="n">behavior_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4438"><a href="#L-4438"><span class="linenos">4438</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4439"><a href="#L-4439"><span class="linenos">4439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4440"><a href="#L-4440"><span class="linenos">4440</span></a><span class="sd">        Visualize random predictions</span>
</span><span id="L-4441"><a href="#L-4441"><span class="linenos">4441</span></a>
</span><span id="L-4442"><a href="#L-4442"><span class="linenos">4442</span></a><span class="sd">        Parameters</span>
</span><span id="L-4443"><a href="#L-4443"><span class="linenos">4443</span></a><span class="sd">        ----------</span>
</span><span id="L-4444"><a href="#L-4444"><span class="linenos">4444</span></a><span class="sd">        episode_name : str</span>
</span><span id="L-4445"><a href="#L-4445"><span class="linenos">4445</span></a><span class="sd">            the name of the episode to load</span>
</span><span id="L-4446"><a href="#L-4446"><span class="linenos">4446</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="L-4447"><a href="#L-4447"><span class="linenos">4447</span></a><span class="sd">            the epoch to load (by default last)</span>
</span><span id="L-4448"><a href="#L-4448"><span class="linenos">4448</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="L-4449"><a href="#L-4449"><span class="linenos">4449</span></a><span class="sd">            parameter update dictionary</span>
</span><span id="L-4450"><a href="#L-4450"><span class="linenos">4450</span></a><span class="sd">        add_legend : bool, default True</span>
</span><span id="L-4451"><a href="#L-4451"><span class="linenos">4451</span></a><span class="sd">            if True, legend will be added to the plot</span>
</span><span id="L-4452"><a href="#L-4452"><span class="linenos">4452</span></a><span class="sd">        ground_truth : bool, default True</span>
</span><span id="L-4453"><a href="#L-4453"><span class="linenos">4453</span></a><span class="sd">            if True, ground truth will be added to the plot</span>
</span><span id="L-4454"><a href="#L-4454"><span class="linenos">4454</span></a><span class="sd">        colormap : str, default &#39;Accent&#39;</span>
</span><span id="L-4455"><a href="#L-4455"><span class="linenos">4455</span></a><span class="sd">            the `matplotlib` colormap to use</span>
</span><span id="L-4456"><a href="#L-4456"><span class="linenos">4456</span></a><span class="sd">        hide_axes : bool, default True</span>
</span><span id="L-4457"><a href="#L-4457"><span class="linenos">4457</span></a><span class="sd">            if `True`, the axes will be hidden on the plot</span>
</span><span id="L-4458"><a href="#L-4458"><span class="linenos">4458</span></a><span class="sd">        min_classes : int, default 1</span>
</span><span id="L-4459"><a href="#L-4459"><span class="linenos">4459</span></a><span class="sd">            the minimum number of classes in a displayed interval</span>
</span><span id="L-4460"><a href="#L-4460"><span class="linenos">4460</span></a><span class="sd">        width : float, default 10</span>
</span><span id="L-4461"><a href="#L-4461"><span class="linenos">4461</span></a><span class="sd">            the width of the plot</span>
</span><span id="L-4462"><a href="#L-4462"><span class="linenos">4462</span></a><span class="sd">        whole_video : bool, default False</span>
</span><span id="L-4463"><a href="#L-4463"><span class="linenos">4463</span></a><span class="sd">            if `True`, whole videos are plotted instead of segments</span>
</span><span id="L-4464"><a href="#L-4464"><span class="linenos">4464</span></a><span class="sd">        transparent : bool, default False</span>
</span><span id="L-4465"><a href="#L-4465"><span class="linenos">4465</span></a><span class="sd">            if `True`, the background on the plot is transparent</span>
</span><span id="L-4466"><a href="#L-4466"><span class="linenos">4466</span></a><span class="sd">        drop_classes : set, optional</span>
</span><span id="L-4467"><a href="#L-4467"><span class="linenos">4467</span></a><span class="sd">            a set of class names to not be displayed</span>
</span><span id="L-4468"><a href="#L-4468"><span class="linenos">4468</span></a><span class="sd">        search_classes : set, optional</span>
</span><span id="L-4469"><a href="#L-4469"><span class="linenos">4469</span></a><span class="sd">            if given, only intervals where at least one of the classes is in ground truth will be shown</span>
</span><span id="L-4470"><a href="#L-4470"><span class="linenos">4470</span></a><span class="sd">        num_plots : int, default 1</span>
</span><span id="L-4471"><a href="#L-4471"><span class="linenos">4471</span></a><span class="sd">            the number of plots to make</span>
</span><span id="L-4472"><a href="#L-4472"><span class="linenos">4472</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="L-4473"><a href="#L-4473"><span class="linenos">4473</span></a><span class="sd">            if `True`, the dataset will be deleted after computation</span>
</span><span id="L-4474"><a href="#L-4474"><span class="linenos">4474</span></a><span class="sd">        smooth_interval_prediction : int, default 0</span>
</span><span id="L-4475"><a href="#L-4475"><span class="linenos">4475</span></a><span class="sd">            if &gt;0, predictions shorter than this number of frames are removed (filled with prediction for the previous frame)</span>
</span><span id="L-4476"><a href="#L-4476"><span class="linenos">4476</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="L-4477"><a href="#L-4477"><span class="linenos">4477</span></a><span class="sd">            the data path to run the prediction for</span>
</span><span id="L-4478"><a href="#L-4478"><span class="linenos">4478</span></a><span class="sd">        mode : {&#39;all&#39;, &#39;test&#39;, &#39;val&#39;, &#39;train&#39;}</span>
</span><span id="L-4479"><a href="#L-4479"><span class="linenos">4479</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None)</span>
</span><span id="L-4480"><a href="#L-4480"><span class="linenos">4480</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="L-4481"><a href="#L-4481"><span class="linenos">4481</span></a><span class="sd">            a set of string file paths (data with all prefixes + feature files, in any order) to run the prediction</span>
</span><span id="L-4482"><a href="#L-4482"><span class="linenos">4482</span></a><span class="sd">            for</span>
</span><span id="L-4483"><a href="#L-4483"><span class="linenos">4483</span></a><span class="sd">        behavior_name : str, optional</span>
</span><span id="L-4484"><a href="#L-4484"><span class="linenos">4484</span></a><span class="sd">            for non-exclusive classificaton datasets, choose which behavior to visualize (by default first in list)</span>
</span><span id="L-4485"><a href="#L-4485"><span class="linenos">4485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4486"><a href="#L-4486"><span class="linenos">4486</span></a>
</span><span id="L-4487"><a href="#L-4487"><span class="linenos">4487</span></a>        <span class="n">other_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">)</span>
</span><span id="L-4488"><a href="#L-4488"><span class="linenos">4488</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="L-4489"><a href="#L-4489"><span class="linenos">4489</span></a>            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="L-4490"><a href="#L-4490"><span class="linenos">4490</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="L-4491"><a href="#L-4491"><span class="linenos">4491</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="L-4492"><a href="#L-4492"><span class="linenos">4492</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-4493"><a href="#L-4493"><span class="linenos">4493</span></a>            <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-4494"><a href="#L-4494"><span class="linenos">4494</span></a>            <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="L-4495"><a href="#L-4495"><span class="linenos">4495</span></a>            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-4496"><a href="#L-4496"><span class="linenos">4496</span></a>        <span class="p">)</span>
</span><span id="L-4497"><a href="#L-4497"><span class="linenos">4497</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">other_path</span><span class="p">):</span>
</span><span id="L-4498"><a href="#L-4498"><span class="linenos">4498</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">other_path</span><span class="p">)</span>
</span><span id="L-4499"><a href="#L-4499"><span class="linenos">4499</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_plots</span><span class="p">):</span>
</span><span id="L-4500"><a href="#L-4500"><span class="linenos">4500</span></a>            <span class="n">task</span><span class="o">.</span><span class="n">visualize_results</span><span class="p">(</span>
</span><span id="L-4501"><a href="#L-4501"><span class="linenos">4501</span></a>                <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-4502"><a href="#L-4502"><span class="linenos">4502</span></a>                    <span class="n">other_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">_prediction_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.jpg&quot;</span>
</span><span id="L-4503"><a href="#L-4503"><span class="linenos">4503</span></a>                <span class="p">),</span>
</span><span id="L-4504"><a href="#L-4504"><span class="linenos">4504</span></a>                <span class="n">add_legend</span><span class="o">=</span><span class="n">add_legend</span><span class="p">,</span>
</span><span id="L-4505"><a href="#L-4505"><span class="linenos">4505</span></a>                <span class="n">ground_truth</span><span class="o">=</span><span class="n">ground_truth</span><span class="p">,</span>
</span><span id="L-4506"><a href="#L-4506"><span class="linenos">4506</span></a>                <span class="n">colormap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span>
</span><span id="L-4507"><a href="#L-4507"><span class="linenos">4507</span></a>                <span class="n">hide_axes</span><span class="o">=</span><span class="n">hide_axes</span><span class="p">,</span>
</span><span id="L-4508"><a href="#L-4508"><span class="linenos">4508</span></a>                <span class="n">min_classes</span><span class="o">=</span><span class="n">min_classes</span><span class="p">,</span>
</span><span id="L-4509"><a href="#L-4509"><span class="linenos">4509</span></a>                <span class="n">whole_video</span><span class="o">=</span><span class="n">whole_video</span><span class="p">,</span>
</span><span id="L-4510"><a href="#L-4510"><span class="linenos">4510</span></a>                <span class="n">transparent</span><span class="o">=</span><span class="n">transparent</span><span class="p">,</span>
</span><span id="L-4511"><a href="#L-4511"><span class="linenos">4511</span></a>                <span class="n">dataset</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-4512"><a href="#L-4512"><span class="linenos">4512</span></a>                <span class="n">drop_classes</span><span class="o">=</span><span class="n">drop_classes</span><span class="p">,</span>
</span><span id="L-4513"><a href="#L-4513"><span class="linenos">4513</span></a>                <span class="n">search_classes</span><span class="o">=</span><span class="n">search_classes</span><span class="p">,</span>
</span><span id="L-4514"><a href="#L-4514"><span class="linenos">4514</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="L-4515"><a href="#L-4515"><span class="linenos">4515</span></a>                <span class="n">smooth_interval_prediction</span><span class="o">=</span><span class="n">smooth_interval_prediction</span><span class="p">,</span>
</span><span id="L-4516"><a href="#L-4516"><span class="linenos">4516</span></a>                <span class="n">behavior_name</span><span class="o">=</span><span class="n">behavior_name</span><span class="p">,</span>
</span><span id="L-4517"><a href="#L-4517"><span class="linenos">4517</span></a>            <span class="p">)</span>
</span><span id="L-4518"><a href="#L-4518"><span class="linenos">4518</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="L-4519"><a href="#L-4519"><span class="linenos">4519</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-4520"><a href="#L-4520"><span class="linenos">4520</span></a>
</span><span id="L-4521"><a href="#L-4521"><span class="linenos">4521</span></a>    <span class="k">def</span> <span class="nf">create_metadata_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4522"><a href="#L-4522"><span class="linenos">4522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4523"><a href="#L-4523"><span class="linenos">4523</span></a><span class="sd">        Create a copy of the meta files</span>
</span><span id="L-4524"><a href="#L-4524"><span class="linenos">4524</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4525"><a href="#L-4525"><span class="linenos">4525</span></a>
</span><span id="L-4526"><a href="#L-4526"><span class="linenos">4526</span></a>        <span class="n">meta_copy_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;backup&quot;</span><span class="p">)</span>
</span><span id="L-4527"><a href="#L-4527"><span class="linenos">4527</span></a>        <span class="n">meta_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">)</span>
</span><span id="L-4528"><a href="#L-4528"><span class="linenos">4528</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">):</span>
</span><span id="L-4529"><a href="#L-4529"><span class="linenos">4529</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">)</span>
</span><span id="L-4530"><a href="#L-4530"><span class="linenos">4530</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">)</span>
</span><span id="L-4531"><a href="#L-4531"><span class="linenos">4531</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">meta_path</span><span class="p">):</span>
</span><span id="L-4532"><a href="#L-4532"><span class="linenos">4532</span></a>            <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;backup&quot;</span><span class="p">:</span>
</span><span id="L-4533"><a href="#L-4533"><span class="linenos">4533</span></a>                <span class="k">continue</span>
</span><span id="L-4534"><a href="#L-4534"><span class="linenos">4534</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="L-4535"><a href="#L-4535"><span class="linenos">4535</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-4536"><a href="#L-4536"><span class="linenos">4536</span></a>            <span class="p">)</span>
</span><span id="L-4537"><a href="#L-4537"><span class="linenos">4537</span></a>
</span><span id="L-4538"><a href="#L-4538"><span class="linenos">4538</span></a>    <span class="k">def</span> <span class="nf">load_metadata_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4539"><a href="#L-4539"><span class="linenos">4539</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4540"><a href="#L-4540"><span class="linenos">4540</span></a><span class="sd">        Load from previously created meta data backup (in case of corruption)</span>
</span><span id="L-4541"><a href="#L-4541"><span class="linenos">4541</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4542"><a href="#L-4542"><span class="linenos">4542</span></a>
</span><span id="L-4543"><a href="#L-4543"><span class="linenos">4543</span></a>        <span class="n">meta_copy_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;backup&quot;</span><span class="p">)</span>
</span><span id="L-4544"><a href="#L-4544"><span class="linenos">4544</span></a>        <span class="n">meta_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">)</span>
</span><span id="L-4545"><a href="#L-4545"><span class="linenos">4545</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">):</span>
</span><span id="L-4546"><a href="#L-4546"><span class="linenos">4546</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="L-4547"><a href="#L-4547"><span class="linenos">4547</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-4548"><a href="#L-4548"><span class="linenos">4548</span></a>            <span class="p">)</span>
</span><span id="L-4549"><a href="#L-4549"><span class="linenos">4549</span></a>
</span><span id="L-4550"><a href="#L-4550"><span class="linenos">4550</span></a>    <span class="k">def</span> <span class="nf">get_behavior_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-4551"><a href="#L-4551"><span class="linenos">4551</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4552"><a href="#L-4552"><span class="linenos">4552</span></a><span class="sd">        Get the behavior dictionary for an episode</span>
</span><span id="L-4553"><a href="#L-4553"><span class="linenos">4553</span></a>
</span><span id="L-4554"><a href="#L-4554"><span class="linenos">4554</span></a><span class="sd">        Parameters</span>
</span><span id="L-4555"><a href="#L-4555"><span class="linenos">4555</span></a><span class="sd">        ----------</span>
</span><span id="L-4556"><a href="#L-4556"><span class="linenos">4556</span></a><span class="sd">        episode_name : str</span>
</span><span id="L-4557"><a href="#L-4557"><span class="linenos">4557</span></a><span class="sd">            the name of the episode</span>
</span><span id="L-4558"><a href="#L-4558"><span class="linenos">4558</span></a>
</span><span id="L-4559"><a href="#L-4559"><span class="linenos">4559</span></a><span class="sd">        Returns</span>
</span><span id="L-4560"><a href="#L-4560"><span class="linenos">4560</span></a><span class="sd">        -------</span>
</span><span id="L-4561"><a href="#L-4561"><span class="linenos">4561</span></a><span class="sd">        behaviors_dictionary : dict</span>
</span><span id="L-4562"><a href="#L-4562"><span class="linenos">4562</span></a><span class="sd">            a dictionary where keys are label indices and values are label names</span>
</span><span id="L-4563"><a href="#L-4563"><span class="linenos">4563</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4564"><a href="#L-4564"><span class="linenos">4564</span></a>
</span><span id="L-4565"><a href="#L-4565"><span class="linenos">4565</span></a>        <span class="n">run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-4566"><a href="#L-4566"><span class="linenos">4566</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_behaviors_dict</span><span class="p">()</span>
</span><span id="L-4567"><a href="#L-4567"><span class="linenos">4567</span></a>
</span><span id="L-4568"><a href="#L-4568"><span class="linenos">4568</span></a>    <span class="k">def</span> <span class="nf">import_episodes</span><span class="p">(</span>
</span><span id="L-4569"><a href="#L-4569"><span class="linenos">4569</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-4570"><a href="#L-4570"><span class="linenos">4570</span></a>        <span class="n">episodes_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-4571"><a href="#L-4571"><span class="linenos">4571</span></a>        <span class="n">name_map</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4572"><a href="#L-4572"><span class="linenos">4572</span></a>        <span class="n">repeat_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="L-4573"><a href="#L-4573"><span class="linenos">4573</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4574"><a href="#L-4574"><span class="linenos">4574</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4575"><a href="#L-4575"><span class="linenos">4575</span></a><span class="sd">        Import episodes exported with `Project.export_episodes`</span>
</span><span id="L-4576"><a href="#L-4576"><span class="linenos">4576</span></a>
</span><span id="L-4577"><a href="#L-4577"><span class="linenos">4577</span></a><span class="sd">        Parameters</span>
</span><span id="L-4578"><a href="#L-4578"><span class="linenos">4578</span></a><span class="sd">        ----------</span>
</span><span id="L-4579"><a href="#L-4579"><span class="linenos">4579</span></a><span class="sd">        episodes_directory : str</span>
</span><span id="L-4580"><a href="#L-4580"><span class="linenos">4580</span></a><span class="sd">            the path to the exported episodes directory</span>
</span><span id="L-4581"><a href="#L-4581"><span class="linenos">4581</span></a><span class="sd">        name_map : dict</span>
</span><span id="L-4582"><a href="#L-4582"><span class="linenos">4582</span></a><span class="sd">            a name change dictionary for the episodes: keys are old names, values are new names</span>
</span><span id="L-4583"><a href="#L-4583"><span class="linenos">4583</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4584"><a href="#L-4584"><span class="linenos">4584</span></a>
</span><span id="L-4585"><a href="#L-4585"><span class="linenos">4585</span></a>        <span class="k">if</span> <span class="n">name_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4586"><a href="#L-4586"><span class="linenos">4586</span></a>            <span class="n">name_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-4587"><a href="#L-4587"><span class="linenos">4587</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">episodes_directory</span><span class="p">,</span> <span class="s2">&quot;episodes.pickle&quot;</span><span class="p">))</span>
</span><span id="L-4588"><a href="#L-4588"><span class="linenos">4588</span></a>        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-4589"><a href="#L-4589"><span class="linenos">4589</span></a>        <span class="n">import_string</span> <span class="o">=</span> <span class="s2">&quot;Imported episodes: &quot;</span>
</span><span id="L-4590"><a href="#L-4590"><span class="linenos">4590</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="L-4591"><a href="#L-4591"><span class="linenos">4591</span></a>            <span class="k">if</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">name_map</span><span class="p">:</span>
</span><span id="L-4592"><a href="#L-4592"><span class="linenos">4592</span></a>                <span class="n">import_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="L-4593"><a href="#L-4593"><span class="linenos">4593</span></a>                <span class="n">episode_name</span> <span class="o">=</span> <span class="n">name_map</span><span class="p">[</span><span class="n">episode_name</span><span class="p">]</span>
</span><span id="L-4594"><a href="#L-4594"><span class="linenos">4594</span></a>                <span class="n">import_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">), &quot;</span>
</span><span id="L-4595"><a href="#L-4595"><span class="linenos">4595</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-4596"><a href="#L-4596"><span class="linenos">4596</span></a>                <span class="n">import_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-4597"><a href="#L-4597"><span class="linenos">4597</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-4598"><a href="#L-4598"><span class="linenos">4598</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_check_episode_validity</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">allow_doublecolon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-4599"><a href="#L-4599"><span class="linenos">4599</span></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-4600"><a href="#L-4600"><span class="linenos">4600</span></a>                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;is already taken!&quot;</span><span class="p">):</span>
</span><span id="L-4601"><a href="#L-4601"><span class="linenos">4601</span></a>                    <span class="k">if</span> <span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;skip&quot;</span><span class="p">:</span>
</span><span id="L-4602"><a href="#L-4602"><span class="linenos">4602</span></a>                        <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-4603"><a href="#L-4603"><span class="linenos">4603</span></a>                    <span class="k">elif</span> <span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;force&quot;</span><span class="p">:</span>
</span><span id="L-4604"><a href="#L-4604"><span class="linenos">4604</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-4605"><a href="#L-4605"><span class="linenos">4605</span></a>                    <span class="k">elif</span> <span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
</span><span id="L-4606"><a href="#L-4606"><span class="linenos">4606</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-4607"><a href="#L-4607"><span class="linenos">4607</span></a>                            <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> episode name is already taken; please use the name_map parameter to rename it&quot;</span>
</span><span id="L-4608"><a href="#L-4608"><span class="linenos">4608</span></a>                        <span class="p">)</span>
</span><span id="L-4609"><a href="#L-4609"><span class="linenos">4609</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-4610"><a href="#L-4610"><span class="linenos">4610</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-4611"><a href="#L-4611"><span class="linenos">4611</span></a>                            <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">repeat_policy</span><span class="si">}</span><span class="s2"> repeat policy is not recognized; please choose from [&#39;skip&#39;, &#39;force&#39; ans &#39;error&#39;]&quot;</span>
</span><span id="L-4612"><a href="#L-4612"><span class="linenos">4612</span></a>                        <span class="p">)</span>
</span><span id="L-4613"><a href="#L-4613"><span class="linenos">4613</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="n">episodes</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">to_remove</span><span class="p">)</span>
</span><span id="L-4614"><a href="#L-4614"><span class="linenos">4614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="L-4615"><a href="#L-4615"><span class="linenos">4615</span></a>            <span class="n">episodes</span><span class="p">,</span>
</span><span id="L-4616"><a href="#L-4616"><span class="linenos">4616</span></a>            <span class="n">name_map</span><span class="o">=</span><span class="n">name_map</span><span class="p">,</span>
</span><span id="L-4617"><a href="#L-4617"><span class="linenos">4617</span></a>            <span class="n">force</span><span class="o">=</span><span class="p">(</span><span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;force&quot;</span><span class="p">),</span>
</span><span id="L-4618"><a href="#L-4618"><span class="linenos">4618</span></a>            <span class="n">data_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="L-4619"><a href="#L-4619"><span class="linenos">4619</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="L-4620"><a href="#L-4620"><span class="linenos">4620</span></a>        <span class="p">)</span>
</span><span id="L-4621"><a href="#L-4621"><span class="linenos">4621</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="L-4622"><a href="#L-4622"><span class="linenos">4622</span></a>            <span class="k">if</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">name_map</span><span class="p">:</span>
</span><span id="L-4623"><a href="#L-4623"><span class="linenos">4623</span></a>                <span class="n">new_episode_name</span> <span class="o">=</span> <span class="n">name_map</span><span class="p">[</span><span class="n">episode_name</span><span class="p">]</span>
</span><span id="L-4624"><a href="#L-4624"><span class="linenos">4624</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-4625"><a href="#L-4625"><span class="linenos">4625</span></a>                <span class="n">new_episode_name</span> <span class="o">=</span> <span class="n">episode_name</span>
</span><span id="L-4626"><a href="#L-4626"><span class="linenos">4626</span></a>            <span class="n">model_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-4627"><a href="#L-4627"><span class="linenos">4627</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">new_episode_name</span>
</span><span id="L-4628"><a href="#L-4628"><span class="linenos">4628</span></a>            <span class="p">)</span>
</span><span id="L-4629"><a href="#L-4629"><span class="linenos">4629</span></a>            <span class="n">old_model_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">episodes_directory</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-4630"><a href="#L-4630"><span class="linenos">4630</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_dir</span><span class="p">):</span>
</span><span id="L-4631"><a href="#L-4631"><span class="linenos">4631</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
</span><span id="L-4632"><a href="#L-4632"><span class="linenos">4632</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
</span><span id="L-4633"><a href="#L-4633"><span class="linenos">4633</span></a>            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">old_model_dir</span><span class="p">):</span>
</span><span id="L-4634"><a href="#L-4634"><span class="linenos">4634</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span>
</span><span id="L-4635"><a href="#L-4635"><span class="linenos">4635</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">old_model_dir</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-4636"><a href="#L-4636"><span class="linenos">4636</span></a>                <span class="p">)</span>
</span><span id="L-4637"><a href="#L-4637"><span class="linenos">4637</span></a>            <span class="n">log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-4638"><a href="#L-4638"><span class="linenos">4638</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="L-4639"><a href="#L-4639"><span class="linenos">4639</span></a>            <span class="p">)</span>
</span><span id="L-4640"><a href="#L-4640"><span class="linenos">4640</span></a>            <span class="n">old_log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-4641"><a href="#L-4641"><span class="linenos">4641</span></a>                <span class="n">episodes_directory</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="L-4642"><a href="#L-4642"><span class="linenos">4642</span></a>            <span class="p">)</span>
</span><span id="L-4643"><a href="#L-4643"><span class="linenos">4643</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">old_log_file</span><span class="p">,</span> <span class="n">log_file</span><span class="p">)</span>
</span><span id="L-4644"><a href="#L-4644"><span class="linenos">4644</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">import_string</span><span class="p">)</span>
</span><span id="L-4645"><a href="#L-4645"><span class="linenos">4645</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-4646"><a href="#L-4646"><span class="linenos">4646</span></a>
</span><span id="L-4647"><a href="#L-4647"><span class="linenos">4647</span></a>    <span class="k">def</span> <span class="nf">export_episodes</span><span class="p">(</span>
</span><span id="L-4648"><a href="#L-4648"><span class="linenos">4648</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">output_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-4649"><a href="#L-4649"><span class="linenos">4649</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4650"><a href="#L-4650"><span class="linenos">4650</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4651"><a href="#L-4651"><span class="linenos">4651</span></a><span class="sd">        Save selected episodes as a file that can be imported into another project with `Project.import_episodes`</span>
</span><span id="L-4652"><a href="#L-4652"><span class="linenos">4652</span></a>
</span><span id="L-4653"><a href="#L-4653"><span class="linenos">4653</span></a><span class="sd">        Parameters</span>
</span><span id="L-4654"><a href="#L-4654"><span class="linenos">4654</span></a><span class="sd">        ----------</span>
</span><span id="L-4655"><a href="#L-4655"><span class="linenos">4655</span></a><span class="sd">        episode_names : list</span>
</span><span id="L-4656"><a href="#L-4656"><span class="linenos">4656</span></a><span class="sd">            a list of string episode names</span>
</span><span id="L-4657"><a href="#L-4657"><span class="linenos">4657</span></a><span class="sd">        output_directory : str</span>
</span><span id="L-4658"><a href="#L-4658"><span class="linenos">4658</span></a><span class="sd">            the path to the directory where the episodes will be saved</span>
</span><span id="L-4659"><a href="#L-4659"><span class="linenos">4659</span></a><span class="sd">        name : str, optional</span>
</span><span id="L-4660"><a href="#L-4660"><span class="linenos">4660</span></a><span class="sd">            the name of the episodes directory (by default `exported_episodes`)</span>
</span><span id="L-4661"><a href="#L-4661"><span class="linenos">4661</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4662"><a href="#L-4662"><span class="linenos">4662</span></a>
</span><span id="L-4663"><a href="#L-4663"><span class="linenos">4663</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4664"><a href="#L-4664"><span class="linenos">4664</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;exported_episodes&quot;</span>
</span><span id="L-4665"><a href="#L-4665"><span class="linenos">4665</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="L-4666"><a href="#L-4666"><span class="linenos">4666</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
</span><span id="L-4667"><a href="#L-4667"><span class="linenos">4667</span></a>        <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)):</span>
</span><span id="L-4668"><a href="#L-4668"><span class="linenos">4668</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-4669"><a href="#L-4669"><span class="linenos">4669</span></a>            <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="L-4670"><a href="#L-4670"><span class="linenos">4670</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">)</span>
</span><span id="L-4671"><a href="#L-4671"><span class="linenos">4671</span></a>            <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)):</span>
</span><span id="L-4672"><a href="#L-4672"><span class="linenos">4672</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-4673"><a href="#L-4673"><span class="linenos">4673</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-4674"><a href="#L-4674"><span class="linenos">4674</span></a>        <span class="n">dest_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-4675"><a href="#L-4675"><span class="linenos">4675</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">)</span>
</span><span id="L-4676"><a href="#L-4676"><span class="linenos">4676</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">))</span>
</span><span id="L-4677"><a href="#L-4677"><span class="linenos">4677</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">))</span>
</span><span id="L-4678"><a href="#L-4678"><span class="linenos">4678</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-4679"><a href="#L-4679"><span class="linenos">4679</span></a>        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="L-4680"><a href="#L-4680"><span class="linenos">4680</span></a>            <span class="n">runs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode</span><span class="p">)</span>
</span><span id="L-4681"><a href="#L-4681"><span class="linenos">4681</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="L-4682"><a href="#L-4682"><span class="linenos">4682</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="L-4683"><a href="#L-4683"><span class="linenos">4683</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">),</span>
</span><span id="L-4684"><a href="#L-4684"><span class="linenos">4684</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">),</span>
</span><span id="L-4685"><a href="#L-4685"><span class="linenos">4685</span></a>            <span class="p">)</span>
</span><span id="L-4686"><a href="#L-4686"><span class="linenos">4686</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span>
</span><span id="L-4687"><a href="#L-4687"><span class="linenos">4687</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
</span><span id="L-4688"><a href="#L-4688"><span class="linenos">4688</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
</span><span id="L-4689"><a href="#L-4689"><span class="linenos">4689</span></a>            <span class="p">)</span>
</span><span id="L-4690"><a href="#L-4690"><span class="linenos">4690</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_subset</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span>
</span><span id="L-4691"><a href="#L-4691"><span class="linenos">4691</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;episodes.pickle&quot;</span><span class="p">))</span>
</span><span id="L-4692"><a href="#L-4692"><span class="linenos">4692</span></a>
</span><span id="L-4693"><a href="#L-4693"><span class="linenos">4693</span></a>    <span class="k">def</span> <span class="nf">get_results_table</span><span class="p">(</span>
</span><span id="L-4694"><a href="#L-4694"><span class="linenos">4694</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-4695"><a href="#L-4695"><span class="linenos">4695</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="L-4696"><a href="#L-4696"><span class="linenos">4696</span></a>        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4697"><a href="#L-4697"><span class="linenos">4697</span></a>        <span class="n">include_std</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-4698"><a href="#L-4698"><span class="linenos">4698</span></a>        <span class="n">classes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-4699"><a href="#L-4699"><span class="linenos">4699</span></a>    <span class="p">):</span>
</span><span id="L-4700"><a href="#L-4700"><span class="linenos">4700</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4701"><a href="#L-4701"><span class="linenos">4701</span></a><span class="sd">        Genererate a `pandas` dataframe with a summary of episode results</span>
</span><span id="L-4702"><a href="#L-4702"><span class="linenos">4702</span></a>
</span><span id="L-4703"><a href="#L-4703"><span class="linenos">4703</span></a><span class="sd">        Parameters</span>
</span><span id="L-4704"><a href="#L-4704"><span class="linenos">4704</span></a><span class="sd">        ----------</span>
</span><span id="L-4705"><a href="#L-4705"><span class="linenos">4705</span></a><span class="sd">        episode_names : list</span>
</span><span id="L-4706"><a href="#L-4706"><span class="linenos">4706</span></a><span class="sd">            a list of names of episodes to include</span>
</span><span id="L-4707"><a href="#L-4707"><span class="linenos">4707</span></a><span class="sd">        metrics : list, optional</span>
</span><span id="L-4708"><a href="#L-4708"><span class="linenos">4708</span></a><span class="sd">            a list of metric names to include</span>
</span><span id="L-4709"><a href="#L-4709"><span class="linenos">4709</span></a><span class="sd">        include_std : bool, default False</span>
</span><span id="L-4710"><a href="#L-4710"><span class="linenos">4710</span></a><span class="sd">            if `True`, for episodes with multiple runs the mean and standard deviation will be displayed;</span>
</span><span id="L-4711"><a href="#L-4711"><span class="linenos">4711</span></a><span class="sd">            otherwise only mean</span>
</span><span id="L-4712"><a href="#L-4712"><span class="linenos">4712</span></a><span class="sd">        classes : list, optional</span>
</span><span id="L-4713"><a href="#L-4713"><span class="linenos">4713</span></a><span class="sd">            a list of names of classes to include (by default all are included)</span>
</span><span id="L-4714"><a href="#L-4714"><span class="linenos">4714</span></a>
</span><span id="L-4715"><a href="#L-4715"><span class="linenos">4715</span></a><span class="sd">        Returns</span>
</span><span id="L-4716"><a href="#L-4716"><span class="linenos">4716</span></a><span class="sd">        -------</span>
</span><span id="L-4717"><a href="#L-4717"><span class="linenos">4717</span></a><span class="sd">        results : pd.DataFrame</span>
</span><span id="L-4718"><a href="#L-4718"><span class="linenos">4718</span></a><span class="sd">            a table with the results</span>
</span><span id="L-4719"><a href="#L-4719"><span class="linenos">4719</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4720"><a href="#L-4720"><span class="linenos">4720</span></a>
</span><span id="L-4721"><a href="#L-4721"><span class="linenos">4721</span></a>        <span class="n">run_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-4722"><a href="#L-4722"><span class="linenos">4722</span></a>        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="L-4723"><a href="#L-4723"><span class="linenos">4723</span></a>            <span class="n">run_names</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode</span><span class="p">)</span>
</span><span id="L-4724"><a href="#L-4724"><span class="linenos">4724</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span><span class="n">run_names</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-4725"><a href="#L-4725"><span class="linenos">4725</span></a>        <span class="n">metric_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;results&quot;</span><span class="p">]</span>
</span><span id="L-4726"><a href="#L-4726"><span class="linenos">4726</span></a>        <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-4727"><a href="#L-4727"><span class="linenos">4727</span></a>        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4728"><a href="#L-4728"><span class="linenos">4728</span></a>            <span class="n">metric_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-4729"><a href="#L-4729"><span class="linenos">4729</span></a>                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">metric_columns</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">metrics</span>
</span><span id="L-4730"><a href="#L-4730"><span class="linenos">4730</span></a>            <span class="p">]</span>
</span><span id="L-4731"><a href="#L-4731"><span class="linenos">4731</span></a>        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="L-4732"><a href="#L-4732"><span class="linenos">4732</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-4733"><a href="#L-4733"><span class="linenos">4733</span></a>            <span class="n">metric_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-4734"><a href="#L-4734"><span class="linenos">4734</span></a>            <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode</span><span class="p">):</span>
</span><span id="L-4735"><a href="#L-4735"><span class="linenos">4735</span></a>                <span class="n">beh_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_dictionary</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="L-4736"><a href="#L-4736"><span class="linenos">4736</span></a>                <span class="n">res_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="L-4737"><a href="#L-4737"><span class="linenos">4737</span></a>                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">metric_columns</span><span class="p">:</span>
</span><span id="L-4738"><a href="#L-4738"><span class="linenos">4738</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">episodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">run</span><span class="p">,</span> <span class="n">column</span><span class="p">]):</span>
</span><span id="L-4739"><a href="#L-4739"><span class="linenos">4739</span></a>                        <span class="k">continue</span>
</span><span id="L-4740"><a href="#L-4740"><span class="linenos">4740</span></a>                    <span class="n">split</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="L-4741"><a href="#L-4741"><span class="linenos">4741</span></a>                    <span class="k">if</span> <span class="n">split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
</span><span id="L-4742"><a href="#L-4742"><span class="linenos">4742</span></a>                        <span class="n">beh_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-4743"><a href="#L-4743"><span class="linenos">4743</span></a>                        <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-4744"><a href="#L-4744"><span class="linenos">4744</span></a>                        <span class="n">beh</span> <span class="o">=</span> <span class="n">beh_dict</span><span class="p">[</span><span class="n">beh_ind</span><span class="p">]</span>
</span><span id="L-4745"><a href="#L-4745"><span class="linenos">4745</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-4746"><a href="#L-4746"><span class="linenos">4746</span></a>                        <span class="n">beh</span> <span class="o">=</span> <span class="s2">&quot;average&quot;</span>
</span><span id="L-4747"><a href="#L-4747"><span class="linenos">4747</span></a>                        <span class="n">metric_name</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-4748"><a href="#L-4748"><span class="linenos">4748</span></a>                    <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">episodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">run</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span>
</span><span id="L-4749"><a href="#L-4749"><span class="linenos">4749</span></a>                    <span class="n">metric_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">metric_name</span><span class="p">)</span>
</span><span id="L-4750"><a href="#L-4750"><span class="linenos">4750</span></a>                <span class="k">if</span> <span class="s2">&quot;average&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">:</span>
</span><span id="L-4751"><a href="#L-4751"><span class="linenos">4751</span></a>                    <span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-4752"><a href="#L-4752"><span class="linenos">4752</span></a>                <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_set</span><span class="p">:</span>
</span><span id="L-4753"><a href="#L-4753"><span class="linenos">4753</span></a>                    <span class="k">if</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]:</span>
</span><span id="L-4754"><a href="#L-4754"><span class="linenos">4754</span></a>                        <span class="n">arr</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-4755"><a href="#L-4755"><span class="linenos">4755</span></a>                            <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span>
</span><span id="L-4756"><a href="#L-4756"><span class="linenos">4756</span></a>                            <span class="k">for</span> <span class="n">beh</span> <span class="ow">in</span> <span class="n">res_dict</span>
</span><span id="L-4757"><a href="#L-4757"><span class="linenos">4757</span></a>                            <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span>
</span><span id="L-4758"><a href="#L-4758"><span class="linenos">4758</span></a>                        <span class="p">]</span>
</span><span id="L-4759"><a href="#L-4759"><span class="linenos">4759</span></a>                        <span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="L-4760"><a href="#L-4760"><span class="linenos">4760</span></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_dict</span><span class="p">)</span>
</span><span id="L-4761"><a href="#L-4761"><span class="linenos">4761</span></a>            <span class="n">episode_results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-4762"><a href="#L-4762"><span class="linenos">4762</span></a>            <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_set</span><span class="p">:</span>
</span><span id="L-4763"><a href="#L-4763"><span class="linenos">4763</span></a>                <span class="k">for</span> <span class="n">beh</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-4764"><a href="#L-4764"><span class="linenos">4764</span></a>                    <span class="k">if</span> <span class="n">classes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">beh</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
</span><span id="L-4765"><a href="#L-4765"><span class="linenos">4765</span></a>                        <span class="k">continue</span>
</span><span id="L-4766"><a href="#L-4766"><span class="linenos">4766</span></a>                    <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-4767"><a href="#L-4767"><span class="linenos">4767</span></a>                    <span class="k">for</span> <span class="n">res_dict</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="L-4768"><a href="#L-4768"><span class="linenos">4768</span></a>                        <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">]:</span>
</span><span id="L-4769"><a href="#L-4769"><span class="linenos">4769</span></a>                            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">][</span><span class="n">metric</span><span class="p">])</span>
</span><span id="L-4770"><a href="#L-4770"><span class="linenos">4770</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-4771"><a href="#L-4771"><span class="linenos">4771</span></a>                        <span class="k">if</span> <span class="n">include_std</span><span class="p">:</span>
</span><span id="L-4772"><a href="#L-4772"><span class="linenos">4772</span></a>                            <span class="n">episode_results</span><span class="p">[</span>
</span><span id="L-4773"><a href="#L-4773"><span class="linenos">4773</span></a>                                <span class="p">(</span><span class="n">beh</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> mean&quot;</span><span class="p">)</span>
</span><span id="L-4774"><a href="#L-4774"><span class="linenos">4774</span></a>                            <span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="L-4775"><a href="#L-4775"><span class="linenos">4775</span></a>                            <span class="n">episode_results</span><span class="p">[(</span><span class="n">beh</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> std&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span>
</span><span id="L-4776"><a href="#L-4776"><span class="linenos">4776</span></a>                                <span class="n">arr</span>
</span><span id="L-4777"><a href="#L-4777"><span class="linenos">4777</span></a>                            <span class="p">)</span>
</span><span id="L-4778"><a href="#L-4778"><span class="linenos">4778</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4779"><a href="#L-4779"><span class="linenos">4779</span></a>                            <span class="n">episode_results</span><span class="p">[(</span><span class="n">beh</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="L-4780"><a href="#L-4780"><span class="linenos">4780</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">episode_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-4781"><a href="#L-4781"><span class="linenos">4781</span></a>                <span class="n">results_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-4782"><a href="#L-4782"><span class="linenos">4782</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RESULTS:&quot;</span><span class="p">)</span>
</span><span id="L-4783"><a href="#L-4783"><span class="linenos">4783</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</span><span id="L-4784"><a href="#L-4784"><span class="linenos">4784</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-4785"><a href="#L-4785"><span class="linenos">4785</span></a>        <span class="k">return</span> <span class="n">results_df</span>
</span><span id="L-4786"><a href="#L-4786"><span class="linenos">4786</span></a>
</span><span id="L-4787"><a href="#L-4787"><span class="linenos">4787</span></a>    <span class="k">def</span> <span class="nf">episode_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-4788"><a href="#L-4788"><span class="linenos">4788</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4789"><a href="#L-4789"><span class="linenos">4789</span></a><span class="sd">        Check if an episode already exists</span>
</span><span id="L-4790"><a href="#L-4790"><span class="linenos">4790</span></a>
</span><span id="L-4791"><a href="#L-4791"><span class="linenos">4791</span></a><span class="sd">        Parameters</span>
</span><span id="L-4792"><a href="#L-4792"><span class="linenos">4792</span></a><span class="sd">        ----------</span>
</span><span id="L-4793"><a href="#L-4793"><span class="linenos">4793</span></a><span class="sd">        episode_name : str</span>
</span><span id="L-4794"><a href="#L-4794"><span class="linenos">4794</span></a><span class="sd">            the episode name</span>
</span><span id="L-4795"><a href="#L-4795"><span class="linenos">4795</span></a>
</span><span id="L-4796"><a href="#L-4796"><span class="linenos">4796</span></a><span class="sd">        Returns</span>
</span><span id="L-4797"><a href="#L-4797"><span class="linenos">4797</span></a><span class="sd">        -------</span>
</span><span id="L-4798"><a href="#L-4798"><span class="linenos">4798</span></a><span class="sd">        exists : bool</span>
</span><span id="L-4799"><a href="#L-4799"><span class="linenos">4799</span></a><span class="sd">            `True` if the episode exists</span>
</span><span id="L-4800"><a href="#L-4800"><span class="linenos">4800</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4801"><a href="#L-4801"><span class="linenos">4801</span></a>
</span><span id="L-4802"><a href="#L-4802"><span class="linenos">4802</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="L-4803"><a href="#L-4803"><span class="linenos">4803</span></a>
</span><span id="L-4804"><a href="#L-4804"><span class="linenos">4804</span></a>    <span class="k">def</span> <span class="nf">search_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-4805"><a href="#L-4805"><span class="linenos">4805</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4806"><a href="#L-4806"><span class="linenos">4806</span></a><span class="sd">        Check if a search already exists</span>
</span><span id="L-4807"><a href="#L-4807"><span class="linenos">4807</span></a>
</span><span id="L-4808"><a href="#L-4808"><span class="linenos">4808</span></a><span class="sd">        Parameters</span>
</span><span id="L-4809"><a href="#L-4809"><span class="linenos">4809</span></a><span class="sd">        ----------</span>
</span><span id="L-4810"><a href="#L-4810"><span class="linenos">4810</span></a><span class="sd">        search_name : str</span>
</span><span id="L-4811"><a href="#L-4811"><span class="linenos">4811</span></a><span class="sd">            the search name</span>
</span><span id="L-4812"><a href="#L-4812"><span class="linenos">4812</span></a>
</span><span id="L-4813"><a href="#L-4813"><span class="linenos">4813</span></a><span class="sd">        Returns</span>
</span><span id="L-4814"><a href="#L-4814"><span class="linenos">4814</span></a><span class="sd">        -------</span>
</span><span id="L-4815"><a href="#L-4815"><span class="linenos">4815</span></a><span class="sd">        exists : bool</span>
</span><span id="L-4816"><a href="#L-4816"><span class="linenos">4816</span></a><span class="sd">            `True` if the search exists</span>
</span><span id="L-4817"><a href="#L-4817"><span class="linenos">4817</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4818"><a href="#L-4818"><span class="linenos">4818</span></a>
</span><span id="L-4819"><a href="#L-4819"><span class="linenos">4819</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="L-4820"><a href="#L-4820"><span class="linenos">4820</span></a>
</span><span id="L-4821"><a href="#L-4821"><span class="linenos">4821</span></a>    <span class="k">def</span> <span class="nf">prediction_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-4822"><a href="#L-4822"><span class="linenos">4822</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4823"><a href="#L-4823"><span class="linenos">4823</span></a><span class="sd">        Check if a prediction already exists</span>
</span><span id="L-4824"><a href="#L-4824"><span class="linenos">4824</span></a>
</span><span id="L-4825"><a href="#L-4825"><span class="linenos">4825</span></a><span class="sd">        Parameters</span>
</span><span id="L-4826"><a href="#L-4826"><span class="linenos">4826</span></a><span class="sd">        ----------</span>
</span><span id="L-4827"><a href="#L-4827"><span class="linenos">4827</span></a><span class="sd">        prediction_name : str</span>
</span><span id="L-4828"><a href="#L-4828"><span class="linenos">4828</span></a><span class="sd">            the prediction name</span>
</span><span id="L-4829"><a href="#L-4829"><span class="linenos">4829</span></a>
</span><span id="L-4830"><a href="#L-4830"><span class="linenos">4830</span></a><span class="sd">        Returns</span>
</span><span id="L-4831"><a href="#L-4831"><span class="linenos">4831</span></a><span class="sd">        -------</span>
</span><span id="L-4832"><a href="#L-4832"><span class="linenos">4832</span></a><span class="sd">        exists : bool</span>
</span><span id="L-4833"><a href="#L-4833"><span class="linenos">4833</span></a><span class="sd">            `True` if the prediction exists</span>
</span><span id="L-4834"><a href="#L-4834"><span class="linenos">4834</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4835"><a href="#L-4835"><span class="linenos">4835</span></a>
</span><span id="L-4836"><a href="#L-4836"><span class="linenos">4836</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">)</span>
</span><span id="L-4837"><a href="#L-4837"><span class="linenos">4837</span></a>
</span><span id="L-4838"><a href="#L-4838"><span class="linenos">4838</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-4839"><a href="#L-4839"><span class="linenos">4839</span></a>    <span class="k">def</span> <span class="nf">project_name_available</span><span class="p">(</span><span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-4840"><a href="#L-4840"><span class="linenos">4840</span></a>        <span class="k">if</span> <span class="n">projects_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4841"><a href="#L-4841"><span class="linenos">4841</span></a>            <span class="n">projects_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()),</span> <span class="s2">&quot;DLC2Action&quot;</span><span class="p">)</span>
</span><span id="L-4842"><a href="#L-4842"><span class="linenos">4842</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_path</span><span class="p">,</span> <span class="n">project_name</span><span class="p">))</span>
</span><span id="L-4843"><a href="#L-4843"><span class="linenos">4843</span></a>
</span><span id="L-4844"><a href="#L-4844"><span class="linenos">4844</span></a>    <span class="k">def</span> <span class="nf">_update_episode_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
</span><span id="L-4845"><a href="#L-4845"><span class="linenos">4845</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4846"><a href="#L-4846"><span class="linenos">4846</span></a><span class="sd">        Update meta data with evaluation results</span>
</span><span id="L-4847"><a href="#L-4847"><span class="linenos">4847</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4848"><a href="#L-4848"><span class="linenos">4848</span></a>
</span><span id="L-4849"><a href="#L-4849"><span class="linenos">4849</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">update_episode_metrics</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
</span><span id="L-4850"><a href="#L-4850"><span class="linenos">4850</span></a>
</span><span id="L-4851"><a href="#L-4851"><span class="linenos">4851</span></a>    <span class="k">def</span> <span class="nf">rename_episode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-4852"><a href="#L-4852"><span class="linenos">4852</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
</span><span id="L-4853"><a href="#L-4853"><span class="linenos">4853</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">),</span>
</span><span id="L-4854"><a href="#L-4854"><span class="linenos">4854</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">new_episode_name</span><span class="p">),</span>
</span><span id="L-4855"><a href="#L-4855"><span class="linenos">4855</span></a>        <span class="p">)</span>
</span><span id="L-4856"><a href="#L-4856"><span class="linenos">4856</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
</span><span id="L-4857"><a href="#L-4857"><span class="linenos">4857</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
</span><span id="L-4858"><a href="#L-4858"><span class="linenos">4858</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-4859"><a href="#L-4859"><span class="linenos">4859</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="L-4860"><a href="#L-4860"><span class="linenos">4860</span></a>            <span class="p">),</span>
</span><span id="L-4861"><a href="#L-4861"><span class="linenos">4861</span></a>        <span class="p">)</span>
</span><span id="L-4862"><a href="#L-4862"><span class="linenos">4862</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">rename_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">new_episode_name</span><span class="p">)</span>
</span><span id="L-4863"><a href="#L-4863"><span class="linenos">4863</span></a>
</span><span id="L-4864"><a href="#L-4864"><span class="linenos">4864</span></a>
</span><span id="L-4865"><a href="#L-4865"><span class="linenos">4865</span></a><span class="k">class</span> <span class="nc">_Runner</span><span class="p">:</span>
</span><span id="L-4866"><a href="#L-4866"><span class="linenos">4866</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4867"><a href="#L-4867"><span class="linenos">4867</span></a><span class="sd">    A helper class for running hyperparameter searches</span>
</span><span id="L-4868"><a href="#L-4868"><span class="linenos">4868</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-4869"><a href="#L-4869"><span class="linenos">4869</span></a>
</span><span id="L-4870"><a href="#L-4870"><span class="linenos">4870</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-4871"><a href="#L-4871"><span class="linenos">4871</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-4872"><a href="#L-4872"><span class="linenos">4872</span></a>        <span class="n">search_name</span><span class="p">,</span>
</span><span id="L-4873"><a href="#L-4873"><span class="linenos">4873</span></a>        <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-4874"><a href="#L-4874"><span class="linenos">4874</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-4875"><a href="#L-4875"><span class="linenos">4875</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-4876"><a href="#L-4876"><span class="linenos">4876</span></a>        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-4877"><a href="#L-4877"><span class="linenos">4877</span></a>        <span class="n">average</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-4878"><a href="#L-4878"><span class="linenos">4878</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TaskDispatcher</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="L-4879"><a href="#L-4879"><span class="linenos">4879</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-4880"><a href="#L-4880"><span class="linenos">4880</span></a>        <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">,</span>
</span><span id="L-4881"><a href="#L-4881"><span class="linenos">4881</span></a>    <span class="p">):</span>
</span><span id="L-4882"><a href="#L-4882"><span class="linenos">4882</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4883"><a href="#L-4883"><span class="linenos">4883</span></a><span class="sd">        Parameters</span>
</span><span id="L-4884"><a href="#L-4884"><span class="linenos">4884</span></a><span class="sd">        ----------</span>
</span><span id="L-4885"><a href="#L-4885"><span class="linenos">4885</span></a><span class="sd">        search_space : dict</span>
</span><span id="L-4886"><a href="#L-4886"><span class="linenos">4886</span></a><span class="sd">            a dictionary representing the search space; of this general structure:</span>
</span><span id="L-4887"><a href="#L-4887"><span class="linenos">4887</span></a><span class="sd">            {&#39;group/param_name&#39;: (&#39;float/int/float_log/int_log&#39;, start, end),</span>
</span><span id="L-4888"><a href="#L-4888"><span class="linenos">4888</span></a><span class="sd">            &#39;group/param_name&#39;: (&#39;categorical&#39;, [choices])}, e.g.</span>
</span><span id="L-4889"><a href="#L-4889"><span class="linenos">4889</span></a><span class="sd">            {&#39;data/overlap&#39;: (&#39;int&#39;, 5, 100), &#39;training/lr&#39;: (&#39;float_log&#39;, 1e-4, 1e-2),</span>
</span><span id="L-4890"><a href="#L-4890"><span class="linenos">4890</span></a><span class="sd">            &#39;data/feature_extraction&#39;: (&#39;categorical&#39;, [&#39;kinematic&#39;, &#39;bones&#39;])}</span>
</span><span id="L-4891"><a href="#L-4891"><span class="linenos">4891</span></a><span class="sd">        load_episode : str</span>
</span><span id="L-4892"><a href="#L-4892"><span class="linenos">4892</span></a><span class="sd">            the name of the episode to load the model from</span>
</span><span id="L-4893"><a href="#L-4893"><span class="linenos">4893</span></a><span class="sd">        load_epoch : int</span>
</span><span id="L-4894"><a href="#L-4894"><span class="linenos">4894</span></a><span class="sd">            the epoch to load the model from (if not provided, the last checkpoint is used)</span>
</span><span id="L-4895"><a href="#L-4895"><span class="linenos">4895</span></a><span class="sd">        metric : str</span>
</span><span id="L-4896"><a href="#L-4896"><span class="linenos">4896</span></a><span class="sd">            the metric to maximize/minimize (see direction)</span>
</span><span id="L-4897"><a href="#L-4897"><span class="linenos">4897</span></a><span class="sd">        average : int</span>
</span><span id="L-4898"><a href="#L-4898"><span class="linenos">4898</span></a><span class="sd">            the number of epochs to average the metric; if 0, the last value is taken</span>
</span><span id="L-4899"><a href="#L-4899"><span class="linenos">4899</span></a><span class="sd">        remove_saved_features : bool</span>
</span><span id="L-4900"><a href="#L-4900"><span class="linenos">4900</span></a><span class="sd">            if `True`, the old datasets will be deleted when data parameters change</span>
</span><span id="L-4901"><a href="#L-4901"><span class="linenos">4901</span></a><span class="sd">        project : Project</span>
</span><span id="L-4902"><a href="#L-4902"><span class="linenos">4902</span></a><span class="sd">            the parent `Project` instance</span>
</span><span id="L-4903"><a href="#L-4903"><span class="linenos">4903</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4904"><a href="#L-4904"><span class="linenos">4904</span></a>
</span><span id="L-4905"><a href="#L-4905"><span class="linenos">4905</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">search_space</span> <span class="o">=</span> <span class="n">search_space</span>
</span><span id="L-4906"><a href="#L-4906"><span class="linenos">4906</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_episode</span> <span class="o">=</span> <span class="n">load_episode</span>
</span><span id="L-4907"><a href="#L-4907"><span class="linenos">4907</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">load_epoch</span> <span class="o">=</span> <span class="n">load_epoch</span>
</span><span id="L-4908"><a href="#L-4908"><span class="linenos">4908</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span>
</span><span id="L-4909"><a href="#L-4909"><span class="linenos">4909</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">average</span> <span class="o">=</span> <span class="n">average</span>
</span><span id="L-4910"><a href="#L-4910"><span class="linenos">4910</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_save_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-4911"><a href="#L-4911"><span class="linenos">4911</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_saved_featuress</span> <span class="o">=</span> <span class="n">remove_saved_features</span>
</span><span id="L-4912"><a href="#L-4912"><span class="linenos">4912</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_stores</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_save_stores</span>
</span><span id="L-4913"><a href="#L-4913"><span class="linenos">4913</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_datasets</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">remove_saved_features</span>
</span><span id="L-4914"><a href="#L-4914"><span class="linenos">4914</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">task</span>
</span><span id="L-4915"><a href="#L-4915"><span class="linenos">4915</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">search_name</span> <span class="o">=</span> <span class="n">search_name</span>
</span><span id="L-4916"><a href="#L-4916"><span class="linenos">4916</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_update</span>
</span><span id="L-4917"><a href="#L-4917"><span class="linenos">4917</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">remove_episode</span>
</span><span id="L-4918"><a href="#L-4918"><span class="linenos">4918</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_fill</span>
</span><span id="L-4919"><a href="#L-4919"><span class="linenos">4919</span></a>
</span><span id="L-4920"><a href="#L-4920"><span class="linenos">4920</span></a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-4921"><a href="#L-4921"><span class="linenos">4921</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4922"><a href="#L-4922"><span class="linenos">4922</span></a><span class="sd">        Remove datasets if needed</span>
</span><span id="L-4923"><a href="#L-4923"><span class="linenos">4923</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4924"><a href="#L-4924"><span class="linenos">4924</span></a>
</span><span id="L-4925"><a href="#L-4925"><span class="linenos">4925</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_saved_featuress</span><span class="p">:</span>
</span><span id="L-4926"><a href="#L-4926"><span class="linenos">4926</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_datasets</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feature_save_path</span><span class="p">)])</span>
</span><span id="L-4927"><a href="#L-4927"><span class="linenos">4927</span></a>
</span><span id="L-4928"><a href="#L-4928"><span class="linenos">4928</span></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
</span><span id="L-4929"><a href="#L-4929"><span class="linenos">4929</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4930"><a href="#L-4930"><span class="linenos">4930</span></a><span class="sd">        Make a trial run</span>
</span><span id="L-4931"><a href="#L-4931"><span class="linenos">4931</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4932"><a href="#L-4932"><span class="linenos">4932</span></a>
</span><span id="L-4933"><a href="#L-4933"><span class="linenos">4933</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="L-4934"><a href="#L-4934"><span class="linenos">4934</span></a>        <span class="n">param_update</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
</span><span id="L-4935"><a href="#L-4935"><span class="linenos">4935</span></a>            <span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})))</span>
</span><span id="L-4936"><a href="#L-4936"><span class="linenos">4936</span></a>        <span class="p">)</span>
</span><span id="L-4937"><a href="#L-4937"><span class="linenos">4937</span></a>        <span class="k">for</span> <span class="n">full_name</span><span class="p">,</span> <span class="n">space</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_space</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-4938"><a href="#L-4938"><span class="linenos">4938</span></a>            <span class="n">group</span><span class="p">,</span> <span class="n">param_name</span> <span class="o">=</span> <span class="n">full_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-4939"><a href="#L-4939"><span class="linenos">4939</span></a>                <span class="n">full_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-4940"><a href="#L-4940"><span class="linenos">4940</span></a>            <span class="p">)</span>
</span><span id="L-4941"><a href="#L-4941"><span class="linenos">4941</span></a>            <span class="n">log</span> <span class="o">=</span> <span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span>
</span><span id="L-4942"><a href="#L-4942"><span class="linenos">4942</span></a>            <span class="k">if</span> <span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">):</span>
</span><span id="L-4943"><a href="#L-4943"><span class="linenos">4943</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="n">full_name</span><span class="p">,</span> <span class="n">space</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">space</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
</span><span id="L-4944"><a href="#L-4944"><span class="linenos">4944</span></a>            <span class="k">elif</span> <span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">):</span>
</span><span id="L-4945"><a href="#L-4945"><span class="linenos">4945</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="n">full_name</span><span class="p">,</span> <span class="n">space</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">space</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
</span><span id="L-4946"><a href="#L-4946"><span class="linenos">4946</span></a>            <span class="k">elif</span> <span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;categorical&quot;</span><span class="p">:</span>
</span><span id="L-4947"><a href="#L-4947"><span class="linenos">4947</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="n">full_name</span><span class="p">,</span> <span class="n">space</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-4948"><a href="#L-4948"><span class="linenos">4948</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-4949"><a href="#L-4949"><span class="linenos">4949</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-4950"><a href="#L-4950"><span class="linenos">4950</span></a>                    <span class="s2">&quot;The search space has to be formatted as either &quot;</span>
</span><span id="L-4951"><a href="#L-4951"><span class="linenos">4951</span></a>                    <span class="s1">&#39;(&quot;float&quot;/&quot;int&quot;/&quot;float_log&quot;/&quot;int_log&quot;, start, end) &#39;</span>
</span><span id="L-4952"><a href="#L-4952"><span class="linenos">4952</span></a>                    <span class="sa">f</span><span class="s1">&#39;or (&quot;categorical&quot;, [choices]); got </span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s1"> for </span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-4953"><a href="#L-4953"><span class="linenos">4953</span></a>                <span class="p">)</span>
</span><span id="L-4954"><a href="#L-4954"><span class="linenos">4954</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-4955"><a href="#L-4955"><span class="linenos">4955</span></a>                <span class="n">param_update</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-4956"><a href="#L-4956"><span class="linenos">4956</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-4957"><a href="#L-4957"><span class="linenos">4957</span></a>                <span class="n">pars</span> <span class="o">=</span> <span class="n">param_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
</span><span id="L-4958"><a href="#L-4958"><span class="linenos">4958</span></a>                <span class="n">pars</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">]</span>
</span><span id="L-4959"><a href="#L-4959"><span class="linenos">4959</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-4960"><a href="#L-4960"><span class="linenos">4960</span></a>                    <span class="n">param_update</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">pars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-4961"><a href="#L-4961"><span class="linenos">4961</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-4962"><a href="#L-4962"><span class="linenos">4962</span></a>                    <span class="n">param_update</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">pars</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">pars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-4963"><a href="#L-4963"><span class="linenos">4963</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-4964"><a href="#L-4964"><span class="linenos">4964</span></a>                    <span class="n">param_update</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">pars</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">pars</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="n">pars</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-4965"><a href="#L-4965"><span class="linenos">4965</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">param_update</span><span class="p">)</span>
</span><span id="L-4966"><a href="#L-4966"><span class="linenos">4966</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-4967"><a href="#L-4967"><span class="linenos">4967</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
</span><span id="L-4968"><a href="#L-4968"><span class="linenos">4968</span></a>            <span class="n">params</span><span class="p">,</span>
</span><span id="L-4969"><a href="#L-4969"><span class="linenos">4969</span></a>            <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-4970"><a href="#L-4970"><span class="linenos">4970</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="L-4971"><a href="#L-4971"><span class="linenos">4971</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="L-4972"><a href="#L-4972"><span class="linenos">4972</span></a>            <span class="n">only_load_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-4973"><a href="#L-4973"><span class="linenos">4973</span></a>        <span class="p">)</span>
</span><span id="L-4974"><a href="#L-4974"><span class="linenos">4974</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_save_path</span> <span class="o">!=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">]:</span>
</span><span id="L-4975"><a href="#L-4975"><span class="linenos">4975</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4976"><a href="#L-4976"><span class="linenos">4976</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
</span><span id="L-4977"><a href="#L-4977"><span class="linenos">4977</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">feature_save_path</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">]</span>
</span><span id="L-4978"><a href="#L-4978"><span class="linenos">4978</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_stores</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span id="L-4979"><a href="#L-4979"><span class="linenos">4979</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4980"><a href="#L-4980"><span class="linenos">4980</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">TaskDispatcher</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
</span><span id="L-4981"><a href="#L-4981"><span class="linenos">4981</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4982"><a href="#L-4982"><span class="linenos">4982</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">update_task</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span id="L-4983"><a href="#L-4983"><span class="linenos">4983</span></a>
</span><span id="L-4984"><a href="#L-4984"><span class="linenos">4984</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">metrics_log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">)</span>
</span><span id="L-4985"><a href="#L-4985"><span class="linenos">4985</span></a>        <span class="n">metric_values</span> <span class="o">=</span> <span class="n">metrics_log</span><span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">]</span>
</span><span id="L-4986"><a href="#L-4986"><span class="linenos">4986</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">average</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-4987"><a href="#L-4987"><span class="linenos">4987</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">metric_values</span><span class="p">)[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">average</span> <span class="p">:])</span>
</span><span id="L-4988"><a href="#L-4988"><span class="linenos">4988</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4989"><a href="#L-4989"><span class="linenos">4989</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">metric_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-4990"><a href="#L-4990"><span class="linenos">4990</span></a>        <span class="k">return</span> <span class="n">value</span>
</span></pre></div>


            </section>
                <section id="Project">
                            <input id="Project-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Project</span>:

                <label class="view-source-button" for="Project-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project-51"><a href="#Project-51"><span class="linenos">  51</span></a><span class="k">class</span> <span class="nc">Project</span><span class="p">:</span>
</span><span id="Project-52"><a href="#Project-52"><span class="linenos">  52</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-53"><a href="#Project-53"><span class="linenos">  53</span></a><span class="sd">    A class to create and maintain the project files + keep track of experiments</span>
</span><span id="Project-54"><a href="#Project-54"><span class="linenos">  54</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Project-55"><a href="#Project-55"><span class="linenos">  55</span></a>
</span><span id="Project-56"><a href="#Project-56"><span class="linenos">  56</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Project-57"><a href="#Project-57"><span class="linenos">  57</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-58"><a href="#Project-58"><span class="linenos">  58</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-59"><a href="#Project-59"><span class="linenos">  59</span></a>        <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-60"><a href="#Project-60"><span class="linenos">  60</span></a>        <span class="n">annotation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
</span><span id="Project-61"><a href="#Project-61"><span class="linenos">  61</span></a>        <span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-62"><a href="#Project-62"><span class="linenos">  62</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-63"><a href="#Project-63"><span class="linenos">  63</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-64"><a href="#Project-64"><span class="linenos">  64</span></a>        <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-65"><a href="#Project-65"><span class="linenos">  65</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-66"><a href="#Project-66"><span class="linenos">  66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-67"><a href="#Project-67"><span class="linenos">  67</span></a><span class="sd">        Parameters</span>
</span><span id="Project-68"><a href="#Project-68"><span class="linenos">  68</span></a><span class="sd">        ----------</span>
</span><span id="Project-69"><a href="#Project-69"><span class="linenos">  69</span></a><span class="sd">        name : str</span>
</span><span id="Project-70"><a href="#Project-70"><span class="linenos">  70</span></a><span class="sd">            name of the project</span>
</span><span id="Project-71"><a href="#Project-71"><span class="linenos">  71</span></a><span class="sd">        data_type : str, optional</span>
</span><span id="Project-72"><a href="#Project-72"><span class="linenos">  72</span></a><span class="sd">            data type (run Project.data_types() to see available options; has to be provided if the project is being</span>
</span><span id="Project-73"><a href="#Project-73"><span class="linenos">  73</span></a><span class="sd">            created)</span>
</span><span id="Project-74"><a href="#Project-74"><span class="linenos">  74</span></a><span class="sd">        annotation_type : str, default &#39;none&#39;</span>
</span><span id="Project-75"><a href="#Project-75"><span class="linenos">  75</span></a><span class="sd">            annotation type (run Project.annotation_types() to see available options)</span>
</span><span id="Project-76"><a href="#Project-76"><span class="linenos">  76</span></a><span class="sd">        projects_path : str, optional</span>
</span><span id="Project-77"><a href="#Project-77"><span class="linenos">  77</span></a><span class="sd">            path to the projects folder (is filled with ~/DLC2Action by default)</span>
</span><span id="Project-78"><a href="#Project-78"><span class="linenos">  78</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="Project-79"><a href="#Project-79"><span class="linenos">  79</span></a><span class="sd">            path to the folder containing input files for the project (has to be provided if the project is being</span>
</span><span id="Project-80"><a href="#Project-80"><span class="linenos">  80</span></a><span class="sd">            created)</span>
</span><span id="Project-81"><a href="#Project-81"><span class="linenos">  81</span></a><span class="sd">        annotation_path : str, optional</span>
</span><span id="Project-82"><a href="#Project-82"><span class="linenos">  82</span></a><span class="sd">            path to the folder containing annotation files for the project</span>
</span><span id="Project-83"><a href="#Project-83"><span class="linenos">  83</span></a><span class="sd">        copy : bool, default False</span>
</span><span id="Project-84"><a href="#Project-84"><span class="linenos">  84</span></a><span class="sd">            if True, the files from annotation_path and data_path will be copied to the projects folder;</span>
</span><span id="Project-85"><a href="#Project-85"><span class="linenos">  85</span></a><span class="sd">            otherwise they will be moved</span>
</span><span id="Project-86"><a href="#Project-86"><span class="linenos">  86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-87"><a href="#Project-87"><span class="linenos">  87</span></a>
</span><span id="Project-88"><a href="#Project-88"><span class="linenos">  88</span></a>        <span class="k">if</span> <span class="n">projects_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-89"><a href="#Project-89"><span class="linenos">  89</span></a>            <span class="n">projects_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()),</span> <span class="s2">&quot;DLC2Action&quot;</span><span class="p">)</span>
</span><span id="Project-90"><a href="#Project-90"><span class="linenos">  90</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">projects_path</span><span class="p">):</span>
</span><span id="Project-91"><a href="#Project-91"><span class="linenos">  91</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">projects_path</span><span class="p">)</span>
</span><span id="Project-92"><a href="#Project-92"><span class="linenos">  92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="Project-93"><a href="#Project-93"><span class="linenos">  93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Project-94"><a href="#Project-94"><span class="linenos">  94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span>
</span><span id="Project-95"><a href="#Project-95"><span class="linenos">  95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span> <span class="o">=</span> <span class="n">annotation_type</span>
</span><span id="Project-96"><a href="#Project-96"><span class="linenos">  96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">data_path</span>
</span><span id="Project-97"><a href="#Project-97"><span class="linenos">  97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span> <span class="o">=</span> <span class="n">annotation_path</span>
</span><span id="Project-98"><a href="#Project-98"><span class="linenos">  98</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">):</span>
</span><span id="Project-99"><a href="#Project-99"><span class="linenos">  99</span></a>            <span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-100"><a href="#Project-100"><span class="linenos"> 100</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-101"><a href="#Project-101"><span class="linenos"> 101</span></a>                    <span class="s2">&quot;The data_type parameter is necessary when creating a new project!&quot;</span>
</span><span id="Project-102"><a href="#Project-102"><span class="linenos"> 102</span></a>                <span class="p">)</span>
</span><span id="Project-103"><a href="#Project-103"><span class="linenos"> 103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_project</span><span class="p">(</span>
</span><span id="Project-104"><a href="#Project-104"><span class="linenos"> 104</span></a>                <span class="n">data_type</span><span class="p">,</span> <span class="n">annotation_type</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">annotation_path</span><span class="p">,</span> <span class="n">copy</span>
</span><span id="Project-105"><a href="#Project-105"><span class="linenos"> 105</span></a>            <span class="p">)</span>
</span><span id="Project-106"><a href="#Project-106"><span class="linenos"> 106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-107"><a href="#Project-107"><span class="linenos"> 107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_types</span><span class="p">()</span>
</span><span id="Project-108"><a href="#Project-108"><span class="linenos"> 108</span></a>            <span class="k">if</span> <span class="n">data_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="ow">and</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-109"><a href="#Project-109"><span class="linenos"> 109</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-110"><a href="#Project-110"><span class="linenos"> 110</span></a>                    <span class="sa">f</span><span class="s2">&quot;The project has already been initialized with data_type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span id="Project-111"><a href="#Project-111"><span class="linenos"> 111</span></a>                <span class="p">)</span>
</span><span id="Project-112"><a href="#Project-112"><span class="linenos"> 112</span></a>            <span class="k">if</span> <span class="n">annotation_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span> <span class="ow">and</span> <span class="n">annotation_type</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="Project-113"><a href="#Project-113"><span class="linenos"> 113</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-114"><a href="#Project-114"><span class="linenos"> 114</span></a>                    <span class="sa">f</span><span class="s2">&quot;The project has already been initialized with annotation_type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span id="Project-115"><a href="#Project-115"><span class="linenos"> 115</span></a>                <span class="p">)</span>
</span><span id="Project-116"><a href="#Project-116"><span class="linenos"> 116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">data_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_paths</span><span class="p">()</span>
</span><span id="Project-117"><a href="#Project-117"><span class="linenos"> 117</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-118"><a href="#Project-118"><span class="linenos"> 118</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">data_path</span>
</span><span id="Project-119"><a href="#Project-119"><span class="linenos"> 119</span></a>            <span class="c1"># if data_path != self.data_path and data_path is not None:</span>
</span><span id="Project-120"><a href="#Project-120"><span class="linenos"> 120</span></a>            <span class="c1">#     raise ValueError(</span>
</span><span id="Project-121"><a href="#Project-121"><span class="linenos"> 121</span></a>            <span class="c1">#         f&quot;The project has already been initialized with data_path={self.data_path}!&quot;</span>
</span><span id="Project-122"><a href="#Project-122"><span class="linenos"> 122</span></a>            <span class="c1">#     )</span>
</span><span id="Project-123"><a href="#Project-123"><span class="linenos"> 123</span></a>            <span class="k">if</span> <span class="n">annotation_path</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span> <span class="ow">and</span> <span class="n">annotation_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-124"><a href="#Project-124"><span class="linenos"> 124</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-125"><a href="#Project-125"><span class="linenos"> 125</span></a>                    <span class="sa">f</span><span class="s2">&quot;The project has already been initialized with annotation_path=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span id="Project-126"><a href="#Project-126"><span class="linenos"> 126</span></a>                <span class="p">)</span>
</span><span id="Project-127"><a href="#Project-127"><span class="linenos"> 127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_configs</span><span class="p">()</span>
</span><span id="Project-128"><a href="#Project-128"><span class="linenos"> 128</span></a>
</span><span id="Project-129"><a href="#Project-129"><span class="linenos"> 129</span></a>    <span class="k">def</span> <span class="nf">_aggregate_predictions</span><span class="p">(</span>
</span><span id="Project-130"><a href="#Project-130"><span class="linenos"> 130</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-131"><a href="#Project-131"><span class="linenos"> 131</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-132"><a href="#Project-132"><span class="linenos"> 132</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-133"><a href="#Project-133"><span class="linenos"> 133</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-134"><a href="#Project-134"><span class="linenos"> 134</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-135"><a href="#Project-135"><span class="linenos"> 135</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-136"><a href="#Project-136"><span class="linenos"> 136</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-137"><a href="#Project-137"><span class="linenos"> 137</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span id="Project-138"><a href="#Project-138"><span class="linenos"> 138</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project-139"><a href="#Project-139"><span class="linenos"> 139</span></a>        <span class="n">evaluate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-140"><a href="#Project-140"><span class="linenos"> 140</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-141"><a href="#Project-141"><span class="linenos"> 141</span></a>        <span class="n">embedding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-142"><a href="#Project-142"><span class="linenos"> 142</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TaskDispatcher</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="Project-143"><a href="#Project-143"><span class="linenos"> 143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-144"><a href="#Project-144"><span class="linenos"> 144</span></a><span class="sd">        Generate a prediction</span>
</span><span id="Project-145"><a href="#Project-145"><span class="linenos"> 145</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-146"><a href="#Project-146"><span class="linenos"> 146</span></a>
</span><span id="Project-147"><a href="#Project-147"><span class="linenos"> 147</span></a>        <span class="k">if</span> <span class="n">load_epochs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-148"><a href="#Project-148"><span class="linenos"> 148</span></a>            <span class="n">load_epochs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project-149"><a href="#Project-149"><span class="linenos"> 149</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)))</span>
</span><span id="Project-150"><a href="#Project-150"><span class="linenos"> 150</span></a>        <span class="n">cnt</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)))</span>
</span><span id="Project-151"><a href="#Project-151"><span class="linenos"> 151</span></a>        <span class="n">behs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_dictionary</span><span class="p">(</span><span class="n">episode_names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="Project-152"><a href="#Project-152"><span class="linenos"> 152</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="Project-153"><a href="#Project-153"><span class="linenos"> 153</span></a>            <span class="p">[</span>
</span><span id="Project-154"><a href="#Project-154"><span class="linenos"> 154</span></a>                <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_dictionary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">==</span> <span class="n">behs</span>
</span><span id="Project-155"><a href="#Project-155"><span class="linenos"> 155</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">episode_names</span>
</span><span id="Project-156"><a href="#Project-156"><span class="linenos"> 156</span></a>            <span class="p">]</span>
</span><span id="Project-157"><a href="#Project-157"><span class="linenos"> 157</span></a>        <span class="p">):</span>
</span><span id="Project-158"><a href="#Project-158"><span class="linenos"> 158</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The behavior sets are different in </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-159"><a href="#Project-159"><span class="linenos"> 159</span></a>        <span class="n">behaviors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Project-160"><a href="#Project-160"><span class="linenos"> 160</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">episode_names</span><span class="p">):</span>
</span><span id="Project-161"><a href="#Project-161"><span class="linenos"> 161</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">data_mode</span><span class="p">,</span> <span class="n">new_pred</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_prediction</span><span class="p">(</span>
</span><span id="Project-162"><a href="#Project-162"><span class="linenos"> 162</span></a>                <span class="n">prediction_name</span><span class="p">,</span>
</span><span id="Project-163"><a href="#Project-163"><span class="linenos"> 163</span></a>                <span class="n">episode_names</span><span class="o">=</span><span class="p">[</span><span class="n">episode_name</span><span class="p">],</span>
</span><span id="Project-164"><a href="#Project-164"><span class="linenos"> 164</span></a>                <span class="n">load_epochs</span><span class="o">=</span><span class="p">[</span><span class="n">load_epochs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
</span><span id="Project-165"><a href="#Project-165"><span class="linenos"> 165</span></a>                <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-166"><a href="#Project-166"><span class="linenos"> 166</span></a>                <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-167"><a href="#Project-167"><span class="linenos"> 167</span></a>                <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project-168"><a href="#Project-168"><span class="linenos"> 168</span></a>                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project-169"><a href="#Project-169"><span class="linenos"> 169</span></a>                <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project-170"><a href="#Project-170"><span class="linenos"> 170</span></a>                <span class="n">evaluate</span><span class="o">=</span><span class="n">evaluate</span><span class="p">,</span>
</span><span id="Project-171"><a href="#Project-171"><span class="linenos"> 171</span></a>                <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project-172"><a href="#Project-172"><span class="linenos"> 172</span></a>                <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
</span><span id="Project-173"><a href="#Project-173"><span class="linenos"> 173</span></a>            <span class="p">)</span>
</span><span id="Project-174"><a href="#Project-174"><span class="linenos"> 174</span></a>            <span class="n">new_pred</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">data_mode</span><span class="p">)</span><span class="o">.</span><span class="n">generate_full_length_prediction</span><span class="p">(</span><span class="n">new_pred</span><span class="p">)</span>
</span><span id="Project-175"><a href="#Project-175"><span class="linenos"> 175</span></a>            <span class="n">beh_dict</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span>
</span><span id="Project-176"><a href="#Project-176"><span class="linenos"> 176</span></a>            <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">video_values</span> <span class="ow">in</span> <span class="n">new_pred</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-177"><a href="#Project-177"><span class="linenos"> 177</span></a>                <span class="k">for</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">clip_prediction</span> <span class="ow">in</span> <span class="n">video_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-178"><a href="#Project-178"><span class="linenos"> 178</span></a>                    <span class="k">for</span> <span class="n">beh_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">clip_prediction</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="Project-179"><a href="#Project-179"><span class="linenos"> 179</span></a>                        <span class="n">prediction</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span>
</span><span id="Project-180"><a href="#Project-180"><span class="linenos"> 180</span></a>                            <span class="n">beh_dict</span><span class="p">[</span><span class="n">beh_i</span><span class="p">]</span>
</span><span id="Project-181"><a href="#Project-181"><span class="linenos"> 181</span></a>                        <span class="p">]</span> <span class="o">+=</span> <span class="n">clip_prediction</span><span class="p">[</span><span class="n">beh_i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Project-182"><a href="#Project-182"><span class="linenos"> 182</span></a>                        <span class="n">cnt</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="n">beh_dict</span><span class="p">[</span><span class="n">beh_i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Project-183"><a href="#Project-183"><span class="linenos"> 183</span></a>                        <span class="n">behaviors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">beh_dict</span><span class="p">[</span><span class="n">beh_i</span><span class="p">])</span>
</span><span id="Project-184"><a href="#Project-184"><span class="linenos"> 184</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="Project-185"><a href="#Project-185"><span class="linenos"> 185</span></a>        <span class="c1"># behaviors = sorted(behaviors)</span>
</span><span id="Project-186"><a href="#Project-186"><span class="linenos"> 186</span></a>        <span class="n">behavior_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="Project-187"><a href="#Project-187"><span class="linenos"> 187</span></a>            <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="Project-188"><a href="#Project-188"><span class="linenos"> 188</span></a>        <span class="p">)</span>
</span><span id="Project-189"><a href="#Project-189"><span class="linenos"> 189</span></a>        <span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">behavior_indices</span><span class="p">]</span>
</span><span id="Project-190"><a href="#Project-190"><span class="linenos"> 190</span></a>        <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">video_values</span> <span class="ow">in</span> <span class="n">prediction</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-191"><a href="#Project-191"><span class="linenos"> 191</span></a>            <span class="k">for</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">clip_values</span> <span class="ow">in</span> <span class="n">video_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-192"><a href="#Project-192"><span class="linenos"> 192</span></a>                <span class="n">pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span>
</span><span id="Project-193"><a href="#Project-193"><span class="linenos"> 193</span></a>                    <span class="p">[</span>
</span><span id="Project-194"><a href="#Project-194"><span class="linenos"> 194</span></a>                        <span class="n">clip_values</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span> <span class="o">/</span> <span class="n">cnt</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="n">beh</span><span class="p">]</span>
</span><span id="Project-195"><a href="#Project-195"><span class="linenos"> 195</span></a>                        <span class="k">for</span> <span class="n">beh</span> <span class="ow">in</span> <span class="n">behaviors</span>
</span><span id="Project-196"><a href="#Project-196"><span class="linenos"> 196</span></a>                    <span class="p">],</span>
</span><span id="Project-197"><a href="#Project-197"><span class="linenos"> 197</span></a>                    <span class="mi">0</span><span class="p">,</span>
</span><span id="Project-198"><a href="#Project-198"><span class="linenos"> 198</span></a>                <span class="p">)</span>
</span><span id="Project-199"><a href="#Project-199"><span class="linenos"> 199</span></a>                <span class="n">output</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span>
</span><span id="Project-200"><a href="#Project-200"><span class="linenos"> 200</span></a>        <span class="k">return</span> <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">data_mode</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">output</span><span class="p">),</span> <span class="kc">None</span>
</span><span id="Project-201"><a href="#Project-201"><span class="linenos"> 201</span></a>
</span><span id="Project-202"><a href="#Project-202"><span class="linenos"> 202</span></a>    <span class="k">def</span> <span class="nf">_make_prediction</span><span class="p">(</span>
</span><span id="Project-203"><a href="#Project-203"><span class="linenos"> 203</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-204"><a href="#Project-204"><span class="linenos"> 204</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-205"><a href="#Project-205"><span class="linenos"> 205</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-206"><a href="#Project-206"><span class="linenos"> 206</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-207"><a href="#Project-207"><span class="linenos"> 207</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-208"><a href="#Project-208"><span class="linenos"> 208</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-209"><a href="#Project-209"><span class="linenos"> 209</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-210"><a href="#Project-210"><span class="linenos"> 210</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span id="Project-211"><a href="#Project-211"><span class="linenos"> 211</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project-212"><a href="#Project-212"><span class="linenos"> 212</span></a>        <span class="n">evaluate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-213"><a href="#Project-213"><span class="linenos"> 213</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-214"><a href="#Project-214"><span class="linenos"> 214</span></a>        <span class="n">embedding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-215"><a href="#Project-215"><span class="linenos"> 215</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TaskDispatcher</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="Project-216"><a href="#Project-216"><span class="linenos"> 216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-217"><a href="#Project-217"><span class="linenos"> 217</span></a><span class="sd">        Generate a prediction</span>
</span><span id="Project-218"><a href="#Project-218"><span class="linenos"> 218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-219"><a href="#Project-219"><span class="linenos"> 219</span></a>
</span><span id="Project-220"><a href="#Project-220"><span class="linenos"> 220</span></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-221"><a href="#Project-221"><span class="linenos"> 221</span></a>        <span class="n">epochs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-222"><a href="#Project-222"><span class="linenos"> 222</span></a>        <span class="k">if</span> <span class="n">load_epochs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-223"><a href="#Project-223"><span class="linenos"> 223</span></a>            <span class="n">load_epochs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project-224"><a href="#Project-224"><span class="linenos"> 224</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">load_epochs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">episode_names</span><span class="p">):</span>
</span><span id="Project-225"><a href="#Project-225"><span class="linenos"> 225</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-226"><a href="#Project-226"><span class="linenos"> 226</span></a>                <span class="sa">f</span><span class="s2">&quot;The length of load_epochs and the length of episode_names should be the same!&quot;</span>
</span><span id="Project-227"><a href="#Project-227"><span class="linenos"> 227</span></a>            <span class="p">)</span>
</span><span id="Project-228"><a href="#Project-228"><span class="linenos"> 228</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">episode_names</span><span class="p">):</span>
</span><span id="Project-229"><a href="#Project-229"><span class="linenos"> 229</span></a>            <span class="n">names</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-230"><a href="#Project-230"><span class="linenos"> 230</span></a>            <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">load_epochs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="Project-231"><a href="#Project-231"><span class="linenos"> 231</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-232"><a href="#Project-232"><span class="linenos"> 232</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;None of the episodes </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2"> exist!&quot;</span><span class="p">)</span>
</span><span id="Project-233"><a href="#Project-233"><span class="linenos"> 233</span></a>            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span><span id="Project-234"><a href="#Project-234"><span class="linenos"> 234</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span>
</span><span id="Project-235"><a href="#Project-235"><span class="linenos"> 235</span></a>        <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-236"><a href="#Project-236"><span class="linenos"> 236</span></a>            <span class="n">episodes</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span>
</span><span id="Project-237"><a href="#Project-237"><span class="linenos"> 237</span></a>        <span class="p">]</span>
</span><span id="Project-238"><a href="#Project-238"><span class="linenos"> 238</span></a>        <span class="n">overlaps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-239"><a href="#Project-239"><span class="linenos"> 239</span></a>            <span class="n">episodes</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span>
</span><span id="Project-240"><a href="#Project-240"><span class="linenos"> 240</span></a>        <span class="p">]</span>
</span><span id="Project-241"><a href="#Project-241"><span class="linenos"> 241</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">==</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]):</span>
</span><span id="Project-242"><a href="#Project-242"><span class="linenos"> 242</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Episodes </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2"> have different segment lengths&quot;</span><span class="p">)</span>
</span><span id="Project-243"><a href="#Project-243"><span class="linenos"> 243</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">==</span> <span class="n">overlaps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">overlaps</span><span class="p">]):</span>
</span><span id="Project-244"><a href="#Project-244"><span class="linenos"> 244</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Episodes </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2"> have different overlaps&quot;</span><span class="p">)</span>
</span><span id="Project-245"><a href="#Project-245"><span class="linenos"> 245</span></a>        <span class="n">load_epochs</span> <span class="o">=</span> <span class="n">epochs</span>
</span><span id="Project-246"><a href="#Project-246"><span class="linenos"> 246</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-247"><a href="#Project-247"><span class="linenos"> 247</span></a>        <span class="n">decision_thresholds</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-248"><a href="#Project-248"><span class="linenos"> 248</span></a>        <span class="n">time_total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-249"><a href="#Project-249"><span class="linenos"> 249</span></a>        <span class="n">behavior_dicts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-250"><a href="#Project-250"><span class="linenos"> 250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_dictionary</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">names</span>
</span><span id="Project-251"><a href="#Project-251"><span class="linenos"> 251</span></a>        <span class="p">]</span>
</span><span id="Project-252"><a href="#Project-252"><span class="linenos"> 252</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="Project-253"><a href="#Project-253"><span class="linenos"> 253</span></a>            <span class="p">[</span>
</span><span id="Project-254"><a href="#Project-254"><span class="linenos"> 254</span></a>                <span class="nb">set</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">behavior_dicts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="Project-255"><a href="#Project-255"><span class="linenos"> 255</span></a>                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">behavior_dicts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="Project-256"><a href="#Project-256"><span class="linenos"> 256</span></a>            <span class="p">]</span>
</span><span id="Project-257"><a href="#Project-257"><span class="linenos"> 257</span></a>        <span class="p">):</span>
</span><span id="Project-258"><a href="#Project-258"><span class="linenos"> 258</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-259"><a href="#Project-259"><span class="linenos"> 259</span></a>                <span class="sa">f</span><span class="s2">&quot;Episodes </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2"> have different sets of behaviors!&quot;</span>
</span><span id="Project-260"><a href="#Project-260"><span class="linenos"> 260</span></a>            <span class="p">)</span>
</span><span id="Project-261"><a href="#Project-261"><span class="linenos"> 261</span></a>        <span class="n">behavior_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">behavior_dicts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="Project-262"><a href="#Project-262"><span class="linenos"> 262</span></a>        <span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span><span class="n">behavior_dicts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">behavior_indices</span><span class="p">]</span>
</span><span id="Project-263"><a href="#Project-263"><span class="linenos"> 263</span></a>        <span class="n">cnt</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Project-264"><a href="#Project-264"><span class="linenos"> 264</span></a>        <span class="n">behavior_probs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Project-265"><a href="#Project-265"><span class="linenos"> 265</span></a>        <span class="k">for</span> <span class="n">episode_name</span><span class="p">,</span> <span class="n">load_epoch</span><span class="p">,</span> <span class="n">behavior_dict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Project-266"><a href="#Project-266"><span class="linenos"> 266</span></a>            <span class="n">names</span><span class="p">,</span> <span class="n">load_epochs</span><span class="p">,</span> <span class="n">behavior_dicts</span>
</span><span id="Project-267"><a href="#Project-267"><span class="linenos"> 267</span></a>        <span class="p">):</span>
</span><span id="Project-268"><a href="#Project-268"><span class="linenos"> 268</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;episode </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-269"><a href="#Project-269"><span class="linenos"> 269</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">data_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project-270"><a href="#Project-270"><span class="linenos"> 270</span></a>                <span class="n">prediction_name</span><span class="o">=</span><span class="n">prediction_name</span><span class="p">,</span>
</span><span id="Project-271"><a href="#Project-271"><span class="linenos"> 271</span></a>                <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-272"><a href="#Project-272"><span class="linenos"> 272</span></a>                <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-273"><a href="#Project-273"><span class="linenos"> 273</span></a>                <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-274"><a href="#Project-274"><span class="linenos"> 274</span></a>                <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-275"><a href="#Project-275"><span class="linenos"> 275</span></a>                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project-276"><a href="#Project-276"><span class="linenos"> 276</span></a>                <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project-277"><a href="#Project-277"><span class="linenos"> 277</span></a>                <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project-278"><a href="#Project-278"><span class="linenos"> 278</span></a>                <span class="n">decision_thresholds</span><span class="o">=</span><span class="n">decision_thresholds</span><span class="p">,</span>
</span><span id="Project-279"><a href="#Project-279"><span class="linenos"> 279</span></a>            <span class="p">)</span>
</span><span id="Project-280"><a href="#Project-280"><span class="linenos"> 280</span></a>            <span class="n">behavior_indices_cur</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">behavior_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="Project-281"><a href="#Project-281"><span class="linenos"> 281</span></a>            <span class="n">behaviors_cur</span> <span class="o">=</span> <span class="p">[</span><span class="n">behavior_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">behavior_indices_cur</span><span class="p">]</span>
</span><span id="Project-282"><a href="#Project-282"><span class="linenos"> 282</span></a>            <span class="c1"># data_mode = &quot;train&quot; if mode == &quot;all&quot; else mode</span>
</span><span id="Project-283"><a href="#Project-283"><span class="linenos"> 283</span></a>            <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Project-284"><a href="#Project-284"><span class="linenos"> 284</span></a>            <span class="n">new_pred</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
</span><span id="Project-285"><a href="#Project-285"><span class="linenos"> 285</span></a>                <span class="n">data_mode</span><span class="p">,</span>
</span><span id="Project-286"><a href="#Project-286"><span class="linenos"> 286</span></a>                <span class="n">raw_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-287"><a href="#Project-287"><span class="linenos"> 287</span></a>                <span class="n">apply_primary_function</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-288"><a href="#Project-288"><span class="linenos"> 288</span></a>                <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project-289"><a href="#Project-289"><span class="linenos"> 289</span></a>                <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
</span><span id="Project-290"><a href="#Project-290"><span class="linenos"> 290</span></a>            <span class="p">)</span>
</span><span id="Project-291"><a href="#Project-291"><span class="linenos"> 291</span></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">beh</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">behaviors_cur</span><span class="p">):</span>
</span><span id="Project-292"><a href="#Project-292"><span class="linenos"> 292</span></a>                <span class="n">cnt</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Project-293"><a href="#Project-293"><span class="linenos"> 293</span></a>                <span class="n">behavior_probs</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_pred</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Project-294"><a href="#Project-294"><span class="linenos"> 294</span></a>            <span class="c1"># indices = [</span>
</span><span id="Project-295"><a href="#Project-295"><span class="linenos"> 295</span></a>            <span class="c1">#     behaviors.index(behavior_dict[i]) for i in range(new_pred.shape[1])</span>
</span><span id="Project-296"><a href="#Project-296"><span class="linenos"> 296</span></a>            <span class="c1"># ]</span>
</span><span id="Project-297"><a href="#Project-297"><span class="linenos"> 297</span></a>            <span class="c1"># new_pred = new_pred[:, indices, :]</span>
</span><span id="Project-298"><a href="#Project-298"><span class="linenos"> 298</span></a>            <span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Project-299"><a href="#Project-299"><span class="linenos"> 299</span></a>            <span class="n">time_total</span> <span class="o">+=</span> <span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span>
</span><span id="Project-300"><a href="#Project-300"><span class="linenos"> 300</span></a>            <span class="k">if</span> <span class="n">evaluate</span><span class="p">:</span>
</span><span id="Project-301"><a href="#Project-301"><span class="linenos"> 301</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">evaluate_prediction</span><span class="p">(</span><span class="n">new_pred</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_mode</span><span class="p">)</span>
</span><span id="Project-302"><a href="#Project-302"><span class="linenos"> 302</span></a>                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span><span class="p">:</span>
</span><span id="Project-303"><a href="#Project-303"><span class="linenos"> 303</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_metrics</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
</span><span id="Project-304"><a href="#Project-304"><span class="linenos"> 304</span></a>            <span class="c1"># if prediction is None:</span>
</span><span id="Project-305"><a href="#Project-305"><span class="linenos"> 305</span></a>            <span class="c1">#     prediction = new_pred</span>
</span><span id="Project-306"><a href="#Project-306"><span class="linenos"> 306</span></a>            <span class="c1"># else:</span>
</span><span id="Project-307"><a href="#Project-307"><span class="linenos"> 307</span></a>            <span class="c1">#     prediction += new_pred</span>
</span><span id="Project-308"><a href="#Project-308"><span class="linenos"> 308</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-309"><a href="#Project-309"><span class="linenos"> 309</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">behavior_probs</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span> <span class="o">/</span> <span class="n">cnt</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span> <span class="k">for</span> <span class="n">beh</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Project-310"><a href="#Project-310"><span class="linenos"> 310</span></a>        <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span>
</span><span id="Project-311"><a href="#Project-311"><span class="linenos"> 311</span></a>        <span class="n">time_total</span> <span class="o">-=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span>
</span><span id="Project-312"><a href="#Project-312"><span class="linenos"> 312</span></a>        <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="Project-313"><a href="#Project-313"><span class="linenos"> 313</span></a>        <span class="n">time_total</span> <span class="o">-=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>
</span><span id="Project-314"><a href="#Project-314"><span class="linenos"> 314</span></a>        <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span><span class="p">)</span>
</span><span id="Project-315"><a href="#Project-315"><span class="linenos"> 315</span></a>        <span class="n">inference_time</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">minutes</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">seconds</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-316"><a href="#Project-316"><span class="linenos"> 316</span></a>        <span class="c1"># prediction /= len(names)</span>
</span><span id="Project-317"><a href="#Project-317"><span class="linenos"> 317</span></a>        <span class="k">return</span> <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">data_mode</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">inference_time</span>
</span><span id="Project-318"><a href="#Project-318"><span class="linenos"> 318</span></a>
</span><span id="Project-319"><a href="#Project-319"><span class="linenos"> 319</span></a>    <span class="k">def</span> <span class="nf">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project-320"><a href="#Project-320"><span class="linenos"> 320</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-321"><a href="#Project-321"><span class="linenos"> 321</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-322"><a href="#Project-322"><span class="linenos"> 322</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-323"><a href="#Project-323"><span class="linenos"> 323</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-324"><a href="#Project-324"><span class="linenos"> 324</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-325"><a href="#Project-325"><span class="linenos"> 325</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-326"><a href="#Project-326"><span class="linenos"> 326</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
</span><span id="Project-327"><a href="#Project-327"><span class="linenos"> 327</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-328"><a href="#Project-328"><span class="linenos"> 328</span></a>        <span class="n">decision_thresholds</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-329"><a href="#Project-329"><span class="linenos"> 329</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-330"><a href="#Project-330"><span class="linenos"> 330</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TaskDispatcher</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="Project-331"><a href="#Project-331"><span class="linenos"> 331</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-332"><a href="#Project-332"><span class="linenos"> 332</span></a><span class="sd">        Make a `TaskDispatcher` object that will be used to generate a prediction</span>
</span><span id="Project-333"><a href="#Project-333"><span class="linenos"> 333</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-334"><a href="#Project-334"><span class="linenos"> 334</span></a>
</span><span id="Project-335"><a href="#Project-335"><span class="linenos"> 335</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-336"><a href="#Project-336"><span class="linenos"> 336</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-337"><a href="#Project-337"><span class="linenos"> 337</span></a>        <span class="n">parameters_update_second</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-338"><a href="#Project-338"><span class="linenos"> 338</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span> <span class="ow">or</span> <span class="n">data_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">file_paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-339"><a href="#Project-339"><span class="linenos"> 339</span></a>            <span class="n">parameters_update_second</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project-340"><a href="#Project-340"><span class="linenos"> 340</span></a>                <span class="s2">&quot;val_frac&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project-341"><a href="#Project-341"><span class="linenos"> 341</span></a>                <span class="s2">&quot;test_frac&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project-342"><a href="#Project-342"><span class="linenos"> 342</span></a>                <span class="s2">&quot;partition_method&quot;</span><span class="p">:</span> <span class="s2">&quot;random&quot;</span><span class="p">,</span>
</span><span id="Project-343"><a href="#Project-343"><span class="linenos"> 343</span></a>                <span class="s2">&quot;save_split&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-344"><a href="#Project-344"><span class="linenos"> 344</span></a>                <span class="s2">&quot;split_path&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-345"><a href="#Project-345"><span class="linenos"> 345</span></a>            <span class="p">}</span>
</span><span id="Project-346"><a href="#Project-346"><span class="linenos"> 346</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
</span><span id="Project-347"><a href="#Project-347"><span class="linenos"> 347</span></a>        <span class="k">if</span> <span class="n">decision_thresholds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-348"><a href="#Project-348"><span class="linenos"> 348</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="Project-349"><a href="#Project-349"><span class="linenos"> 349</span></a>                <span class="nb">len</span><span class="p">(</span><span class="n">decision_thresholds</span><span class="p">)</span>
</span><span id="Project-350"><a href="#Project-350"><span class="linenos"> 350</span></a>                <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">load_episode</span><span class="p">)</span><span class="o">.</span><span class="n">get_num_classes</span><span class="p">()</span>
</span><span id="Project-351"><a href="#Project-351"><span class="linenos"> 351</span></a>            <span class="p">):</span>
</span><span id="Project-352"><a href="#Project-352"><span class="linenos"> 352</span></a>                <span class="n">parameters_update_second</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project-353"><a href="#Project-353"><span class="linenos"> 353</span></a>                    <span class="s2">&quot;threshold_value&quot;</span><span class="p">:</span> <span class="n">decision_thresholds</span>
</span><span id="Project-354"><a href="#Project-354"><span class="linenos"> 354</span></a>                <span class="p">}</span>
</span><span id="Project-355"><a href="#Project-355"><span class="linenos"> 355</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-356"><a href="#Project-356"><span class="linenos"> 356</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-357"><a href="#Project-357"><span class="linenos"> 357</span></a>                    <span class="sa">f</span><span class="s2">&quot;The length of the decision thresholds </span><span class="si">{</span><span class="n">decision_thresholds</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Project-358"><a href="#Project-358"><span class="linenos"> 358</span></a>                    <span class="sa">f</span><span class="s2">&quot;must be equal to the length of the behaviors dictionary &quot;</span>
</span><span id="Project-359"><a href="#Project-359"><span class="linenos"> 359</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">load_episode</span><span class="p">)</span><span class="o">.</span><span class="n">get_behaviors_dict</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-360"><a href="#Project-360"><span class="linenos"> 360</span></a>                <span class="p">)</span>
</span><span id="Project-361"><a href="#Project-361"><span class="linenos"> 361</span></a>        <span class="n">data_param_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-362"><a href="#Project-362"><span class="linenos"> 362</span></a>        <span class="k">if</span> <span class="n">data_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-363"><a href="#Project-363"><span class="linenos"> 363</span></a>            <span class="n">data_param_update</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data_path&quot;</span><span class="p">:</span> <span class="n">data_path</span><span class="p">}</span>
</span><span id="Project-364"><a href="#Project-364"><span class="linenos"> 364</span></a>        <span class="k">if</span> <span class="n">file_paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-365"><a href="#Project-365"><span class="linenos"> 365</span></a>            <span class="n">data_param_update</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data_path&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;file_paths&quot;</span><span class="p">:</span> <span class="n">file_paths</span><span class="p">}</span>
</span><span id="Project-366"><a href="#Project-366"><span class="linenos"> 366</span></a>        <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters_update</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data_param_update</span><span class="p">})</span>
</span><span id="Project-367"><a href="#Project-367"><span class="linenos"> 367</span></a>        <span class="k">if</span> <span class="n">data_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">file_paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-368"><a href="#Project-368"><span class="linenos"> 368</span></a>            <span class="n">general_update</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project-369"><a href="#Project-369"><span class="linenos"> 369</span></a>                <span class="s2">&quot;annotation_type&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
</span><span id="Project-370"><a href="#Project-370"><span class="linenos"> 370</span></a>                <span class="s2">&quot;only_load_annotated&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-371"><a href="#Project-371"><span class="linenos"> 371</span></a>            <span class="p">}</span>
</span><span id="Project-372"><a href="#Project-372"><span class="linenos"> 372</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-373"><a href="#Project-373"><span class="linenos"> 373</span></a>            <span class="n">general_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-374"><a href="#Project-374"><span class="linenos"> 374</span></a>        <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters_update</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="n">general_update</span><span class="p">})</span>
</span><span id="Project-375"><a href="#Project-375"><span class="linenos"> 375</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task</span><span class="p">(</span>
</span><span id="Project-376"><a href="#Project-376"><span class="linenos"> 376</span></a>            <span class="n">episode_name</span><span class="o">=</span><span class="n">prediction_name</span><span class="p">,</span>
</span><span id="Project-377"><a href="#Project-377"><span class="linenos"> 377</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-378"><a href="#Project-378"><span class="linenos"> 378</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-379"><a href="#Project-379"><span class="linenos"> 379</span></a>            <span class="n">parameters_update_second</span><span class="o">=</span><span class="n">parameters_update_second</span><span class="p">,</span>
</span><span id="Project-380"><a href="#Project-380"><span class="linenos"> 380</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-381"><a href="#Project-381"><span class="linenos"> 381</span></a>            <span class="n">purpose</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span>
</span><span id="Project-382"><a href="#Project-382"><span class="linenos"> 382</span></a>            <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project-383"><a href="#Project-383"><span class="linenos"> 383</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_dictionary</span><span class="p">(</span><span class="n">load_episode</span><span class="p">),</span>
</span><span id="Project-384"><a href="#Project-384"><span class="linenos"> 384</span></a>        <span class="p">)</span>
</span><span id="Project-385"><a href="#Project-385"><span class="linenos"> 385</span></a>        <span class="c1"># if data_path is not None or file_paths is not None:</span>
</span><span id="Project-386"><a href="#Project-386"><span class="linenos"> 386</span></a>        <span class="c1">#     print(&#39;SETTING&#39;)</span>
</span><span id="Project-387"><a href="#Project-387"><span class="linenos"> 387</span></a>        <span class="c1">#     task.set_behaviors(self.get_behavior_dictionary(load_episode))</span>
</span><span id="Project-388"><a href="#Project-388"><span class="linenos"> 388</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-389"><a href="#Project-389"><span class="linenos"> 389</span></a>            <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">):</span>
</span><span id="Project-390"><a href="#Project-390"><span class="linenos"> 390</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
</span><span id="Project-391"><a href="#Project-391"><span class="linenos"> 391</span></a>            <span class="k">elif</span> <span class="n">task</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">):</span>
</span><span id="Project-392"><a href="#Project-392"><span class="linenos"> 392</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span>
</span><span id="Project-393"><a href="#Project-393"><span class="linenos"> 393</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-394"><a href="#Project-394"><span class="linenos"> 394</span></a>                <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
</span><span id="Project-395"><a href="#Project-395"><span class="linenos"> 395</span></a>        <span class="k">return</span> <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span>
</span><span id="Project-396"><a href="#Project-396"><span class="linenos"> 396</span></a>
</span><span id="Project-397"><a href="#Project-397"><span class="linenos"> 397</span></a>    <span class="k">def</span> <span class="nf">_make_task_training</span><span class="p">(</span>
</span><span id="Project-398"><a href="#Project-398"><span class="linenos"> 398</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-399"><a href="#Project-399"><span class="linenos"> 399</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-400"><a href="#Project-400"><span class="linenos"> 400</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-401"><a href="#Project-401"><span class="linenos"> 401</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-402"><a href="#Project-402"><span class="linenos"> 402</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-403"><a href="#Project-403"><span class="linenos"> 403</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-404"><a href="#Project-404"><span class="linenos"> 404</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-405"><a href="#Project-405"><span class="linenos"> 405</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-406"><a href="#Project-406"><span class="linenos"> 406</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-407"><a href="#Project-407"><span class="linenos"> 407</span></a>        <span class="n">continuing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-408"><a href="#Project-408"><span class="linenos"> 408</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-409"><a href="#Project-409"><span class="linenos"> 409</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-410"><a href="#Project-410"><span class="linenos"> 410</span></a>        <span class="n">throwaway</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-411"><a href="#Project-411"><span class="linenos"> 411</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TaskDispatcher</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="Project-412"><a href="#Project-412"><span class="linenos"> 412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-413"><a href="#Project-413"><span class="linenos"> 413</span></a><span class="sd">        Make a `TaskDispatcher` object that will be used to generate a prediction</span>
</span><span id="Project-414"><a href="#Project-414"><span class="linenos"> 414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-415"><a href="#Project-415"><span class="linenos"> 415</span></a>
</span><span id="Project-416"><a href="#Project-416"><span class="linenos"> 416</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-417"><a href="#Project-417"><span class="linenos"> 417</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-418"><a href="#Project-418"><span class="linenos"> 418</span></a>        <span class="k">if</span> <span class="n">continuing</span><span class="p">:</span>
</span><span id="Project-419"><a href="#Project-419"><span class="linenos"> 419</span></a>            <span class="n">purpose</span> <span class="o">=</span> <span class="s2">&quot;continuing&quot;</span>
</span><span id="Project-420"><a href="#Project-420"><span class="linenos"> 420</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-421"><a href="#Project-421"><span class="linenos"> 421</span></a>            <span class="n">purpose</span> <span class="o">=</span> <span class="s2">&quot;training&quot;</span>
</span><span id="Project-422"><a href="#Project-422"><span class="linenos"> 422</span></a>        <span class="k">if</span> <span class="n">mask_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-423"><a href="#Project-423"><span class="linenos"> 423</span></a>            <span class="n">mask_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_path</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">.pickle&quot;</span><span class="p">)</span>
</span><span id="Project-424"><a href="#Project-424"><span class="linenos"> 424</span></a>        <span class="n">parameters_update_second</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;real_lens&quot;</span><span class="p">:</span> <span class="n">mask_name</span><span class="p">}}</span>
</span><span id="Project-425"><a href="#Project-425"><span class="linenos"> 425</span></a>        <span class="k">if</span> <span class="n">throwaway</span><span class="p">:</span>
</span><span id="Project-426"><a href="#Project-426"><span class="linenos"> 426</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project-427"><a href="#Project-427"><span class="linenos"> 427</span></a>                <span class="n">parameters_update</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;normalize&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;cpu&quot;</span><span class="p">}}</span>
</span><span id="Project-428"><a href="#Project-428"><span class="linenos"> 428</span></a>            <span class="p">)</span>
</span><span id="Project-429"><a href="#Project-429"><span class="linenos"> 429</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task</span><span class="p">(</span>
</span><span id="Project-430"><a href="#Project-430"><span class="linenos"> 430</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-431"><a href="#Project-431"><span class="linenos"> 431</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-432"><a href="#Project-432"><span class="linenos"> 432</span></a>            <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-433"><a href="#Project-433"><span class="linenos"> 433</span></a>            <span class="n">parameters_update_second</span><span class="p">,</span>
</span><span id="Project-434"><a href="#Project-434"><span class="linenos"> 434</span></a>            <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-435"><a href="#Project-435"><span class="linenos"> 435</span></a>            <span class="n">load_search</span><span class="p">,</span>
</span><span id="Project-436"><a href="#Project-436"><span class="linenos"> 436</span></a>            <span class="n">load_parameters</span><span class="p">,</span>
</span><span id="Project-437"><a href="#Project-437"><span class="linenos"> 437</span></a>            <span class="n">round_to_binary</span><span class="p">,</span>
</span><span id="Project-438"><a href="#Project-438"><span class="linenos"> 438</span></a>            <span class="n">purpose</span><span class="p">,</span>
</span><span id="Project-439"><a href="#Project-439"><span class="linenos"> 439</span></a>            <span class="n">task</span><span class="p">,</span>
</span><span id="Project-440"><a href="#Project-440"><span class="linenos"> 440</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project-441"><a href="#Project-441"><span class="linenos"> 441</span></a>        <span class="p">)</span>
</span><span id="Project-442"><a href="#Project-442"><span class="linenos"> 442</span></a>
</span><span id="Project-443"><a href="#Project-443"><span class="linenos"> 443</span></a>    <span class="k">def</span> <span class="nf">_make_parameters</span><span class="p">(</span>
</span><span id="Project-444"><a href="#Project-444"><span class="linenos"> 444</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-445"><a href="#Project-445"><span class="linenos"> 445</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-446"><a href="#Project-446"><span class="linenos"> 446</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-447"><a href="#Project-447"><span class="linenos"> 447</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-448"><a href="#Project-448"><span class="linenos"> 448</span></a>        <span class="n">parameters_update_second</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-449"><a href="#Project-449"><span class="linenos"> 449</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-450"><a href="#Project-450"><span class="linenos"> 450</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-451"><a href="#Project-451"><span class="linenos"> 451</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-452"><a href="#Project-452"><span class="linenos"> 452</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-453"><a href="#Project-453"><span class="linenos"> 453</span></a>        <span class="n">purpose</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
</span><span id="Project-454"><a href="#Project-454"><span class="linenos"> 454</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-455"><a href="#Project-455"><span class="linenos"> 455</span></a>    <span class="p">):</span>
</span><span id="Project-456"><a href="#Project-456"><span class="linenos"> 456</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-457"><a href="#Project-457"><span class="linenos"> 457</span></a><span class="sd">        Construct a parameters dictionary</span>
</span><span id="Project-458"><a href="#Project-458"><span class="linenos"> 458</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-459"><a href="#Project-459"><span class="linenos"> 459</span></a>
</span><span id="Project-460"><a href="#Project-460"><span class="linenos"> 460</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-461"><a href="#Project-461"><span class="linenos"> 461</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-462"><a href="#Project-462"><span class="linenos"> 462</span></a>        <span class="n">pars_update</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters_update</span><span class="p">)</span>
</span><span id="Project-463"><a href="#Project-463"><span class="linenos"> 463</span></a>        <span class="k">if</span> <span class="n">parameters_update_second</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-464"><a href="#Project-464"><span class="linenos"> 464</span></a>            <span class="n">parameters_update_second</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-465"><a href="#Project-465"><span class="linenos"> 465</span></a>        <span class="k">if</span> <span class="n">purpose</span> <span class="o">==</span> <span class="s2">&quot;prediction&quot;</span> <span class="ow">and</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Project-466"><a href="#Project-466"><span class="linenos"> 466</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot change model parameters after training!&quot;</span><span class="p">)</span>
</span><span id="Project-467"><a href="#Project-467"><span class="linenos"> 467</span></a>        <span class="k">if</span> <span class="n">purpose</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;continuing&quot;</span><span class="p">,</span> <span class="s2">&quot;prediction&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">load_episode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-468"><a href="#Project-468"><span class="linenos"> 468</span></a>            <span class="n">read_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="Project-469"><a href="#Project-469"><span class="linenos"> 469</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">load_episode</span><span class="p">)</span>
</span><span id="Project-470"><a href="#Project-470"><span class="linenos"> 470</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project-471"><a href="#Project-471"><span class="linenos"> 471</span></a>                <span class="n">read_parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">],</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span>
</span><span id="Project-472"><a href="#Project-472"><span class="linenos"> 472</span></a>            <span class="p">)</span>
</span><span id="Project-473"><a href="#Project-473"><span class="linenos"> 473</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ssl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project-474"><a href="#Project-474"><span class="linenos"> 474</span></a>                <span class="n">read_parameters</span><span class="p">[</span><span class="s2">&quot;ssl&quot;</span><span class="p">],</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ssl&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="Project-475"><a href="#Project-475"><span class="linenos"> 475</span></a>            <span class="p">)</span>
</span><span id="Project-476"><a href="#Project-476"><span class="linenos"> 476</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-477"><a href="#Project-477"><span class="linenos"> 477</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="Project-478"><a href="#Project-478"><span class="linenos"> 478</span></a>        <span class="k">if</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">pars_update</span><span class="p">:</span>
</span><span id="Project-479"><a href="#Project-479"><span class="linenos"> 479</span></a>            <span class="n">model_params</span> <span class="o">=</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="Project-480"><a href="#Project-480"><span class="linenos"> 480</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-481"><a href="#Project-481"><span class="linenos"> 481</span></a>            <span class="n">model_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-482"><a href="#Project-482"><span class="linenos"> 482</span></a>        <span class="k">if</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">pars_update</span><span class="p">:</span>
</span><span id="Project-483"><a href="#Project-483"><span class="linenos"> 483</span></a>            <span class="n">feat_params</span> <span class="o">=</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
</span><span id="Project-484"><a href="#Project-484"><span class="linenos"> 484</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-485"><a href="#Project-485"><span class="linenos"> 485</span></a>            <span class="n">feat_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-486"><a href="#Project-486"><span class="linenos"> 486</span></a>        <span class="k">if</span> <span class="s2">&quot;augmentations&quot;</span> <span class="ow">in</span> <span class="n">pars_update</span><span class="p">:</span>
</span><span id="Project-487"><a href="#Project-487"><span class="linenos"> 487</span></a>            <span class="n">aug_params</span> <span class="o">=</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;augmentations&quot;</span><span class="p">)</span>
</span><span id="Project-488"><a href="#Project-488"><span class="linenos"> 488</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-489"><a href="#Project-489"><span class="linenos"> 489</span></a>            <span class="n">aug_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-490"><a href="#Project-490"><span class="linenos"> 490</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">pars_update</span><span class="p">)</span>
</span><span id="Project-491"><a href="#Project-491"><span class="linenos"> 491</span></a>        <span class="k">if</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_name&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-492"><a href="#Project-492"><span class="linenos"> 492</span></a>            <span class="n">model_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="Project-493"><a href="#Project-493"><span class="linenos"> 493</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-494"><a href="#Project-494"><span class="linenos"> 494</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="Project-495"><a href="#Project-495"><span class="linenos"> 495</span></a>            <span class="p">)</span>
</span><span id="Project-496"><a href="#Project-496"><span class="linenos"> 496</span></a>        <span class="k">if</span> <span class="n">pars_update</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-497"><a href="#Project-497"><span class="linenos"> 497</span></a>            <span class="n">feat_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="Project-498"><a href="#Project-498"><span class="linenos"> 498</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-499"><a href="#Project-499"><span class="linenos"> 499</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-500"><a href="#Project-500"><span class="linenos"> 500</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feat_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project-501"><a href="#Project-501"><span class="linenos"> 501</span></a>                <span class="p">)</span>
</span><span id="Project-502"><a href="#Project-502"><span class="linenos"> 502</span></a>            <span class="p">)</span>
</span><span id="Project-503"><a href="#Project-503"><span class="linenos"> 503</span></a>            <span class="n">aug_name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">extractor_to_transformer</span><span class="p">[</span>
</span><span id="Project-504"><a href="#Project-504"><span class="linenos"> 504</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="Project-505"><a href="#Project-505"><span class="linenos"> 505</span></a>            <span class="p">]</span>
</span><span id="Project-506"><a href="#Project-506"><span class="linenos"> 506</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-507"><a href="#Project-507"><span class="linenos"> 507</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-508"><a href="#Project-508"><span class="linenos"> 508</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aug_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project-509"><a href="#Project-509"><span class="linenos"> 509</span></a>                <span class="p">)</span>
</span><span id="Project-510"><a href="#Project-510"><span class="linenos"> 510</span></a>            <span class="p">)</span>
</span><span id="Project-511"><a href="#Project-511"><span class="linenos"> 511</span></a>        <span class="k">if</span> <span class="n">model_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-512"><a href="#Project-512"><span class="linenos"> 512</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">model_params</span><span class="p">)</span>
</span><span id="Project-513"><a href="#Project-513"><span class="linenos"> 513</span></a>        <span class="k">if</span> <span class="n">feat_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-514"><a href="#Project-514"><span class="linenos"> 514</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">feat_params</span><span class="p">)</span>
</span><span id="Project-515"><a href="#Project-515"><span class="linenos"> 515</span></a>        <span class="k">if</span> <span class="n">aug_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-516"><a href="#Project-516"><span class="linenos"> 516</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project-517"><a href="#Project-517"><span class="linenos"> 517</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">],</span> <span class="n">aug_params</span>
</span><span id="Project-518"><a href="#Project-518"><span class="linenos"> 518</span></a>            <span class="p">)</span>
</span><span id="Project-519"><a href="#Project-519"><span class="linenos"> 519</span></a>        <span class="k">if</span> <span class="n">load_search</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-520"><a href="#Project-520"><span class="linenos"> 520</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_with_search</span><span class="p">(</span>
</span><span id="Project-521"><a href="#Project-521"><span class="linenos"> 521</span></a>                <span class="n">parameters</span><span class="p">,</span> <span class="n">load_search</span><span class="p">,</span> <span class="n">load_parameters</span><span class="p">,</span> <span class="n">round_to_binary</span>
</span><span id="Project-522"><a href="#Project-522"><span class="linenos"> 522</span></a>            <span class="p">)</span>
</span><span id="Project-523"><a href="#Project-523"><span class="linenos"> 523</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span><span class="p">(</span>
</span><span id="Project-524"><a href="#Project-524"><span class="linenos"> 524</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-525"><a href="#Project-525"><span class="linenos"> 525</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-526"><a href="#Project-526"><span class="linenos"> 526</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-527"><a href="#Project-527"><span class="linenos"> 527</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-528"><a href="#Project-528"><span class="linenos"> 528</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project-529"><a href="#Project-529"><span class="linenos"> 529</span></a>            <span class="n">only_load_model</span><span class="o">=</span><span class="p">(</span><span class="n">purpose</span> <span class="o">!=</span> <span class="s2">&quot;continuing&quot;</span><span class="p">),</span>
</span><span id="Project-530"><a href="#Project-530"><span class="linenos"> 530</span></a>            <span class="n">continuing</span><span class="o">=</span><span class="p">(</span><span class="n">purpose</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;prediction&quot;</span><span class="p">,</span> <span class="s2">&quot;continuing&quot;</span><span class="p">]),</span>
</span><span id="Project-531"><a href="#Project-531"><span class="linenos"> 531</span></a>            <span class="n">enforce_split_parameters</span><span class="o">=</span><span class="p">(</span><span class="n">purpose</span> <span class="o">==</span> <span class="s2">&quot;prediction&quot;</span><span class="p">),</span>
</span><span id="Project-532"><a href="#Project-532"><span class="linenos"> 532</span></a>        <span class="p">)</span>
</span><span id="Project-533"><a href="#Project-533"><span class="linenos"> 533</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">parameters_update_second</span><span class="p">)</span>
</span><span id="Project-534"><a href="#Project-534"><span class="linenos"> 534</span></a>        <span class="k">return</span> <span class="n">parameters</span>
</span><span id="Project-535"><a href="#Project-535"><span class="linenos"> 535</span></a>
</span><span id="Project-536"><a href="#Project-536"><span class="linenos"> 536</span></a>    <span class="k">def</span> <span class="nf">_make_task</span><span class="p">(</span>
</span><span id="Project-537"><a href="#Project-537"><span class="linenos"> 537</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-538"><a href="#Project-538"><span class="linenos"> 538</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-539"><a href="#Project-539"><span class="linenos"> 539</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-540"><a href="#Project-540"><span class="linenos"> 540</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-541"><a href="#Project-541"><span class="linenos"> 541</span></a>        <span class="n">parameters_update_second</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-542"><a href="#Project-542"><span class="linenos"> 542</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-543"><a href="#Project-543"><span class="linenos"> 543</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-544"><a href="#Project-544"><span class="linenos"> 544</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-545"><a href="#Project-545"><span class="linenos"> 545</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-546"><a href="#Project-546"><span class="linenos"> 546</span></a>        <span class="n">purpose</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
</span><span id="Project-547"><a href="#Project-547"><span class="linenos"> 547</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-548"><a href="#Project-548"><span class="linenos"> 548</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-549"><a href="#Project-549"><span class="linenos"> 549</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-550"><a href="#Project-550"><span class="linenos"> 550</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TaskDispatcher</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">CommentedMap</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]:</span>
</span><span id="Project-551"><a href="#Project-551"><span class="linenos"> 551</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-552"><a href="#Project-552"><span class="linenos"> 552</span></a><span class="sd">        Make a `TaskDispatcher` object</span>
</span><span id="Project-553"><a href="#Project-553"><span class="linenos"> 553</span></a>
</span><span id="Project-554"><a href="#Project-554"><span class="linenos"> 554</span></a><span class="sd">        The task parameters are read from the config files and then updated with the</span>
</span><span id="Project-555"><a href="#Project-555"><span class="linenos"> 555</span></a><span class="sd">        parameters_update dictionary. The model can be either initialized from scratch or loaded from one of the</span>
</span><span id="Project-556"><a href="#Project-556"><span class="linenos"> 556</span></a><span class="sd">        previous experiments. All parameters and results are saved in the meta files and can be accessed with the</span>
</span><span id="Project-557"><a href="#Project-557"><span class="linenos"> 557</span></a><span class="sd">        list_episodes() function. The train/test/validation split is saved and loaded from a file whenever the</span>
</span><span id="Project-558"><a href="#Project-558"><span class="linenos"> 558</span></a><span class="sd">        same split parameters are used. The pre-computed datasets are also saved and loaded whenever the same</span>
</span><span id="Project-559"><a href="#Project-559"><span class="linenos"> 559</span></a><span class="sd">        data parameters are used.</span>
</span><span id="Project-560"><a href="#Project-560"><span class="linenos"> 560</span></a>
</span><span id="Project-561"><a href="#Project-561"><span class="linenos"> 561</span></a><span class="sd">        Parameters</span>
</span><span id="Project-562"><a href="#Project-562"><span class="linenos"> 562</span></a><span class="sd">        ----------</span>
</span><span id="Project-563"><a href="#Project-563"><span class="linenos"> 563</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project-564"><a href="#Project-564"><span class="linenos"> 564</span></a><span class="sd">            the name of the episode</span>
</span><span id="Project-565"><a href="#Project-565"><span class="linenos"> 565</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="Project-566"><a href="#Project-566"><span class="linenos"> 566</span></a><span class="sd">            the (previously run) episode name to load the model from</span>
</span><span id="Project-567"><a href="#Project-567"><span class="linenos"> 567</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-568"><a href="#Project-568"><span class="linenos"> 568</span></a><span class="sd">            the dictionary used to update the parameters from the config</span>
</span><span id="Project-569"><a href="#Project-569"><span class="linenos"> 569</span></a><span class="sd">        parameters_update_second : dict, optional</span>
</span><span id="Project-570"><a href="#Project-570"><span class="linenos"> 570</span></a><span class="sd">            the dictionary used to update the parameters after the automatic fill-out</span>
</span><span id="Project-571"><a href="#Project-571"><span class="linenos"> 571</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="Project-572"><a href="#Project-572"><span class="linenos"> 572</span></a><span class="sd">            the epoch to load (if load_episodes is not None); if not provided, the last epoch is used</span>
</span><span id="Project-573"><a href="#Project-573"><span class="linenos"> 573</span></a><span class="sd">        load_search : str, optional</span>
</span><span id="Project-574"><a href="#Project-574"><span class="linenos"> 574</span></a><span class="sd">            the hyperparameter search result to load</span>
</span><span id="Project-575"><a href="#Project-575"><span class="linenos"> 575</span></a><span class="sd">        load_parameters : list, optional</span>
</span><span id="Project-576"><a href="#Project-576"><span class="linenos"> 576</span></a><span class="sd">            a list of string names of the parameters to load from load_search (if not provided, all parameters</span>
</span><span id="Project-577"><a href="#Project-577"><span class="linenos"> 577</span></a><span class="sd">            are loaded)</span>
</span><span id="Project-578"><a href="#Project-578"><span class="linenos"> 578</span></a><span class="sd">        round_to_binary : list, optional</span>
</span><span id="Project-579"><a href="#Project-579"><span class="linenos"> 579</span></a><span class="sd">            a list of string names of the loaded parameters that should be rounded to the nearest power of two</span>
</span><span id="Project-580"><a href="#Project-580"><span class="linenos"> 580</span></a><span class="sd">        purpose : {&quot;train&quot;, &quot;continuing&quot;, &quot;prediction&quot;}</span>
</span><span id="Project-581"><a href="#Project-581"><span class="linenos"> 581</span></a><span class="sd">            the purpose of the task object (`&quot;train&quot;` for training from scratch, `&quot;continuing&quot;` for continuing</span>
</span><span id="Project-582"><a href="#Project-582"><span class="linenos"> 582</span></a><span class="sd">            the training of an interrupted episode, `&quot;prediction&quot;` for generating a prediction)</span>
</span><span id="Project-583"><a href="#Project-583"><span class="linenos"> 583</span></a><span class="sd">        task : TaskDispatcher, optional</span>
</span><span id="Project-584"><a href="#Project-584"><span class="linenos"> 584</span></a><span class="sd">            a pre-existing task; if provided, the method will update the task instead of creating a new one</span>
</span><span id="Project-585"><a href="#Project-585"><span class="linenos"> 585</span></a><span class="sd">            (this might save time, mainly on dataset loading)</span>
</span><span id="Project-586"><a href="#Project-586"><span class="linenos"> 586</span></a>
</span><span id="Project-587"><a href="#Project-587"><span class="linenos"> 587</span></a><span class="sd">        Returns</span>
</span><span id="Project-588"><a href="#Project-588"><span class="linenos"> 588</span></a><span class="sd">        -------</span>
</span><span id="Project-589"><a href="#Project-589"><span class="linenos"> 589</span></a><span class="sd">        task : TaskDispatcher</span>
</span><span id="Project-590"><a href="#Project-590"><span class="linenos"> 590</span></a><span class="sd">            the `TaskDispatcher` instance</span>
</span><span id="Project-591"><a href="#Project-591"><span class="linenos"> 591</span></a><span class="sd">        parameters : dict</span>
</span><span id="Project-592"><a href="#Project-592"><span class="linenos"> 592</span></a><span class="sd">            the parameters dictionary that describes the task</span>
</span><span id="Project-593"><a href="#Project-593"><span class="linenos"> 593</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-594"><a href="#Project-594"><span class="linenos"> 594</span></a>
</span><span id="Project-595"><a href="#Project-595"><span class="linenos"> 595</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_parameters</span><span class="p">(</span>
</span><span id="Project-596"><a href="#Project-596"><span class="linenos"> 596</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-597"><a href="#Project-597"><span class="linenos"> 597</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-598"><a href="#Project-598"><span class="linenos"> 598</span></a>            <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-599"><a href="#Project-599"><span class="linenos"> 599</span></a>            <span class="n">parameters_update_second</span><span class="p">,</span>
</span><span id="Project-600"><a href="#Project-600"><span class="linenos"> 600</span></a>            <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-601"><a href="#Project-601"><span class="linenos"> 601</span></a>            <span class="n">load_search</span><span class="p">,</span>
</span><span id="Project-602"><a href="#Project-602"><span class="linenos"> 602</span></a>            <span class="n">load_parameters</span><span class="p">,</span>
</span><span id="Project-603"><a href="#Project-603"><span class="linenos"> 603</span></a>            <span class="n">round_to_binary</span><span class="p">,</span>
</span><span id="Project-604"><a href="#Project-604"><span class="linenos"> 604</span></a>            <span class="n">purpose</span><span class="p">,</span>
</span><span id="Project-605"><a href="#Project-605"><span class="linenos"> 605</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project-606"><a href="#Project-606"><span class="linenos"> 606</span></a>        <span class="p">)</span>
</span><span id="Project-607"><a href="#Project-607"><span class="linenos"> 607</span></a>        <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;annotation_type&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="Project-608"><a href="#Project-608"><span class="linenos"> 608</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project-609"><a href="#Project-609"><span class="linenos"> 609</span></a>                <span class="n">parameters</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;behavior_dictionary&quot;</span><span class="p">:</span> <span class="n">behaviors</span><span class="p">}}</span>
</span><span id="Project-610"><a href="#Project-610"><span class="linenos"> 610</span></a>            <span class="p">)</span>
</span><span id="Project-611"><a href="#Project-611"><span class="linenos"> 611</span></a>        <span class="k">if</span> <span class="n">task</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-612"><a href="#Project-612"><span class="linenos"> 612</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="n">TaskDispatcher</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-613"><a href="#Project-613"><span class="linenos"> 613</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-614"><a href="#Project-614"><span class="linenos"> 614</span></a>            <span class="n">task</span><span class="o">.</span><span class="n">update_task</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-615"><a href="#Project-615"><span class="linenos"> 615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-616"><a href="#Project-616"><span class="linenos"> 616</span></a>        <span class="k">return</span> <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span>
</span><span id="Project-617"><a href="#Project-617"><span class="linenos"> 617</span></a>
</span><span id="Project-618"><a href="#Project-618"><span class="linenos"> 618</span></a>    <span class="k">def</span> <span class="nf">run_episode</span><span class="p">(</span>
</span><span id="Project-619"><a href="#Project-619"><span class="linenos"> 619</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-620"><a href="#Project-620"><span class="linenos"> 620</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-621"><a href="#Project-621"><span class="linenos"> 621</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-622"><a href="#Project-622"><span class="linenos"> 622</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-623"><a href="#Project-623"><span class="linenos"> 623</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-624"><a href="#Project-624"><span class="linenos"> 624</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-625"><a href="#Project-625"><span class="linenos"> 625</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-626"><a href="#Project-626"><span class="linenos"> 626</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-627"><a href="#Project-627"><span class="linenos"> 627</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-628"><a href="#Project-628"><span class="linenos"> 628</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-629"><a href="#Project-629"><span class="linenos"> 629</span></a>        <span class="n">n_seeds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project-630"><a href="#Project-630"><span class="linenos"> 630</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-631"><a href="#Project-631"><span class="linenos"> 631</span></a>        <span class="n">suppress_name_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-632"><a href="#Project-632"><span class="linenos"> 632</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-633"><a href="#Project-633"><span class="linenos"> 633</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-634"><a href="#Project-634"><span class="linenos"> 634</span></a>        <span class="n">autostop_metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-635"><a href="#Project-635"><span class="linenos"> 635</span></a>        <span class="n">autostop_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="Project-636"><a href="#Project-636"><span class="linenos"> 636</span></a>        <span class="n">autostop_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="Project-637"><a href="#Project-637"><span class="linenos"> 637</span></a>        <span class="n">loading_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-638"><a href="#Project-638"><span class="linenos"> 638</span></a>        <span class="n">trial</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-639"><a href="#Project-639"><span class="linenos"> 639</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskDispatcher</span><span class="p">:</span>
</span><span id="Project-640"><a href="#Project-640"><span class="linenos"> 640</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-641"><a href="#Project-641"><span class="linenos"> 641</span></a><span class="sd">        Run an episode</span>
</span><span id="Project-642"><a href="#Project-642"><span class="linenos"> 642</span></a>
</span><span id="Project-643"><a href="#Project-643"><span class="linenos"> 643</span></a><span class="sd">        The task parameters are read from the config files and then updated with the</span>
</span><span id="Project-644"><a href="#Project-644"><span class="linenos"> 644</span></a><span class="sd">        parameters_update dictionary. The model can be either initialized from scratch or loaded from one of the</span>
</span><span id="Project-645"><a href="#Project-645"><span class="linenos"> 645</span></a><span class="sd">        previous experiments. All parameters and results are saved in the meta files and can be accessed with the</span>
</span><span id="Project-646"><a href="#Project-646"><span class="linenos"> 646</span></a><span class="sd">        list_episodes() function. The train/test/validation split is saved and loaded from a file whenever the</span>
</span><span id="Project-647"><a href="#Project-647"><span class="linenos"> 647</span></a><span class="sd">        same split parameters are used. The pre-computed datasets are also saved and loaded whenever the same</span>
</span><span id="Project-648"><a href="#Project-648"><span class="linenos"> 648</span></a><span class="sd">        data parameters are used.</span>
</span><span id="Project-649"><a href="#Project-649"><span class="linenos"> 649</span></a>
</span><span id="Project-650"><a href="#Project-650"><span class="linenos"> 650</span></a><span class="sd">        You can use the autostop parameters to finish training when the parameters are not improving. It will be</span>
</span><span id="Project-651"><a href="#Project-651"><span class="linenos"> 651</span></a><span class="sd">        stopped if the average value of `autostop_metric` over the last `autostop_interval` epochs is smaller than</span>
</span><span id="Project-652"><a href="#Project-652"><span class="linenos"> 652</span></a><span class="sd">        the average over the previous `autostop_interval` epochs + `autostop_threshold`. For example, if the</span>
</span><span id="Project-653"><a href="#Project-653"><span class="linenos"> 653</span></a><span class="sd">        current epoch is 120 and `autostop_interval` is 50, the averages over epochs 70-120 and 20-70 will be compared.</span>
</span><span id="Project-654"><a href="#Project-654"><span class="linenos"> 654</span></a>
</span><span id="Project-655"><a href="#Project-655"><span class="linenos"> 655</span></a><span class="sd">        Parameters</span>
</span><span id="Project-656"><a href="#Project-656"><span class="linenos"> 656</span></a><span class="sd">        ----------</span>
</span><span id="Project-657"><a href="#Project-657"><span class="linenos"> 657</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project-658"><a href="#Project-658"><span class="linenos"> 658</span></a><span class="sd">            the episode name</span>
</span><span id="Project-659"><a href="#Project-659"><span class="linenos"> 659</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="Project-660"><a href="#Project-660"><span class="linenos"> 660</span></a><span class="sd">            the (previously run) episode name to load the model from; if the episode has multiple runs,</span>
</span><span id="Project-661"><a href="#Project-661"><span class="linenos"> 661</span></a><span class="sd">            the new episode will have the same number of runs, each starting with one of the pre-trained models</span>
</span><span id="Project-662"><a href="#Project-662"><span class="linenos"> 662</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-663"><a href="#Project-663"><span class="linenos"> 663</span></a><span class="sd">            the dictionary used to update the parameters from the config files</span>
</span><span id="Project-664"><a href="#Project-664"><span class="linenos"> 664</span></a><span class="sd">        task : TaskDispatcher, optional</span>
</span><span id="Project-665"><a href="#Project-665"><span class="linenos"> 665</span></a><span class="sd">            a pre-existing `TaskDispatcher` object (if provided, the method will update it instead of creating</span>
</span><span id="Project-666"><a href="#Project-666"><span class="linenos"> 666</span></a><span class="sd">            a new instance)</span>
</span><span id="Project-667"><a href="#Project-667"><span class="linenos"> 667</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="Project-668"><a href="#Project-668"><span class="linenos"> 668</span></a><span class="sd">            the epoch to load (if load_episodes is not None); if not provided, the last epoch is used</span>
</span><span id="Project-669"><a href="#Project-669"><span class="linenos"> 669</span></a><span class="sd">        load_search : str, optional</span>
</span><span id="Project-670"><a href="#Project-670"><span class="linenos"> 670</span></a><span class="sd">            the hyperparameter search result to load</span>
</span><span id="Project-671"><a href="#Project-671"><span class="linenos"> 671</span></a><span class="sd">        load_parameters : list, optional</span>
</span><span id="Project-672"><a href="#Project-672"><span class="linenos"> 672</span></a><span class="sd">            a list of string names of the parameters to load from load_search (if not provided, all parameters</span>
</span><span id="Project-673"><a href="#Project-673"><span class="linenos"> 673</span></a><span class="sd">            are loaded)</span>
</span><span id="Project-674"><a href="#Project-674"><span class="linenos"> 674</span></a><span class="sd">        round_to_binary : list, optional</span>
</span><span id="Project-675"><a href="#Project-675"><span class="linenos"> 675</span></a><span class="sd">            a list of string names of the loaded parameters that should be rounded to the nearest power of two</span>
</span><span id="Project-676"><a href="#Project-676"><span class="linenos"> 676</span></a><span class="sd">        load_strict : bool, default True</span>
</span><span id="Project-677"><a href="#Project-677"><span class="linenos"> 677</span></a><span class="sd">            if `False`, matching weights will be loaded from `load_episode` and differences in parameter name lists and</span>
</span><span id="Project-678"><a href="#Project-678"><span class="linenos"> 678</span></a><span class="sd">            weight shapes will be ignored; otherwise mismatches will prompt a `RuntimeError`</span>
</span><span id="Project-679"><a href="#Project-679"><span class="linenos"> 679</span></a><span class="sd">        n_seeds : int, default 1</span>
</span><span id="Project-680"><a href="#Project-680"><span class="linenos"> 680</span></a><span class="sd">            the number of runs to perform with different random seeds; if `n_seeds &gt; 1`, the episodes will be named</span>
</span><span id="Project-681"><a href="#Project-681"><span class="linenos"> 681</span></a><span class="sd">            `episode_name#seed_index`, e.g. `test_episode#0` and `test_episode#1`</span>
</span><span id="Project-682"><a href="#Project-682"><span class="linenos"> 682</span></a><span class="sd">        force : bool, default False</span>
</span><span id="Project-683"><a href="#Project-683"><span class="linenos"> 683</span></a><span class="sd">            if `True` and an episode with name `episode_name` already exists, it will be overwritten (use with caution!)</span>
</span><span id="Project-684"><a href="#Project-684"><span class="linenos"> 684</span></a><span class="sd">        suppress_name_check : bool, default False</span>
</span><span id="Project-685"><a href="#Project-685"><span class="linenos"> 685</span></a><span class="sd">            if `True`, episode names with a double colon are allowed (please don&#39;t use this option unless you understand</span>
</span><span id="Project-686"><a href="#Project-686"><span class="linenos"> 686</span></a><span class="sd">            why they are usually forbidden)</span>
</span><span id="Project-687"><a href="#Project-687"><span class="linenos"> 687</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project-688"><a href="#Project-688"><span class="linenos"> 688</span></a><span class="sd">            if `True`, the dataset will be deleted after training</span>
</span><span id="Project-689"><a href="#Project-689"><span class="linenos"> 689</span></a><span class="sd">        mask_name : str, optional</span>
</span><span id="Project-690"><a href="#Project-690"><span class="linenos"> 690</span></a><span class="sd">            the name of the real_lens to apply</span>
</span><span id="Project-691"><a href="#Project-691"><span class="linenos"> 691</span></a><span class="sd">        autostop_interval : int, default 50</span>
</span><span id="Project-692"><a href="#Project-692"><span class="linenos"> 692</span></a><span class="sd">            the number of epochs to average the autostop metric over</span>
</span><span id="Project-693"><a href="#Project-693"><span class="linenos"> 693</span></a><span class="sd">        autostop_threshold : float, default 0.001</span>
</span><span id="Project-694"><a href="#Project-694"><span class="linenos"> 694</span></a><span class="sd">            the autostop difference threshold</span>
</span><span id="Project-695"><a href="#Project-695"><span class="linenos"> 695</span></a><span class="sd">        autostop_metric : str, optional</span>
</span><span id="Project-696"><a href="#Project-696"><span class="linenos"> 696</span></a><span class="sd">            the autostop metric (can be any one of the tracked metrics of `&#39;loss&#39;`)</span>
</span><span id="Project-697"><a href="#Project-697"><span class="linenos"> 697</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-698"><a href="#Project-698"><span class="linenos"> 698</span></a>
</span><span id="Project-699"><a href="#Project-699"><span class="linenos"> 699</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span> <span class="ow">or</span> <span class="n">n_seeds</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-700"><a href="#Project-700"><span class="linenos"> 700</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-701"><a href="#Project-701"><span class="linenos"> 701</span></a>                <span class="sa">f</span><span class="s2">&quot;The n_seeds parameter has to be an integer larger than 0; got </span><span class="si">{</span><span class="n">n_seeds</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-702"><a href="#Project-702"><span class="linenos"> 702</span></a>            <span class="p">)</span>
</span><span id="Project-703"><a href="#Project-703"><span class="linenos"> 703</span></a>        <span class="k">if</span> <span class="n">n_seeds</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mask_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-704"><a href="#Project-704"><span class="linenos"> 704</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot apply a real_lens with n_seeds &gt; 1&quot;</span><span class="p">)</span>
</span><span id="Project-705"><a href="#Project-705"><span class="linenos"> 705</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_episode_validity</span><span class="p">(</span>
</span><span id="Project-706"><a href="#Project-706"><span class="linenos"> 706</span></a>            <span class="n">episode_name</span><span class="p">,</span> <span class="n">allow_doublecolon</span><span class="o">=</span><span class="n">suppress_name_check</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span>
</span><span id="Project-707"><a href="#Project-707"><span class="linenos"> 707</span></a>        <span class="p">)</span>
</span><span id="Project-708"><a href="#Project-708"><span class="linenos"> 708</span></a>        <span class="n">load_runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">load_episode</span><span class="p">)</span>
</span><span id="Project-709"><a href="#Project-709"><span class="linenos"> 709</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">load_runs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-710"><a href="#Project-710"><span class="linenos"> 710</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_episodes</span><span class="p">(</span>
</span><span id="Project-711"><a href="#Project-711"><span class="linenos"> 711</span></a>                <span class="n">episode_names</span><span class="o">=</span><span class="p">[</span>
</span><span id="Project-712"><a href="#Project-712"><span class="linenos"> 712</span></a>                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s1">#</span><span class="si">{</span><span class="n">run</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">load_runs</span>
</span><span id="Project-713"><a href="#Project-713"><span class="linenos"> 713</span></a>                <span class="p">],</span>
</span><span id="Project-714"><a href="#Project-714"><span class="linenos"> 714</span></a>                <span class="n">load_episodes</span><span class="o">=</span><span class="n">load_runs</span><span class="p">,</span>
</span><span id="Project-715"><a href="#Project-715"><span class="linenos"> 715</span></a>                <span class="n">parameters_updates</span><span class="o">=</span><span class="p">[</span><span class="n">parameters_update</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project-716"><a href="#Project-716"><span class="linenos"> 716</span></a>                <span class="n">load_epochs</span><span class="o">=</span><span class="p">[</span><span class="n">load_epoch</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project-717"><a href="#Project-717"><span class="linenos"> 717</span></a>                <span class="n">load_searches</span><span class="o">=</span><span class="p">[</span><span class="n">load_search</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project-718"><a href="#Project-718"><span class="linenos"> 718</span></a>                <span class="n">load_parameters</span><span class="o">=</span><span class="p">[</span><span class="n">load_parameters</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project-719"><a href="#Project-719"><span class="linenos"> 719</span></a>                <span class="n">round_to_binary</span><span class="o">=</span><span class="p">[</span><span class="n">round_to_binary</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project-720"><a href="#Project-720"><span class="linenos"> 720</span></a>                <span class="n">load_strict</span><span class="o">=</span><span class="p">[</span><span class="n">load_strict</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project-721"><a href="#Project-721"><span class="linenos"> 721</span></a>                <span class="n">suppress_name_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-722"><a href="#Project-722"><span class="linenos"> 722</span></a>                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="Project-723"><a href="#Project-723"><span class="linenos"> 723</span></a>                <span class="n">remove_saved_features</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Project-724"><a href="#Project-724"><span class="linenos"> 724</span></a>            <span class="p">)</span>
</span><span id="Project-725"><a href="#Project-725"><span class="linenos"> 725</span></a>            <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project-726"><a href="#Project-726"><span class="linenos"> 726</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span>
</span><span id="Project-727"><a href="#Project-727"><span class="linenos"> 727</span></a>                    <span class="p">{</span>
</span><span id="Project-728"><a href="#Project-728"><span class="linenos"> 728</span></a>                        <span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">general_parameters</span><span class="p">,</span>
</span><span id="Project-729"><a href="#Project-729"><span class="linenos"> 729</span></a>                        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">data_parameters</span><span class="p">,</span>
</span><span id="Project-730"><a href="#Project-730"><span class="linenos"> 730</span></a>                        <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">feature_parameters</span><span class="p">,</span>
</span><span id="Project-731"><a href="#Project-731"><span class="linenos"> 731</span></a>                    <span class="p">}</span>
</span><span id="Project-732"><a href="#Project-732"><span class="linenos"> 732</span></a>                <span class="p">)</span>
</span><span id="Project-733"><a href="#Project-733"><span class="linenos"> 733</span></a>            <span class="k">if</span> <span class="n">n_seeds</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-734"><a href="#Project-734"><span class="linenos"> 734</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Project-735"><a href="#Project-735"><span class="linenos"> 735</span></a>                    <span class="sa">f</span><span class="s2">&quot;The n_seeds parameter is disregarded since load_episode=</span><span class="si">{</span><span class="n">load_episode</span><span class="si">}</span><span class="s2"> has multiple runs&quot;</span>
</span><span id="Project-736"><a href="#Project-736"><span class="linenos"> 736</span></a>                <span class="p">)</span>
</span><span id="Project-737"><a href="#Project-737"><span class="linenos"> 737</span></a>        <span class="k">elif</span> <span class="n">n_seeds</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-738"><a href="#Project-738"><span class="linenos"> 738</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_episodes</span><span class="p">(</span>
</span><span id="Project-739"><a href="#Project-739"><span class="linenos"> 739</span></a>                <span class="n">episode_names</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project-740"><a href="#Project-740"><span class="linenos"> 740</span></a>                <span class="n">load_episodes</span><span class="o">=</span><span class="p">[</span><span class="n">load_episode</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project-741"><a href="#Project-741"><span class="linenos"> 741</span></a>                <span class="n">parameters_updates</span><span class="o">=</span><span class="p">[</span><span class="n">parameters_update</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project-742"><a href="#Project-742"><span class="linenos"> 742</span></a>                <span class="n">load_epochs</span><span class="o">=</span><span class="p">[</span><span class="n">load_epoch</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project-743"><a href="#Project-743"><span class="linenos"> 743</span></a>                <span class="n">load_searches</span><span class="o">=</span><span class="p">[</span><span class="n">load_search</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project-744"><a href="#Project-744"><span class="linenos"> 744</span></a>                <span class="n">load_parameters</span><span class="o">=</span><span class="p">[</span><span class="n">load_parameters</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project-745"><a href="#Project-745"><span class="linenos"> 745</span></a>                <span class="n">round_to_binary</span><span class="o">=</span><span class="p">[</span><span class="n">round_to_binary</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project-746"><a href="#Project-746"><span class="linenos"> 746</span></a>                <span class="n">load_strict</span><span class="o">=</span><span class="p">[</span><span class="n">load_strict</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project-747"><a href="#Project-747"><span class="linenos"> 747</span></a>                <span class="n">suppress_name_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-748"><a href="#Project-748"><span class="linenos"> 748</span></a>                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="Project-749"><a href="#Project-749"><span class="linenos"> 749</span></a>                <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="Project-750"><a href="#Project-750"><span class="linenos"> 750</span></a>            <span class="p">)</span>
</span><span id="Project-751"><a href="#Project-751"><span class="linenos"> 751</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-752"><a href="#Project-752"><span class="linenos"> 752</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAINING </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-753"><a href="#Project-753"><span class="linenos"> 753</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Project-754"><a href="#Project-754"><span class="linenos"> 754</span></a>                <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="Project-755"><a href="#Project-755"><span class="linenos"> 755</span></a>                    <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-756"><a href="#Project-756"><span class="linenos"> 756</span></a>                    <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-757"><a href="#Project-757"><span class="linenos"> 757</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-758"><a href="#Project-758"><span class="linenos"> 758</span></a>                    <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-759"><a href="#Project-759"><span class="linenos"> 759</span></a>                    <span class="n">load_search</span><span class="p">,</span>
</span><span id="Project-760"><a href="#Project-760"><span class="linenos"> 760</span></a>                    <span class="n">load_parameters</span><span class="p">,</span>
</span><span id="Project-761"><a href="#Project-761"><span class="linenos"> 761</span></a>                    <span class="n">round_to_binary</span><span class="p">,</span>
</span><span id="Project-762"><a href="#Project-762"><span class="linenos"> 762</span></a>                    <span class="n">continuing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Project-763"><a href="#Project-763"><span class="linenos"> 763</span></a>                    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project-764"><a href="#Project-764"><span class="linenos"> 764</span></a>                    <span class="n">mask_name</span><span class="o">=</span><span class="n">mask_name</span><span class="p">,</span>
</span><span id="Project-765"><a href="#Project-765"><span class="linenos"> 765</span></a>                    <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project-766"><a href="#Project-766"><span class="linenos"> 766</span></a>                <span class="p">)</span>
</span><span id="Project-767"><a href="#Project-767"><span class="linenos"> 767</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_save_episode</span><span class="p">(</span>
</span><span id="Project-768"><a href="#Project-768"><span class="linenos"> 768</span></a>                    <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-769"><a href="#Project-769"><span class="linenos"> 769</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-770"><a href="#Project-770"><span class="linenos"> 770</span></a>                    <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">(),</span>
</span><span id="Project-771"><a href="#Project-771"><span class="linenos"> 771</span></a>                    <span class="n">norm_stats</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">get_normalization_stats</span><span class="p">(),</span>
</span><span id="Project-772"><a href="#Project-772"><span class="linenos"> 772</span></a>                <span class="p">)</span>
</span><span id="Project-773"><a href="#Project-773"><span class="linenos"> 773</span></a>                <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Project-774"><a href="#Project-774"><span class="linenos"> 774</span></a>                <span class="k">if</span> <span class="n">trial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-775"><a href="#Project-775"><span class="linenos"> 775</span></a>                    <span class="n">trial</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="n">trial</span>
</span><span id="Project-776"><a href="#Project-776"><span class="linenos"> 776</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project-777"><a href="#Project-777"><span class="linenos"> 777</span></a>                    <span class="n">trial</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="Project-778"><a href="#Project-778"><span class="linenos"> 778</span></a>                <span class="n">logs</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
</span><span id="Project-779"><a href="#Project-779"><span class="linenos"> 779</span></a>                    <span class="n">autostop_metric</span><span class="o">=</span><span class="n">autostop_metric</span><span class="p">,</span>
</span><span id="Project-780"><a href="#Project-780"><span class="linenos"> 780</span></a>                    <span class="n">autostop_interval</span><span class="o">=</span><span class="n">autostop_interval</span><span class="p">,</span>
</span><span id="Project-781"><a href="#Project-781"><span class="linenos"> 781</span></a>                    <span class="n">autostop_threshold</span><span class="o">=</span><span class="n">autostop_threshold</span><span class="p">,</span>
</span><span id="Project-782"><a href="#Project-782"><span class="linenos"> 782</span></a>                    <span class="n">loading_bar</span><span class="o">=</span><span class="n">loading_bar</span><span class="p">,</span>
</span><span id="Project-783"><a href="#Project-783"><span class="linenos"> 783</span></a>                    <span class="n">trial</span><span class="o">=</span><span class="n">trial</span><span class="p">,</span>
</span><span id="Project-784"><a href="#Project-784"><span class="linenos"> 784</span></a>                    <span class="n">optimized_metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
</span><span id="Project-785"><a href="#Project-785"><span class="linenos"> 785</span></a>                <span class="p">)</span>
</span><span id="Project-786"><a href="#Project-786"><span class="linenos"> 786</span></a>                <span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Project-787"><a href="#Project-787"><span class="linenos"> 787</span></a>                <span class="n">time_total</span> <span class="o">=</span> <span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span>
</span><span id="Project-788"><a href="#Project-788"><span class="linenos"> 788</span></a>                <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span>
</span><span id="Project-789"><a href="#Project-789"><span class="linenos"> 789</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span>
</span><span id="Project-790"><a href="#Project-790"><span class="linenos"> 790</span></a>                <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="Project-791"><a href="#Project-791"><span class="linenos"> 791</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>
</span><span id="Project-792"><a href="#Project-792"><span class="linenos"> 792</span></a>                <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span><span class="p">)</span>
</span><span id="Project-793"><a href="#Project-793"><span class="linenos"> 793</span></a>                <span class="n">training_time</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">minutes</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">seconds</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-794"><a href="#Project-794"><span class="linenos"> 794</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_results</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">logs</span><span class="p">,</span> <span class="n">training_time</span><span class="p">)</span>
</span><span id="Project-795"><a href="#Project-795"><span class="linenos"> 795</span></a>                <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project-796"><a href="#Project-796"><span class="linenos"> 796</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-797"><a href="#Project-797"><span class="linenos"> 797</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-798"><a href="#Project-798"><span class="linenos"> 798</span></a>                <span class="k">return</span> <span class="n">task</span>
</span><span id="Project-799"><a href="#Project-799"><span class="linenos"> 799</span></a>
</span><span id="Project-800"><a href="#Project-800"><span class="linenos"> 800</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Project-801"><a href="#Project-801"><span class="linenos"> 801</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">optuna</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">TrialPruned</span><span class="p">):</span>
</span><span id="Project-802"><a href="#Project-802"><span class="linenos"> 802</span></a>                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="Project-803"><a href="#Project-803"><span class="linenos"> 803</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project-804"><a href="#Project-804"><span class="linenos"> 804</span></a>                    <span class="c1"># if str(e) != f&quot;The {episode_name} episode name is already in use!&quot;:</span>
</span><span id="Project-805"><a href="#Project-805"><span class="linenos"> 805</span></a>                    <span class="c1">#     self.remove_episode(episode_name)</span>
</span><span id="Project-806"><a href="#Project-806"><span class="linenos"> 806</span></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Episode </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> could not run&quot;</span><span class="p">)</span>
</span><span id="Project-807"><a href="#Project-807"><span class="linenos"> 807</span></a>
</span><span id="Project-808"><a href="#Project-808"><span class="linenos"> 808</span></a>    <span class="k">def</span> <span class="nf">run_episodes</span><span class="p">(</span>
</span><span id="Project-809"><a href="#Project-809"><span class="linenos"> 809</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-810"><a href="#Project-810"><span class="linenos"> 810</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-811"><a href="#Project-811"><span class="linenos"> 811</span></a>        <span class="n">load_episodes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-812"><a href="#Project-812"><span class="linenos"> 812</span></a>        <span class="n">parameters_updates</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-813"><a href="#Project-813"><span class="linenos"> 813</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-814"><a href="#Project-814"><span class="linenos"> 814</span></a>        <span class="n">load_searches</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-815"><a href="#Project-815"><span class="linenos"> 815</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-816"><a href="#Project-816"><span class="linenos"> 816</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-817"><a href="#Project-817"><span class="linenos"> 817</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-818"><a href="#Project-818"><span class="linenos"> 818</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-819"><a href="#Project-819"><span class="linenos"> 819</span></a>        <span class="n">suppress_name_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-820"><a href="#Project-820"><span class="linenos"> 820</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-821"><a href="#Project-821"><span class="linenos"> 821</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskDispatcher</span><span class="p">:</span>
</span><span id="Project-822"><a href="#Project-822"><span class="linenos"> 822</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-823"><a href="#Project-823"><span class="linenos"> 823</span></a><span class="sd">        Run multiple episodes in sequence (and re-use previously loaded information)</span>
</span><span id="Project-824"><a href="#Project-824"><span class="linenos"> 824</span></a>
</span><span id="Project-825"><a href="#Project-825"><span class="linenos"> 825</span></a><span class="sd">        For each episode, the task parameters are read from the config files and then updated with the</span>
</span><span id="Project-826"><a href="#Project-826"><span class="linenos"> 826</span></a><span class="sd">        parameter_update dictionary. The model can be either initialized from scratch or loaded from one of the</span>
</span><span id="Project-827"><a href="#Project-827"><span class="linenos"> 827</span></a><span class="sd">        previous experiments. All parameters and results are saved in the meta files and can be accessed with the</span>
</span><span id="Project-828"><a href="#Project-828"><span class="linenos"> 828</span></a><span class="sd">        list_episodes() function. The train/test/validation split is saved and loaded from a file whenever the</span>
</span><span id="Project-829"><a href="#Project-829"><span class="linenos"> 829</span></a><span class="sd">        same split parameters are used. The pre-computed datasets are also saved and loaded whenever the same</span>
</span><span id="Project-830"><a href="#Project-830"><span class="linenos"> 830</span></a><span class="sd">        data parameters are used.</span>
</span><span id="Project-831"><a href="#Project-831"><span class="linenos"> 831</span></a>
</span><span id="Project-832"><a href="#Project-832"><span class="linenos"> 832</span></a><span class="sd">        Parameters</span>
</span><span id="Project-833"><a href="#Project-833"><span class="linenos"> 833</span></a><span class="sd">        ----------</span>
</span><span id="Project-834"><a href="#Project-834"><span class="linenos"> 834</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project-835"><a href="#Project-835"><span class="linenos"> 835</span></a><span class="sd">            a list of strings of episode names</span>
</span><span id="Project-836"><a href="#Project-836"><span class="linenos"> 836</span></a><span class="sd">        load_episodes : list, optional</span>
</span><span id="Project-837"><a href="#Project-837"><span class="linenos"> 837</span></a><span class="sd">            a list of strings of (previously run) episode names to load the model from; if the episode has multiple runs,</span>
</span><span id="Project-838"><a href="#Project-838"><span class="linenos"> 838</span></a><span class="sd">            the new episode will have the same number of runs, each starting with one of the pre-trained models</span>
</span><span id="Project-839"><a href="#Project-839"><span class="linenos"> 839</span></a><span class="sd">        parameters_updates : list, optional</span>
</span><span id="Project-840"><a href="#Project-840"><span class="linenos"> 840</span></a><span class="sd">            a list of dictionaries used to update the parameters from the config</span>
</span><span id="Project-841"><a href="#Project-841"><span class="linenos"> 841</span></a><span class="sd">        load_epochs : list, optional</span>
</span><span id="Project-842"><a href="#Project-842"><span class="linenos"> 842</span></a><span class="sd">            a list of integers used to specify the epoch to load (if load_episodes is not None)</span>
</span><span id="Project-843"><a href="#Project-843"><span class="linenos"> 843</span></a><span class="sd">        load_searches : list, optional</span>
</span><span id="Project-844"><a href="#Project-844"><span class="linenos"> 844</span></a><span class="sd">            a list of strings of hyperparameter search results to load</span>
</span><span id="Project-845"><a href="#Project-845"><span class="linenos"> 845</span></a><span class="sd">        load_parameters : list, optional</span>
</span><span id="Project-846"><a href="#Project-846"><span class="linenos"> 846</span></a><span class="sd">            a list of lists of string names of the parameters to load from the searches</span>
</span><span id="Project-847"><a href="#Project-847"><span class="linenos"> 847</span></a><span class="sd">        round_to_binary : list, optional</span>
</span><span id="Project-848"><a href="#Project-848"><span class="linenos"> 848</span></a><span class="sd">            a list of string names of the loaded parameters that should be rounded to the nearest power of two</span>
</span><span id="Project-849"><a href="#Project-849"><span class="linenos"> 849</span></a><span class="sd">        load_strict : list, optional</span>
</span><span id="Project-850"><a href="#Project-850"><span class="linenos"> 850</span></a><span class="sd">            a list of boolean values specifying weight loading policy: if `False`, matching weights will be loaded from</span>
</span><span id="Project-851"><a href="#Project-851"><span class="linenos"> 851</span></a><span class="sd">            the corresponding episode and differences in parameter name lists and</span>
</span><span id="Project-852"><a href="#Project-852"><span class="linenos"> 852</span></a><span class="sd">            weight shapes will be ignored; otherwise mismatches will prompt a `RuntimeError` (by default `True` for</span>
</span><span id="Project-853"><a href="#Project-853"><span class="linenos"> 853</span></a><span class="sd">            every episode)</span>
</span><span id="Project-854"><a href="#Project-854"><span class="linenos"> 854</span></a><span class="sd">        force : bool, default False</span>
</span><span id="Project-855"><a href="#Project-855"><span class="linenos"> 855</span></a><span class="sd">            if `True` and an episode name is already taken, it will be overwritten (use with caution!)</span>
</span><span id="Project-856"><a href="#Project-856"><span class="linenos"> 856</span></a><span class="sd">        suppress_name_check : bool, default False</span>
</span><span id="Project-857"><a href="#Project-857"><span class="linenos"> 857</span></a><span class="sd">            if `True`, episode names with a double colon are allowed (please don&#39;t use this option unless you understand</span>
</span><span id="Project-858"><a href="#Project-858"><span class="linenos"> 858</span></a><span class="sd">            why they are usually forbidden)</span>
</span><span id="Project-859"><a href="#Project-859"><span class="linenos"> 859</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project-860"><a href="#Project-860"><span class="linenos"> 860</span></a><span class="sd">            if `True`, the dataset will be deleted after training</span>
</span><span id="Project-861"><a href="#Project-861"><span class="linenos"> 861</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-862"><a href="#Project-862"><span class="linenos"> 862</span></a>
</span><span id="Project-863"><a href="#Project-863"><span class="linenos"> 863</span></a>        <span class="n">task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-864"><a href="#Project-864"><span class="linenos"> 864</span></a>        <span class="k">if</span> <span class="n">load_searches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-865"><a href="#Project-865"><span class="linenos"> 865</span></a>            <span class="n">load_searches</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project-866"><a href="#Project-866"><span class="linenos"> 866</span></a>        <span class="k">if</span> <span class="n">load_episodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-867"><a href="#Project-867"><span class="linenos"> 867</span></a>            <span class="n">load_episodes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project-868"><a href="#Project-868"><span class="linenos"> 868</span></a>        <span class="k">if</span> <span class="n">parameters_updates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-869"><a href="#Project-869"><span class="linenos"> 869</span></a>            <span class="n">parameters_updates</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project-870"><a href="#Project-870"><span class="linenos"> 870</span></a>        <span class="k">if</span> <span class="n">load_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-871"><a href="#Project-871"><span class="linenos"> 871</span></a>            <span class="n">load_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project-872"><a href="#Project-872"><span class="linenos"> 872</span></a>        <span class="k">if</span> <span class="n">load_epochs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-873"><a href="#Project-873"><span class="linenos"> 873</span></a>            <span class="n">load_epochs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project-874"><a href="#Project-874"><span class="linenos"> 874</span></a>        <span class="k">if</span> <span class="n">load_strict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-875"><a href="#Project-875"><span class="linenos"> 875</span></a>            <span class="n">load_strict</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project-876"><a href="#Project-876"><span class="linenos"> 876</span></a>        <span class="k">for</span> <span class="p">(</span>
</span><span id="Project-877"><a href="#Project-877"><span class="linenos"> 877</span></a>            <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-878"><a href="#Project-878"><span class="linenos"> 878</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-879"><a href="#Project-879"><span class="linenos"> 879</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-880"><a href="#Project-880"><span class="linenos"> 880</span></a>            <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-881"><a href="#Project-881"><span class="linenos"> 881</span></a>            <span class="n">load_search</span><span class="p">,</span>
</span><span id="Project-882"><a href="#Project-882"><span class="linenos"> 882</span></a>            <span class="n">load_parameters_list</span><span class="p">,</span>
</span><span id="Project-883"><a href="#Project-883"><span class="linenos"> 883</span></a>            <span class="n">load_strict_value</span><span class="p">,</span>
</span><span id="Project-884"><a href="#Project-884"><span class="linenos"> 884</span></a>        <span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Project-885"><a href="#Project-885"><span class="linenos"> 885</span></a>            <span class="n">parameters_updates</span><span class="p">,</span>
</span><span id="Project-886"><a href="#Project-886"><span class="linenos"> 886</span></a>            <span class="n">episode_names</span><span class="p">,</span>
</span><span id="Project-887"><a href="#Project-887"><span class="linenos"> 887</span></a>            <span class="n">load_episodes</span><span class="p">,</span>
</span><span id="Project-888"><a href="#Project-888"><span class="linenos"> 888</span></a>            <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project-889"><a href="#Project-889"><span class="linenos"> 889</span></a>            <span class="n">load_searches</span><span class="p">,</span>
</span><span id="Project-890"><a href="#Project-890"><span class="linenos"> 890</span></a>            <span class="n">load_parameters</span><span class="p">,</span>
</span><span id="Project-891"><a href="#Project-891"><span class="linenos"> 891</span></a>            <span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project-892"><a href="#Project-892"><span class="linenos"> 892</span></a>        <span class="p">):</span>
</span><span id="Project-893"><a href="#Project-893"><span class="linenos"> 893</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_episode</span><span class="p">(</span>
</span><span id="Project-894"><a href="#Project-894"><span class="linenos"> 894</span></a>                <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-895"><a href="#Project-895"><span class="linenos"> 895</span></a>                <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-896"><a href="#Project-896"><span class="linenos"> 896</span></a>                <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-897"><a href="#Project-897"><span class="linenos"> 897</span></a>                <span class="n">task</span><span class="p">,</span>
</span><span id="Project-898"><a href="#Project-898"><span class="linenos"> 898</span></a>                <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-899"><a href="#Project-899"><span class="linenos"> 899</span></a>                <span class="n">load_search</span><span class="p">,</span>
</span><span id="Project-900"><a href="#Project-900"><span class="linenos"> 900</span></a>                <span class="n">load_parameters_list</span><span class="p">,</span>
</span><span id="Project-901"><a href="#Project-901"><span class="linenos"> 901</span></a>                <span class="n">round_to_binary</span><span class="p">,</span>
</span><span id="Project-902"><a href="#Project-902"><span class="linenos"> 902</span></a>                <span class="n">load_strict_value</span><span class="p">,</span>
</span><span id="Project-903"><a href="#Project-903"><span class="linenos"> 903</span></a>                <span class="n">suppress_name_check</span><span class="o">=</span><span class="n">suppress_name_check</span><span class="p">,</span>
</span><span id="Project-904"><a href="#Project-904"><span class="linenos"> 904</span></a>                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="Project-905"><a href="#Project-905"><span class="linenos"> 905</span></a>                <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="Project-906"><a href="#Project-906"><span class="linenos"> 906</span></a>            <span class="p">)</span>
</span><span id="Project-907"><a href="#Project-907"><span class="linenos"> 907</span></a>        <span class="k">return</span> <span class="n">task</span>
</span><span id="Project-908"><a href="#Project-908"><span class="linenos"> 908</span></a>
</span><span id="Project-909"><a href="#Project-909"><span class="linenos"> 909</span></a>    <span class="k">def</span> <span class="nf">continue_episode</span><span class="p">(</span>
</span><span id="Project-910"><a href="#Project-910"><span class="linenos"> 910</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-911"><a href="#Project-911"><span class="linenos"> 911</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-912"><a href="#Project-912"><span class="linenos"> 912</span></a>        <span class="n">num_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-913"><a href="#Project-913"><span class="linenos"> 913</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-914"><a href="#Project-914"><span class="linenos"> 914</span></a>        <span class="n">n_seeds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project-915"><a href="#Project-915"><span class="linenos"> 915</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-916"><a href="#Project-916"><span class="linenos"> 916</span></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
</span><span id="Project-917"><a href="#Project-917"><span class="linenos"> 917</span></a>        <span class="n">num_cpus</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-918"><a href="#Project-918"><span class="linenos"> 918</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskDispatcher</span><span class="p">:</span>
</span><span id="Project-919"><a href="#Project-919"><span class="linenos"> 919</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-920"><a href="#Project-920"><span class="linenos"> 920</span></a><span class="sd">        Load an older episode and continue running from the latest checkpoint</span>
</span><span id="Project-921"><a href="#Project-921"><span class="linenos"> 921</span></a>
</span><span id="Project-922"><a href="#Project-922"><span class="linenos"> 922</span></a><span class="sd">        All parameters as well as the model and optimizer state dictionaries are loaded from the episode.</span>
</span><span id="Project-923"><a href="#Project-923"><span class="linenos"> 923</span></a>
</span><span id="Project-924"><a href="#Project-924"><span class="linenos"> 924</span></a><span class="sd">        Parameters</span>
</span><span id="Project-925"><a href="#Project-925"><span class="linenos"> 925</span></a><span class="sd">        ----------</span>
</span><span id="Project-926"><a href="#Project-926"><span class="linenos"> 926</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project-927"><a href="#Project-927"><span class="linenos"> 927</span></a><span class="sd">            the name of the episode to continue</span>
</span><span id="Project-928"><a href="#Project-928"><span class="linenos"> 928</span></a><span class="sd">        num_epochs : int, optional</span>
</span><span id="Project-929"><a href="#Project-929"><span class="linenos"> 929</span></a><span class="sd">            the new number of epochs</span>
</span><span id="Project-930"><a href="#Project-930"><span class="linenos"> 930</span></a><span class="sd">        task : TaskDispatcher, optional</span>
</span><span id="Project-931"><a href="#Project-931"><span class="linenos"> 931</span></a><span class="sd">            a pre-existing task; if provided, the method will update the task instead of creating a new one</span>
</span><span id="Project-932"><a href="#Project-932"><span class="linenos"> 932</span></a><span class="sd">            (this might save time, mainly on dataset loading)</span>
</span><span id="Project-933"><a href="#Project-933"><span class="linenos"> 933</span></a><span class="sd">        result_average_interval : int, default 5</span>
</span><span id="Project-934"><a href="#Project-934"><span class="linenos"> 934</span></a><span class="sd">            the metric are averaged over the last result_average_interval to be stored in the episodes meta file</span>
</span><span id="Project-935"><a href="#Project-935"><span class="linenos"> 935</span></a><span class="sd">            and displayed by list_episodes() function (the full log is still always available)</span>
</span><span id="Project-936"><a href="#Project-936"><span class="linenos"> 936</span></a><span class="sd">        n_seeds : int, default 1</span>
</span><span id="Project-937"><a href="#Project-937"><span class="linenos"> 937</span></a><span class="sd">            the number of runs to perform; if `n_seeds &gt; 1`, the episodes will be named `episode_name#run_index`, e.g.</span>
</span><span id="Project-938"><a href="#Project-938"><span class="linenos"> 938</span></a><span class="sd">            `test_episode#0` and `test_episode#1`</span>
</span><span id="Project-939"><a href="#Project-939"><span class="linenos"> 939</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project-940"><a href="#Project-940"><span class="linenos"> 940</span></a><span class="sd">            if `True`, pre-computed features will be deleted after the run</span>
</span><span id="Project-941"><a href="#Project-941"><span class="linenos"> 941</span></a><span class="sd">        device : str, default &quot;cuda&quot;</span>
</span><span id="Project-942"><a href="#Project-942"><span class="linenos"> 942</span></a><span class="sd">            the torch device to use</span>
</span><span id="Project-943"><a href="#Project-943"><span class="linenos"> 943</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-944"><a href="#Project-944"><span class="linenos"> 944</span></a>
</span><span id="Project-945"><a href="#Project-945"><span class="linenos"> 945</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-946"><a href="#Project-946"><span class="linenos"> 946</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project-947"><a href="#Project-947"><span class="linenos"> 947</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAINING </span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-948"><a href="#Project-948"><span class="linenos"> 948</span></a>            <span class="k">if</span> <span class="n">num_epochs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">unfinished</span><span class="p">():</span>
</span><span id="Project-949"><a href="#Project-949"><span class="linenos"> 949</span></a>                <span class="k">continue</span>
</span><span id="Project-950"><a href="#Project-950"><span class="linenos"> 950</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project-951"><a href="#Project-951"><span class="linenos"> 951</span></a>                <span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="Project-952"><a href="#Project-952"><span class="linenos"> 952</span></a>                    <span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="n">num_epochs</span><span class="p">,</span>
</span><span id="Project-953"><a href="#Project-953"><span class="linenos"> 953</span></a>                    <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span>
</span><span id="Project-954"><a href="#Project-954"><span class="linenos"> 954</span></a>                <span class="p">},</span>
</span><span id="Project-955"><a href="#Project-955"><span class="linenos"> 955</span></a>                <span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;num_cpus&quot;</span><span class="p">:</span> <span class="n">num_cpus</span><span class="p">},</span>
</span><span id="Project-956"><a href="#Project-956"><span class="linenos"> 956</span></a>            <span class="p">}</span>
</span><span id="Project-957"><a href="#Project-957"><span class="linenos"> 957</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="Project-958"><a href="#Project-958"><span class="linenos"> 958</span></a>                <span class="n">run</span><span class="p">,</span>
</span><span id="Project-959"><a href="#Project-959"><span class="linenos"> 959</span></a>                <span class="n">load_episode</span><span class="o">=</span><span class="n">run</span><span class="p">,</span>
</span><span id="Project-960"><a href="#Project-960"><span class="linenos"> 960</span></a>                <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-961"><a href="#Project-961"><span class="linenos"> 961</span></a>                <span class="n">continuing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-962"><a href="#Project-962"><span class="linenos"> 962</span></a>                <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project-963"><a href="#Project-963"><span class="linenos"> 963</span></a>            <span class="p">)</span>
</span><span id="Project-964"><a href="#Project-964"><span class="linenos"> 964</span></a>            <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Project-965"><a href="#Project-965"><span class="linenos"> 965</span></a>            <span class="n">logs</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="Project-966"><a href="#Project-966"><span class="linenos"> 966</span></a>            <span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Project-967"><a href="#Project-967"><span class="linenos"> 967</span></a>            <span class="n">old_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_training_time</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="Project-968"><a href="#Project-968"><span class="linenos"> 968</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">old_time</span><span class="p">):</span>
</span><span id="Project-969"><a href="#Project-969"><span class="linenos"> 969</span></a>                <span class="n">time_end</span> <span class="o">+=</span> <span class="n">old_time</span>
</span><span id="Project-970"><a href="#Project-970"><span class="linenos"> 970</span></a>                <span class="n">time_total</span> <span class="o">=</span> <span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span>
</span><span id="Project-971"><a href="#Project-971"><span class="linenos"> 971</span></a>                <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span>
</span><span id="Project-972"><a href="#Project-972"><span class="linenos"> 972</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span>
</span><span id="Project-973"><a href="#Project-973"><span class="linenos"> 973</span></a>                <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="Project-974"><a href="#Project-974"><span class="linenos"> 974</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>
</span><span id="Project-975"><a href="#Project-975"><span class="linenos"> 975</span></a>                <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span><span class="p">)</span>
</span><span id="Project-976"><a href="#Project-976"><span class="linenos"> 976</span></a>                <span class="n">training_time</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">minutes</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">seconds</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-977"><a href="#Project-977"><span class="linenos"> 977</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-978"><a href="#Project-978"><span class="linenos"> 978</span></a>                <span class="n">training_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Project-979"><a href="#Project-979"><span class="linenos"> 979</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_episode</span><span class="p">(</span>
</span><span id="Project-980"><a href="#Project-980"><span class="linenos"> 980</span></a>                <span class="n">run</span><span class="p">,</span>
</span><span id="Project-981"><a href="#Project-981"><span class="linenos"> 981</span></a>                <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-982"><a href="#Project-982"><span class="linenos"> 982</span></a>                <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">(),</span>
</span><span id="Project-983"><a href="#Project-983"><span class="linenos"> 983</span></a>                <span class="n">suppress_validation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-984"><a href="#Project-984"><span class="linenos"> 984</span></a>                <span class="n">training_time</span><span class="o">=</span><span class="n">training_time</span><span class="p">,</span>
</span><span id="Project-985"><a href="#Project-985"><span class="linenos"> 985</span></a>                <span class="n">norm_stats</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">get_normalization_stats</span><span class="p">(),</span>
</span><span id="Project-986"><a href="#Project-986"><span class="linenos"> 986</span></a>            <span class="p">)</span>
</span><span id="Project-987"><a href="#Project-987"><span class="linenos"> 987</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_results</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">logs</span><span class="p">)</span>
</span><span id="Project-988"><a href="#Project-988"><span class="linenos"> 988</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-989"><a href="#Project-989"><span class="linenos"> 989</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_seeds</span><span class="p">:</span>
</span><span id="Project-990"><a href="#Project-990"><span class="linenos"> 990</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">),</span> <span class="n">n_seeds</span><span class="p">):</span>
</span><span id="Project-991"><a href="#Project-991"><span class="linenos"> 991</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">run_episode</span><span class="p">(</span>
</span><span id="Project-992"><a href="#Project-992"><span class="linenos"> 992</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Project-993"><a href="#Project-993"><span class="linenos"> 993</span></a>                    <span class="n">parameters_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="Project-994"><a href="#Project-994"><span class="linenos"> 994</span></a>                    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project-995"><a href="#Project-995"><span class="linenos"> 995</span></a>                    <span class="n">suppress_name_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-996"><a href="#Project-996"><span class="linenos"> 996</span></a>                <span class="p">)</span>
</span><span id="Project-997"><a href="#Project-997"><span class="linenos"> 997</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project-998"><a href="#Project-998"><span class="linenos"> 998</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-999"><a href="#Project-999"><span class="linenos"> 999</span></a>        <span class="k">return</span> <span class="n">task</span>
</span><span id="Project-1000"><a href="#Project-1000"><span class="linenos">1000</span></a>
</span><span id="Project-1001"><a href="#Project-1001"><span class="linenos">1001</span></a>    <span class="k">def</span> <span class="nf">run_default_hyperparameter_search</span><span class="p">(</span>
</span><span id="Project-1002"><a href="#Project-1002"><span class="linenos">1002</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1003"><a href="#Project-1003"><span class="linenos">1003</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-1004"><a href="#Project-1004"><span class="linenos">1004</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1005"><a href="#Project-1005"><span class="linenos">1005</span></a>        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
</span><span id="Project-1006"><a href="#Project-1006"><span class="linenos">1006</span></a>        <span class="n">best_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="Project-1007"><a href="#Project-1007"><span class="linenos">1007</span></a>        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;maximize&quot;</span><span class="p">,</span>
</span><span id="Project-1008"><a href="#Project-1008"><span class="linenos">1008</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1009"><a href="#Project-1009"><span class="linenos">1009</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1010"><a href="#Project-1010"><span class="linenos">1010</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-1011"><a href="#Project-1011"><span class="linenos">1011</span></a>        <span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-1012"><a href="#Project-1012"><span class="linenos">1012</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1013"><a href="#Project-1013"><span class="linenos">1013</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1014"><a href="#Project-1014"><span class="linenos">1014</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project-1015"><a href="#Project-1015"><span class="linenos">1015</span></a>        <span class="n">num_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="Project-1016"><a href="#Project-1016"><span class="linenos">1016</span></a>        <span class="n">test_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project-1017"><a href="#Project-1017"><span class="linenos">1017</span></a>        <span class="n">n_trials</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
</span><span id="Project-1018"><a href="#Project-1018"><span class="linenos">1018</span></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1019"><a href="#Project-1019"><span class="linenos">1019</span></a>    <span class="p">):</span>
</span><span id="Project-1020"><a href="#Project-1020"><span class="linenos">1020</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-1021"><a href="#Project-1021"><span class="linenos">1021</span></a><span class="sd">        Run an optuna hyperparameter search with default parameters for a model</span>
</span><span id="Project-1022"><a href="#Project-1022"><span class="linenos">1022</span></a>
</span><span id="Project-1023"><a href="#Project-1023"><span class="linenos">1023</span></a><span class="sd">        For the vast majority of cases, optimizing the default parameters should be enough.</span>
</span><span id="Project-1024"><a href="#Project-1024"><span class="linenos">1024</span></a><span class="sd">        Check out `dlc2action.options.model_hyperparameters` for the lists of parameters.</span>
</span><span id="Project-1025"><a href="#Project-1025"><span class="linenos">1025</span></a><span class="sd">        There are also options to set overlap, test fraction and number of epochs parameters for the search without</span>
</span><span id="Project-1026"><a href="#Project-1026"><span class="linenos">1026</span></a><span class="sd">        modifying the project config files. However, if you want something more complex, look into</span>
</span><span id="Project-1027"><a href="#Project-1027"><span class="linenos">1027</span></a><span class="sd">        `Project.run_hyperparameter_search`.</span>
</span><span id="Project-1028"><a href="#Project-1028"><span class="linenos">1028</span></a>
</span><span id="Project-1029"><a href="#Project-1029"><span class="linenos">1029</span></a><span class="sd">        The task parameters are read from the config files and updated with the parameters_update dictionary.</span>
</span><span id="Project-1030"><a href="#Project-1030"><span class="linenos">1030</span></a><span class="sd">        The model can be either initialized from scratch or loaded from a previously run episode.</span>
</span><span id="Project-1031"><a href="#Project-1031"><span class="linenos">1031</span></a><span class="sd">        For each trial, the objective metric is averaged over a few best epochs.</span>
</span><span id="Project-1032"><a href="#Project-1032"><span class="linenos">1032</span></a>
</span><span id="Project-1033"><a href="#Project-1033"><span class="linenos">1033</span></a><span class="sd">        Parameters</span>
</span><span id="Project-1034"><a href="#Project-1034"><span class="linenos">1034</span></a><span class="sd">        ----------</span>
</span><span id="Project-1035"><a href="#Project-1035"><span class="linenos">1035</span></a><span class="sd">        search_name : str</span>
</span><span id="Project-1036"><a href="#Project-1036"><span class="linenos">1036</span></a><span class="sd">            the name of the search to store it in the meta files and load in run_episode</span>
</span><span id="Project-1037"><a href="#Project-1037"><span class="linenos">1037</span></a><span class="sd">        model_name : str, optional</span>
</span><span id="Project-1038"><a href="#Project-1038"><span class="linenos">1038</span></a><span class="sd">            the name of the model (by default loaded from the project settings, see `project.help(&#39;models&#39;)` for options)</span>
</span><span id="Project-1039"><a href="#Project-1039"><span class="linenos">1039</span></a><span class="sd">        metric : str, default f1</span>
</span><span id="Project-1040"><a href="#Project-1040"><span class="linenos">1040</span></a><span class="sd">            the metric to maximize/minimize (see direction); if the metric has an `&quot;average&quot;` parameter and it is set to</span>
</span><span id="Project-1041"><a href="#Project-1041"><span class="linenos">1041</span></a><span class="sd">            `&quot;none&quot;` in the config files, it will be reset to `&quot;macro&quot;` for the search; see `project.help(&#39;metrics&#39;)` for options</span>
</span><span id="Project-1042"><a href="#Project-1042"><span class="linenos">1042</span></a><span class="sd">        n_trials : int, default 20</span>
</span><span id="Project-1043"><a href="#Project-1043"><span class="linenos">1043</span></a><span class="sd">            the number of optimization trials to run</span>
</span><span id="Project-1044"><a href="#Project-1044"><span class="linenos">1044</span></a><span class="sd">        best_n : int, default 1</span>
</span><span id="Project-1045"><a href="#Project-1045"><span class="linenos">1045</span></a><span class="sd">            the number of epochs to average the metric; if 0, the last value is taken</span>
</span><span id="Project-1046"><a href="#Project-1046"><span class="linenos">1046</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-1047"><a href="#Project-1047"><span class="linenos">1047</span></a><span class="sd">            the parameters update dictionary</span>
</span><span id="Project-1048"><a href="#Project-1048"><span class="linenos">1048</span></a><span class="sd">        direction : {&#39;maximize&#39;, &#39;minimize&#39;}</span>
</span><span id="Project-1049"><a href="#Project-1049"><span class="linenos">1049</span></a><span class="sd">            optimization direction</span>
</span><span id="Project-1050"><a href="#Project-1050"><span class="linenos">1050</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="Project-1051"><a href="#Project-1051"><span class="linenos">1051</span></a><span class="sd">            the name of the episode to load the model from</span>
</span><span id="Project-1052"><a href="#Project-1052"><span class="linenos">1052</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="Project-1053"><a href="#Project-1053"><span class="linenos">1053</span></a><span class="sd">            the epoch to load the model from (if not provided, the last checkpoint is used)</span>
</span><span id="Project-1054"><a href="#Project-1054"><span class="linenos">1054</span></a><span class="sd">        prune : bool, default False</span>
</span><span id="Project-1055"><a href="#Project-1055"><span class="linenos">1055</span></a><span class="sd">            if `True`, experiments where the optimized metric is improving too slowly will be terminated</span>
</span><span id="Project-1056"><a href="#Project-1056"><span class="linenos">1056</span></a><span class="sd">            (with optuna HyperBand pruner)</span>
</span><span id="Project-1057"><a href="#Project-1057"><span class="linenos">1057</span></a><span class="sd">        force : bool, default False</span>
</span><span id="Project-1058"><a href="#Project-1058"><span class="linenos">1058</span></a><span class="sd">            if `True`, existing searches with the same name will be overwritten</span>
</span><span id="Project-1059"><a href="#Project-1059"><span class="linenos">1059</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project-1060"><a href="#Project-1060"><span class="linenos">1060</span></a><span class="sd">            if `True`, pre-computed features will be deleted after each run (if the data parameters change)</span>
</span><span id="Project-1061"><a href="#Project-1061"><span class="linenos">1061</span></a><span class="sd">        device : str, optional</span>
</span><span id="Project-1062"><a href="#Project-1062"><span class="linenos">1062</span></a><span class="sd">            cuda:{i} or cpu, if not given it is read from the default parameters</span>
</span><span id="Project-1063"><a href="#Project-1063"><span class="linenos">1063</span></a>
</span><span id="Project-1064"><a href="#Project-1064"><span class="linenos">1064</span></a><span class="sd">        Returns</span>
</span><span id="Project-1065"><a href="#Project-1065"><span class="linenos">1065</span></a><span class="sd">        -------</span>
</span><span id="Project-1066"><a href="#Project-1066"><span class="linenos">1066</span></a><span class="sd">        dict</span>
</span><span id="Project-1067"><a href="#Project-1067"><span class="linenos">1067</span></a><span class="sd">            a dictionary of best parameters</span>
</span><span id="Project-1068"><a href="#Project-1068"><span class="linenos">1068</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-1069"><a href="#Project-1069"><span class="linenos">1069</span></a>
</span><span id="Project-1070"><a href="#Project-1070"><span class="linenos">1070</span></a>        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1071"><a href="#Project-1071"><span class="linenos">1071</span></a>            <span class="n">model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="Project-1072"><a href="#Project-1072"><span class="linenos">1072</span></a>        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">model_hyperparameters</span><span class="p">:</span>
</span><span id="Project-1073"><a href="#Project-1073"><span class="linenos">1073</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-1074"><a href="#Project-1074"><span class="linenos">1074</span></a>                <span class="sa">f</span><span class="s2">&quot;There is no default search space for </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">! Please choose from </span><span class="si">{</span><span class="n">options</span><span class="o">.</span><span class="n">model_hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2"> or try project.run_hyperparameter_search()&quot;</span>
</span><span id="Project-1075"><a href="#Project-1075"><span class="linenos">1075</span></a>            <span class="p">)</span>
</span><span id="Project-1076"><a href="#Project-1076"><span class="linenos">1076</span></a>        <span class="n">pars</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project-1077"><a href="#Project-1077"><span class="linenos">1077</span></a>            <span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="Project-1078"><a href="#Project-1078"><span class="linenos">1078</span></a>                <span class="s2">&quot;overlap&quot;</span><span class="p">:</span> <span class="n">overlap</span><span class="p">,</span>
</span><span id="Project-1079"><a href="#Project-1079"><span class="linenos">1079</span></a>                <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
</span><span id="Project-1080"><a href="#Project-1080"><span class="linenos">1080</span></a>                <span class="s2">&quot;metric_functions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">metric</span><span class="p">},</span>
</span><span id="Project-1081"><a href="#Project-1081"><span class="linenos">1081</span></a>            <span class="p">},</span>
</span><span id="Project-1082"><a href="#Project-1082"><span class="linenos">1082</span></a>            <span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="n">num_epochs</span><span class="p">},</span>
</span><span id="Project-1083"><a href="#Project-1083"><span class="linenos">1083</span></a>        <span class="p">}</span>
</span><span id="Project-1084"><a href="#Project-1084"><span class="linenos">1084</span></a>        <span class="k">if</span> <span class="n">test_frac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1085"><a href="#Project-1085"><span class="linenos">1085</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;test_frac&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_frac</span>
</span><span id="Project-1086"><a href="#Project-1086"><span class="linenos">1086</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">metric</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
</span><span id="Project-1087"><a href="#Project-1087"><span class="linenos">1087</span></a>            <span class="n">project_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="Project-1088"><a href="#Project-1088"><span class="linenos">1088</span></a>            <span class="k">if</span> <span class="n">project_pars</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;average&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="Project-1089"><a href="#Project-1089"><span class="linenos">1089</span></a>                <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">metric</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="s2">&quot;macro&quot;</span><span class="p">}}</span>
</span><span id="Project-1090"><a href="#Project-1090"><span class="linenos">1090</span></a>        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1091"><a href="#Project-1091"><span class="linenos">1091</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;device&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="Project-1092"><a href="#Project-1092"><span class="linenos">1092</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_hyperparameter_search</span><span class="p">(</span>
</span><span id="Project-1093"><a href="#Project-1093"><span class="linenos">1093</span></a>            <span class="n">search_name</span><span class="o">=</span><span class="n">search_name</span><span class="p">,</span>
</span><span id="Project-1094"><a href="#Project-1094"><span class="linenos">1094</span></a>            <span class="n">search_space</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">model_hyperparameters</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span>
</span><span id="Project-1095"><a href="#Project-1095"><span class="linenos">1095</span></a>            <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
</span><span id="Project-1096"><a href="#Project-1096"><span class="linenos">1096</span></a>            <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span>
</span><span id="Project-1097"><a href="#Project-1097"><span class="linenos">1097</span></a>            <span class="n">best_n</span><span class="o">=</span><span class="n">best_n</span><span class="p">,</span>
</span><span id="Project-1098"><a href="#Project-1098"><span class="linenos">1098</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">pars</span><span class="p">,</span>
</span><span id="Project-1099"><a href="#Project-1099"><span class="linenos">1099</span></a>            <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
</span><span id="Project-1100"><a href="#Project-1100"><span class="linenos">1100</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-1101"><a href="#Project-1101"><span class="linenos">1101</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-1102"><a href="#Project-1102"><span class="linenos">1102</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project-1103"><a href="#Project-1103"><span class="linenos">1103</span></a>            <span class="n">prune</span><span class="o">=</span><span class="n">prune</span><span class="p">,</span>
</span><span id="Project-1104"><a href="#Project-1104"><span class="linenos">1104</span></a>            <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="Project-1105"><a href="#Project-1105"><span class="linenos">1105</span></a>            <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="Project-1106"><a href="#Project-1106"><span class="linenos">1106</span></a>        <span class="p">)</span>
</span><span id="Project-1107"><a href="#Project-1107"><span class="linenos">1107</span></a>
</span><span id="Project-1108"><a href="#Project-1108"><span class="linenos">1108</span></a>    <span class="k">def</span> <span class="nf">run_hyperparameter_search</span><span class="p">(</span>
</span><span id="Project-1109"><a href="#Project-1109"><span class="linenos">1109</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1110"><a href="#Project-1110"><span class="linenos">1110</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-1111"><a href="#Project-1111"><span class="linenos">1111</span></a>        <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-1112"><a href="#Project-1112"><span class="linenos">1112</span></a>        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
</span><span id="Project-1113"><a href="#Project-1113"><span class="linenos">1113</span></a>        <span class="n">n_trials</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="Project-1114"><a href="#Project-1114"><span class="linenos">1114</span></a>        <span class="n">best_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project-1115"><a href="#Project-1115"><span class="linenos">1115</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1116"><a href="#Project-1116"><span class="linenos">1116</span></a>        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;maximize&quot;</span><span class="p">,</span>
</span><span id="Project-1117"><a href="#Project-1117"><span class="linenos">1117</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1118"><a href="#Project-1118"><span class="linenos">1118</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1119"><a href="#Project-1119"><span class="linenos">1119</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-1120"><a href="#Project-1120"><span class="linenos">1120</span></a>        <span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1121"><a href="#Project-1121"><span class="linenos">1121</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1122"><a href="#Project-1122"><span class="linenos">1122</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1123"><a href="#Project-1123"><span class="linenos">1123</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-1124"><a href="#Project-1124"><span class="linenos">1124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-1125"><a href="#Project-1125"><span class="linenos">1125</span></a><span class="sd">        Run an optuna hyperparameter search</span>
</span><span id="Project-1126"><a href="#Project-1126"><span class="linenos">1126</span></a>
</span><span id="Project-1127"><a href="#Project-1127"><span class="linenos">1127</span></a><span class="sd">        For a simpler function that fits most use cases, check out `Project.run_default_hyperparameter_search()`.</span>
</span><span id="Project-1128"><a href="#Project-1128"><span class="linenos">1128</span></a>
</span><span id="Project-1129"><a href="#Project-1129"><span class="linenos">1129</span></a><span class="sd">        To use a default search space with this method, import `dlc2action.options.model_hyperparameters`. It is</span>
</span><span id="Project-1130"><a href="#Project-1130"><span class="linenos">1130</span></a><span class="sd">        a dictionary where keys are model names and values are default search spaces.</span>
</span><span id="Project-1131"><a href="#Project-1131"><span class="linenos">1131</span></a>
</span><span id="Project-1132"><a href="#Project-1132"><span class="linenos">1132</span></a><span class="sd">        The task parameters are read from the config files and updated with the parameters_update dictionary.</span>
</span><span id="Project-1133"><a href="#Project-1133"><span class="linenos">1133</span></a><span class="sd">        The model can be either initialized from scratch or loaded from a previously run episode.</span>
</span><span id="Project-1134"><a href="#Project-1134"><span class="linenos">1134</span></a><span class="sd">        For each trial, the objective metric is averaged over a few best epochs.</span>
</span><span id="Project-1135"><a href="#Project-1135"><span class="linenos">1135</span></a>
</span><span id="Project-1136"><a href="#Project-1136"><span class="linenos">1136</span></a><span class="sd">        Parameters</span>
</span><span id="Project-1137"><a href="#Project-1137"><span class="linenos">1137</span></a><span class="sd">        ----------</span>
</span><span id="Project-1138"><a href="#Project-1138"><span class="linenos">1138</span></a><span class="sd">        search_name : str</span>
</span><span id="Project-1139"><a href="#Project-1139"><span class="linenos">1139</span></a><span class="sd">            the name of the search to store it in the meta files and load in run_episode</span>
</span><span id="Project-1140"><a href="#Project-1140"><span class="linenos">1140</span></a><span class="sd">        search_space : dict</span>
</span><span id="Project-1141"><a href="#Project-1141"><span class="linenos">1141</span></a><span class="sd">            a dictionary representing the search space; of this general structure:</span>
</span><span id="Project-1142"><a href="#Project-1142"><span class="linenos">1142</span></a><span class="sd">            {&#39;group/param_name&#39;: (&#39;float/int/float_log/int_log&#39;, start, end),</span>
</span><span id="Project-1143"><a href="#Project-1143"><span class="linenos">1143</span></a><span class="sd">            &#39;group/param_name&#39;: (&#39;categorical&#39;, [choices])}, e.g.</span>
</span><span id="Project-1144"><a href="#Project-1144"><span class="linenos">1144</span></a><span class="sd">            {&#39;data/overlap&#39;: (&#39;int&#39;, 5, 100), &#39;training/lr&#39;: (&#39;float_log&#39;, 1e-4, 1e-2),</span>
</span><span id="Project-1145"><a href="#Project-1145"><span class="linenos">1145</span></a><span class="sd">            &#39;data/feature_extraction&#39;: (&#39;categorical&#39;, [&#39;kinematic&#39;, &#39;bones&#39;])};</span>
</span><span id="Project-1146"><a href="#Project-1146"><span class="linenos">1146</span></a><span class="sd">        metric : str, default f1</span>
</span><span id="Project-1147"><a href="#Project-1147"><span class="linenos">1147</span></a><span class="sd">            the metric to maximize/minimize (see direction)</span>
</span><span id="Project-1148"><a href="#Project-1148"><span class="linenos">1148</span></a><span class="sd">        n_trials : int, default 20</span>
</span><span id="Project-1149"><a href="#Project-1149"><span class="linenos">1149</span></a><span class="sd">            the number of optimization trials to run</span>
</span><span id="Project-1150"><a href="#Project-1150"><span class="linenos">1150</span></a><span class="sd">        best_n : int, default 1</span>
</span><span id="Project-1151"><a href="#Project-1151"><span class="linenos">1151</span></a><span class="sd">            the number of epochs to average the metric; if 0, the last value is taken</span>
</span><span id="Project-1152"><a href="#Project-1152"><span class="linenos">1152</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-1153"><a href="#Project-1153"><span class="linenos">1153</span></a><span class="sd">            the parameters update dictionary</span>
</span><span id="Project-1154"><a href="#Project-1154"><span class="linenos">1154</span></a><span class="sd">        direction : {&#39;maximize&#39;, &#39;minimize&#39;}</span>
</span><span id="Project-1155"><a href="#Project-1155"><span class="linenos">1155</span></a><span class="sd">            optimization direction</span>
</span><span id="Project-1156"><a href="#Project-1156"><span class="linenos">1156</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="Project-1157"><a href="#Project-1157"><span class="linenos">1157</span></a><span class="sd">            the name of the episode to load the model from</span>
</span><span id="Project-1158"><a href="#Project-1158"><span class="linenos">1158</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="Project-1159"><a href="#Project-1159"><span class="linenos">1159</span></a><span class="sd">            the epoch to load the model from (if not provided, the last checkpoint is used)</span>
</span><span id="Project-1160"><a href="#Project-1160"><span class="linenos">1160</span></a><span class="sd">        prune : bool, default False</span>
</span><span id="Project-1161"><a href="#Project-1161"><span class="linenos">1161</span></a><span class="sd">            if `True`, experiments where the optimized metric is improving too slowly will be terminated</span>
</span><span id="Project-1162"><a href="#Project-1162"><span class="linenos">1162</span></a><span class="sd">            (with optuna HyperBand pruner)</span>
</span><span id="Project-1163"><a href="#Project-1163"><span class="linenos">1163</span></a><span class="sd">        force : bool, default False</span>
</span><span id="Project-1164"><a href="#Project-1164"><span class="linenos">1164</span></a><span class="sd">            if `True`, existing searches with the same name will be overwritten</span>
</span><span id="Project-1165"><a href="#Project-1165"><span class="linenos">1165</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project-1166"><a href="#Project-1166"><span class="linenos">1166</span></a><span class="sd">            if `True`, pre-computed features will be deleted after each run (if the data parameters change)</span>
</span><span id="Project-1167"><a href="#Project-1167"><span class="linenos">1167</span></a>
</span><span id="Project-1168"><a href="#Project-1168"><span class="linenos">1168</span></a><span class="sd">        Returns</span>
</span><span id="Project-1169"><a href="#Project-1169"><span class="linenos">1169</span></a><span class="sd">        -------</span>
</span><span id="Project-1170"><a href="#Project-1170"><span class="linenos">1170</span></a><span class="sd">        dict</span>
</span><span id="Project-1171"><a href="#Project-1171"><span class="linenos">1171</span></a><span class="sd">            a dictionary of best parameters</span>
</span><span id="Project-1172"><a href="#Project-1172"><span class="linenos">1172</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-1173"><a href="#Project-1173"><span class="linenos">1173</span></a>
</span><span id="Project-1174"><a href="#Project-1174"><span class="linenos">1174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_search_validity</span><span class="p">(</span><span class="n">search_name</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
</span><span id="Project-1175"><a href="#Project-1175"><span class="linenos">1175</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SEARCH </span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1176"><a href="#Project-1176"><span class="linenos">1176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1177"><a href="#Project-1177"><span class="linenos">1177</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1178"><a href="#Project-1178"><span class="linenos">1178</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-1179"><a href="#Project-1179"><span class="linenos">1179</span></a>        <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project-1180"><a href="#Project-1180"><span class="linenos">1180</span></a>            <span class="n">parameters_update</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;metric_functions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">metric</span><span class="p">}}}</span>
</span><span id="Project-1181"><a href="#Project-1181"><span class="linenos">1181</span></a>        <span class="p">)</span>
</span><span id="Project-1182"><a href="#Project-1182"><span class="linenos">1182</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_parameters</span><span class="p">(</span>
</span><span id="Project-1183"><a href="#Project-1183"><span class="linenos">1183</span></a>            <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Project-1184"><a href="#Project-1184"><span class="linenos">1184</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-1185"><a href="#Project-1185"><span class="linenos">1185</span></a>            <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-1186"><a href="#Project-1186"><span class="linenos">1186</span></a>            <span class="n">parameters_update_second</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model_save_path&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}},</span>
</span><span id="Project-1187"><a href="#Project-1187"><span class="linenos">1187</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-1188"><a href="#Project-1188"><span class="linenos">1188</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project-1189"><a href="#Project-1189"><span class="linenos">1189</span></a>        <span class="p">)</span>
</span><span id="Project-1190"><a href="#Project-1190"><span class="linenos">1190</span></a>        <span class="n">task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-1191"><a href="#Project-1191"><span class="linenos">1191</span></a>
</span><span id="Project-1192"><a href="#Project-1192"><span class="linenos">1192</span></a>        <span class="k">if</span> <span class="n">prune</span><span class="p">:</span>
</span><span id="Project-1193"><a href="#Project-1193"><span class="linenos">1193</span></a>            <span class="n">pruner</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">pruners</span><span class="o">.</span><span class="n">HyperbandPruner</span><span class="p">()</span>
</span><span id="Project-1194"><a href="#Project-1194"><span class="linenos">1194</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1195"><a href="#Project-1195"><span class="linenos">1195</span></a>            <span class="n">pruner</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">pruners</span><span class="o">.</span><span class="n">NopPruner</span><span class="p">()</span>
</span><span id="Project-1196"><a href="#Project-1196"><span class="linenos">1196</span></a>        <span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span> <span class="n">pruner</span><span class="o">=</span><span class="n">pruner</span><span class="p">)</span>
</span><span id="Project-1197"><a href="#Project-1197"><span class="linenos">1197</span></a>        <span class="n">runner</span> <span class="o">=</span> <span class="n">_Runner</span><span class="p">(</span>
</span><span id="Project-1198"><a href="#Project-1198"><span class="linenos">1198</span></a>            <span class="n">search_space</span><span class="o">=</span><span class="n">search_space</span><span class="p">,</span>
</span><span id="Project-1199"><a href="#Project-1199"><span class="linenos">1199</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-1200"><a href="#Project-1200"><span class="linenos">1200</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-1201"><a href="#Project-1201"><span class="linenos">1201</span></a>            <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
</span><span id="Project-1202"><a href="#Project-1202"><span class="linenos">1202</span></a>            <span class="n">average</span><span class="o">=</span><span class="n">best_n</span><span class="p">,</span>
</span><span id="Project-1203"><a href="#Project-1203"><span class="linenos">1203</span></a>            <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project-1204"><a href="#Project-1204"><span class="linenos">1204</span></a>            <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="Project-1205"><a href="#Project-1205"><span class="linenos">1205</span></a>            <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1206"><a href="#Project-1206"><span class="linenos">1206</span></a>            <span class="n">search_name</span><span class="o">=</span><span class="n">search_name</span><span class="p">,</span>
</span><span id="Project-1207"><a href="#Project-1207"><span class="linenos">1207</span></a>        <span class="p">)</span>
</span><span id="Project-1208"><a href="#Project-1208"><span class="linenos">1208</span></a>        <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">parameters</span><span class="p">),</span> <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">)</span>
</span><span id="Project-1209"><a href="#Project-1209"><span class="linenos">1209</span></a>        <span class="n">search_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_path</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="Project-1210"><a href="#Project-1210"><span class="linenos">1210</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">search_path</span><span class="p">)</span>
</span><span id="Project-1211"><a href="#Project-1211"><span class="linenos">1211</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_contour</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
</span><span id="Project-1212"><a href="#Project-1212"><span class="linenos">1212</span></a>        <span class="n">plotly</span><span class="o">.</span><span class="n">offline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Project-1213"><a href="#Project-1213"><span class="linenos">1213</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">_contour.html&quot;</span><span class="p">)</span>
</span><span id="Project-1214"><a href="#Project-1214"><span class="linenos">1214</span></a>        <span class="p">)</span>
</span><span id="Project-1215"><a href="#Project-1215"><span class="linenos">1215</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_param_importances</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
</span><span id="Project-1216"><a href="#Project-1216"><span class="linenos">1216</span></a>        <span class="n">plotly</span><span class="o">.</span><span class="n">offline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Project-1217"><a href="#Project-1217"><span class="linenos">1217</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">_importances.html&quot;</span><span class="p">)</span>
</span><span id="Project-1218"><a href="#Project-1218"><span class="linenos">1218</span></a>        <span class="p">)</span>
</span><span id="Project-1219"><a href="#Project-1219"><span class="linenos">1219</span></a>        <span class="n">best_params</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span>
</span><span id="Project-1220"><a href="#Project-1220"><span class="linenos">1220</span></a>        <span class="n">best_value</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_value</span>
</span><span id="Project-1221"><a href="#Project-1221"><span class="linenos">1221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_search</span><span class="p">(</span>
</span><span id="Project-1222"><a href="#Project-1222"><span class="linenos">1222</span></a>            <span class="n">search_name</span><span class="p">,</span>
</span><span id="Project-1223"><a href="#Project-1223"><span class="linenos">1223</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-1224"><a href="#Project-1224"><span class="linenos">1224</span></a>            <span class="n">n_trials</span><span class="p">,</span>
</span><span id="Project-1225"><a href="#Project-1225"><span class="linenos">1225</span></a>            <span class="n">best_params</span><span class="p">,</span>
</span><span id="Project-1226"><a href="#Project-1226"><span class="linenos">1226</span></a>            <span class="n">best_value</span><span class="p">,</span>
</span><span id="Project-1227"><a href="#Project-1227"><span class="linenos">1227</span></a>            <span class="n">metric</span><span class="p">,</span>
</span><span id="Project-1228"><a href="#Project-1228"><span class="linenos">1228</span></a>            <span class="n">search_space</span><span class="p">,</span>
</span><span id="Project-1229"><a href="#Project-1229"><span class="linenos">1229</span></a>        <span class="p">)</span>
</span><span id="Project-1230"><a href="#Project-1230"><span class="linenos">1230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1231"><a href="#Project-1231"><span class="linenos">1231</span></a>        <span class="n">runner</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
</span><span id="Project-1232"><a href="#Project-1232"><span class="linenos">1232</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;best parameters: </span><span class="si">{</span><span class="n">best_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1233"><a href="#Project-1233"><span class="linenos">1233</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1234"><a href="#Project-1234"><span class="linenos">1234</span></a>        <span class="k">return</span> <span class="n">best_params</span>
</span><span id="Project-1235"><a href="#Project-1235"><span class="linenos">1235</span></a>
</span><span id="Project-1236"><a href="#Project-1236"><span class="linenos">1236</span></a>    <span class="k">def</span> <span class="nf">run_prediction</span><span class="p">(</span>
</span><span id="Project-1237"><a href="#Project-1237"><span class="linenos">1237</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1238"><a href="#Project-1238"><span class="linenos">1238</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-1239"><a href="#Project-1239"><span class="linenos">1239</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-1240"><a href="#Project-1240"><span class="linenos">1240</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1241"><a href="#Project-1241"><span class="linenos">1241</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1242"><a href="#Project-1242"><span class="linenos">1242</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Project-1243"><a href="#Project-1243"><span class="linenos">1243</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1244"><a href="#Project-1244"><span class="linenos">1244</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span id="Project-1245"><a href="#Project-1245"><span class="linenos">1245</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1246"><a href="#Project-1246"><span class="linenos">1246</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1247"><a href="#Project-1247"><span class="linenos">1247</span></a>        <span class="n">submission</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1248"><a href="#Project-1248"><span class="linenos">1248</span></a>        <span class="n">frame_number_map_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1249"><a href="#Project-1249"><span class="linenos">1249</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1250"><a href="#Project-1250"><span class="linenos">1250</span></a>        <span class="n">embedding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1251"><a href="#Project-1251"><span class="linenos">1251</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1252"><a href="#Project-1252"><span class="linenos">1252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-1253"><a href="#Project-1253"><span class="linenos">1253</span></a><span class="sd">        Load models from previously run episodes to generate a prediction</span>
</span><span id="Project-1254"><a href="#Project-1254"><span class="linenos">1254</span></a>
</span><span id="Project-1255"><a href="#Project-1255"><span class="linenos">1255</span></a><span class="sd">        The probabilities predicted by the models are averaged.</span>
</span><span id="Project-1256"><a href="#Project-1256"><span class="linenos">1256</span></a><span class="sd">        Unless `submission` is `True`, the prediction results are saved as a pickled dictionary in the project_name/results/predictions folder</span>
</span><span id="Project-1257"><a href="#Project-1257"><span class="linenos">1257</span></a><span class="sd">        under the {episode_name}_{load_epoch}.pickle name. The file is a nested dictionary where the first-level</span>
</span><span id="Project-1258"><a href="#Project-1258"><span class="linenos">1258</span></a><span class="sd">        keys are the video ids, the second-level keys are the clip ids (like individual names) and the values</span>
</span><span id="Project-1259"><a href="#Project-1259"><span class="linenos">1259</span></a><span class="sd">        are the prediction arrays.</span>
</span><span id="Project-1260"><a href="#Project-1260"><span class="linenos">1260</span></a>
</span><span id="Project-1261"><a href="#Project-1261"><span class="linenos">1261</span></a><span class="sd">        Parameters</span>
</span><span id="Project-1262"><a href="#Project-1262"><span class="linenos">1262</span></a><span class="sd">        ----------</span>
</span><span id="Project-1263"><a href="#Project-1263"><span class="linenos">1263</span></a><span class="sd">        prediction_name : str</span>
</span><span id="Project-1264"><a href="#Project-1264"><span class="linenos">1264</span></a><span class="sd">            the name of the prediction</span>
</span><span id="Project-1265"><a href="#Project-1265"><span class="linenos">1265</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project-1266"><a href="#Project-1266"><span class="linenos">1266</span></a><span class="sd">            a list of string episode names to load the models from</span>
</span><span id="Project-1267"><a href="#Project-1267"><span class="linenos">1267</span></a><span class="sd">        load_epochs : list, optional</span>
</span><span id="Project-1268"><a href="#Project-1268"><span class="linenos">1268</span></a><span class="sd">            a list of integer epoch indices to load the model from; if None, the last ones are used</span>
</span><span id="Project-1269"><a href="#Project-1269"><span class="linenos">1269</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-1270"><a href="#Project-1270"><span class="linenos">1270</span></a><span class="sd">            a dictionary of parameter updates</span>
</span><span id="Project-1271"><a href="#Project-1271"><span class="linenos">1271</span></a><span class="sd">        augment_n : int, default 10</span>
</span><span id="Project-1272"><a href="#Project-1272"><span class="linenos">1272</span></a><span class="sd">            the number of augmentations to average over</span>
</span><span id="Project-1273"><a href="#Project-1273"><span class="linenos">1273</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="Project-1274"><a href="#Project-1274"><span class="linenos">1274</span></a><span class="sd">            the data path to run the prediction for</span>
</span><span id="Project-1275"><a href="#Project-1275"><span class="linenos">1275</span></a><span class="sd">        mode : {&#39;all&#39;, &#39;test&#39;, &#39;val&#39;, &#39;train&#39;}</span>
</span><span id="Project-1276"><a href="#Project-1276"><span class="linenos">1276</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None)</span>
</span><span id="Project-1277"><a href="#Project-1277"><span class="linenos">1277</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="Project-1278"><a href="#Project-1278"><span class="linenos">1278</span></a><span class="sd">            a set of string file paths (data with all prefixes + feature files, in any order) to run the prediction</span>
</span><span id="Project-1279"><a href="#Project-1279"><span class="linenos">1279</span></a><span class="sd">            for</span>
</span><span id="Project-1280"><a href="#Project-1280"><span class="linenos">1280</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project-1281"><a href="#Project-1281"><span class="linenos">1281</span></a><span class="sd">            if `True`, pre-computed features will be deleted</span>
</span><span id="Project-1282"><a href="#Project-1282"><span class="linenos">1282</span></a><span class="sd">        submission : bool, default False</span>
</span><span id="Project-1283"><a href="#Project-1283"><span class="linenos">1283</span></a><span class="sd">            if `True`, a MABe-22 style submission file is generated</span>
</span><span id="Project-1284"><a href="#Project-1284"><span class="linenos">1284</span></a><span class="sd">        frame_number_map_file : str, optional</span>
</span><span id="Project-1285"><a href="#Project-1285"><span class="linenos">1285</span></a><span class="sd">            path to the frame number map file</span>
</span><span id="Project-1286"><a href="#Project-1286"><span class="linenos">1286</span></a><span class="sd">        force : bool, default False</span>
</span><span id="Project-1287"><a href="#Project-1287"><span class="linenos">1287</span></a><span class="sd">            if `True`, existing prediction with this name will be overwritten</span>
</span><span id="Project-1288"><a href="#Project-1288"><span class="linenos">1288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-1289"><a href="#Project-1289"><span class="linenos">1289</span></a>
</span><span id="Project-1290"><a href="#Project-1290"><span class="linenos">1290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_prediction_validity</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
</span><span id="Project-1291"><a href="#Project-1291"><span class="linenos">1291</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PREDICTION </span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1292"><a href="#Project-1292"><span class="linenos">1292</span></a>        <span class="k">if</span> <span class="n">submission</span><span class="p">:</span>
</span><span id="Project-1293"><a href="#Project-1293"><span class="linenos">1293</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="Project-1294"><a href="#Project-1294"><span class="linenos">1294</span></a>            <span class="c1"># TODO: add submission option to _make_prediction</span>
</span><span id="Project-1295"><a href="#Project-1295"><span class="linenos">1295</span></a>            <span class="n">predicted</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">generate_submission</span><span class="p">(</span>
</span><span id="Project-1296"><a href="#Project-1296"><span class="linenos">1296</span></a>                <span class="n">frame_number_map_file</span><span class="o">=</span><span class="n">frame_number_map_file</span><span class="p">,</span>
</span><span id="Project-1297"><a href="#Project-1297"><span class="linenos">1297</span></a>                <span class="n">dataset</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1298"><a href="#Project-1298"><span class="linenos">1298</span></a>                <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project-1299"><a href="#Project-1299"><span class="linenos">1299</span></a>            <span class="p">)</span>
</span><span id="Project-1300"><a href="#Project-1300"><span class="linenos">1300</span></a>            <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-1301"><a href="#Project-1301"><span class="linenos">1301</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span>
</span><span id="Project-1302"><a href="#Project-1302"><span class="linenos">1302</span></a>                <span class="s2">&quot;results&quot;</span><span class="p">,</span>
</span><span id="Project-1303"><a href="#Project-1303"><span class="linenos">1303</span></a>                <span class="s2">&quot;predictions&quot;</span><span class="p">,</span>
</span><span id="Project-1304"><a href="#Project-1304"><span class="linenos">1304</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Project-1305"><a href="#Project-1305"><span class="linenos">1305</span></a>            <span class="p">)</span>
</span><span id="Project-1306"><a href="#Project-1306"><span class="linenos">1306</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="Project-1307"><a href="#Project-1307"><span class="linenos">1307</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">predicted</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Project-1308"><a href="#Project-1308"><span class="linenos">1308</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1309"><a href="#Project-1309"><span class="linenos">1309</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Project-1310"><a href="#Project-1310"><span class="linenos">1310</span></a>                <span class="p">(</span>
</span><span id="Project-1311"><a href="#Project-1311"><span class="linenos">1311</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="Project-1312"><a href="#Project-1312"><span class="linenos">1312</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-1313"><a href="#Project-1313"><span class="linenos">1313</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1314"><a href="#Project-1314"><span class="linenos">1314</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="Project-1315"><a href="#Project-1315"><span class="linenos">1315</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project-1316"><a href="#Project-1316"><span class="linenos">1316</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_prediction</span><span class="p">(</span>
</span><span id="Project-1317"><a href="#Project-1317"><span class="linenos">1317</span></a>                    <span class="n">prediction_name</span><span class="p">,</span>
</span><span id="Project-1318"><a href="#Project-1318"><span class="linenos">1318</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="Project-1319"><a href="#Project-1319"><span class="linenos">1319</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project-1320"><a href="#Project-1320"><span class="linenos">1320</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-1321"><a href="#Project-1321"><span class="linenos">1321</span></a>                    <span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-1322"><a href="#Project-1322"><span class="linenos">1322</span></a>                    <span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project-1323"><a href="#Project-1323"><span class="linenos">1323</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1324"><a href="#Project-1324"><span class="linenos">1324</span></a>                    <span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project-1325"><a href="#Project-1325"><span class="linenos">1325</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1326"><a href="#Project-1326"><span class="linenos">1326</span></a>                    <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
</span><span id="Project-1327"><a href="#Project-1327"><span class="linenos">1327</span></a>                <span class="p">)</span>
</span><span id="Project-1328"><a href="#Project-1328"><span class="linenos">1328</span></a>                <span class="n">predicted</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span><span class="o">.</span><span class="n">generate_full_length_prediction</span><span class="p">(</span>
</span><span id="Project-1329"><a href="#Project-1329"><span class="linenos">1329</span></a>                    <span class="n">prediction</span>
</span><span id="Project-1330"><a href="#Project-1330"><span class="linenos">1330</span></a>                <span class="p">)</span>
</span><span id="Project-1331"><a href="#Project-1331"><span class="linenos">1331</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="Project-1332"><a href="#Project-1332"><span class="linenos">1332</span></a>                <span class="p">(</span>
</span><span id="Project-1333"><a href="#Project-1333"><span class="linenos">1333</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="Project-1334"><a href="#Project-1334"><span class="linenos">1334</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-1335"><a href="#Project-1335"><span class="linenos">1335</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1336"><a href="#Project-1336"><span class="linenos">1336</span></a>                    <span class="n">predicted</span><span class="p">,</span>
</span><span id="Project-1337"><a href="#Project-1337"><span class="linenos">1337</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project-1338"><a href="#Project-1338"><span class="linenos">1338</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_predictions</span><span class="p">(</span>
</span><span id="Project-1339"><a href="#Project-1339"><span class="linenos">1339</span></a>                    <span class="n">prediction_name</span><span class="p">,</span>
</span><span id="Project-1340"><a href="#Project-1340"><span class="linenos">1340</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="Project-1341"><a href="#Project-1341"><span class="linenos">1341</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project-1342"><a href="#Project-1342"><span class="linenos">1342</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-1343"><a href="#Project-1343"><span class="linenos">1343</span></a>                    <span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-1344"><a href="#Project-1344"><span class="linenos">1344</span></a>                    <span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project-1345"><a href="#Project-1345"><span class="linenos">1345</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1346"><a href="#Project-1346"><span class="linenos">1346</span></a>                    <span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project-1347"><a href="#Project-1347"><span class="linenos">1347</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1348"><a href="#Project-1348"><span class="linenos">1348</span></a>                    <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
</span><span id="Project-1349"><a href="#Project-1349"><span class="linenos">1349</span></a>                <span class="p">)</span>
</span><span id="Project-1350"><a href="#Project-1350"><span class="linenos">1350</span></a>            <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_path</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">)</span>
</span><span id="Project-1351"><a href="#Project-1351"><span class="linenos">1351</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="Project-1352"><a href="#Project-1352"><span class="linenos">1352</span></a>            <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">predicted</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-1353"><a href="#Project-1353"><span class="linenos">1353</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="Project-1354"><a href="#Project-1354"><span class="linenos">1354</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-1355"><a href="#Project-1355"><span class="linenos">1355</span></a>                        <span class="n">folder</span><span class="p">,</span> <span class="n">video_id</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">_prediction.pickle&quot;</span>
</span><span id="Project-1356"><a href="#Project-1356"><span class="linenos">1356</span></a>                    <span class="p">),</span>
</span><span id="Project-1357"><a href="#Project-1357"><span class="linenos">1357</span></a>                    <span class="s2">&quot;wb&quot;</span><span class="p">,</span>
</span><span id="Project-1358"><a href="#Project-1358"><span class="linenos">1358</span></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-1359"><a href="#Project-1359"><span class="linenos">1359</span></a>                    <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;min_frames&quot;</span><span class="p">],</span> <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;max_frames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span>
</span><span id="Project-1360"><a href="#Project-1360"><span class="linenos">1360</span></a>                        <span class="n">mode</span>
</span><span id="Project-1361"><a href="#Project-1361"><span class="linenos">1361</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">get_min_max_frames</span><span class="p">(</span><span class="n">video_id</span><span class="p">)</span>
</span><span id="Project-1362"><a href="#Project-1362"><span class="linenos">1362</span></a>                    <span class="n">behavior_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="Project-1363"><a href="#Project-1363"><span class="linenos">1363</span></a>                        <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="Project-1364"><a href="#Project-1364"><span class="linenos">1364</span></a>                    <span class="p">)</span>
</span><span id="Project-1365"><a href="#Project-1365"><span class="linenos">1365</span></a>                    <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;behaviors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-1366"><a href="#Project-1366"><span class="linenos">1366</span></a>                        <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">behavior_indices</span>
</span><span id="Project-1367"><a href="#Project-1367"><span class="linenos">1367</span></a>                    <span class="p">]</span>
</span><span id="Project-1368"><a href="#Project-1368"><span class="linenos">1368</span></a>                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project-1369"><a href="#Project-1369"><span class="linenos">1369</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project-1370"><a href="#Project-1370"><span class="linenos">1370</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-1371"><a href="#Project-1371"><span class="linenos">1371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_prediction</span><span class="p">(</span>
</span><span id="Project-1372"><a href="#Project-1372"><span class="linenos">1372</span></a>            <span class="n">prediction_name</span><span class="p">,</span>
</span><span id="Project-1373"><a href="#Project-1373"><span class="linenos">1373</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-1374"><a href="#Project-1374"><span class="linenos">1374</span></a>            <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">(),</span>
</span><span id="Project-1375"><a href="#Project-1375"><span class="linenos">1375</span></a>            <span class="n">embedding</span><span class="p">,</span>
</span><span id="Project-1376"><a href="#Project-1376"><span class="linenos">1376</span></a>            <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project-1377"><a href="#Project-1377"><span class="linenos">1377</span></a>        <span class="p">)</span>
</span><span id="Project-1378"><a href="#Project-1378"><span class="linenos">1378</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1379"><a href="#Project-1379"><span class="linenos">1379</span></a>
</span><span id="Project-1380"><a href="#Project-1380"><span class="linenos">1380</span></a>    <span class="k">def</span> <span class="nf">evaluate_prediction</span><span class="p">(</span>
</span><span id="Project-1381"><a href="#Project-1381"><span class="linenos">1381</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1382"><a href="#Project-1382"><span class="linenos">1382</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-1383"><a href="#Project-1383"><span class="linenos">1383</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1384"><a href="#Project-1384"><span class="linenos">1384</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1385"><a href="#Project-1385"><span class="linenos">1385</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1386"><a href="#Project-1386"><span class="linenos">1386</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1387"><a href="#Project-1387"><span class="linenos">1387</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1388"><a href="#Project-1388"><span class="linenos">1388</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
</span><span id="Project-1389"><a href="#Project-1389"><span class="linenos">1389</span></a>
</span><span id="Project-1390"><a href="#Project-1390"><span class="linenos">1390</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="Project-1391"><a href="#Project-1391"><span class="linenos">1391</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-1392"><a href="#Project-1392"><span class="linenos">1392</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;predictions&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">.pickle&quot;</span>
</span><span id="Project-1393"><a href="#Project-1393"><span class="linenos">1393</span></a>            <span class="p">),</span>
</span><span id="Project-1394"><a href="#Project-1394"><span class="linenos">1394</span></a>            <span class="s2">&quot;rb&quot;</span><span class="p">,</span>
</span><span id="Project-1395"><a href="#Project-1395"><span class="linenos">1395</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-1396"><a href="#Project-1396"><span class="linenos">1396</span></a>            <span class="n">prediction</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Project-1397"><a href="#Project-1397"><span class="linenos">1397</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1398"><a href="#Project-1398"><span class="linenos">1398</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-1399"><a href="#Project-1399"><span class="linenos">1399</span></a>        <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project-1400"><a href="#Project-1400"><span class="linenos">1400</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">),</span> <span class="n">parameters_update</span>
</span><span id="Project-1401"><a href="#Project-1401"><span class="linenos">1401</span></a>        <span class="p">)</span>
</span><span id="Project-1402"><a href="#Project-1402"><span class="linenos">1402</span></a>        <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="Project-1403"><a href="#Project-1403"><span class="linenos">1403</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project-1404"><a href="#Project-1404"><span class="linenos">1404</span></a>            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project-1405"><a href="#Project-1405"><span class="linenos">1405</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1406"><a href="#Project-1406"><span class="linenos">1406</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-1407"><a href="#Project-1407"><span class="linenos">1407</span></a>            <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-1408"><a href="#Project-1408"><span class="linenos">1408</span></a>            <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project-1409"><a href="#Project-1409"><span class="linenos">1409</span></a>            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1410"><a href="#Project-1410"><span class="linenos">1410</span></a>        <span class="p">)</span>
</span><span id="Project-1411"><a href="#Project-1411"><span class="linenos">1411</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">evaluate_prediction</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project-1412"><a href="#Project-1412"><span class="linenos">1412</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project-1413"><a href="#Project-1413"><span class="linenos">1413</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-1414"><a href="#Project-1414"><span class="linenos">1414</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1415"><a href="#Project-1415"><span class="linenos">1415</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="Project-1416"><a href="#Project-1416"><span class="linenos">1416</span></a>
</span><span id="Project-1417"><a href="#Project-1417"><span class="linenos">1417</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="Project-1418"><a href="#Project-1418"><span class="linenos">1418</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1419"><a href="#Project-1419"><span class="linenos">1419</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-1420"><a href="#Project-1420"><span class="linenos">1420</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1421"><a href="#Project-1421"><span class="linenos">1421</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project-1422"><a href="#Project-1422"><span class="linenos">1422</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1423"><a href="#Project-1423"><span class="linenos">1423</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1424"><a href="#Project-1424"><span class="linenos">1424</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1425"><a href="#Project-1425"><span class="linenos">1425</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1426"><a href="#Project-1426"><span class="linenos">1426</span></a>        <span class="n">multiple_episode_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;average&quot;</span><span class="p">,</span>
</span><span id="Project-1427"><a href="#Project-1427"><span class="linenos">1427</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1428"><a href="#Project-1428"><span class="linenos">1428</span></a>        <span class="n">skip_updating_meta</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-1429"><a href="#Project-1429"><span class="linenos">1429</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-1430"><a href="#Project-1430"><span class="linenos">1430</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-1431"><a href="#Project-1431"><span class="linenos">1431</span></a><span class="sd">        Load one or several models from previously run episodes to make an evaluation</span>
</span><span id="Project-1432"><a href="#Project-1432"><span class="linenos">1432</span></a>
</span><span id="Project-1433"><a href="#Project-1433"><span class="linenos">1433</span></a><span class="sd">        By default it will run on the test (or validation, if there is no test) subset of the project dataset.</span>
</span><span id="Project-1434"><a href="#Project-1434"><span class="linenos">1434</span></a>
</span><span id="Project-1435"><a href="#Project-1435"><span class="linenos">1435</span></a><span class="sd">        Parameters</span>
</span><span id="Project-1436"><a href="#Project-1436"><span class="linenos">1436</span></a><span class="sd">        ----------</span>
</span><span id="Project-1437"><a href="#Project-1437"><span class="linenos">1437</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project-1438"><a href="#Project-1438"><span class="linenos">1438</span></a><span class="sd">            a list of string episode names to load the models from</span>
</span><span id="Project-1439"><a href="#Project-1439"><span class="linenos">1439</span></a><span class="sd">        load_epochs : list, optional</span>
</span><span id="Project-1440"><a href="#Project-1440"><span class="linenos">1440</span></a><span class="sd">            a list of integer epoch indices to load the model from; if None, the last ones are used</span>
</span><span id="Project-1441"><a href="#Project-1441"><span class="linenos">1441</span></a><span class="sd">        augment_n : int, default 0</span>
</span><span id="Project-1442"><a href="#Project-1442"><span class="linenos">1442</span></a><span class="sd">            the number of augmentations to average over</span>
</span><span id="Project-1443"><a href="#Project-1443"><span class="linenos">1443</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="Project-1444"><a href="#Project-1444"><span class="linenos">1444</span></a><span class="sd">            the data path to run the prediction for</span>
</span><span id="Project-1445"><a href="#Project-1445"><span class="linenos">1445</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="Project-1446"><a href="#Project-1446"><span class="linenos">1446</span></a><span class="sd">            a set of files to run the prediction for</span>
</span><span id="Project-1447"><a href="#Project-1447"><span class="linenos">1447</span></a><span class="sd">        mode : {&#39;test&#39;, &#39;val&#39;, &#39;train&#39;, &#39;all&#39;}</span>
</span><span id="Project-1448"><a href="#Project-1448"><span class="linenos">1448</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None;</span>
</span><span id="Project-1449"><a href="#Project-1449"><span class="linenos">1449</span></a><span class="sd">            by default &#39;test&#39; if test subset is not empty and &#39;val&#39; otherwise)</span>
</span><span id="Project-1450"><a href="#Project-1450"><span class="linenos">1450</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-1451"><a href="#Project-1451"><span class="linenos">1451</span></a><span class="sd">            a dictionary with parameter updates (cannot change model parameters)</span>
</span><span id="Project-1452"><a href="#Project-1452"><span class="linenos">1452</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project-1453"><a href="#Project-1453"><span class="linenos">1453</span></a><span class="sd">            if `True`, the dataset will be deleted</span>
</span><span id="Project-1454"><a href="#Project-1454"><span class="linenos">1454</span></a>
</span><span id="Project-1455"><a href="#Project-1455"><span class="linenos">1455</span></a><span class="sd">        Returns</span>
</span><span id="Project-1456"><a href="#Project-1456"><span class="linenos">1456</span></a><span class="sd">        -------</span>
</span><span id="Project-1457"><a href="#Project-1457"><span class="linenos">1457</span></a><span class="sd">        metric : dict</span>
</span><span id="Project-1458"><a href="#Project-1458"><span class="linenos">1458</span></a><span class="sd">            a dictionary of average values of metric functions</span>
</span><span id="Project-1459"><a href="#Project-1459"><span class="linenos">1459</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-1460"><a href="#Project-1460"><span class="linenos">1460</span></a>
</span><span id="Project-1461"><a href="#Project-1461"><span class="linenos">1461</span></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-1462"><a href="#Project-1462"><span class="linenos">1462</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="Project-1463"><a href="#Project-1463"><span class="linenos">1463</span></a>            <span class="n">names</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-1464"><a href="#Project-1464"><span class="linenos">1464</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">episode_names</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-1465"><a href="#Project-1465"><span class="linenos">1465</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVALUATION </span><span class="si">{</span><span class="n">episode_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1466"><a href="#Project-1466"><span class="linenos">1466</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1467"><a href="#Project-1467"><span class="linenos">1467</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVALUATION </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1468"><a href="#Project-1468"><span class="linenos">1468</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-1469"><a href="#Project-1469"><span class="linenos">1469</span></a>            <span class="n">evaluate</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Project-1470"><a href="#Project-1470"><span class="linenos">1470</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1471"><a href="#Project-1471"><span class="linenos">1471</span></a>            <span class="n">evaluate</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-1472"><a href="#Project-1472"><span class="linenos">1472</span></a>        <span class="k">if</span> <span class="n">multiple_episode_policy</span> <span class="o">==</span> <span class="s2">&quot;average&quot;</span><span class="p">:</span>
</span><span id="Project-1473"><a href="#Project-1473"><span class="linenos">1473</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Project-1474"><a href="#Project-1474"><span class="linenos">1474</span></a>                <span class="p">(</span>
</span><span id="Project-1475"><a href="#Project-1475"><span class="linenos">1475</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="Project-1476"><a href="#Project-1476"><span class="linenos">1476</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-1477"><a href="#Project-1477"><span class="linenos">1477</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1478"><a href="#Project-1478"><span class="linenos">1478</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="Project-1479"><a href="#Project-1479"><span class="linenos">1479</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project-1480"><a href="#Project-1480"><span class="linenos">1480</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_prediction</span><span class="p">(</span>
</span><span id="Project-1481"><a href="#Project-1481"><span class="linenos">1481</span></a>                    <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project-1482"><a href="#Project-1482"><span class="linenos">1482</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="Project-1483"><a href="#Project-1483"><span class="linenos">1483</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project-1484"><a href="#Project-1484"><span class="linenos">1484</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-1485"><a href="#Project-1485"><span class="linenos">1485</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1486"><a href="#Project-1486"><span class="linenos">1486</span></a>                    <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-1487"><a href="#Project-1487"><span class="linenos">1487</span></a>                    <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project-1488"><a href="#Project-1488"><span class="linenos">1488</span></a>                    <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project-1489"><a href="#Project-1489"><span class="linenos">1489</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="n">evaluate</span><span class="p">,</span>
</span><span id="Project-1490"><a href="#Project-1490"><span class="linenos">1490</span></a>                <span class="p">)</span>
</span><span id="Project-1491"><a href="#Project-1491"><span class="linenos">1491</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Project-1492"><a href="#Project-1492"><span class="linenos">1492</span></a>                <span class="p">(</span>
</span><span id="Project-1493"><a href="#Project-1493"><span class="linenos">1493</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="Project-1494"><a href="#Project-1494"><span class="linenos">1494</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-1495"><a href="#Project-1495"><span class="linenos">1495</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1496"><a href="#Project-1496"><span class="linenos">1496</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="Project-1497"><a href="#Project-1497"><span class="linenos">1497</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project-1498"><a href="#Project-1498"><span class="linenos">1498</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_predictions</span><span class="p">(</span>
</span><span id="Project-1499"><a href="#Project-1499"><span class="linenos">1499</span></a>                    <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project-1500"><a href="#Project-1500"><span class="linenos">1500</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="Project-1501"><a href="#Project-1501"><span class="linenos">1501</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project-1502"><a href="#Project-1502"><span class="linenos">1502</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-1503"><a href="#Project-1503"><span class="linenos">1503</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1504"><a href="#Project-1504"><span class="linenos">1504</span></a>                    <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-1505"><a href="#Project-1505"><span class="linenos">1505</span></a>                    <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project-1506"><a href="#Project-1506"><span class="linenos">1506</span></a>                    <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project-1507"><a href="#Project-1507"><span class="linenos">1507</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="n">evaluate</span><span class="p">,</span>
</span><span id="Project-1508"><a href="#Project-1508"><span class="linenos">1508</span></a>                <span class="p">)</span>
</span><span id="Project-1509"><a href="#Project-1509"><span class="linenos">1509</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AGGREGATED:&quot;</span><span class="p">)</span>
</span><span id="Project-1510"><a href="#Project-1510"><span class="linenos">1510</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">evaluate_prediction</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project-1511"><a href="#Project-1511"><span class="linenos">1511</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skip_updating_meta</span><span class="p">:</span>
</span><span id="Project-1512"><a href="#Project-1512"><span class="linenos">1512</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_metrics</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">results</span><span class="p">)</span>
</span><span id="Project-1513"><a href="#Project-1513"><span class="linenos">1513</span></a>        <span class="k">elif</span> <span class="n">multiple_episode_policy</span> <span class="o">==</span> <span class="s2">&quot;statistics&quot;</span><span class="p">:</span>
</span><span id="Project-1514"><a href="#Project-1514"><span class="linenos">1514</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="Project-1515"><a href="#Project-1515"><span class="linenos">1515</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-1516"><a href="#Project-1516"><span class="linenos">1516</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
</span><span id="Project-1517"><a href="#Project-1517"><span class="linenos">1517</span></a>                <span class="p">(</span>
</span><span id="Project-1518"><a href="#Project-1518"><span class="linenos">1518</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="Project-1519"><a href="#Project-1519"><span class="linenos">1519</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-1520"><a href="#Project-1520"><span class="linenos">1520</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1521"><a href="#Project-1521"><span class="linenos">1521</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="Project-1522"><a href="#Project-1522"><span class="linenos">1522</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project-1523"><a href="#Project-1523"><span class="linenos">1523</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_prediction</span><span class="p">(</span>
</span><span id="Project-1524"><a href="#Project-1524"><span class="linenos">1524</span></a>                    <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project-1525"><a href="#Project-1525"><span class="linenos">1525</span></a>                    <span class="p">[</span><span class="n">name</span><span class="p">],</span>
</span><span id="Project-1526"><a href="#Project-1526"><span class="linenos">1526</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project-1527"><a href="#Project-1527"><span class="linenos">1527</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-1528"><a href="#Project-1528"><span class="linenos">1528</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project-1529"><a href="#Project-1529"><span class="linenos">1529</span></a>                    <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-1530"><a href="#Project-1530"><span class="linenos">1530</span></a>                    <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project-1531"><a href="#Project-1531"><span class="linenos">1531</span></a>                    <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project-1532"><a href="#Project-1532"><span class="linenos">1532</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="n">evaluate</span><span class="p">,</span>
</span><span id="Project-1533"><a href="#Project-1533"><span class="linenos">1533</span></a>                    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project-1534"><a href="#Project-1534"><span class="linenos">1534</span></a>                <span class="p">)</span>
</span><span id="Project-1535"><a href="#Project-1535"><span class="linenos">1535</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">evaluate_prediction</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project-1536"><a href="#Project-1536"><span class="linenos">1536</span></a>                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-1537"><a href="#Project-1537"><span class="linenos">1537</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Project-1538"><a href="#Project-1538"><span class="linenos">1538</span></a>                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skip_updating_meta</span><span class="p">:</span>
</span><span id="Project-1539"><a href="#Project-1539"><span class="linenos">1539</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_metrics</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
</span><span id="Project-1540"><a href="#Project-1540"><span class="linenos">1540</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="Project-1541"><a href="#Project-1541"><span class="linenos">1541</span></a>            <span class="n">mean_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Project-1542"><a href="#Project-1542"><span class="linenos">1542</span></a>            <span class="n">std_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Project-1543"><a href="#Project-1543"><span class="linenos">1543</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-1544"><a href="#Project-1544"><span class="linenos">1544</span></a>                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span>
</span><span id="Project-1545"><a href="#Project-1545"><span class="linenos">1545</span></a>                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span>
</span><span id="Project-1546"><a href="#Project-1546"><span class="linenos">1546</span></a>                <span class="n">mean_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Project-1547"><a href="#Project-1547"><span class="linenos">1547</span></a>                <span class="n">std_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Project-1548"><a href="#Project-1548"><span class="linenos">1548</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MEAN:&quot;</span><span class="p">)</span>
</span><span id="Project-1549"><a href="#Project-1549"><span class="linenos">1549</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">mean_string</span><span class="p">)</span>
</span><span id="Project-1550"><a href="#Project-1550"><span class="linenos">1550</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STD:&quot;</span><span class="p">)</span>
</span><span id="Project-1551"><a href="#Project-1551"><span class="linenos">1551</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">std_string</span><span class="p">)</span>
</span><span id="Project-1552"><a href="#Project-1552"><span class="linenos">1552</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1553"><a href="#Project-1553"><span class="linenos">1553</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-1554"><a href="#Project-1554"><span class="linenos">1554</span></a>                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">multiple_episode_policy</span><span class="si">}</span><span class="s2"> multiple episode policy is not recognized; please choose &quot;</span>
</span><span id="Project-1555"><a href="#Project-1555"><span class="linenos">1555</span></a>                <span class="sa">f</span><span class="s2">&quot;from [&#39;average&#39;, &#39;statistics&#39;]&quot;</span>
</span><span id="Project-1556"><a href="#Project-1556"><span class="linenos">1556</span></a>            <span class="p">)</span>
</span><span id="Project-1557"><a href="#Project-1557"><span class="linenos">1557</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project-1558"><a href="#Project-1558"><span class="linenos">1558</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-1559"><a href="#Project-1559"><span class="linenos">1559</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inference time: </span><span class="si">{</span><span class="n">inference_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1560"><a href="#Project-1560"><span class="linenos">1560</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1561"><a href="#Project-1561"><span class="linenos">1561</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="Project-1562"><a href="#Project-1562"><span class="linenos">1562</span></a>
</span><span id="Project-1563"><a href="#Project-1563"><span class="linenos">1563</span></a>    <span class="k">def</span> <span class="nf">_generate_similarity_score</span><span class="p">(</span>
</span><span id="Project-1564"><a href="#Project-1564"><span class="linenos">1564</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1565"><a href="#Project-1565"><span class="linenos">1565</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-1566"><a href="#Project-1566"><span class="linenos">1566</span></a>        <span class="n">target_video_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-1567"><a href="#Project-1567"><span class="linenos">1567</span></a>        <span class="n">target_clip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-1568"><a href="#Project-1568"><span class="linenos">1568</span></a>        <span class="n">target_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Project-1569"><a href="#Project-1569"><span class="linenos">1569</span></a>        <span class="n">target_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Project-1570"><a href="#Project-1570"><span class="linenos">1570</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-1571"><a href="#Project-1571"><span class="linenos">1571</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="Project-1572"><a href="#Project-1572"><span class="linenos">1572</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-1573"><a href="#Project-1573"><span class="linenos">1573</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span>
</span><span id="Project-1574"><a href="#Project-1574"><span class="linenos">1574</span></a>                <span class="s2">&quot;results&quot;</span><span class="p">,</span>
</span><span id="Project-1575"><a href="#Project-1575"><span class="linenos">1575</span></a>                <span class="s2">&quot;predictions&quot;</span><span class="p">,</span>
</span><span id="Project-1576"><a href="#Project-1576"><span class="linenos">1576</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">.pickle&quot;</span><span class="p">,</span>
</span><span id="Project-1577"><a href="#Project-1577"><span class="linenos">1577</span></a>            <span class="p">),</span>
</span><span id="Project-1578"><a href="#Project-1578"><span class="linenos">1578</span></a>            <span class="s2">&quot;rb&quot;</span><span class="p">,</span>
</span><span id="Project-1579"><a href="#Project-1579"><span class="linenos">1579</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-1580"><a href="#Project-1580"><span class="linenos">1580</span></a>            <span class="n">prediction</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Project-1581"><a href="#Project-1581"><span class="linenos">1581</span></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="n">target_video_id</span><span class="p">][</span><span class="n">target_clip</span><span class="p">][:,</span> <span class="n">target_start</span><span class="p">:</span><span class="n">target_end</span><span class="p">]</span>
</span><span id="Project-1582"><a href="#Project-1582"><span class="linenos">1582</span></a>        <span class="n">score_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="Project-1583"><a href="#Project-1583"><span class="linenos">1583</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">prediction</span><span class="p">:</span>
</span><span id="Project-1584"><a href="#Project-1584"><span class="linenos">1584</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">prediction</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="Project-1585"><a href="#Project-1585"><span class="linenos">1585</span></a>                <span class="n">score_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span>
</span><span id="Project-1586"><a href="#Project-1586"><span class="linenos">1586</span></a>                    <span class="n">target</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">prediction</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">score_dict</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="Project-1587"><a href="#Project-1587"><span class="linenos">1587</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Project-1588"><a href="#Project-1588"><span class="linenos">1588</span></a>        <span class="k">return</span> <span class="n">score_dict</span>
</span><span id="Project-1589"><a href="#Project-1589"><span class="linenos">1589</span></a>
</span><span id="Project-1590"><a href="#Project-1590"><span class="linenos">1590</span></a>    <span class="k">def</span> <span class="nf">_suggest_intervals_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">score_dict</span><span class="p">,</span> <span class="n">min_length</span><span class="p">,</span> <span class="n">n_intervals</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-1591"><a href="#Project-1591"><span class="linenos">1591</span></a>        <span class="n">interval_address</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-1592"><a href="#Project-1592"><span class="linenos">1592</span></a>        <span class="n">interval_value</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-1593"><a href="#Project-1593"><span class="linenos">1593</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-1594"><a href="#Project-1594"><span class="linenos">1594</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-1595"><a href="#Project-1595"><span class="linenos">1595</span></a>        <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">video_dict</span> <span class="ow">in</span> <span class="n">score_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-1596"><a href="#Project-1596"><span class="linenos">1596</span></a>            <span class="k">for</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">video_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-1597"><a href="#Project-1597"><span class="linenos">1597</span></a>                <span class="n">s</span> <span class="o">+=</span> <span class="n">value</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Project-1598"><a href="#Project-1598"><span class="linenos">1598</span></a>                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Project-1599"><a href="#Project-1599"><span class="linenos">1599</span></a>        <span class="n">mean_value</span> <span class="o">=</span> <span class="n">s</span> <span class="o">/</span> <span class="n">n</span>
</span><span id="Project-1600"><a href="#Project-1600"><span class="linenos">1600</span></a>        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.75</span>
</span><span id="Project-1601"><a href="#Project-1601"><span class="linenos">1601</span></a>        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="Project-1602"><a href="#Project-1602"><span class="linenos">1602</span></a>            <span class="nb">id</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-1603"><a href="#Project-1603"><span class="linenos">1603</span></a>            <span class="n">interval_address</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-1604"><a href="#Project-1604"><span class="linenos">1604</span></a>            <span class="n">interval_value</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-1605"><a href="#Project-1605"><span class="linenos">1605</span></a>            <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">video_dict</span> <span class="ow">in</span> <span class="n">score_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-1606"><a href="#Project-1606"><span class="linenos">1606</span></a>                <span class="k">for</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">video_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-1607"><a href="#Project-1607"><span class="linenos">1607</span></a>                    <span class="n">res_indices_start</span><span class="p">,</span> <span class="n">res_indices_end</span> <span class="o">=</span> <span class="n">apply_threshold</span><span class="p">(</span>
</span><span id="Project-1608"><a href="#Project-1608"><span class="linenos">1608</span></a>                        <span class="n">value</span><span class="p">,</span>
</span><span id="Project-1609"><a href="#Project-1609"><span class="linenos">1609</span></a>                        <span class="n">threshold</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.9</span><span class="o">**</span><span class="n">it</span><span class="p">))</span> <span class="o">*</span> <span class="n">mean_value</span><span class="p">,</span>
</span><span id="Project-1610"><a href="#Project-1610"><span class="linenos">1610</span></a>                        <span class="n">low</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-1611"><a href="#Project-1611"><span class="linenos">1611</span></a>                        <span class="n">error_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1612"><a href="#Project-1612"><span class="linenos">1612</span></a>                        <span class="n">min_frames</span><span class="o">=</span><span class="n">min_length</span><span class="p">,</span>
</span><span id="Project-1613"><a href="#Project-1613"><span class="linenos">1613</span></a>                        <span class="n">smooth_interval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="Project-1614"><a href="#Project-1614"><span class="linenos">1614</span></a>                    <span class="p">)</span>
</span><span id="Project-1615"><a href="#Project-1615"><span class="linenos">1615</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">res_indices_start</span><span class="p">,</span> <span class="n">res_indices_end</span><span class="p">):</span>
</span><span id="Project-1616"><a href="#Project-1616"><span class="linenos">1616</span></a>                        <span class="n">interval_address</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">]</span>
</span><span id="Project-1617"><a href="#Project-1617"><span class="linenos">1617</span></a>                        <span class="n">interval_value</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">score_dict</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span>
</span><span id="Project-1618"><a href="#Project-1618"><span class="linenos">1618</span></a>                            <span class="n">start</span><span class="p">:</span><span class="n">end</span>
</span><span id="Project-1619"><a href="#Project-1619"><span class="linenos">1619</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Project-1620"><a href="#Project-1620"><span class="linenos">1620</span></a>                        <span class="nb">id</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Project-1621"><a href="#Project-1621"><span class="linenos">1621</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">interval_address</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">n_intervals</span><span class="p">:</span>
</span><span id="Project-1622"><a href="#Project-1622"><span class="linenos">1622</span></a>                <span class="k">break</span>
</span><span id="Project-1623"><a href="#Project-1623"><span class="linenos">1623</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">interval_address</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_intervals</span><span class="p">:</span>
</span><span id="Project-1624"><a href="#Project-1624"><span class="linenos">1624</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Project-1625"><a href="#Project-1625"><span class="linenos">1625</span></a>                <span class="sa">f</span><span class="s2">&quot;Could not get </span><span class="si">{</span><span class="n">n_intervals</span><span class="si">}</span><span class="s2"> intervals from the data, saving the result with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">interval_address</span><span class="p">)</span><span class="si">}</span><span class="s2"> intervals&quot;</span>
</span><span id="Project-1626"><a href="#Project-1626"><span class="linenos">1626</span></a>            <span class="p">)</span>
</span><span id="Project-1627"><a href="#Project-1627"><span class="linenos">1627</span></a>        <span class="n">sorted_intervals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="Project-1628"><a href="#Project-1628"><span class="linenos">1628</span></a>            <span class="n">interval_value</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Project-1629"><a href="#Project-1629"><span class="linenos">1629</span></a>        <span class="p">)</span>
</span><span id="Project-1630"><a href="#Project-1630"><span class="linenos">1630</span></a>        <span class="n">output_intervals</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-1631"><a href="#Project-1631"><span class="linenos">1631</span></a>            <span class="n">interval_address</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Project-1632"><a href="#Project-1632"><span class="linenos">1632</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sorted_intervals</span><span class="p">[:</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_intervals</span><span class="p">),</span> <span class="n">n_intervals</span><span class="p">)]</span>
</span><span id="Project-1633"><a href="#Project-1633"><span class="linenos">1633</span></a>        <span class="p">]</span>
</span><span id="Project-1634"><a href="#Project-1634"><span class="linenos">1634</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="Project-1635"><a href="#Project-1635"><span class="linenos">1635</span></a>        <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">output_intervals</span><span class="p">:</span>
</span><span id="Project-1636"><a href="#Project-1636"><span class="linenos">1636</span></a>            <span class="n">output</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">])</span>
</span><span id="Project-1637"><a href="#Project-1637"><span class="linenos">1637</span></a>        <span class="k">return</span> <span class="n">output</span>
</span><span id="Project-1638"><a href="#Project-1638"><span class="linenos">1638</span></a>
</span><span id="Project-1639"><a href="#Project-1639"><span class="linenos">1639</span></a>    <span class="k">def</span> <span class="nf">list_episodes</span><span class="p">(</span>
</span><span id="Project-1640"><a href="#Project-1640"><span class="linenos">1640</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1641"><a href="#Project-1641"><span class="linenos">1641</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1642"><a href="#Project-1642"><span class="linenos">1642</span></a>        <span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Project-1643"><a href="#Project-1643"><span class="linenos">1643</span></a>        <span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1644"><a href="#Project-1644"><span class="linenos">1644</span></a>        <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-1645"><a href="#Project-1645"><span class="linenos">1645</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Project-1646"><a href="#Project-1646"><span class="linenos">1646</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-1647"><a href="#Project-1647"><span class="linenos">1647</span></a><span class="sd">        Get a filtered pandas dataframe with episode metadata</span>
</span><span id="Project-1648"><a href="#Project-1648"><span class="linenos">1648</span></a>
</span><span id="Project-1649"><a href="#Project-1649"><span class="linenos">1649</span></a><span class="sd">        Parameters</span>
</span><span id="Project-1650"><a href="#Project-1650"><span class="linenos">1650</span></a><span class="sd">        ----------</span>
</span><span id="Project-1651"><a href="#Project-1651"><span class="linenos">1651</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project-1652"><a href="#Project-1652"><span class="linenos">1652</span></a><span class="sd">            a list of strings of episode names</span>
</span><span id="Project-1653"><a href="#Project-1653"><span class="linenos">1653</span></a><span class="sd">        value_filter : str</span>
</span><span id="Project-1654"><a href="#Project-1654"><span class="linenos">1654</span></a><span class="sd">            a string of filters to apply; of this general structure:</span>
</span><span id="Project-1655"><a href="#Project-1655"><span class="linenos">1655</span></a><span class="sd">            &#39;group_name1/par_name1::(&lt;/&gt;/&lt;=/&gt;=/=)value1,group_name2/par_name2::(&lt;/&gt;/&lt;=/&gt;=/=)value2&#39;, e.g.</span>
</span><span id="Project-1656"><a href="#Project-1656"><span class="linenos">1656</span></a><span class="sd">            &#39;data/overlap::=50,results/recall::&gt;0.5,data/feature_extraction::=kinematic,meta/training_time::&gt;=00:00:10&#39;</span>
</span><span id="Project-1657"><a href="#Project-1657"><span class="linenos">1657</span></a><span class="sd">        display_parameters : list</span>
</span><span id="Project-1658"><a href="#Project-1658"><span class="linenos">1658</span></a><span class="sd">            list of parameters to display (e.g. [&#39;data/overlap&#39;, &#39;results/recall&#39;])</span>
</span><span id="Project-1659"><a href="#Project-1659"><span class="linenos">1659</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="Project-1660"><a href="#Project-1660"><span class="linenos">1660</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="Project-1661"><a href="#Project-1661"><span class="linenos">1661</span></a>
</span><span id="Project-1662"><a href="#Project-1662"><span class="linenos">1662</span></a><span class="sd">        Returns</span>
</span><span id="Project-1663"><a href="#Project-1663"><span class="linenos">1663</span></a><span class="sd">        -------</span>
</span><span id="Project-1664"><a href="#Project-1664"><span class="linenos">1664</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="Project-1665"><a href="#Project-1665"><span class="linenos">1665</span></a><span class="sd">            the filtered dataframe</span>
</span><span id="Project-1666"><a href="#Project-1666"><span class="linenos">1666</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-1667"><a href="#Project-1667"><span class="linenos">1667</span></a>
</span><span id="Project-1668"><a href="#Project-1668"><span class="linenos">1668</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span>
</span><span id="Project-1669"><a href="#Project-1669"><span class="linenos">1669</span></a>            <span class="n">episode_names</span><span class="p">,</span> <span class="n">value_filter</span><span class="p">,</span> <span class="n">display_parameters</span>
</span><span id="Project-1670"><a href="#Project-1670"><span class="linenos">1670</span></a>        <span class="p">)</span>
</span><span id="Project-1671"><a href="#Project-1671"><span class="linenos">1671</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="Project-1672"><a href="#Project-1672"><span class="linenos">1672</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TRAINING EPISODES&quot;</span><span class="p">)</span>
</span><span id="Project-1673"><a href="#Project-1673"><span class="linenos">1673</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">episodes</span><span class="p">)</span>
</span><span id="Project-1674"><a href="#Project-1674"><span class="linenos">1674</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1675"><a href="#Project-1675"><span class="linenos">1675</span></a>        <span class="k">return</span> <span class="n">episodes</span>
</span><span id="Project-1676"><a href="#Project-1676"><span class="linenos">1676</span></a>
</span><span id="Project-1677"><a href="#Project-1677"><span class="linenos">1677</span></a>    <span class="k">def</span> <span class="nf">list_predictions</span><span class="p">(</span>
</span><span id="Project-1678"><a href="#Project-1678"><span class="linenos">1678</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1679"><a href="#Project-1679"><span class="linenos">1679</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1680"><a href="#Project-1680"><span class="linenos">1680</span></a>        <span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Project-1681"><a href="#Project-1681"><span class="linenos">1681</span></a>        <span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1682"><a href="#Project-1682"><span class="linenos">1682</span></a>        <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-1683"><a href="#Project-1683"><span class="linenos">1683</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Project-1684"><a href="#Project-1684"><span class="linenos">1684</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-1685"><a href="#Project-1685"><span class="linenos">1685</span></a><span class="sd">        Get a filtered pandas dataframe with prediction metadata</span>
</span><span id="Project-1686"><a href="#Project-1686"><span class="linenos">1686</span></a>
</span><span id="Project-1687"><a href="#Project-1687"><span class="linenos">1687</span></a><span class="sd">        Parameters</span>
</span><span id="Project-1688"><a href="#Project-1688"><span class="linenos">1688</span></a><span class="sd">        ----------</span>
</span><span id="Project-1689"><a href="#Project-1689"><span class="linenos">1689</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project-1690"><a href="#Project-1690"><span class="linenos">1690</span></a><span class="sd">            a list of strings of episode names</span>
</span><span id="Project-1691"><a href="#Project-1691"><span class="linenos">1691</span></a><span class="sd">        value_filter : str</span>
</span><span id="Project-1692"><a href="#Project-1692"><span class="linenos">1692</span></a><span class="sd">            a string of filters to apply; of this general structure:</span>
</span><span id="Project-1693"><a href="#Project-1693"><span class="linenos">1693</span></a><span class="sd">            &#39;group_name1/par_name1:(&lt;&gt;=)value1,group_name2/par_name2:(&lt;&gt;=)value2&#39;, e.g.</span>
</span><span id="Project-1694"><a href="#Project-1694"><span class="linenos">1694</span></a><span class="sd">            &#39;data/overlap:=50,results/recall:&gt;0.5,data/feature_extraction:=kinematic&#39;</span>
</span><span id="Project-1695"><a href="#Project-1695"><span class="linenos">1695</span></a><span class="sd">        display_parameters : list</span>
</span><span id="Project-1696"><a href="#Project-1696"><span class="linenos">1696</span></a><span class="sd">            list of parameters to display (e.g. [&#39;data/overlap&#39;, &#39;results/recall&#39;])</span>
</span><span id="Project-1697"><a href="#Project-1697"><span class="linenos">1697</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="Project-1698"><a href="#Project-1698"><span class="linenos">1698</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="Project-1699"><a href="#Project-1699"><span class="linenos">1699</span></a>
</span><span id="Project-1700"><a href="#Project-1700"><span class="linenos">1700</span></a><span class="sd">        Returns</span>
</span><span id="Project-1701"><a href="#Project-1701"><span class="linenos">1701</span></a><span class="sd">        -------</span>
</span><span id="Project-1702"><a href="#Project-1702"><span class="linenos">1702</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="Project-1703"><a href="#Project-1703"><span class="linenos">1703</span></a><span class="sd">            the filtered dataframe</span>
</span><span id="Project-1704"><a href="#Project-1704"><span class="linenos">1704</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-1705"><a href="#Project-1705"><span class="linenos">1705</span></a>
</span><span id="Project-1706"><a href="#Project-1706"><span class="linenos">1706</span></a>        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span>
</span><span id="Project-1707"><a href="#Project-1707"><span class="linenos">1707</span></a>            <span class="n">episode_names</span><span class="p">,</span> <span class="n">value_filter</span><span class="p">,</span> <span class="n">display_parameters</span>
</span><span id="Project-1708"><a href="#Project-1708"><span class="linenos">1708</span></a>        <span class="p">)</span>
</span><span id="Project-1709"><a href="#Project-1709"><span class="linenos">1709</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="Project-1710"><a href="#Project-1710"><span class="linenos">1710</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PREDICTIONS&quot;</span><span class="p">)</span>
</span><span id="Project-1711"><a href="#Project-1711"><span class="linenos">1711</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
</span><span id="Project-1712"><a href="#Project-1712"><span class="linenos">1712</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1713"><a href="#Project-1713"><span class="linenos">1713</span></a>        <span class="k">return</span> <span class="n">predictions</span>
</span><span id="Project-1714"><a href="#Project-1714"><span class="linenos">1714</span></a>
</span><span id="Project-1715"><a href="#Project-1715"><span class="linenos">1715</span></a>    <span class="k">def</span> <span class="nf">list_searches</span><span class="p">(</span>
</span><span id="Project-1716"><a href="#Project-1716"><span class="linenos">1716</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1717"><a href="#Project-1717"><span class="linenos">1717</span></a>        <span class="n">search_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1718"><a href="#Project-1718"><span class="linenos">1718</span></a>        <span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Project-1719"><a href="#Project-1719"><span class="linenos">1719</span></a>        <span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1720"><a href="#Project-1720"><span class="linenos">1720</span></a>        <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-1721"><a href="#Project-1721"><span class="linenos">1721</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Project-1722"><a href="#Project-1722"><span class="linenos">1722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-1723"><a href="#Project-1723"><span class="linenos">1723</span></a><span class="sd">        Get a filtered pandas dataframe with hyperparameter search metadata</span>
</span><span id="Project-1724"><a href="#Project-1724"><span class="linenos">1724</span></a>
</span><span id="Project-1725"><a href="#Project-1725"><span class="linenos">1725</span></a><span class="sd">        Parameters</span>
</span><span id="Project-1726"><a href="#Project-1726"><span class="linenos">1726</span></a><span class="sd">        ----------</span>
</span><span id="Project-1727"><a href="#Project-1727"><span class="linenos">1727</span></a><span class="sd">        search_names : list</span>
</span><span id="Project-1728"><a href="#Project-1728"><span class="linenos">1728</span></a><span class="sd">            a list of strings of search names</span>
</span><span id="Project-1729"><a href="#Project-1729"><span class="linenos">1729</span></a><span class="sd">        value_filter : str</span>
</span><span id="Project-1730"><a href="#Project-1730"><span class="linenos">1730</span></a><span class="sd">            a string of filters to apply; of this general structure:</span>
</span><span id="Project-1731"><a href="#Project-1731"><span class="linenos">1731</span></a><span class="sd">            &#39;group_name1/par_name1:(&lt;&gt;=)value1,group_name2/par_name2:(&lt;&gt;=)value2&#39;, e.g.</span>
</span><span id="Project-1732"><a href="#Project-1732"><span class="linenos">1732</span></a><span class="sd">            &#39;data/overlap:=50,results/recall:&gt;0.5,data/feature_extraction:=kinematic&#39;</span>
</span><span id="Project-1733"><a href="#Project-1733"><span class="linenos">1733</span></a><span class="sd">        display_parameters : list</span>
</span><span id="Project-1734"><a href="#Project-1734"><span class="linenos">1734</span></a><span class="sd">            list of parameters to display (e.g. [&#39;data/overlap&#39;, &#39;results/recall&#39;])</span>
</span><span id="Project-1735"><a href="#Project-1735"><span class="linenos">1735</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="Project-1736"><a href="#Project-1736"><span class="linenos">1736</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="Project-1737"><a href="#Project-1737"><span class="linenos">1737</span></a>
</span><span id="Project-1738"><a href="#Project-1738"><span class="linenos">1738</span></a><span class="sd">        Returns</span>
</span><span id="Project-1739"><a href="#Project-1739"><span class="linenos">1739</span></a><span class="sd">        -------</span>
</span><span id="Project-1740"><a href="#Project-1740"><span class="linenos">1740</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="Project-1741"><a href="#Project-1741"><span class="linenos">1741</span></a><span class="sd">            the filtered dataframe</span>
</span><span id="Project-1742"><a href="#Project-1742"><span class="linenos">1742</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-1743"><a href="#Project-1743"><span class="linenos">1743</span></a>
</span><span id="Project-1744"><a href="#Project-1744"><span class="linenos">1744</span></a>        <span class="n">searches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span>
</span><span id="Project-1745"><a href="#Project-1745"><span class="linenos">1745</span></a>            <span class="n">search_names</span><span class="p">,</span> <span class="n">value_filter</span><span class="p">,</span> <span class="n">display_parameters</span>
</span><span id="Project-1746"><a href="#Project-1746"><span class="linenos">1746</span></a>        <span class="p">)</span>
</span><span id="Project-1747"><a href="#Project-1747"><span class="linenos">1747</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="Project-1748"><a href="#Project-1748"><span class="linenos">1748</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SEARCHES&quot;</span><span class="p">)</span>
</span><span id="Project-1749"><a href="#Project-1749"><span class="linenos">1749</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">searches</span><span class="p">)</span>
</span><span id="Project-1750"><a href="#Project-1750"><span class="linenos">1750</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1751"><a href="#Project-1751"><span class="linenos">1751</span></a>        <span class="k">return</span> <span class="n">searches</span>
</span><span id="Project-1752"><a href="#Project-1752"><span class="linenos">1752</span></a>
</span><span id="Project-1753"><a href="#Project-1753"><span class="linenos">1753</span></a>    <span class="k">def</span> <span class="nf">get_best_parameters</span><span class="p">(</span>
</span><span id="Project-1754"><a href="#Project-1754"><span class="linenos">1754</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1755"><a href="#Project-1755"><span class="linenos">1755</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-1756"><a href="#Project-1756"><span class="linenos">1756</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1757"><a href="#Project-1757"><span class="linenos">1757</span></a>    <span class="p">):</span>
</span><span id="Project-1758"><a href="#Project-1758"><span class="linenos">1758</span></a>        <span class="n">params</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">get_best_params</span><span class="p">(</span>
</span><span id="Project-1759"><a href="#Project-1759"><span class="linenos">1759</span></a>            <span class="n">search_name</span><span class="p">,</span> <span class="n">round_to_binary</span><span class="o">=</span><span class="n">round_to_binary</span>
</span><span id="Project-1760"><a href="#Project-1760"><span class="linenos">1760</span></a>        <span class="p">)</span>
</span><span id="Project-1761"><a href="#Project-1761"><span class="linenos">1761</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">}})</span>
</span><span id="Project-1762"><a href="#Project-1762"><span class="linenos">1762</span></a>        <span class="k">return</span> <span class="n">params</span>
</span><span id="Project-1763"><a href="#Project-1763"><span class="linenos">1763</span></a>
</span><span id="Project-1764"><a href="#Project-1764"><span class="linenos">1764</span></a>    <span class="k">def</span> <span class="nf">list_best_parameters</span><span class="p">(</span>
</span><span id="Project-1765"><a href="#Project-1765"><span class="linenos">1765</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Project-1766"><a href="#Project-1766"><span class="linenos">1766</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-1767"><a href="#Project-1767"><span class="linenos">1767</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-1768"><a href="#Project-1768"><span class="linenos">1768</span></a><span class="sd">        Get the raw dictionary of best parameters found by a search</span>
</span><span id="Project-1769"><a href="#Project-1769"><span class="linenos">1769</span></a>
</span><span id="Project-1770"><a href="#Project-1770"><span class="linenos">1770</span></a><span class="sd">        Parameters</span>
</span><span id="Project-1771"><a href="#Project-1771"><span class="linenos">1771</span></a><span class="sd">        ----------</span>
</span><span id="Project-1772"><a href="#Project-1772"><span class="linenos">1772</span></a><span class="sd">        search_name : str</span>
</span><span id="Project-1773"><a href="#Project-1773"><span class="linenos">1773</span></a><span class="sd">            the name of the search</span>
</span><span id="Project-1774"><a href="#Project-1774"><span class="linenos">1774</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="Project-1775"><a href="#Project-1775"><span class="linenos">1775</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="Project-1776"><a href="#Project-1776"><span class="linenos">1776</span></a>
</span><span id="Project-1777"><a href="#Project-1777"><span class="linenos">1777</span></a><span class="sd">        Returns</span>
</span><span id="Project-1778"><a href="#Project-1778"><span class="linenos">1778</span></a><span class="sd">        -------</span>
</span><span id="Project-1779"><a href="#Project-1779"><span class="linenos">1779</span></a><span class="sd">        best_params : dict</span>
</span><span id="Project-1780"><a href="#Project-1780"><span class="linenos">1780</span></a><span class="sd">            a dictionary of the best parameters where the keys are in &#39;{group}/{name}&#39; format</span>
</span><span id="Project-1781"><a href="#Project-1781"><span class="linenos">1781</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-1782"><a href="#Project-1782"><span class="linenos">1782</span></a>
</span><span id="Project-1783"><a href="#Project-1783"><span class="linenos">1783</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">get_best_params_raw</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="Project-1784"><a href="#Project-1784"><span class="linenos">1784</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="Project-1785"><a href="#Project-1785"><span class="linenos">1785</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SEARCH RESULTS </span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1786"><a href="#Project-1786"><span class="linenos">1786</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-1787"><a href="#Project-1787"><span class="linenos">1787</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1788"><a href="#Project-1788"><span class="linenos">1788</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-1789"><a href="#Project-1789"><span class="linenos">1789</span></a>        <span class="k">return</span> <span class="n">params</span>
</span><span id="Project-1790"><a href="#Project-1790"><span class="linenos">1790</span></a>
</span><span id="Project-1791"><a href="#Project-1791"><span class="linenos">1791</span></a>    <span class="k">def</span> <span class="nf">plot_episodes</span><span class="p">(</span>
</span><span id="Project-1792"><a href="#Project-1792"><span class="linenos">1792</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-1793"><a href="#Project-1793"><span class="linenos">1793</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-1794"><a href="#Project-1794"><span class="linenos">1794</span></a>        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-1795"><a href="#Project-1795"><span class="linenos">1795</span></a>        <span class="n">modes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1796"><a href="#Project-1796"><span class="linenos">1796</span></a>        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1797"><a href="#Project-1797"><span class="linenos">1797</span></a>        <span class="n">episode_labels</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1798"><a href="#Project-1798"><span class="linenos">1798</span></a>        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1799"><a href="#Project-1799"><span class="linenos">1799</span></a>        <span class="n">add_hlines</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1800"><a href="#Project-1800"><span class="linenos">1800</span></a>        <span class="n">epoch_limits</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1801"><a href="#Project-1801"><span class="linenos">1801</span></a>        <span class="n">colors</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-1802"><a href="#Project-1802"><span class="linenos">1802</span></a>        <span class="n">add_highpoint_hlines</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-1803"><a href="#Project-1803"><span class="linenos">1803</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1804"><a href="#Project-1804"><span class="linenos">1804</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-1805"><a href="#Project-1805"><span class="linenos">1805</span></a><span class="sd">        Plot episode training curves</span>
</span><span id="Project-1806"><a href="#Project-1806"><span class="linenos">1806</span></a>
</span><span id="Project-1807"><a href="#Project-1807"><span class="linenos">1807</span></a><span class="sd">        Parameters</span>
</span><span id="Project-1808"><a href="#Project-1808"><span class="linenos">1808</span></a><span class="sd">        ----------</span>
</span><span id="Project-1809"><a href="#Project-1809"><span class="linenos">1809</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project-1810"><a href="#Project-1810"><span class="linenos">1810</span></a><span class="sd">            a list of episode names to plot; to plot to episodes in one line combine them in a list</span>
</span><span id="Project-1811"><a href="#Project-1811"><span class="linenos">1811</span></a><span class="sd">            (e.g. [&#39;episode1&#39;, [&#39;episode2&#39;, &#39;episode3&#39;]] to plot episode2 and episode3 as one experiment)</span>
</span><span id="Project-1812"><a href="#Project-1812"><span class="linenos">1812</span></a><span class="sd">        metrics : list</span>
</span><span id="Project-1813"><a href="#Project-1813"><span class="linenos">1813</span></a><span class="sd">            a list of metric to plot</span>
</span><span id="Project-1814"><a href="#Project-1814"><span class="linenos">1814</span></a><span class="sd">        modes : list, optional</span>
</span><span id="Project-1815"><a href="#Project-1815"><span class="linenos">1815</span></a><span class="sd">            a list of modes to plot (&#39;train&#39; and/or &#39;val&#39;; `[&#39;val&#39;]` by default)</span>
</span><span id="Project-1816"><a href="#Project-1816"><span class="linenos">1816</span></a><span class="sd">        title : str, optional</span>
</span><span id="Project-1817"><a href="#Project-1817"><span class="linenos">1817</span></a><span class="sd">            title for the plot</span>
</span><span id="Project-1818"><a href="#Project-1818"><span class="linenos">1818</span></a><span class="sd">        episode_labels : list, optional</span>
</span><span id="Project-1819"><a href="#Project-1819"><span class="linenos">1819</span></a><span class="sd">            a list of strings used to label the curves (has to be the same length as episode_names)</span>
</span><span id="Project-1820"><a href="#Project-1820"><span class="linenos">1820</span></a><span class="sd">        save_path : str, optional</span>
</span><span id="Project-1821"><a href="#Project-1821"><span class="linenos">1821</span></a><span class="sd">            the path to save the resulting plot</span>
</span><span id="Project-1822"><a href="#Project-1822"><span class="linenos">1822</span></a><span class="sd">        add_hlines : list, optional</span>
</span><span id="Project-1823"><a href="#Project-1823"><span class="linenos">1823</span></a><span class="sd">            a list of float values (or (value, label) tuples) to mark with horizontal lines</span>
</span><span id="Project-1824"><a href="#Project-1824"><span class="linenos">1824</span></a><span class="sd">        colors: list, optional</span>
</span><span id="Project-1825"><a href="#Project-1825"><span class="linenos">1825</span></a><span class="sd">            a list of matplotlib colors</span>
</span><span id="Project-1826"><a href="#Project-1826"><span class="linenos">1826</span></a><span class="sd">        add_highpoint_hlines : bool, default False</span>
</span><span id="Project-1827"><a href="#Project-1827"><span class="linenos">1827</span></a><span class="sd">            if `True`, horizontal lines will be added at the highest value of each episode</span>
</span><span id="Project-1828"><a href="#Project-1828"><span class="linenos">1828</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-1829"><a href="#Project-1829"><span class="linenos">1829</span></a>
</span><span id="Project-1830"><a href="#Project-1830"><span class="linenos">1830</span></a>        <span class="k">if</span> <span class="n">modes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1831"><a href="#Project-1831"><span class="linenos">1831</span></a>            <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span>
</span><span id="Project-1832"><a href="#Project-1832"><span class="linenos">1832</span></a>        <span class="k">if</span> <span class="n">add_hlines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1833"><a href="#Project-1833"><span class="linenos">1833</span></a>            <span class="n">add_hlines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-1834"><a href="#Project-1834"><span class="linenos">1834</span></a>        <span class="n">logs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-1835"><a href="#Project-1835"><span class="linenos">1835</span></a>        <span class="n">epochs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-1836"><a href="#Project-1836"><span class="linenos">1836</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-1837"><a href="#Project-1837"><span class="linenos">1837</span></a>        <span class="k">if</span> <span class="n">episode_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1838"><a href="#Project-1838"><span class="linenos">1838</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">episode_labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">episode_names</span><span class="p">)</span>
</span><span id="Project-1839"><a href="#Project-1839"><span class="linenos">1839</span></a>        <span class="k">for</span> <span class="n">name_i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">episode_names</span><span class="p">):</span>
</span><span id="Project-1840"><a href="#Project-1840"><span class="linenos">1840</span></a>            <span class="n">log_params</span> <span class="o">=</span> <span class="n">product</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">modes</span><span class="p">)</span>
</span><span id="Project-1841"><a href="#Project-1841"><span class="linenos">1841</span></a>            <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">log_params</span><span class="p">:</span>
</span><span id="Project-1842"><a href="#Project-1842"><span class="linenos">1842</span></a>                <span class="k">if</span> <span class="n">episode_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1843"><a href="#Project-1843"><span class="linenos">1843</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="n">episode_labels</span><span class="p">[</span><span class="n">name_i</span><span class="p">]</span>
</span><span id="Project-1844"><a href="#Project-1844"><span class="linenos">1844</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1845"><a href="#Project-1845"><span class="linenos">1845</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Project-1846"><a href="#Project-1846"><span class="linenos">1846</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-1847"><a href="#Project-1847"><span class="linenos">1847</span></a>                    <span class="n">label</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-1848"><a href="#Project-1848"><span class="linenos">1848</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-1849"><a href="#Project-1849"><span class="linenos">1849</span></a>                    <span class="n">label</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-1850"><a href="#Project-1850"><span class="linenos">1850</span></a>                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span><span id="Project-1851"><a href="#Project-1851"><span class="linenos">1851</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Project-1852"><a href="#Project-1852"><span class="linenos">1852</span></a>                    <span class="n">epoch_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="Project-1853"><a href="#Project-1853"><span class="linenos">1853</span></a>                    <span class="n">multi_logs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="Project-1854"><a href="#Project-1854"><span class="linenos">1854</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span id="Project-1855"><a href="#Project-1855"><span class="linenos">1855</span></a>                        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="Project-1856"><a href="#Project-1856"><span class="linenos">1856</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-1857"><a href="#Project-1857"><span class="linenos">1857</span></a>                            <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project-1858"><a href="#Project-1858"><span class="linenos">1858</span></a>                                <span class="n">index</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Project-1859"><a href="#Project-1859"><span class="linenos">1859</span></a>                                <span class="k">if</span> <span class="n">multi_logs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="Project-1860"><a href="#Project-1860"><span class="linenos">1860</span></a>                                    <span class="k">if</span> <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1861"><a href="#Project-1861"><span class="linenos">1861</span></a>                                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Project-1862"><a href="#Project-1862"><span class="linenos">1862</span></a>                                            <span class="s2">&quot;The run indices are not consistent across episodes!&quot;</span>
</span><span id="Project-1863"><a href="#Project-1863"><span class="linenos">1863</span></a>                                        <span class="p">)</span>
</span><span id="Project-1864"><a href="#Project-1864"><span class="linenos">1864</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1865"><a href="#Project-1865"><span class="linenos">1865</span></a>                                        <span class="n">multi_logs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span>
</span><span id="Project-1866"><a href="#Project-1866"><span class="linenos">1866</span></a>                                <span class="n">multi_logs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="Project-1867"><a href="#Project-1867"><span class="linenos">1867</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>
</span><span id="Project-1868"><a href="#Project-1868"><span class="linenos">1868</span></a>                                <span class="p">)</span>
</span><span id="Project-1869"><a href="#Project-1869"><span class="linenos">1869</span></a>                                <span class="n">start</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Project-1870"><a href="#Project-1870"><span class="linenos">1870</span></a>                                    <span class="mi">0</span>
</span><span id="Project-1871"><a href="#Project-1871"><span class="linenos">1871</span></a>                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Project-1872"><a href="#Project-1872"><span class="linenos">1872</span></a>                                    <span class="k">else</span> <span class="n">epoch_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Project-1873"><a href="#Project-1873"><span class="linenos">1873</span></a>                                <span class="p">)</span>
</span><span id="Project-1874"><a href="#Project-1874"><span class="linenos">1874</span></a>                                <span class="n">epoch_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Project-1875"><a href="#Project-1875"><span class="linenos">1875</span></a>                                    <span class="n">x</span> <span class="o">+</span> <span class="n">start</span>
</span><span id="Project-1876"><a href="#Project-1876"><span class="linenos">1876</span></a>                                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project-1877"><a href="#Project-1877"><span class="linenos">1877</span></a>                                <span class="p">]</span>
</span><span id="Project-1878"><a href="#Project-1878"><span class="linenos">1878</span></a>                            <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-1879"><a href="#Project-1879"><span class="linenos">1879</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1880"><a href="#Project-1880"><span class="linenos">1880</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_logs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-1881"><a href="#Project-1881"><span class="linenos">1881</span></a>                                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Project-1882"><a href="#Project-1882"><span class="linenos">1882</span></a>                                    <span class="s2">&quot;Cannot plot a single-run episode after a multi-run episode!&quot;</span>
</span><span id="Project-1883"><a href="#Project-1883"><span class="linenos">1883</span></a>                                <span class="p">)</span>
</span><span id="Project-1884"><a href="#Project-1884"><span class="linenos">1884</span></a>                            <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="Project-1885"><a href="#Project-1885"><span class="linenos">1885</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>
</span><span id="Project-1886"><a href="#Project-1886"><span class="linenos">1886</span></a>                            <span class="p">)</span>
</span><span id="Project-1887"><a href="#Project-1887"><span class="linenos">1887</span></a>                            <span class="n">start</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Project-1888"><a href="#Project-1888"><span class="linenos">1888</span></a>                                <span class="mi">0</span>
</span><span id="Project-1889"><a href="#Project-1889"><span class="linenos">1889</span></a>                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Project-1890"><a href="#Project-1890"><span class="linenos">1890</span></a>                                <span class="k">else</span> <span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Project-1891"><a href="#Project-1891"><span class="linenos">1891</span></a>                            <span class="p">)</span>
</span><span id="Project-1892"><a href="#Project-1892"><span class="linenos">1892</span></a>                            <span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Project-1893"><a href="#Project-1893"><span class="linenos">1893</span></a>                                <span class="n">x</span> <span class="o">+</span> <span class="n">start</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project-1894"><a href="#Project-1894"><span class="linenos">1894</span></a>                            <span class="p">]</span>
</span><span id="Project-1895"><a href="#Project-1895"><span class="linenos">1895</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_logs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-1896"><a href="#Project-1896"><span class="linenos">1896</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span>
</span><span id="Project-1897"><a href="#Project-1897"><span class="linenos">1897</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">])</span>
</span><span id="Project-1898"><a href="#Project-1898"><span class="linenos">1898</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1899"><a href="#Project-1899"><span class="linenos">1899</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">multi_logs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;null&quot;</span><span class="p">])</span>
</span><span id="Project-1900"><a href="#Project-1900"><span class="linenos">1900</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Project-1901"><a href="#Project-1901"><span class="linenos">1901</span></a>                            <span class="nb">tuple</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">epoch_list</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;null&quot;</span><span class="p">])</span>
</span><span id="Project-1902"><a href="#Project-1902"><span class="linenos">1902</span></a>                        <span class="p">)</span>
</span><span id="Project-1903"><a href="#Project-1903"><span class="linenos">1903</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1904"><a href="#Project-1904"><span class="linenos">1904</span></a>                    <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Project-1905"><a href="#Project-1905"><span class="linenos">1905</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-1906"><a href="#Project-1906"><span class="linenos">1906</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-1907"><a href="#Project-1907"><span class="linenos">1907</span></a>                        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project-1908"><a href="#Project-1908"><span class="linenos">1908</span></a>                            <span class="n">tracked_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">()</span>
</span><span id="Project-1909"><a href="#Project-1909"><span class="linenos">1909</span></a>                            <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="Project-1910"><a href="#Project-1910"><span class="linenos">1910</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Project-1911"><a href="#Project-1911"><span class="linenos">1911</span></a>                                    <span class="nb">list</span><span class="p">(</span>
</span><span id="Project-1912"><a href="#Project-1912"><span class="linenos">1912</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>
</span><span id="Project-1913"><a href="#Project-1913"><span class="linenos">1913</span></a>                                    <span class="p">)</span>
</span><span id="Project-1914"><a href="#Project-1914"><span class="linenos">1914</span></a>                                <span class="p">)</span>
</span><span id="Project-1915"><a href="#Project-1915"><span class="linenos">1915</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1916"><a href="#Project-1916"><span class="linenos">1916</span></a>                                <span class="n">relevant</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-1917"><a href="#Project-1917"><span class="linenos">1917</span></a>                                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="Project-1918"><a href="#Project-1918"><span class="linenos">1918</span></a>                                    <span class="n">m_split</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="Project-1919"><a href="#Project-1919"><span class="linenos">1919</span></a>                                    <span class="k">if</span> <span class="p">(</span>
</span><span id="Project-1920"><a href="#Project-1920"><span class="linenos">1920</span></a>                                        <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m_split</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">metric</span>
</span><span id="Project-1921"><a href="#Project-1921"><span class="linenos">1921</span></a>                                        <span class="ow">and</span> <span class="n">m_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span>
</span><span id="Project-1922"><a href="#Project-1922"><span class="linenos">1922</span></a>                                    <span class="p">):</span>
</span><span id="Project-1923"><a href="#Project-1923"><span class="linenos">1923</span></a>                                        <span class="n">relevant</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="Project-1924"><a href="#Project-1924"><span class="linenos">1924</span></a>                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-1925"><a href="#Project-1925"><span class="linenos">1925</span></a>                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-1926"><a href="#Project-1926"><span class="linenos">1926</span></a>                                        <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> metric was not tracked at </span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-1927"><a href="#Project-1927"><span class="linenos">1927</span></a>                                    <span class="p">)</span>
</span><span id="Project-1928"><a href="#Project-1928"><span class="linenos">1928</span></a>                                <span class="n">arr</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-1929"><a href="#Project-1929"><span class="linenos">1929</span></a>                                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
</span><span id="Project-1930"><a href="#Project-1930"><span class="linenos">1930</span></a>                                    <span class="n">arr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</span><span id="Project-1931"><a href="#Project-1931"><span class="linenos">1931</span></a>                                <span class="n">arr</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span>
</span><span id="Project-1932"><a href="#Project-1932"><span class="linenos">1932</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
</span><span id="Project-1933"><a href="#Project-1933"><span class="linenos">1933</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="Project-1934"><a href="#Project-1934"><span class="linenos">1934</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Project-1935"><a href="#Project-1935"><span class="linenos">1935</span></a>                            <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Project-1936"><a href="#Project-1936"><span class="linenos">1936</span></a>                                <span class="p">[</span>
</span><span id="Project-1937"><a href="#Project-1937"><span class="linenos">1937</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project-1938"><a href="#Project-1938"><span class="linenos">1938</span></a>                                    <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span>
</span><span id="Project-1939"><a href="#Project-1939"><span class="linenos">1939</span></a>                                <span class="p">]</span>
</span><span id="Project-1940"><a href="#Project-1940"><span class="linenos">1940</span></a>                            <span class="p">)</span>
</span><span id="Project-1941"><a href="#Project-1941"><span class="linenos">1941</span></a>                        <span class="p">)</span>
</span><span id="Project-1942"><a href="#Project-1942"><span class="linenos">1942</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1943"><a href="#Project-1943"><span class="linenos">1943</span></a>                        <span class="n">tracked_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">()</span>
</span><span id="Project-1944"><a href="#Project-1944"><span class="linenos">1944</span></a>                        <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="Project-1945"><a href="#Project-1945"><span class="linenos">1945</span></a>                            <span class="n">log</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">))</span>
</span><span id="Project-1946"><a href="#Project-1946"><span class="linenos">1946</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1947"><a href="#Project-1947"><span class="linenos">1947</span></a>                            <span class="n">relevant</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-1948"><a href="#Project-1948"><span class="linenos">1948</span></a>                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="Project-1949"><a href="#Project-1949"><span class="linenos">1949</span></a>                                <span class="n">m_split</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="Project-1950"><a href="#Project-1950"><span class="linenos">1950</span></a>                                <span class="k">if</span> <span class="p">(</span>
</span><span id="Project-1951"><a href="#Project-1951"><span class="linenos">1951</span></a>                                    <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m_split</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">metric</span>
</span><span id="Project-1952"><a href="#Project-1952"><span class="linenos">1952</span></a>                                    <span class="ow">and</span> <span class="n">m_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span>
</span><span id="Project-1953"><a href="#Project-1953"><span class="linenos">1953</span></a>                                <span class="p">):</span>
</span><span id="Project-1954"><a href="#Project-1954"><span class="linenos">1954</span></a>                                    <span class="n">relevant</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="Project-1955"><a href="#Project-1955"><span class="linenos">1955</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-1956"><a href="#Project-1956"><span class="linenos">1956</span></a>                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-1957"><a href="#Project-1957"><span class="linenos">1957</span></a>                                    <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> metric was not tracked at </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-1958"><a href="#Project-1958"><span class="linenos">1958</span></a>                                <span class="p">)</span>
</span><span id="Project-1959"><a href="#Project-1959"><span class="linenos">1959</span></a>                            <span class="n">arr</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-1960"><a href="#Project-1960"><span class="linenos">1960</span></a>                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
</span><span id="Project-1961"><a href="#Project-1961"><span class="linenos">1961</span></a>                                <span class="n">arr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</span><span id="Project-1962"><a href="#Project-1962"><span class="linenos">1962</span></a>                            <span class="n">arr</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span>
</span><span id="Project-1963"><a href="#Project-1963"><span class="linenos">1963</span></a>                            <span class="n">log</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="Project-1964"><a href="#Project-1964"><span class="linenos">1964</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="Project-1965"><a href="#Project-1965"><span class="linenos">1965</span></a>                <span class="n">logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="Project-1966"><a href="#Project-1966"><span class="linenos">1966</span></a>        <span class="c1"># if episode_labels is not None:</span>
</span><span id="Project-1967"><a href="#Project-1967"><span class="linenos">1967</span></a>        <span class="c1">#     print(f&#39;{len(episode_labels)=}, {len(logs)=}&#39;)</span>
</span><span id="Project-1968"><a href="#Project-1968"><span class="linenos">1968</span></a>        <span class="c1">#     if len(episode_labels) != len(logs):</span>
</span><span id="Project-1969"><a href="#Project-1969"><span class="linenos">1969</span></a>
</span><span id="Project-1970"><a href="#Project-1970"><span class="linenos">1970</span></a>        <span class="c1">#         raise ValueError(</span>
</span><span id="Project-1971"><a href="#Project-1971"><span class="linenos">1971</span></a>        <span class="c1">#             f&quot;The length of episode_labels ({len(episode_labels)}) has to be equal to the length of &quot;</span>
</span><span id="Project-1972"><a href="#Project-1972"><span class="linenos">1972</span></a>        <span class="c1">#             f&quot;curves ({len(logs)})!&quot;</span>
</span><span id="Project-1973"><a href="#Project-1973"><span class="linenos">1973</span></a>        <span class="c1">#         )</span>
</span><span id="Project-1974"><a href="#Project-1974"><span class="linenos">1974</span></a>        <span class="c1">#     else:</span>
</span><span id="Project-1975"><a href="#Project-1975"><span class="linenos">1975</span></a>        <span class="c1">#         labels = episode_labels</span>
</span><span id="Project-1976"><a href="#Project-1976"><span class="linenos">1976</span></a>        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-1977"><a href="#Project-1977"><span class="linenos">1977</span></a>            <span class="n">colors</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">logs</span><span class="p">)))</span>
</span><span id="Project-1978"><a href="#Project-1978"><span class="linenos">1978</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">logs</span><span class="p">):</span>
</span><span id="Project-1979"><a href="#Project-1979"><span class="linenos">1979</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-1980"><a href="#Project-1980"><span class="linenos">1980</span></a>                <span class="s2">&quot;The length of colors has to be equal to the length of curves (metrics * modes * episode_names)!&quot;</span>
</span><span id="Project-1981"><a href="#Project-1981"><span class="linenos">1981</span></a>            <span class="p">)</span>
</span><span id="Project-1982"><a href="#Project-1982"><span class="linenos">1982</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="Project-1983"><a href="#Project-1983"><span class="linenos">1983</span></a>        <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-1984"><a href="#Project-1984"><span class="linenos">1984</span></a>        <span class="k">for</span> <span class="n">log</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">epoch_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">logs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">epochs</span><span class="p">):</span>
</span><span id="Project-1985"><a href="#Project-1985"><span class="linenos">1985</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="Project-1986"><a href="#Project-1986"><span class="linenos">1986</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
</span><span id="Project-1987"><a href="#Project-1987"><span class="linenos">1987</span></a>                    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="Project-1988"><a href="#Project-1988"><span class="linenos">1988</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Project-1989"><a href="#Project-1989"><span class="linenos">1989</span></a>                    <span class="n">epoch_list</span><span class="p">,</span>
</span><span id="Project-1990"><a href="#Project-1990"><span class="linenos">1990</span></a>                    <span class="n">log</span><span class="p">,</span>
</span><span id="Project-1991"><a href="#Project-1991"><span class="linenos">1991</span></a>                    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="Project-1992"><a href="#Project-1992"><span class="linenos">1992</span></a>                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="Project-1993"><a href="#Project-1993"><span class="linenos">1993</span></a>                <span class="p">)</span>
</span><span id="Project-1994"><a href="#Project-1994"><span class="linenos">1994</span></a>                <span class="k">if</span> <span class="n">add_highpoint_hlines</span><span class="p">:</span>
</span><span id="Project-1995"><a href="#Project-1995"><span class="linenos">1995</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">log</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span><span id="Project-1996"><a href="#Project-1996"><span class="linenos">1996</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-1997"><a href="#Project-1997"><span class="linenos">1997</span></a>                <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">xx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">epoch_list</span><span class="p">):</span>
</span><span id="Project-1998"><a href="#Project-1998"><span class="linenos">1998</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
</span><span id="Project-1999"><a href="#Project-1999"><span class="linenos">1999</span></a>                        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="Project-2000"><a href="#Project-2000"><span class="linenos">2000</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Project-2001"><a href="#Project-2001"><span class="linenos">2001</span></a>                        <span class="n">xx</span><span class="p">,</span>
</span><span id="Project-2002"><a href="#Project-2002"><span class="linenos">2002</span></a>                        <span class="n">l</span><span class="p">,</span>
</span><span id="Project-2003"><a href="#Project-2003"><span class="linenos">2003</span></a>                        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="Project-2004"><a href="#Project-2004"><span class="linenos">2004</span></a>                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="Project-2005"><a href="#Project-2005"><span class="linenos">2005</span></a>                    <span class="p">)</span>
</span><span id="Project-2006"><a href="#Project-2006"><span class="linenos">2006</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">log</span><span class="p">]):</span>
</span><span id="Project-2007"><a href="#Project-2007"><span class="linenos">2007</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Project-2008"><a href="#Project-2008"><span class="linenos">2008</span></a>                        <span class="sa">f</span><span class="s2">&quot;Got logs with unequal lengths in parallel runs for </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-2009"><a href="#Project-2009"><span class="linenos">2009</span></a>                    <span class="p">)</span>
</span><span id="Project-2010"><a href="#Project-2010"><span class="linenos">2010</span></a>                    <span class="n">log</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="Project-2011"><a href="#Project-2011"><span class="linenos">2011</span></a>                    <span class="n">epoch_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">)</span>
</span><span id="Project-2012"><a href="#Project-2012"><span class="linenos">2012</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">):</span>
</span><span id="Project-2013"><a href="#Project-2013"><span class="linenos">2013</span></a>                        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-2014"><a href="#Project-2014"><span class="linenos">2014</span></a>                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
</span><span id="Project-2015"><a href="#Project-2015"><span class="linenos">2015</span></a>                            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="Project-2016"><a href="#Project-2016"><span class="linenos">2016</span></a>                                <span class="n">y_ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="Project-2017"><a href="#Project-2017"><span class="linenos">2017</span></a>                                <span class="n">to_remove</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">y_ind</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
</span><span id="Project-2018"><a href="#Project-2018"><span class="linenos">2018</span></a>                        <span class="n">epoch_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-2019"><a href="#Project-2019"><span class="linenos">2019</span></a>                            <span class="n">y</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_remove</span>
</span><span id="Project-2020"><a href="#Project-2020"><span class="linenos">2020</span></a>                        <span class="p">]</span>
</span><span id="Project-2021"><a href="#Project-2021"><span class="linenos">2021</span></a>                        <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">]</span>
</span><span id="Project-2022"><a href="#Project-2022"><span class="linenos">2022</span></a>                    <span class="n">length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">log</span><span class="p">])</span>
</span><span id="Project-2023"><a href="#Project-2023"><span class="linenos">2023</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)):</span>
</span><span id="Project-2024"><a href="#Project-2024"><span class="linenos">2024</span></a>                        <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="n">length</span><span class="p">]</span>
</span><span id="Project-2025"><a href="#Project-2025"><span class="linenos">2025</span></a>                        <span class="n">epoch_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoch_list</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="n">length</span><span class="p">]</span>
</span><span id="Project-2026"><a href="#Project-2026"><span class="linenos">2026</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">==</span> <span class="n">epoch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">epoch_list</span><span class="p">]):</span>
</span><span id="Project-2027"><a href="#Project-2027"><span class="linenos">2027</span></a>                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Project-2028"><a href="#Project-2028"><span class="linenos">2028</span></a>                            <span class="sa">f</span><span class="s2">&quot;Got different epoch indices in parallel runs for </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-2029"><a href="#Project-2029"><span class="linenos">2029</span></a>                        <span class="p">)</span>
</span><span id="Project-2030"><a href="#Project-2030"><span class="linenos">2030</span></a>                <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">log</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Project-2031"><a href="#Project-2031"><span class="linenos">2031</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Project-2032"><a href="#Project-2032"><span class="linenos">2032</span></a>                    <span class="n">epoch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Project-2033"><a href="#Project-2033"><span class="linenos">2033</span></a>                    <span class="n">mean</span><span class="p">,</span>
</span><span id="Project-2034"><a href="#Project-2034"><span class="linenos">2034</span></a>                    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="Project-2035"><a href="#Project-2035"><span class="linenos">2035</span></a>                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="Project-2036"><a href="#Project-2036"><span class="linenos">2036</span></a>                <span class="p">)</span>
</span><span id="Project-2037"><a href="#Project-2037"><span class="linenos">2037</span></a>                <span class="k">if</span> <span class="n">add_highpoint_hlines</span><span class="p">:</span>
</span><span id="Project-2038"><a href="#Project-2038"><span class="linenos">2038</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mean</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span><span id="Project-2039"><a href="#Project-2039"><span class="linenos">2039</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">add_hlines</span><span class="p">:</span>
</span><span id="Project-2040"><a href="#Project-2040"><span class="linenos">2040</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-2041"><a href="#Project-2041"><span class="linenos">2041</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
</span><span id="Project-2042"><a href="#Project-2042"><span class="linenos">2042</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="Project-2043"><a href="#Project-2043"><span class="linenos">2043</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
</span><span id="Project-2044"><a href="#Project-2044"><span class="linenos">2044</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
</span><span id="Project-2045"><a href="#Project-2045"><span class="linenos">2045</span></a>
</span><span id="Project-2046"><a href="#Project-2046"><span class="linenos">2046</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="Project-2047"><a href="#Project-2047"><span class="linenos">2047</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;epochs&quot;</span><span class="p">)</span>
</span><span id="Project-2048"><a href="#Project-2048"><span class="linenos">2048</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-2049"><a href="#Project-2049"><span class="linenos">2049</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Project-2050"><a href="#Project-2050"><span class="linenos">2050</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2051"><a href="#Project-2051"><span class="linenos">2051</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
</span><span id="Project-2052"><a href="#Project-2052"><span class="linenos">2052</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2053"><a href="#Project-2053"><span class="linenos">2053</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">episode_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-2054"><a href="#Project-2054"><span class="linenos">2054</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">episode_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-2055"><a href="#Project-2055"><span class="linenos">2055</span></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-2056"><a href="#Project-2056"><span class="linenos">2056</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-2057"><a href="#Project-2057"><span class="linenos">2057</span></a>        <span class="k">if</span> <span class="n">epoch_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2058"><a href="#Project-2058"><span class="linenos">2058</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">epoch_limits</span><span class="p">)</span>
</span><span id="Project-2059"><a href="#Project-2059"><span class="linenos">2059</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2060"><a href="#Project-2060"><span class="linenos">2060</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="Project-2061"><a href="#Project-2061"><span class="linenos">2061</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Project-2062"><a href="#Project-2062"><span class="linenos">2062</span></a>        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2063"><a href="#Project-2063"><span class="linenos">2063</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
</span><span id="Project-2064"><a href="#Project-2064"><span class="linenos">2064</span></a>
</span><span id="Project-2065"><a href="#Project-2065"><span class="linenos">2065</span></a>    <span class="k">def</span> <span class="nf">update_parameters</span><span class="p">(</span>
</span><span id="Project-2066"><a href="#Project-2066"><span class="linenos">2066</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-2067"><a href="#Project-2067"><span class="linenos">2067</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-2068"><a href="#Project-2068"><span class="linenos">2068</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-2069"><a href="#Project-2069"><span class="linenos">2069</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-2070"><a href="#Project-2070"><span class="linenos">2070</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-2071"><a href="#Project-2071"><span class="linenos">2071</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2072"><a href="#Project-2072"><span class="linenos">2072</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2073"><a href="#Project-2073"><span class="linenos">2073</span></a><span class="sd">        Update the parameters in the project config files</span>
</span><span id="Project-2074"><a href="#Project-2074"><span class="linenos">2074</span></a>
</span><span id="Project-2075"><a href="#Project-2075"><span class="linenos">2075</span></a><span class="sd">        Parameters</span>
</span><span id="Project-2076"><a href="#Project-2076"><span class="linenos">2076</span></a><span class="sd">        ----------</span>
</span><span id="Project-2077"><a href="#Project-2077"><span class="linenos">2077</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-2078"><a href="#Project-2078"><span class="linenos">2078</span></a><span class="sd">            a dictionary of parameter updates</span>
</span><span id="Project-2079"><a href="#Project-2079"><span class="linenos">2079</span></a><span class="sd">        load_search : str, optional</span>
</span><span id="Project-2080"><a href="#Project-2080"><span class="linenos">2080</span></a><span class="sd">            the name of hyperparameter search results to load to config</span>
</span><span id="Project-2081"><a href="#Project-2081"><span class="linenos">2081</span></a><span class="sd">        load_parameters : list, optional</span>
</span><span id="Project-2082"><a href="#Project-2082"><span class="linenos">2082</span></a><span class="sd">            a list of lists of string names of the parameters to load from the searches</span>
</span><span id="Project-2083"><a href="#Project-2083"><span class="linenos">2083</span></a><span class="sd">        round_to_binary : list, optional</span>
</span><span id="Project-2084"><a href="#Project-2084"><span class="linenos">2084</span></a><span class="sd">            a list of string names of the loaded parameters that should be rounded to the nearest power of two</span>
</span><span id="Project-2085"><a href="#Project-2085"><span class="linenos">2085</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2086"><a href="#Project-2086"><span class="linenos">2086</span></a>
</span><span id="Project-2087"><a href="#Project-2087"><span class="linenos">2087</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-2088"><a href="#Project-2088"><span class="linenos">2088</span></a>            <span class="s2">&quot;general&quot;</span><span class="p">,</span>
</span><span id="Project-2089"><a href="#Project-2089"><span class="linenos">2089</span></a>            <span class="s2">&quot;losses&quot;</span><span class="p">,</span>
</span><span id="Project-2090"><a href="#Project-2090"><span class="linenos">2090</span></a>            <span class="s2">&quot;metrics&quot;</span><span class="p">,</span>
</span><span id="Project-2091"><a href="#Project-2091"><span class="linenos">2091</span></a>            <span class="s2">&quot;ssl&quot;</span><span class="p">,</span>
</span><span id="Project-2092"><a href="#Project-2092"><span class="linenos">2092</span></a>            <span class="s2">&quot;training&quot;</span><span class="p">,</span>
</span><span id="Project-2093"><a href="#Project-2093"><span class="linenos">2093</span></a>            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
</span><span id="Project-2094"><a href="#Project-2094"><span class="linenos">2094</span></a>        <span class="p">]</span>
</span><span id="Project-2095"><a href="#Project-2095"><span class="linenos">2095</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">(</span><span class="n">catch_blanks</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Project-2096"><a href="#Project-2096"><span class="linenos">2096</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2097"><a href="#Project-2097"><span class="linenos">2097</span></a>            <span class="k">if</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">parameters_update</span><span class="p">:</span>
</span><span id="Project-2098"><a href="#Project-2098"><span class="linenos">2098</span></a>                <span class="n">model_params</span> <span class="o">=</span> <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="Project-2099"><a href="#Project-2099"><span class="linenos">2099</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2100"><a href="#Project-2100"><span class="linenos">2100</span></a>                <span class="n">model_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-2101"><a href="#Project-2101"><span class="linenos">2101</span></a>            <span class="k">if</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">parameters_update</span><span class="p">:</span>
</span><span id="Project-2102"><a href="#Project-2102"><span class="linenos">2102</span></a>                <span class="n">feat_params</span> <span class="o">=</span> <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
</span><span id="Project-2103"><a href="#Project-2103"><span class="linenos">2103</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2104"><a href="#Project-2104"><span class="linenos">2104</span></a>                <span class="n">feat_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-2105"><a href="#Project-2105"><span class="linenos">2105</span></a>            <span class="k">if</span> <span class="s2">&quot;augmentations&quot;</span> <span class="ow">in</span> <span class="n">parameters_update</span><span class="p">:</span>
</span><span id="Project-2106"><a href="#Project-2106"><span class="linenos">2106</span></a>                <span class="n">aug_params</span> <span class="o">=</span> <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;augmentations&quot;</span><span class="p">)</span>
</span><span id="Project-2107"><a href="#Project-2107"><span class="linenos">2107</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2108"><a href="#Project-2108"><span class="linenos">2108</span></a>                <span class="n">aug_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-2109"><a href="#Project-2109"><span class="linenos">2109</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">parameters_update</span><span class="p">)</span>
</span><span id="Project-2110"><a href="#Project-2110"><span class="linenos">2110</span></a>            <span class="n">model_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="Project-2111"><a href="#Project-2111"><span class="linenos">2111</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-2112"><a href="#Project-2112"><span class="linenos">2112</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="Project-2113"><a href="#Project-2113"><span class="linenos">2113</span></a>            <span class="p">)</span>
</span><span id="Project-2114"><a href="#Project-2114"><span class="linenos">2114</span></a>            <span class="k">if</span> <span class="n">model_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2115"><a href="#Project-2115"><span class="linenos">2115</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">model_params</span><span class="p">)</span>
</span><span id="Project-2116"><a href="#Project-2116"><span class="linenos">2116</span></a>            <span class="n">feat_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="Project-2117"><a href="#Project-2117"><span class="linenos">2117</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-2118"><a href="#Project-2118"><span class="linenos">2118</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2119"><a href="#Project-2119"><span class="linenos">2119</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feat_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project-2120"><a href="#Project-2120"><span class="linenos">2120</span></a>                <span class="p">)</span>
</span><span id="Project-2121"><a href="#Project-2121"><span class="linenos">2121</span></a>            <span class="p">)</span>
</span><span id="Project-2122"><a href="#Project-2122"><span class="linenos">2122</span></a>            <span class="k">if</span> <span class="n">feat_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2123"><a href="#Project-2123"><span class="linenos">2123</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project-2124"><a href="#Project-2124"><span class="linenos">2124</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">feat_params</span>
</span><span id="Project-2125"><a href="#Project-2125"><span class="linenos">2125</span></a>                <span class="p">)</span>
</span><span id="Project-2126"><a href="#Project-2126"><span class="linenos">2126</span></a>            <span class="n">aug_name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">extractor_to_transformer</span><span class="p">[</span>
</span><span id="Project-2127"><a href="#Project-2127"><span class="linenos">2127</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="Project-2128"><a href="#Project-2128"><span class="linenos">2128</span></a>            <span class="p">]</span>
</span><span id="Project-2129"><a href="#Project-2129"><span class="linenos">2129</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-2130"><a href="#Project-2130"><span class="linenos">2130</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2131"><a href="#Project-2131"><span class="linenos">2131</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aug_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project-2132"><a href="#Project-2132"><span class="linenos">2132</span></a>                <span class="p">)</span>
</span><span id="Project-2133"><a href="#Project-2133"><span class="linenos">2133</span></a>            <span class="p">)</span>
</span><span id="Project-2134"><a href="#Project-2134"><span class="linenos">2134</span></a>            <span class="k">if</span> <span class="n">aug_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2135"><a href="#Project-2135"><span class="linenos">2135</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project-2136"><a href="#Project-2136"><span class="linenos">2136</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">],</span> <span class="n">aug_params</span>
</span><span id="Project-2137"><a href="#Project-2137"><span class="linenos">2137</span></a>                <span class="p">)</span>
</span><span id="Project-2138"><a href="#Project-2138"><span class="linenos">2138</span></a>        <span class="k">if</span> <span class="n">load_search</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2139"><a href="#Project-2139"><span class="linenos">2139</span></a>            <span class="n">parameters_update</span><span class="p">,</span> <span class="n">model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">get_best_params</span><span class="p">(</span>
</span><span id="Project-2140"><a href="#Project-2140"><span class="linenos">2140</span></a>                <span class="n">load_search</span><span class="p">,</span> <span class="n">load_parameters</span><span class="p">,</span> <span class="n">round_to_binary</span>
</span><span id="Project-2141"><a href="#Project-2141"><span class="linenos">2141</span></a>            <span class="p">)</span>
</span><span id="Project-2142"><a href="#Project-2142"><span class="linenos">2142</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_name</span>
</span><span id="Project-2143"><a href="#Project-2143"><span class="linenos">2143</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-2144"><a href="#Project-2144"><span class="linenos">2144</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="Project-2145"><a href="#Project-2145"><span class="linenos">2145</span></a>            <span class="p">)</span>
</span><span id="Project-2146"><a href="#Project-2146"><span class="linenos">2146</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">parameters_update</span><span class="p">)</span>
</span><span id="Project-2147"><a href="#Project-2147"><span class="linenos">2147</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="Project-2148"><a href="#Project-2148"><span class="linenos">2148</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="Project-2149"><a href="#Project-2149"><span class="linenos">2149</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
</span><span id="Project-2150"><a href="#Project-2150"><span class="linenos">2150</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2151"><a href="#Project-2151"><span class="linenos">2151</span></a>                <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project-2152"><a href="#Project-2152"><span class="linenos">2152</span></a>        <span class="n">model_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="Project-2153"><a href="#Project-2153"><span class="linenos">2153</span></a>        <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2154"><a href="#Project-2154"><span class="linenos">2154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project-2155"><a href="#Project-2155"><span class="linenos">2155</span></a>        <span class="p">)</span>
</span><span id="Project-2156"><a href="#Project-2156"><span class="linenos">2156</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2157"><a href="#Project-2157"><span class="linenos">2157</span></a>            <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project-2158"><a href="#Project-2158"><span class="linenos">2158</span></a>        <span class="n">features_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="Project-2159"><a href="#Project-2159"><span class="linenos">2159</span></a>        <span class="n">features_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2160"><a href="#Project-2160"><span class="linenos">2160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">features_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project-2161"><a href="#Project-2161"><span class="linenos">2161</span></a>        <span class="p">)</span>
</span><span id="Project-2162"><a href="#Project-2162"><span class="linenos">2162</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">features_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2163"><a href="#Project-2163"><span class="linenos">2163</span></a>            <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project-2164"><a href="#Project-2164"><span class="linenos">2164</span></a>        <span class="n">aug_name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">extractor_to_transformer</span><span class="p">[</span><span class="n">features_name</span><span class="p">]</span>
</span><span id="Project-2165"><a href="#Project-2165"><span class="linenos">2165</span></a>        <span class="n">aug_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2166"><a href="#Project-2166"><span class="linenos">2166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aug_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project-2167"><a href="#Project-2167"><span class="linenos">2167</span></a>        <span class="p">)</span>
</span><span id="Project-2168"><a href="#Project-2168"><span class="linenos">2168</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">aug_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2169"><a href="#Project-2169"><span class="linenos">2169</span></a>            <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project-2170"><a href="#Project-2170"><span class="linenos">2170</span></a>
</span><span id="Project-2171"><a href="#Project-2171"><span class="linenos">2171</span></a>    <span class="k">def</span> <span class="nf">get_summary</span><span class="p">(</span>
</span><span id="Project-2172"><a href="#Project-2172"><span class="linenos">2172</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-2173"><a href="#Project-2173"><span class="linenos">2173</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="Project-2174"><a href="#Project-2174"><span class="linenos">2174</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span>
</span><span id="Project-2175"><a href="#Project-2175"><span class="linenos">2175</span></a>        <span class="n">average</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project-2176"><a href="#Project-2176"><span class="linenos">2176</span></a>        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-2177"><a href="#Project-2177"><span class="linenos">2177</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-2178"><a href="#Project-2178"><span class="linenos">2178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2179"><a href="#Project-2179"><span class="linenos">2179</span></a><span class="sd">        Get a summary of episode statistics</span>
</span><span id="Project-2180"><a href="#Project-2180"><span class="linenos">2180</span></a>
</span><span id="Project-2181"><a href="#Project-2181"><span class="linenos">2181</span></a><span class="sd">        If the episode has multiple runs, the statistics will be aggregated over all of them.</span>
</span><span id="Project-2182"><a href="#Project-2182"><span class="linenos">2182</span></a>
</span><span id="Project-2183"><a href="#Project-2183"><span class="linenos">2183</span></a><span class="sd">        Parameters</span>
</span><span id="Project-2184"><a href="#Project-2184"><span class="linenos">2184</span></a><span class="sd">        ----------</span>
</span><span id="Project-2185"><a href="#Project-2185"><span class="linenos">2185</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project-2186"><a href="#Project-2186"><span class="linenos">2186</span></a><span class="sd">            the name of the episode</span>
</span><span id="Project-2187"><a href="#Project-2187"><span class="linenos">2187</span></a><span class="sd">        method : [&quot;best&quot;, &quot;last&quot;]</span>
</span><span id="Project-2188"><a href="#Project-2188"><span class="linenos">2188</span></a><span class="sd">            the method for choosing the epochs</span>
</span><span id="Project-2189"><a href="#Project-2189"><span class="linenos">2189</span></a><span class="sd">        average : int, default 1</span>
</span><span id="Project-2190"><a href="#Project-2190"><span class="linenos">2190</span></a><span class="sd">            the number of epochs to average over (for each run)</span>
</span><span id="Project-2191"><a href="#Project-2191"><span class="linenos">2191</span></a><span class="sd">        metrics : list, optional</span>
</span><span id="Project-2192"><a href="#Project-2192"><span class="linenos">2192</span></a><span class="sd">            a list of metrics</span>
</span><span id="Project-2193"><a href="#Project-2193"><span class="linenos">2193</span></a>
</span><span id="Project-2194"><a href="#Project-2194"><span class="linenos">2194</span></a><span class="sd">        Returns</span>
</span><span id="Project-2195"><a href="#Project-2195"><span class="linenos">2195</span></a><span class="sd">        -------</span>
</span><span id="Project-2196"><a href="#Project-2196"><span class="linenos">2196</span></a><span class="sd">        statistics : dict</span>
</span><span id="Project-2197"><a href="#Project-2197"><span class="linenos">2197</span></a><span class="sd">            a nested dictionary where first-level keys are metric names and second-level keys are &#39;mean&#39; for the mean</span>
</span><span id="Project-2198"><a href="#Project-2198"><span class="linenos">2198</span></a><span class="sd">            and &#39;std&#39; for the standard deviation</span>
</span><span id="Project-2199"><a href="#Project-2199"><span class="linenos">2199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2200"><a href="#Project-2200"><span class="linenos">2200</span></a>
</span><span id="Project-2201"><a href="#Project-2201"><span class="linenos">2201</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-2202"><a href="#Project-2202"><span class="linenos">2202</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="Project-2203"><a href="#Project-2203"><span class="linenos">2203</span></a>            <span class="n">runs_ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-2204"><a href="#Project-2204"><span class="linenos">2204</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs_ep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-2205"><a href="#Project-2205"><span class="linenos">2205</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Project-2206"><a href="#Project-2206"><span class="linenos">2206</span></a>                    <span class="sa">f</span><span class="s2">&quot;There is no </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> episode in the project memory&quot;</span>
</span><span id="Project-2207"><a href="#Project-2207"><span class="linenos">2207</span></a>                <span class="p">)</span>
</span><span id="Project-2208"><a href="#Project-2208"><span class="linenos">2208</span></a>            <span class="n">runs</span> <span class="o">+=</span> <span class="n">runs_ep</span>
</span><span id="Project-2209"><a href="#Project-2209"><span class="linenos">2209</span></a>        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2210"><a href="#Project-2210"><span class="linenos">2210</span></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">()</span>
</span><span id="Project-2211"><a href="#Project-2211"><span class="linenos">2211</span></a>
</span><span id="Project-2212"><a href="#Project-2212"><span class="linenos">2212</span></a>        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">}</span>
</span><span id="Project-2213"><a href="#Project-2213"><span class="linenos">2213</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project-2214"><a href="#Project-2214"><span class="linenos">2214</span></a>            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
</span><span id="Project-2215"><a href="#Project-2215"><span class="linenos">2215</span></a>                <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
</span><span id="Project-2216"><a href="#Project-2216"><span class="linenos">2216</span></a>                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;best&quot;</span><span class="p">:</span>
</span><span id="Project-2217"><a href="#Project-2217"><span class="linenos">2217</span></a>                    <span class="n">log</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="Project-2218"><a href="#Project-2218"><span class="linenos">2218</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="o">-</span><span class="n">average</span><span class="p">:])</span>
</span><span id="Project-2219"><a href="#Project-2219"><span class="linenos">2219</span></a>                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
</span><span id="Project-2220"><a href="#Project-2220"><span class="linenos">2220</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-2221"><a href="#Project-2221"><span class="linenos">2221</span></a>                        <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
</span><span id="Project-2222"><a href="#Project-2222"><span class="linenos">2222</span></a>                        <span class="k">if</span> <span class="n">average</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Project-2223"><a href="#Project-2223"><span class="linenos">2223</span></a>                            <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">episodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">run</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">)]]</span>
</span><span id="Project-2224"><a href="#Project-2224"><span class="linenos">2224</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2225"><a href="#Project-2225"><span class="linenos">2225</span></a>                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Did not find </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2"> metric for </span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2"> run&quot;</span><span class="p">)</span>
</span><span id="Project-2226"><a href="#Project-2226"><span class="linenos">2226</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="o">-</span><span class="n">average</span><span class="p">:])</span>
</span><span id="Project-2227"><a href="#Project-2227"><span class="linenos">2227</span></a>                <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;epoch&quot;</span><span class="p">):</span>
</span><span id="Project-2228"><a href="#Project-2228"><span class="linenos">2228</span></a>                    <span class="n">epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">method</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Project-2229"><a href="#Project-2229"><span class="linenos">2229</span></a>                    <span class="n">pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="Project-2230"><a href="#Project-2230"><span class="linenos">2230</span></a>                    <span class="n">step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;validation_interval&quot;</span><span class="p">])</span>
</span><span id="Project-2231"><a href="#Project-2231"><span class="linenos">2231</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">log</span><span class="p">[</span><span class="n">epoch</span> <span class="o">//</span> <span class="n">step</span><span class="p">]]</span>
</span><span id="Project-2232"><a href="#Project-2232"><span class="linenos">2232</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2233"><a href="#Project-2233"><span class="linenos">2233</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-2234"><a href="#Project-2234"><span class="linenos">2234</span></a>                        <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> method is not recognized! Please choose from [&#39;last&#39;, &#39;best&#39;, &#39;epoch...&#39;]&quot;</span>
</span><span id="Project-2235"><a href="#Project-2235"><span class="linenos">2235</span></a>                    <span class="p">)</span>
</span><span id="Project-2236"><a href="#Project-2236"><span class="linenos">2236</span></a>        <span class="n">statistics</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="Project-2237"><a href="#Project-2237"><span class="linenos">2237</span></a>        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-2238"><a href="#Project-2238"><span class="linenos">2238</span></a>            <span class="n">statistics</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="Project-2239"><a href="#Project-2239"><span class="linenos">2239</span></a>            <span class="n">statistics</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="Project-2240"><a href="#Project-2240"><span class="linenos">2240</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SUMMARY </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-2241"><a href="#Project-2241"><span class="linenos">2241</span></a>        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">statistics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-2242"><a href="#Project-2242"><span class="linenos">2242</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">: mean </span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project-2243"><a href="#Project-2243"><span class="linenos">2243</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-2244"><a href="#Project-2244"><span class="linenos">2244</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">statistics</span><span class="p">)</span>
</span><span id="Project-2245"><a href="#Project-2245"><span class="linenos">2245</span></a>
</span><span id="Project-2246"><a href="#Project-2246"><span class="linenos">2246</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Project-2247"><a href="#Project-2247"><span class="linenos">2247</span></a>    <span class="k">def</span> <span class="nf">remove_project</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2248"><a href="#Project-2248"><span class="linenos">2248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2249"><a href="#Project-2249"><span class="linenos">2249</span></a><span class="sd">        Remove all project files and experiment records and results</span>
</span><span id="Project-2250"><a href="#Project-2250"><span class="linenos">2250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2251"><a href="#Project-2251"><span class="linenos">2251</span></a>
</span><span id="Project-2252"><a href="#Project-2252"><span class="linenos">2252</span></a>        <span class="k">if</span> <span class="n">projects_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2253"><a href="#Project-2253"><span class="linenos">2253</span></a>            <span class="n">projects_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()),</span> <span class="s2">&quot;DLC2Action&quot;</span><span class="p">)</span>
</span><span id="Project-2254"><a href="#Project-2254"><span class="linenos">2254</span></a>        <span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="Project-2255"><a href="#Project-2255"><span class="linenos">2255</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
</span><span id="Project-2256"><a href="#Project-2256"><span class="linenos">2256</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="Project-2257"><a href="#Project-2257"><span class="linenos">2257</span></a>
</span><span id="Project-2258"><a href="#Project-2258"><span class="linenos">2258</span></a>    <span class="k">def</span> <span class="nf">remove_saved_features</span><span class="p">(</span>
</span><span id="Project-2259"><a href="#Project-2259"><span class="linenos">2259</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-2260"><a href="#Project-2260"><span class="linenos">2260</span></a>        <span class="n">dataset_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-2261"><a href="#Project-2261"><span class="linenos">2261</span></a>        <span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-2262"><a href="#Project-2262"><span class="linenos">2262</span></a>        <span class="n">remove_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-2263"><a href="#Project-2263"><span class="linenos">2263</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2264"><a href="#Project-2264"><span class="linenos">2264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2265"><a href="#Project-2265"><span class="linenos">2265</span></a><span class="sd">        Remove saved pre-computed dataset files</span>
</span><span id="Project-2266"><a href="#Project-2266"><span class="linenos">2266</span></a>
</span><span id="Project-2267"><a href="#Project-2267"><span class="linenos">2267</span></a><span class="sd">        By default, all pre-computed features will be deleted.</span>
</span><span id="Project-2268"><a href="#Project-2268"><span class="linenos">2268</span></a><span class="sd">        No essential information can get lost, storing them only saves time. Be careful with deleting datasets</span>
</span><span id="Project-2269"><a href="#Project-2269"><span class="linenos">2269</span></a><span class="sd">        while training or inference is happening though.</span>
</span><span id="Project-2270"><a href="#Project-2270"><span class="linenos">2270</span></a>
</span><span id="Project-2271"><a href="#Project-2271"><span class="linenos">2271</span></a><span class="sd">        Parameters</span>
</span><span id="Project-2272"><a href="#Project-2272"><span class="linenos">2272</span></a><span class="sd">        ----------</span>
</span><span id="Project-2273"><a href="#Project-2273"><span class="linenos">2273</span></a><span class="sd">        dataset_names : list, optional</span>
</span><span id="Project-2274"><a href="#Project-2274"><span class="linenos">2274</span></a><span class="sd">            a list of dataset names to delete (by default all names are added)</span>
</span><span id="Project-2275"><a href="#Project-2275"><span class="linenos">2275</span></a><span class="sd">        exceptions : list, optional</span>
</span><span id="Project-2276"><a href="#Project-2276"><span class="linenos">2276</span></a><span class="sd">            a list of dataset names to not be deleted</span>
</span><span id="Project-2277"><a href="#Project-2277"><span class="linenos">2277</span></a><span class="sd">        remove_active : bool, default False</span>
</span><span id="Project-2278"><a href="#Project-2278"><span class="linenos">2278</span></a><span class="sd">            if `False`, datasets used by unfinished episodes will not be deleted</span>
</span><span id="Project-2279"><a href="#Project-2279"><span class="linenos">2279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2280"><a href="#Project-2280"><span class="linenos">2280</span></a>
</span><span id="Project-2281"><a href="#Project-2281"><span class="linenos">2281</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing datasets...&quot;</span><span class="p">)</span>
</span><span id="Project-2282"><a href="#Project-2282"><span class="linenos">2282</span></a>        <span class="k">if</span> <span class="n">dataset_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2283"><a href="#Project-2283"><span class="linenos">2283</span></a>            <span class="n">dataset_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-2284"><a href="#Project-2284"><span class="linenos">2284</span></a>        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2285"><a href="#Project-2285"><span class="linenos">2285</span></a>            <span class="n">exceptions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-2286"><a href="#Project-2286"><span class="linenos">2286</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">remove_active</span><span class="p">:</span>
</span><span id="Project-2287"><a href="#Project-2287"><span class="linenos">2287</span></a>            <span class="n">exceptions</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_active_datasets</span><span class="p">()</span>
</span><span id="Project-2288"><a href="#Project-2288"><span class="linenos">2288</span></a>        <span class="n">dataset_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;saved_datasets&quot;</span><span class="p">)</span>
</span><span id="Project-2289"><a href="#Project-2289"><span class="linenos">2289</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">):</span>
</span><span id="Project-2290"><a href="#Project-2290"><span class="linenos">2290</span></a>            <span class="k">if</span> <span class="n">dataset_names</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="Project-2291"><a href="#Project-2291"><span class="linenos">2291</span></a>                <span class="n">dataset_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">)])</span>
</span><span id="Project-2292"><a href="#Project-2292"><span class="linenos">2292</span></a>
</span><span id="Project-2293"><a href="#Project-2293"><span class="linenos">2293</span></a>            <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-2294"><a href="#Project-2294"><span class="linenos">2294</span></a>                <span class="n">x</span>
</span><span id="Project-2295"><a href="#Project-2295"><span class="linenos">2295</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset_names</span>
</span><span id="Project-2296"><a href="#Project-2296"><span class="linenos">2296</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span>
</span><span id="Project-2297"><a href="#Project-2297"><span class="linenos">2297</span></a>            <span class="p">]</span>
</span><span id="Project-2298"><a href="#Project-2298"><span class="linenos">2298</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_remove</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Project-2299"><a href="#Project-2299"><span class="linenos">2299</span></a>                <span class="n">to_remove</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">to_remove</span><span class="p">)</span>
</span><span id="Project-2300"><a href="#Project-2300"><span class="linenos">2300</span></a>            <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="Project-2301"><a href="#Project-2301"><span class="linenos">2301</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">dataset</span><span class="p">))</span>
</span><span id="Project-2302"><a href="#Project-2302"><span class="linenos">2302</span></a>            <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-2303"><a href="#Project-2303"><span class="linenos">2303</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.pickle&quot;</span>
</span><span id="Project-2304"><a href="#Project-2304"><span class="linenos">2304</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset_names</span>
</span><span id="Project-2305"><a href="#Project-2305"><span class="linenos">2305</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.pickle&quot;</span><span class="p">))</span>
</span><span id="Project-2306"><a href="#Project-2306"><span class="linenos">2306</span></a>                <span class="ow">and</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span>
</span><span id="Project-2307"><a href="#Project-2307"><span class="linenos">2307</span></a>            <span class="p">]</span>
</span><span id="Project-2308"><a href="#Project-2308"><span class="linenos">2308</span></a>            <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="Project-2309"><a href="#Project-2309"><span class="linenos">2309</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">dataset</span><span class="p">))</span>
</span><span id="Project-2310"><a href="#Project-2310"><span class="linenos">2310</span></a>            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets</span><span class="p">()</span><span class="o">.</span><span class="n">dataset_names</span><span class="p">()</span>
</span><span id="Project-2311"><a href="#Project-2311"><span class="linenos">2311</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
</span><span id="Project-2312"><a href="#Project-2312"><span class="linenos">2312</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-2313"><a href="#Project-2313"><span class="linenos">2313</span></a>
</span><span id="Project-2314"><a href="#Project-2314"><span class="linenos">2314</span></a>    <span class="k">def</span> <span class="nf">remove_extra_checkpoints</span><span class="p">(</span>
</span><span id="Project-2315"><a href="#Project-2315"><span class="linenos">2315</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-2316"><a href="#Project-2316"><span class="linenos">2316</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2317"><a href="#Project-2317"><span class="linenos">2317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2318"><a href="#Project-2318"><span class="linenos">2318</span></a><span class="sd">        Remove intermediate model checkpoint files (only leave the results of the last epoch)</span>
</span><span id="Project-2319"><a href="#Project-2319"><span class="linenos">2319</span></a>
</span><span id="Project-2320"><a href="#Project-2320"><span class="linenos">2320</span></a><span class="sd">        By default, all intermediate checkpoints will be deleted.</span>
</span><span id="Project-2321"><a href="#Project-2321"><span class="linenos">2321</span></a><span class="sd">        Files in the model folder that are not associated with any record in the meta files are also deleted.</span>
</span><span id="Project-2322"><a href="#Project-2322"><span class="linenos">2322</span></a>
</span><span id="Project-2323"><a href="#Project-2323"><span class="linenos">2323</span></a><span class="sd">        Parameters</span>
</span><span id="Project-2324"><a href="#Project-2324"><span class="linenos">2324</span></a><span class="sd">        ----------</span>
</span><span id="Project-2325"><a href="#Project-2325"><span class="linenos">2325</span></a><span class="sd">        episode_names : list, optional</span>
</span><span id="Project-2326"><a href="#Project-2326"><span class="linenos">2326</span></a><span class="sd">            a list of episode names to clean (by default all names are added)</span>
</span><span id="Project-2327"><a href="#Project-2327"><span class="linenos">2327</span></a><span class="sd">        exceptions : list, optional</span>
</span><span id="Project-2328"><a href="#Project-2328"><span class="linenos">2328</span></a><span class="sd">            a list of episode names to not clean</span>
</span><span id="Project-2329"><a href="#Project-2329"><span class="linenos">2329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2330"><a href="#Project-2330"><span class="linenos">2330</span></a>
</span><span id="Project-2331"><a href="#Project-2331"><span class="linenos">2331</span></a>        <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="Project-2332"><a href="#Project-2332"><span class="linenos">2332</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Project-2333"><a href="#Project-2333"><span class="linenos">2333</span></a>            <span class="n">all_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span>
</span><span id="Project-2334"><a href="#Project-2334"><span class="linenos">2334</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Project-2335"><a href="#Project-2335"><span class="linenos">2335</span></a>            <span class="n">all_names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</span><span id="Project-2336"><a href="#Project-2336"><span class="linenos">2336</span></a>        <span class="k">if</span> <span class="n">episode_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2337"><a href="#Project-2337"><span class="linenos">2337</span></a>            <span class="n">episode_names</span> <span class="o">=</span> <span class="n">all_names</span>
</span><span id="Project-2338"><a href="#Project-2338"><span class="linenos">2338</span></a>        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2339"><a href="#Project-2339"><span class="linenos">2339</span></a>            <span class="n">exceptions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-2340"><a href="#Project-2340"><span class="linenos">2340</span></a>        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">episode_names</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">]</span>
</span><span id="Project-2341"><a href="#Project-2341"><span class="linenos">2341</span></a>        <span class="n">folders</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</span><span id="Project-2342"><a href="#Project-2342"><span class="linenos">2342</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
</span><span id="Project-2343"><a href="#Project-2343"><span class="linenos">2343</span></a>            <span class="k">if</span> <span class="n">folder</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_names</span><span class="p">:</span>
</span><span id="Project-2344"><a href="#Project-2344"><span class="linenos">2344</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>
</span><span id="Project-2345"><a href="#Project-2345"><span class="linenos">2345</span></a>            <span class="k">elif</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="Project-2346"><a href="#Project-2346"><span class="linenos">2346</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>
</span><span id="Project-2347"><a href="#Project-2347"><span class="linenos">2347</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Project-2348"><a href="#Project-2348"><span class="linenos">2348</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
</span><span id="Project-2349"><a href="#Project-2349"><span class="linenos">2349</span></a>
</span><span id="Project-2350"><a href="#Project-2350"><span class="linenos">2350</span></a>    <span class="k">def</span> <span class="nf">remove_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2351"><a href="#Project-2351"><span class="linenos">2351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2352"><a href="#Project-2352"><span class="linenos">2352</span></a><span class="sd">        Remove a hyperparameter search record</span>
</span><span id="Project-2353"><a href="#Project-2353"><span class="linenos">2353</span></a>
</span><span id="Project-2354"><a href="#Project-2354"><span class="linenos">2354</span></a><span class="sd">        Parameters</span>
</span><span id="Project-2355"><a href="#Project-2355"><span class="linenos">2355</span></a><span class="sd">        ----------</span>
</span><span id="Project-2356"><a href="#Project-2356"><span class="linenos">2356</span></a><span class="sd">        search_name : str</span>
</span><span id="Project-2357"><a href="#Project-2357"><span class="linenos">2357</span></a><span class="sd">            the name of the search to remove</span>
</span><span id="Project-2358"><a href="#Project-2358"><span class="linenos">2358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2359"><a href="#Project-2359"><span class="linenos">2359</span></a>
</span><span id="Project-2360"><a href="#Project-2360"><span class="linenos">2360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="Project-2361"><a href="#Project-2361"><span class="linenos">2361</span></a>        <span class="n">graph_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;searches&quot;</span><span class="p">,</span> <span class="n">search_name</span><span class="p">)</span>
</span><span id="Project-2362"><a href="#Project-2362"><span class="linenos">2362</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">graph_path</span><span class="p">):</span>
</span><span id="Project-2363"><a href="#Project-2363"><span class="linenos">2363</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">graph_path</span><span class="p">)</span>
</span><span id="Project-2364"><a href="#Project-2364"><span class="linenos">2364</span></a>
</span><span id="Project-2365"><a href="#Project-2365"><span class="linenos">2365</span></a>    <span class="k">def</span> <span class="nf">remove_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2366"><a href="#Project-2366"><span class="linenos">2366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2367"><a href="#Project-2367"><span class="linenos">2367</span></a><span class="sd">        Remove a prediction record</span>
</span><span id="Project-2368"><a href="#Project-2368"><span class="linenos">2368</span></a>
</span><span id="Project-2369"><a href="#Project-2369"><span class="linenos">2369</span></a><span class="sd">        Parameters</span>
</span><span id="Project-2370"><a href="#Project-2370"><span class="linenos">2370</span></a><span class="sd">        ----------</span>
</span><span id="Project-2371"><a href="#Project-2371"><span class="linenos">2371</span></a><span class="sd">        prediction_name : str</span>
</span><span id="Project-2372"><a href="#Project-2372"><span class="linenos">2372</span></a><span class="sd">            the name of the prediction to remove</span>
</span><span id="Project-2373"><a href="#Project-2373"><span class="linenos">2373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2374"><a href="#Project-2374"><span class="linenos">2374</span></a>
</span><span id="Project-2375"><a href="#Project-2375"><span class="linenos">2375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">)</span>
</span><span id="Project-2376"><a href="#Project-2376"><span class="linenos">2376</span></a>        <span class="n">prediction_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2377"><a href="#Project-2377"><span class="linenos">2377</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;predictions&quot;</span><span class="p">,</span> <span class="n">prediction_name</span>
</span><span id="Project-2378"><a href="#Project-2378"><span class="linenos">2378</span></a>        <span class="p">)</span>
</span><span id="Project-2379"><a href="#Project-2379"><span class="linenos">2379</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">prediction_path</span><span class="p">):</span>
</span><span id="Project-2380"><a href="#Project-2380"><span class="linenos">2380</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">prediction_path</span><span class="p">)</span>
</span><span id="Project-2381"><a href="#Project-2381"><span class="linenos">2381</span></a>
</span><span id="Project-2382"><a href="#Project-2382"><span class="linenos">2382</span></a>    <span class="k">def</span> <span class="nf">remove_episode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2383"><a href="#Project-2383"><span class="linenos">2383</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2384"><a href="#Project-2384"><span class="linenos">2384</span></a><span class="sd">        Remove all model, logs and metafile records related to an episode</span>
</span><span id="Project-2385"><a href="#Project-2385"><span class="linenos">2385</span></a>
</span><span id="Project-2386"><a href="#Project-2386"><span class="linenos">2386</span></a><span class="sd">        Parameters</span>
</span><span id="Project-2387"><a href="#Project-2387"><span class="linenos">2387</span></a><span class="sd">        ----------</span>
</span><span id="Project-2388"><a href="#Project-2388"><span class="linenos">2388</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project-2389"><a href="#Project-2389"><span class="linenos">2389</span></a><span class="sd">            the name of the episode to remove</span>
</span><span id="Project-2390"><a href="#Project-2390"><span class="linenos">2390</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2391"><a href="#Project-2391"><span class="linenos">2391</span></a>
</span><span id="Project-2392"><a href="#Project-2392"><span class="linenos">2392</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-2393"><a href="#Project-2393"><span class="linenos">2393</span></a>        <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-2394"><a href="#Project-2394"><span class="linenos">2394</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project-2395"><a href="#Project-2395"><span class="linenos">2395</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="Project-2396"><a href="#Project-2396"><span class="linenos">2396</span></a>            <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>
</span><span id="Project-2397"><a href="#Project-2397"><span class="linenos">2397</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span><span class="p">):</span>
</span><span id="Project-2398"><a href="#Project-2398"><span class="linenos">2398</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</span><span id="Project-2399"><a href="#Project-2399"><span class="linenos">2399</span></a>            <span class="n">log_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>
</span><span id="Project-2400"><a href="#Project-2400"><span class="linenos">2400</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">log_path</span><span class="p">):</span>
</span><span id="Project-2401"><a href="#Project-2401"><span class="linenos">2401</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">log_path</span><span class="p">)</span>
</span><span id="Project-2402"><a href="#Project-2402"><span class="linenos">2402</span></a>
</span><span id="Project-2403"><a href="#Project-2403"><span class="linenos">2403</span></a>    <span class="k">def</span> <span class="nf">prune_unfinished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2404"><a href="#Project-2404"><span class="linenos">2404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2405"><a href="#Project-2405"><span class="linenos">2405</span></a><span class="sd">        Remove all interrupted episodes</span>
</span><span id="Project-2406"><a href="#Project-2406"><span class="linenos">2406</span></a>
</span><span id="Project-2407"><a href="#Project-2407"><span class="linenos">2407</span></a><span class="sd">        Remove all episodes that either don&#39;t have a log file or have less epochs in the log file than in</span>
</span><span id="Project-2408"><a href="#Project-2408"><span class="linenos">2408</span></a><span class="sd">        the training parameters or have a model folder but not a record. Note that it can remove episodes that are</span>
</span><span id="Project-2409"><a href="#Project-2409"><span class="linenos">2409</span></a><span class="sd">        currently running!</span>
</span><span id="Project-2410"><a href="#Project-2410"><span class="linenos">2410</span></a>
</span><span id="Project-2411"><a href="#Project-2411"><span class="linenos">2411</span></a><span class="sd">        Parameters</span>
</span><span id="Project-2412"><a href="#Project-2412"><span class="linenos">2412</span></a><span class="sd">        ----------</span>
</span><span id="Project-2413"><a href="#Project-2413"><span class="linenos">2413</span></a><span class="sd">        exceptions : list</span>
</span><span id="Project-2414"><a href="#Project-2414"><span class="linenos">2414</span></a><span class="sd">            the episodes to keep even if they are interrupted</span>
</span><span id="Project-2415"><a href="#Project-2415"><span class="linenos">2415</span></a>
</span><span id="Project-2416"><a href="#Project-2416"><span class="linenos">2416</span></a><span class="sd">        Returns</span>
</span><span id="Project-2417"><a href="#Project-2417"><span class="linenos">2417</span></a><span class="sd">        -------</span>
</span><span id="Project-2418"><a href="#Project-2418"><span class="linenos">2418</span></a><span class="sd">        pruned : list</span>
</span><span id="Project-2419"><a href="#Project-2419"><span class="linenos">2419</span></a><span class="sd">            a list of the episode names that were pruned</span>
</span><span id="Project-2420"><a href="#Project-2420"><span class="linenos">2420</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2421"><a href="#Project-2421"><span class="linenos">2421</span></a>
</span><span id="Project-2422"><a href="#Project-2422"><span class="linenos">2422</span></a>        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2423"><a href="#Project-2423"><span class="linenos">2423</span></a>            <span class="n">exceptions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-2424"><a href="#Project-2424"><span class="linenos">2424</span></a>        <span class="n">unfinished</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">unfinished_episodes</span><span class="p">()</span>
</span><span id="Project-2425"><a href="#Project-2425"><span class="linenos">2425</span></a>        <span class="n">unfinished</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unfinished</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">]</span>
</span><span id="Project-2426"><a href="#Project-2426"><span class="linenos">2426</span></a>        <span class="n">model_folders</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">))</span>
</span><span id="Project-2427"><a href="#Project-2427"><span class="linenos">2427</span></a>        <span class="n">unfinished</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Project-2428"><a href="#Project-2428"><span class="linenos">2428</span></a>            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">model_folders</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>
</span><span id="Project-2429"><a href="#Project-2429"><span class="linenos">2429</span></a>        <span class="p">]</span>
</span><span id="Project-2430"><a href="#Project-2430"><span class="linenos">2430</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PRUNING </span><span class="si">{</span><span class="n">unfinished</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-2431"><a href="#Project-2431"><span class="linenos">2431</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">unfinished</span><span class="p">:</span>
</span><span id="Project-2432"><a href="#Project-2432"><span class="linenos">2432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-2433"><a href="#Project-2433"><span class="linenos">2433</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-2434"><a href="#Project-2434"><span class="linenos">2434</span></a>        <span class="k">return</span> <span class="n">unfinished</span>
</span><span id="Project-2435"><a href="#Project-2435"><span class="linenos">2435</span></a>
</span><span id="Project-2436"><a href="#Project-2436"><span class="linenos">2436</span></a>    <span class="k">def</span> <span class="nf">prediction_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project-2437"><a href="#Project-2437"><span class="linenos">2437</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2438"><a href="#Project-2438"><span class="linenos">2438</span></a><span class="sd">        Get the path where prediction files are saved</span>
</span><span id="Project-2439"><a href="#Project-2439"><span class="linenos">2439</span></a>
</span><span id="Project-2440"><a href="#Project-2440"><span class="linenos">2440</span></a><span class="sd">        Parameters</span>
</span><span id="Project-2441"><a href="#Project-2441"><span class="linenos">2441</span></a><span class="sd">        ----------</span>
</span><span id="Project-2442"><a href="#Project-2442"><span class="linenos">2442</span></a><span class="sd">        prediction_name : str</span>
</span><span id="Project-2443"><a href="#Project-2443"><span class="linenos">2443</span></a><span class="sd">            name of the prediction</span>
</span><span id="Project-2444"><a href="#Project-2444"><span class="linenos">2444</span></a>
</span><span id="Project-2445"><a href="#Project-2445"><span class="linenos">2445</span></a><span class="sd">        Returns</span>
</span><span id="Project-2446"><a href="#Project-2446"><span class="linenos">2446</span></a><span class="sd">        -------</span>
</span><span id="Project-2447"><a href="#Project-2447"><span class="linenos">2447</span></a><span class="sd">        prediction_path : str</span>
</span><span id="Project-2448"><a href="#Project-2448"><span class="linenos">2448</span></a><span class="sd">            the file path</span>
</span><span id="Project-2449"><a href="#Project-2449"><span class="linenos">2449</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2450"><a href="#Project-2450"><span class="linenos">2450</span></a>
</span><span id="Project-2451"><a href="#Project-2451"><span class="linenos">2451</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2452"><a href="#Project-2452"><span class="linenos">2452</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;predictions&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-2453"><a href="#Project-2453"><span class="linenos">2453</span></a>        <span class="p">)</span>
</span><span id="Project-2454"><a href="#Project-2454"><span class="linenos">2454</span></a>
</span><span id="Project-2455"><a href="#Project-2455"><span class="linenos">2455</span></a>    <span class="nd">@classmethod</span>
</span><span id="Project-2456"><a href="#Project-2456"><span class="linenos">2456</span></a>    <span class="k">def</span> <span class="nf">print_data_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="Project-2457"><a href="#Project-2457"><span class="linenos">2457</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DATA TYPES:&quot;</span><span class="p">)</span>
</span><span id="Project-2458"><a href="#Project-2458"><span class="linenos">2458</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">data_types</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-2459"><a href="#Project-2459"><span class="linenos">2459</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project-2460"><a href="#Project-2460"><span class="linenos">2460</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project-2461"><a href="#Project-2461"><span class="linenos">2461</span></a>
</span><span id="Project-2462"><a href="#Project-2462"><span class="linenos">2462</span></a>    <span class="nd">@classmethod</span>
</span><span id="Project-2463"><a href="#Project-2463"><span class="linenos">2463</span></a>    <span class="k">def</span> <span class="nf">print_annotation_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="Project-2464"><a href="#Project-2464"><span class="linenos">2464</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ANNOTATION TYPES:&quot;</span><span class="p">)</span>
</span><span id="Project-2465"><a href="#Project-2465"><span class="linenos">2465</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">annotation_types</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-2466"><a href="#Project-2466"><span class="linenos">2466</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project-2467"><a href="#Project-2467"><span class="linenos">2467</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project-2468"><a href="#Project-2468"><span class="linenos">2468</span></a>
</span><span id="Project-2469"><a href="#Project-2469"><span class="linenos">2469</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Project-2470"><a href="#Project-2470"><span class="linenos">2470</span></a>    <span class="k">def</span> <span class="nf">data_types</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="Project-2471"><a href="#Project-2471"><span class="linenos">2471</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2472"><a href="#Project-2472"><span class="linenos">2472</span></a><span class="sd">        Get available data types</span>
</span><span id="Project-2473"><a href="#Project-2473"><span class="linenos">2473</span></a>
</span><span id="Project-2474"><a href="#Project-2474"><span class="linenos">2474</span></a><span class="sd">        Returns</span>
</span><span id="Project-2475"><a href="#Project-2475"><span class="linenos">2475</span></a><span class="sd">        -------</span>
</span><span id="Project-2476"><a href="#Project-2476"><span class="linenos">2476</span></a><span class="sd">        list</span>
</span><span id="Project-2477"><a href="#Project-2477"><span class="linenos">2477</span></a><span class="sd">            available data types</span>
</span><span id="Project-2478"><a href="#Project-2478"><span class="linenos">2478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2479"><a href="#Project-2479"><span class="linenos">2479</span></a>
</span><span id="Project-2480"><a href="#Project-2480"><span class="linenos">2480</span></a>        <span class="k">return</span> <span class="n">options</span><span class="o">.</span><span class="n">input_stores</span>
</span><span id="Project-2481"><a href="#Project-2481"><span class="linenos">2481</span></a>
</span><span id="Project-2482"><a href="#Project-2482"><span class="linenos">2482</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Project-2483"><a href="#Project-2483"><span class="linenos">2483</span></a>    <span class="k">def</span> <span class="nf">annotation_types</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="Project-2484"><a href="#Project-2484"><span class="linenos">2484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2485"><a href="#Project-2485"><span class="linenos">2485</span></a><span class="sd">        Get available annotation types</span>
</span><span id="Project-2486"><a href="#Project-2486"><span class="linenos">2486</span></a>
</span><span id="Project-2487"><a href="#Project-2487"><span class="linenos">2487</span></a><span class="sd">        Returns</span>
</span><span id="Project-2488"><a href="#Project-2488"><span class="linenos">2488</span></a><span class="sd">        -------</span>
</span><span id="Project-2489"><a href="#Project-2489"><span class="linenos">2489</span></a><span class="sd">        list</span>
</span><span id="Project-2490"><a href="#Project-2490"><span class="linenos">2490</span></a><span class="sd">            available annotation types</span>
</span><span id="Project-2491"><a href="#Project-2491"><span class="linenos">2491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2492"><a href="#Project-2492"><span class="linenos">2492</span></a>
</span><span id="Project-2493"><a href="#Project-2493"><span class="linenos">2493</span></a>        <span class="k">return</span> <span class="n">options</span><span class="o">.</span><span class="n">annotation_stores</span>
</span><span id="Project-2494"><a href="#Project-2494"><span class="linenos">2494</span></a>
</span><span id="Project-2495"><a href="#Project-2495"><span class="linenos">2495</span></a>    <span class="k">def</span> <span class="nf">_save_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Project-2496"><a href="#Project-2496"><span class="linenos">2496</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2497"><a href="#Project-2497"><span class="linenos">2497</span></a><span class="sd">        Save a mask file</span>
</span><span id="Project-2498"><a href="#Project-2498"><span class="linenos">2498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2499"><a href="#Project-2499"><span class="linenos">2499</span></a>
</span><span id="Project-2500"><a href="#Project-2500"><span class="linenos">2500</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_path</span><span class="p">()):</span>
</span><span id="Project-2501"><a href="#Project-2501"><span class="linenos">2501</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_path</span><span class="p">())</span>
</span><span id="Project-2502"><a href="#Project-2502"><span class="linenos">2502</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_path</span><span class="p">(),</span> <span class="n">mask_name</span> <span class="o">+</span> <span class="s2">&quot;.pickle&quot;</span><span class="p">),</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2503"><a href="#Project-2503"><span class="linenos">2503</span></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project-2504"><a href="#Project-2504"><span class="linenos">2504</span></a>
</span><span id="Project-2505"><a href="#Project-2505"><span class="linenos">2505</span></a>    <span class="k">def</span> <span class="nf">_load_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-2506"><a href="#Project-2506"><span class="linenos">2506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2507"><a href="#Project-2507"><span class="linenos">2507</span></a><span class="sd">        Load a mask file</span>
</span><span id="Project-2508"><a href="#Project-2508"><span class="linenos">2508</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2509"><a href="#Project-2509"><span class="linenos">2509</span></a>
</span><span id="Project-2510"><a href="#Project-2510"><span class="linenos">2510</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mask_path</span><span class="p">(),</span> <span class="n">mask_name</span> <span class="o">+</span> <span class="s2">&quot;.pickle&quot;</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2511"><a href="#Project-2511"><span class="linenos">2511</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Project-2512"><a href="#Project-2512"><span class="linenos">2512</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="Project-2513"><a href="#Project-2513"><span class="linenos">2513</span></a>
</span><span id="Project-2514"><a href="#Project-2514"><span class="linenos">2514</span></a>    <span class="k">def</span> <span class="nf">_thresholds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DecisionThresholds</span><span class="p">:</span>
</span><span id="Project-2515"><a href="#Project-2515"><span class="linenos">2515</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2516"><a href="#Project-2516"><span class="linenos">2516</span></a><span class="sd">        Get the decision thresholds meta object</span>
</span><span id="Project-2517"><a href="#Project-2517"><span class="linenos">2517</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2518"><a href="#Project-2518"><span class="linenos">2518</span></a>
</span><span id="Project-2519"><a href="#Project-2519"><span class="linenos">2519</span></a>        <span class="k">return</span> <span class="n">DecisionThresholds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_thresholds_path</span><span class="p">())</span>
</span><span id="Project-2520"><a href="#Project-2520"><span class="linenos">2520</span></a>
</span><span id="Project-2521"><a href="#Project-2521"><span class="linenos">2521</span></a>    <span class="k">def</span> <span class="nf">_episodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SavedRuns</span><span class="p">:</span>
</span><span id="Project-2522"><a href="#Project-2522"><span class="linenos">2522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2523"><a href="#Project-2523"><span class="linenos">2523</span></a><span class="sd">        Get the episodes meta object</span>
</span><span id="Project-2524"><a href="#Project-2524"><span class="linenos">2524</span></a>
</span><span id="Project-2525"><a href="#Project-2525"><span class="linenos">2525</span></a><span class="sd">        Returns</span>
</span><span id="Project-2526"><a href="#Project-2526"><span class="linenos">2526</span></a><span class="sd">        -------</span>
</span><span id="Project-2527"><a href="#Project-2527"><span class="linenos">2527</span></a><span class="sd">        episodes : SavedRuns</span>
</span><span id="Project-2528"><a href="#Project-2528"><span class="linenos">2528</span></a><span class="sd">            the episodes meta object</span>
</span><span id="Project-2529"><a href="#Project-2529"><span class="linenos">2529</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2530"><a href="#Project-2530"><span class="linenos">2530</span></a>
</span><span id="Project-2531"><a href="#Project-2531"><span class="linenos">2531</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Project-2532"><a href="#Project-2532"><span class="linenos">2532</span></a>            <span class="k">return</span> <span class="n">SavedRuns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="Project-2533"><a href="#Project-2533"><span class="linenos">2533</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Project-2534"><a href="#Project-2534"><span class="linenos">2534</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="Project-2535"><a href="#Project-2535"><span class="linenos">2535</span></a>            <span class="k">return</span> <span class="n">SavedRuns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="Project-2536"><a href="#Project-2536"><span class="linenos">2536</span></a>
</span><span id="Project-2537"><a href="#Project-2537"><span class="linenos">2537</span></a>    <span class="k">def</span> <span class="nf">_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SavedRuns</span><span class="p">:</span>
</span><span id="Project-2538"><a href="#Project-2538"><span class="linenos">2538</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2539"><a href="#Project-2539"><span class="linenos">2539</span></a><span class="sd">        Get the predictions meta object</span>
</span><span id="Project-2540"><a href="#Project-2540"><span class="linenos">2540</span></a>
</span><span id="Project-2541"><a href="#Project-2541"><span class="linenos">2541</span></a><span class="sd">        Returns</span>
</span><span id="Project-2542"><a href="#Project-2542"><span class="linenos">2542</span></a><span class="sd">        -------</span>
</span><span id="Project-2543"><a href="#Project-2543"><span class="linenos">2543</span></a><span class="sd">        predictions : SavedRuns</span>
</span><span id="Project-2544"><a href="#Project-2544"><span class="linenos">2544</span></a><span class="sd">            the predictions meta object</span>
</span><span id="Project-2545"><a href="#Project-2545"><span class="linenos">2545</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2546"><a href="#Project-2546"><span class="linenos">2546</span></a>
</span><span id="Project-2547"><a href="#Project-2547"><span class="linenos">2547</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Project-2548"><a href="#Project-2548"><span class="linenos">2548</span></a>            <span class="k">return</span> <span class="n">SavedRuns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="Project-2549"><a href="#Project-2549"><span class="linenos">2549</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Project-2550"><a href="#Project-2550"><span class="linenos">2550</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="Project-2551"><a href="#Project-2551"><span class="linenos">2551</span></a>            <span class="k">return</span> <span class="n">SavedRuns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="Project-2552"><a href="#Project-2552"><span class="linenos">2552</span></a>
</span><span id="Project-2553"><a href="#Project-2553"><span class="linenos">2553</span></a>    <span class="k">def</span> <span class="nf">_saved_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SavedStores</span><span class="p">:</span>
</span><span id="Project-2554"><a href="#Project-2554"><span class="linenos">2554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2555"><a href="#Project-2555"><span class="linenos">2555</span></a><span class="sd">        Get the datasets meta object</span>
</span><span id="Project-2556"><a href="#Project-2556"><span class="linenos">2556</span></a>
</span><span id="Project-2557"><a href="#Project-2557"><span class="linenos">2557</span></a><span class="sd">        Returns</span>
</span><span id="Project-2558"><a href="#Project-2558"><span class="linenos">2558</span></a><span class="sd">        -------</span>
</span><span id="Project-2559"><a href="#Project-2559"><span class="linenos">2559</span></a><span class="sd">        datasets : SavedStores</span>
</span><span id="Project-2560"><a href="#Project-2560"><span class="linenos">2560</span></a><span class="sd">            the datasets meta object</span>
</span><span id="Project-2561"><a href="#Project-2561"><span class="linenos">2561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2562"><a href="#Project-2562"><span class="linenos">2562</span></a>
</span><span id="Project-2563"><a href="#Project-2563"><span class="linenos">2563</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Project-2564"><a href="#Project-2564"><span class="linenos">2564</span></a>            <span class="k">return</span> <span class="n">SavedStores</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets_path</span><span class="p">())</span>
</span><span id="Project-2565"><a href="#Project-2565"><span class="linenos">2565</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Project-2566"><a href="#Project-2566"><span class="linenos">2566</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="Project-2567"><a href="#Project-2567"><span class="linenos">2567</span></a>            <span class="k">return</span> <span class="n">SavedStores</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets_path</span><span class="p">())</span>
</span><span id="Project-2568"><a href="#Project-2568"><span class="linenos">2568</span></a>
</span><span id="Project-2569"><a href="#Project-2569"><span class="linenos">2569</span></a>    <span class="k">def</span> <span class="nf">_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Run</span><span class="p">:</span>
</span><span id="Project-2570"><a href="#Project-2570"><span class="linenos">2570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2571"><a href="#Project-2571"><span class="linenos">2571</span></a><span class="sd">        Get a prediction meta object</span>
</span><span id="Project-2572"><a href="#Project-2572"><span class="linenos">2572</span></a>
</span><span id="Project-2573"><a href="#Project-2573"><span class="linenos">2573</span></a><span class="sd">        Parameters</span>
</span><span id="Project-2574"><a href="#Project-2574"><span class="linenos">2574</span></a><span class="sd">        ----------</span>
</span><span id="Project-2575"><a href="#Project-2575"><span class="linenos">2575</span></a><span class="sd">        name : str</span>
</span><span id="Project-2576"><a href="#Project-2576"><span class="linenos">2576</span></a><span class="sd">            episode name</span>
</span><span id="Project-2577"><a href="#Project-2577"><span class="linenos">2577</span></a>
</span><span id="Project-2578"><a href="#Project-2578"><span class="linenos">2578</span></a><span class="sd">        Returns</span>
</span><span id="Project-2579"><a href="#Project-2579"><span class="linenos">2579</span></a><span class="sd">        -------</span>
</span><span id="Project-2580"><a href="#Project-2580"><span class="linenos">2580</span></a><span class="sd">        prediction : Run</span>
</span><span id="Project-2581"><a href="#Project-2581"><span class="linenos">2581</span></a><span class="sd">            the prediction meta object</span>
</span><span id="Project-2582"><a href="#Project-2582"><span class="linenos">2582</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2583"><a href="#Project-2583"><span class="linenos">2583</span></a>
</span><span id="Project-2584"><a href="#Project-2584"><span class="linenos">2584</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Project-2585"><a href="#Project-2585"><span class="linenos">2585</span></a>            <span class="k">return</span> <span class="n">Run</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">meta_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">())</span>
</span><span id="Project-2586"><a href="#Project-2586"><span class="linenos">2586</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Project-2587"><a href="#Project-2587"><span class="linenos">2587</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="Project-2588"><a href="#Project-2588"><span class="linenos">2588</span></a>            <span class="k">return</span> <span class="n">Run</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">meta_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">())</span>
</span><span id="Project-2589"><a href="#Project-2589"><span class="linenos">2589</span></a>
</span><span id="Project-2590"><a href="#Project-2590"><span class="linenos">2590</span></a>    <span class="k">def</span> <span class="nf">_episode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Run</span><span class="p">:</span>
</span><span id="Project-2591"><a href="#Project-2591"><span class="linenos">2591</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2592"><a href="#Project-2592"><span class="linenos">2592</span></a><span class="sd">        Get an episode meta object</span>
</span><span id="Project-2593"><a href="#Project-2593"><span class="linenos">2593</span></a>
</span><span id="Project-2594"><a href="#Project-2594"><span class="linenos">2594</span></a><span class="sd">        Parameters</span>
</span><span id="Project-2595"><a href="#Project-2595"><span class="linenos">2595</span></a><span class="sd">        ----------</span>
</span><span id="Project-2596"><a href="#Project-2596"><span class="linenos">2596</span></a><span class="sd">        name : str</span>
</span><span id="Project-2597"><a href="#Project-2597"><span class="linenos">2597</span></a><span class="sd">            episode name</span>
</span><span id="Project-2598"><a href="#Project-2598"><span class="linenos">2598</span></a>
</span><span id="Project-2599"><a href="#Project-2599"><span class="linenos">2599</span></a><span class="sd">        Returns</span>
</span><span id="Project-2600"><a href="#Project-2600"><span class="linenos">2600</span></a><span class="sd">        -------</span>
</span><span id="Project-2601"><a href="#Project-2601"><span class="linenos">2601</span></a><span class="sd">        episode : Run</span>
</span><span id="Project-2602"><a href="#Project-2602"><span class="linenos">2602</span></a><span class="sd">            the episode meta object</span>
</span><span id="Project-2603"><a href="#Project-2603"><span class="linenos">2603</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2604"><a href="#Project-2604"><span class="linenos">2604</span></a>
</span><span id="Project-2605"><a href="#Project-2605"><span class="linenos">2605</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Project-2606"><a href="#Project-2606"><span class="linenos">2606</span></a>            <span class="k">return</span> <span class="n">Run</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">meta_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes_path</span><span class="p">())</span>
</span><span id="Project-2607"><a href="#Project-2607"><span class="linenos">2607</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Project-2608"><a href="#Project-2608"><span class="linenos">2608</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="Project-2609"><a href="#Project-2609"><span class="linenos">2609</span></a>            <span class="k">return</span> <span class="n">Run</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">meta_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes_path</span><span class="p">())</span>
</span><span id="Project-2610"><a href="#Project-2610"><span class="linenos">2610</span></a>
</span><span id="Project-2611"><a href="#Project-2611"><span class="linenos">2611</span></a>    <span class="k">def</span> <span class="nf">_searches</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Searches</span><span class="p">:</span>
</span><span id="Project-2612"><a href="#Project-2612"><span class="linenos">2612</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2613"><a href="#Project-2613"><span class="linenos">2613</span></a><span class="sd">        Get the hyperparameter search meta object</span>
</span><span id="Project-2614"><a href="#Project-2614"><span class="linenos">2614</span></a>
</span><span id="Project-2615"><a href="#Project-2615"><span class="linenos">2615</span></a><span class="sd">        Returns</span>
</span><span id="Project-2616"><a href="#Project-2616"><span class="linenos">2616</span></a><span class="sd">        -------</span>
</span><span id="Project-2617"><a href="#Project-2617"><span class="linenos">2617</span></a><span class="sd">        searches : Searches</span>
</span><span id="Project-2618"><a href="#Project-2618"><span class="linenos">2618</span></a><span class="sd">            the searches meta object</span>
</span><span id="Project-2619"><a href="#Project-2619"><span class="linenos">2619</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2620"><a href="#Project-2620"><span class="linenos">2620</span></a>
</span><span id="Project-2621"><a href="#Project-2621"><span class="linenos">2621</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Project-2622"><a href="#Project-2622"><span class="linenos">2622</span></a>            <span class="k">return</span> <span class="n">Searches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_searches_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="Project-2623"><a href="#Project-2623"><span class="linenos">2623</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Project-2624"><a href="#Project-2624"><span class="linenos">2624</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata_backup</span><span class="p">()</span>
</span><span id="Project-2625"><a href="#Project-2625"><span class="linenos">2625</span></a>            <span class="k">return</span> <span class="n">Searches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_searches_path</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="Project-2626"><a href="#Project-2626"><span class="linenos">2626</span></a>
</span><span id="Project-2627"><a href="#Project-2627"><span class="linenos">2627</span></a>    <span class="k">def</span> <span class="nf">_update_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2628"><a href="#Project-2628"><span class="linenos">2628</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2629"><a href="#Project-2629"><span class="linenos">2629</span></a><span class="sd">        Update the project config files with newly added files and parameters</span>
</span><span id="Project-2630"><a href="#Project-2630"><span class="linenos">2630</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2631"><a href="#Project-2631"><span class="linenos">2631</span></a>
</span><span id="Project-2632"><a href="#Project-2632"><span class="linenos">2632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;data_path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">}})</span>
</span><span id="Project-2633"><a href="#Project-2633"><span class="linenos">2633</span></a>        <span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]</span>
</span><span id="Project-2634"><a href="#Project-2634"><span class="linenos">2634</span></a>        <span class="n">original_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2635"><a href="#Project-2635"><span class="linenos">2635</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;config&quot;</span>
</span><span id="Project-2636"><a href="#Project-2636"><span class="linenos">2636</span></a>        <span class="p">)</span>
</span><span id="Project-2637"><a href="#Project-2637"><span class="linenos">2637</span></a>        <span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span>
</span><span id="Project-2638"><a href="#Project-2638"><span class="linenos">2638</span></a>        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">original_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;yaml&quot;</span><span class="p">)]</span>
</span><span id="Project-2639"><a href="#Project-2639"><span class="linenos">2639</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
</span><span id="Project-2640"><a href="#Project-2640"><span class="linenos">2640</span></a>            <span class="n">filenames</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Project-2641"><a href="#Project-2641"><span class="linenos">2641</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="Project-2642"><a href="#Project-2642"><span class="linenos">2642</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">original_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>
</span><span id="Project-2643"><a href="#Project-2643"><span class="linenos">2643</span></a>            <span class="p">]</span>
</span><span id="Project-2644"><a href="#Project-2644"><span class="linenos">2644</span></a>        <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">))</span>
</span><span id="Project-2645"><a href="#Project-2645"><span class="linenos">2645</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="Project-2646"><a href="#Project-2646"><span class="linenos">2646</span></a>            <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">))</span>
</span><span id="Project-2647"><a href="#Project-2647"><span class="linenos">2647</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
</span><span id="Project-2648"><a href="#Project-2648"><span class="linenos">2648</span></a>            <span class="n">filepath_original</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">original_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="Project-2649"><a href="#Project-2649"><span class="linenos">2649</span></a>            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;annotation&quot;</span><span class="p">):</span>
</span><span id="Project-2650"><a href="#Project-2650"><span class="linenos">2650</span></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="Project-2651"><a href="#Project-2651"><span class="linenos">2651</span></a>            <span class="n">filepath_project</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="Project-2652"><a href="#Project-2652"><span class="linenos">2652</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath_project</span><span class="p">):</span>
</span><span id="Project-2653"><a href="#Project-2653"><span class="linenos">2653</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">filepath_original</span><span class="p">,</span> <span class="n">filepath_project</span><span class="p">)</span>
</span><span id="Project-2654"><a href="#Project-2654"><span class="linenos">2654</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2655"><a href="#Project-2655"><span class="linenos">2655</span></a>                <span class="n">original_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span><span class="n">filepath_original</span><span class="p">)</span>
</span><span id="Project-2656"><a href="#Project-2656"><span class="linenos">2656</span></a>                <span class="n">project_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span><span class="n">filepath_project</span><span class="p">)</span>
</span><span id="Project-2657"><a href="#Project-2657"><span class="linenos">2657</span></a>                <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-2658"><a href="#Project-2658"><span class="linenos">2658</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">project_pars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-2659"><a href="#Project-2659"><span class="linenos">2659</span></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">original_pars</span><span class="p">:</span>
</span><span id="Project-2660"><a href="#Project-2660"><span class="linenos">2660</span></a>                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">,</span> <span class="s2">&quot;annotation_type&quot;</span><span class="p">]:</span>
</span><span id="Project-2661"><a href="#Project-2661"><span class="linenos">2661</span></a>                            <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Project-2662"><a href="#Project-2662"><span class="linenos">2662</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="Project-2663"><a href="#Project-2663"><span class="linenos">2663</span></a>                    <span class="n">project_pars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Project-2664"><a href="#Project-2664"><span class="linenos">2664</span></a>                <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-2665"><a href="#Project-2665"><span class="linenos">2665</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">original_pars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-2666"><a href="#Project-2666"><span class="linenos">2666</span></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">project_pars</span><span class="p">:</span>
</span><span id="Project-2667"><a href="#Project-2667"><span class="linenos">2667</span></a>                        <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Project-2668"><a href="#Project-2668"><span class="linenos">2668</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="Project-2669"><a href="#Project-2669"><span class="linenos">2669</span></a>                    <span class="n">original_pars</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Project-2670"><a href="#Project-2670"><span class="linenos">2670</span></a>                <span class="n">project_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">project_pars</span><span class="p">,</span> <span class="n">original_pars</span><span class="p">)</span>
</span><span id="Project-2671"><a href="#Project-2671"><span class="linenos">2671</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath_project</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2672"><a href="#Project-2672"><span class="linenos">2672</span></a>                    <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">project_pars</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project-2673"><a href="#Project-2673"><span class="linenos">2673</span></a>
</span><span id="Project-2674"><a href="#Project-2674"><span class="linenos">2674</span></a>    <span class="k">def</span> <span class="nf">_update_project</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2675"><a href="#Project-2675"><span class="linenos">2675</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2676"><a href="#Project-2676"><span class="linenos">2676</span></a><span class="sd">        Update project files with the current version</span>
</span><span id="Project-2677"><a href="#Project-2677"><span class="linenos">2677</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2678"><a href="#Project-2678"><span class="linenos">2678</span></a>
</span><span id="Project-2679"><a href="#Project-2679"><span class="linenos">2679</span></a>        <span class="n">version_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_path</span><span class="p">()</span>
</span><span id="Project-2680"><a href="#Project-2680"><span class="linenos">2680</span></a>        <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Project-2681"><a href="#Project-2681"><span class="linenos">2681</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">version_file</span><span class="p">):</span>
</span><span id="Project-2682"><a href="#Project-2682"><span class="linenos">2682</span></a>            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-2683"><a href="#Project-2683"><span class="linenos">2683</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2684"><a href="#Project-2684"><span class="linenos">2684</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">version_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2685"><a href="#Project-2685"><span class="linenos">2685</span></a>                <span class="n">project_version</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="Project-2686"><a href="#Project-2686"><span class="linenos">2686</span></a>            <span class="k">if</span> <span class="n">project_version</span> <span class="o">&lt;</span> <span class="n">__version__</span><span class="p">:</span>
</span><span id="Project-2687"><a href="#Project-2687"><span class="linenos">2687</span></a>                <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-2688"><a href="#Project-2688"><span class="linenos">2688</span></a>            <span class="k">elif</span> <span class="n">project_version</span> <span class="o">&gt;</span> <span class="n">__version__</span><span class="p">:</span>
</span><span id="Project-2689"><a href="#Project-2689"><span class="linenos">2689</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Project-2690"><a href="#Project-2690"><span class="linenos">2690</span></a>                    <span class="sa">f</span><span class="s2">&quot;The project expects a higher dlc2action version (</span><span class="si">{</span><span class="n">project_version</span><span class="si">}</span><span class="s2">), please update!&quot;</span>
</span><span id="Project-2691"><a href="#Project-2691"><span class="linenos">2691</span></a>                <span class="p">)</span>
</span><span id="Project-2692"><a href="#Project-2692"><span class="linenos">2692</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
</span><span id="Project-2693"><a href="#Project-2693"><span class="linenos">2693</span></a>            <span class="n">project_config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span>
</span><span id="Project-2694"><a href="#Project-2694"><span class="linenos">2694</span></a>            <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2695"><a href="#Project-2695"><span class="linenos">2695</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__path__</span><span class="p">)),</span> <span class="s2">&quot;config&quot;</span>
</span><span id="Project-2696"><a href="#Project-2696"><span class="linenos">2696</span></a>            <span class="p">)</span>
</span><span id="Project-2697"><a href="#Project-2697"><span class="linenos">2697</span></a>            <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span>
</span><span id="Project-2698"><a href="#Project-2698"><span class="linenos">2698</span></a>            <span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">]</span>
</span><span id="Project-2699"><a href="#Project-2699"><span class="linenos">2699</span></a>
</span><span id="Project-2700"><a href="#Project-2700"><span class="linenos">2700</span></a>            <span class="n">project_annotation_configs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span>
</span><span id="Project-2701"><a href="#Project-2701"><span class="linenos">2701</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">)</span>
</span><span id="Project-2702"><a href="#Project-2702"><span class="linenos">2702</span></a>            <span class="p">)</span>
</span><span id="Project-2703"><a href="#Project-2703"><span class="linenos">2703</span></a>            <span class="n">annotation_configs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">))</span>
</span><span id="Project-2704"><a href="#Project-2704"><span class="linenos">2704</span></a>            <span class="k">for</span> <span class="n">ann_config</span> <span class="ow">in</span> <span class="n">annotation_configs</span><span class="p">:</span>
</span><span id="Project-2705"><a href="#Project-2705"><span class="linenos">2705</span></a>                <span class="k">if</span> <span class="n">ann_config</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">project_annotation_configs</span><span class="p">:</span>
</span><span id="Project-2706"><a href="#Project-2706"><span class="linenos">2706</span></a>                    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="Project-2707"><a href="#Project-2707"><span class="linenos">2707</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="n">ann_config</span><span class="p">),</span>
</span><span id="Project-2708"><a href="#Project-2708"><span class="linenos">2708</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="n">ann_config</span><span class="p">),</span>
</span><span id="Project-2709"><a href="#Project-2709"><span class="linenos">2709</span></a>                        <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-2710"><a href="#Project-2710"><span class="linenos">2710</span></a>                    <span class="p">)</span>
</span><span id="Project-2711"><a href="#Project-2711"><span class="linenos">2711</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2712"><a href="#Project-2712"><span class="linenos">2712</span></a>                    <span class="n">project_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-2713"><a href="#Project-2713"><span class="linenos">2713</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">project_config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="n">ann_config</span><span class="p">)</span>
</span><span id="Project-2714"><a href="#Project-2714"><span class="linenos">2714</span></a>                    <span class="p">)</span>
</span><span id="Project-2715"><a href="#Project-2715"><span class="linenos">2715</span></a>                    <span class="n">pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-2716"><a href="#Project-2716"><span class="linenos">2716</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="n">ann_config</span><span class="p">)</span>
</span><span id="Project-2717"><a href="#Project-2717"><span class="linenos">2717</span></a>                    <span class="p">)</span>
</span><span id="Project-2718"><a href="#Project-2718"><span class="linenos">2718</span></a>                    <span class="n">new_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">project_pars</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Project-2719"><a href="#Project-2719"><span class="linenos">2719</span></a>                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">new_keys</span><span class="p">:</span>
</span><span id="Project-2720"><a href="#Project-2720"><span class="linenos">2720</span></a>                        <span class="n">project_pars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="Project-2721"><a href="#Project-2721"><span class="linenos">2721</span></a>                        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
</span><span id="Project-2722"><a href="#Project-2722"><span class="linenos">2722</span></a>                        <span class="n">project_pars</span><span class="o">.</span><span class="n">yaml_add_eol_comment</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="Project-2723"><a href="#Project-2723"><span class="linenos">2723</span></a>                        <span class="n">episodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="Project-2724"><a href="#Project-2724"><span class="linenos">2724</span></a>                            <span class="n">condition</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;general/annotation_type::=</span><span class="si">{</span><span class="n">ann_config</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Project-2725"><a href="#Project-2725"><span class="linenos">2725</span></a>                            <span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;data/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">pars</span><span class="p">[</span><span class="n">key</span><span class="p">]},</span>
</span><span id="Project-2726"><a href="#Project-2726"><span class="linenos">2726</span></a>                        <span class="p">)</span>
</span><span id="Project-2727"><a href="#Project-2727"><span class="linenos">2727</span></a>
</span><span id="Project-2728"><a href="#Project-2728"><span class="linenos">2728</span></a>    <span class="k">def</span> <span class="nf">_initialize_project</span><span class="p">(</span>
</span><span id="Project-2729"><a href="#Project-2729"><span class="linenos">2729</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-2730"><a href="#Project-2730"><span class="linenos">2730</span></a>        <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-2731"><a href="#Project-2731"><span class="linenos">2731</span></a>        <span class="n">annotation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-2732"><a href="#Project-2732"><span class="linenos">2732</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-2733"><a href="#Project-2733"><span class="linenos">2733</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-2734"><a href="#Project-2734"><span class="linenos">2734</span></a>        <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-2735"><a href="#Project-2735"><span class="linenos">2735</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2736"><a href="#Project-2736"><span class="linenos">2736</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2737"><a href="#Project-2737"><span class="linenos">2737</span></a><span class="sd">        Initialize a new project</span>
</span><span id="Project-2738"><a href="#Project-2738"><span class="linenos">2738</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2739"><a href="#Project-2739"><span class="linenos">2739</span></a>
</span><span id="Project-2740"><a href="#Project-2740"><span class="linenos">2740</span></a>        <span class="k">if</span> <span class="n">data_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_types</span><span class="p">():</span>
</span><span id="Project-2741"><a href="#Project-2741"><span class="linenos">2741</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-2742"><a href="#Project-2742"><span class="linenos">2742</span></a>                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2"> data type is not available. &quot;</span>
</span><span id="Project-2743"><a href="#Project-2743"><span class="linenos">2743</span></a>                <span class="sa">f</span><span class="s2">&quot;Please choose from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_types</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-2744"><a href="#Project-2744"><span class="linenos">2744</span></a>            <span class="p">)</span>
</span><span id="Project-2745"><a href="#Project-2745"><span class="linenos">2745</span></a>        <span class="k">if</span> <span class="n">annotation_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_types</span><span class="p">():</span>
</span><span id="Project-2746"><a href="#Project-2746"><span class="linenos">2746</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-2747"><a href="#Project-2747"><span class="linenos">2747</span></a>                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2"> annotation type is not available. &quot;</span>
</span><span id="Project-2748"><a href="#Project-2748"><span class="linenos">2748</span></a>                <span class="sa">f</span><span class="s2">&quot;Please choose from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_types</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-2749"><a href="#Project-2749"><span class="linenos">2749</span></a>            <span class="p">)</span>
</span><span id="Project-2750"><a href="#Project-2750"><span class="linenos">2750</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
</span><span id="Project-2751"><a href="#Project-2751"><span class="linenos">2751</span></a>        <span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;saved_datasets&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">]</span>
</span><span id="Project-2752"><a href="#Project-2752"><span class="linenos">2752</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
</span><span id="Project-2753"><a href="#Project-2753"><span class="linenos">2753</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
</span><span id="Project-2754"><a href="#Project-2754"><span class="linenos">2754</span></a>        <span class="n">results_subfolders</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-2755"><a href="#Project-2755"><span class="linenos">2755</span></a>            <span class="s2">&quot;model&quot;</span><span class="p">,</span>
</span><span id="Project-2756"><a href="#Project-2756"><span class="linenos">2756</span></a>            <span class="s2">&quot;logs&quot;</span><span class="p">,</span>
</span><span id="Project-2757"><a href="#Project-2757"><span class="linenos">2757</span></a>            <span class="s2">&quot;predictions&quot;</span><span class="p">,</span>
</span><span id="Project-2758"><a href="#Project-2758"><span class="linenos">2758</span></a>            <span class="s2">&quot;splits&quot;</span><span class="p">,</span>
</span><span id="Project-2759"><a href="#Project-2759"><span class="linenos">2759</span></a>            <span class="s2">&quot;searches&quot;</span><span class="p">,</span>
</span><span id="Project-2760"><a href="#Project-2760"><span class="linenos">2760</span></a>        <span class="p">]</span>
</span><span id="Project-2761"><a href="#Project-2761"><span class="linenos">2761</span></a>        <span class="k">for</span> <span class="n">sf</span> <span class="ow">in</span> <span class="n">results_subfolders</span><span class="p">:</span>
</span><span id="Project-2762"><a href="#Project-2762"><span class="linenos">2762</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">sf</span><span class="p">))</span>
</span><span id="Project-2763"><a href="#Project-2763"><span class="linenos">2763</span></a>        <span class="k">if</span> <span class="n">data_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2764"><a href="#Project-2764"><span class="linenos">2764</span></a>            <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
</span><span id="Project-2765"><a href="#Project-2765"><span class="linenos">2765</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">))</span>
</span><span id="Project-2766"><a href="#Project-2766"><span class="linenos">2766</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="Project-2767"><a href="#Project-2767"><span class="linenos">2767</span></a>                    <span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-2768"><a href="#Project-2768"><span class="linenos">2768</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span>
</span><span id="Project-2769"><a href="#Project-2769"><span class="linenos">2769</span></a>                    <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-2770"><a href="#Project-2770"><span class="linenos">2770</span></a>                <span class="p">)</span>
</span><span id="Project-2771"><a href="#Project-2771"><span class="linenos">2771</span></a>                <span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
</span><span id="Project-2772"><a href="#Project-2772"><span class="linenos">2772</span></a>        <span class="k">if</span> <span class="n">annotation_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2773"><a href="#Project-2773"><span class="linenos">2773</span></a>            <span class="k">if</span> <span class="n">copy</span><span class="p">:</span>
</span><span id="Project-2774"><a href="#Project-2774"><span class="linenos">2774</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">))</span>
</span><span id="Project-2775"><a href="#Project-2775"><span class="linenos">2775</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="Project-2776"><a href="#Project-2776"><span class="linenos">2776</span></a>                    <span class="n">annotation_path</span><span class="p">,</span>
</span><span id="Project-2777"><a href="#Project-2777"><span class="linenos">2777</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">),</span>
</span><span id="Project-2778"><a href="#Project-2778"><span class="linenos">2778</span></a>                    <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-2779"><a href="#Project-2779"><span class="linenos">2779</span></a>                <span class="p">)</span>
</span><span id="Project-2780"><a href="#Project-2780"><span class="linenos">2780</span></a>                <span class="n">annotation_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">)</span>
</span><span id="Project-2781"><a href="#Project-2781"><span class="linenos">2781</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_config</span><span class="p">(</span>
</span><span id="Project-2782"><a href="#Project-2782"><span class="linenos">2782</span></a>            <span class="n">data_type</span><span class="p">,</span>
</span><span id="Project-2783"><a href="#Project-2783"><span class="linenos">2783</span></a>            <span class="n">annotation_type</span><span class="p">,</span>
</span><span id="Project-2784"><a href="#Project-2784"><span class="linenos">2784</span></a>            <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-2785"><a href="#Project-2785"><span class="linenos">2785</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="Project-2786"><a href="#Project-2786"><span class="linenos">2786</span></a>        <span class="p">)</span>
</span><span id="Project-2787"><a href="#Project-2787"><span class="linenos">2787</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_meta</span><span class="p">()</span>
</span><span id="Project-2788"><a href="#Project-2788"><span class="linenos">2788</span></a>
</span><span id="Project-2789"><a href="#Project-2789"><span class="linenos">2789</span></a>    <span class="k">def</span> <span class="nf">_read_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="Project-2790"><a href="#Project-2790"><span class="linenos">2790</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2791"><a href="#Project-2791"><span class="linenos">2791</span></a><span class="sd">        Get data type and annotation type from existing project files</span>
</span><span id="Project-2792"><a href="#Project-2792"><span class="linenos">2792</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2793"><a href="#Project-2793"><span class="linenos">2793</span></a>
</span><span id="Project-2794"><a href="#Project-2794"><span class="linenos">2794</span></a>        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;general.yaml&quot;</span><span class="p">)</span>
</span><span id="Project-2795"><a href="#Project-2795"><span class="linenos">2795</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2796"><a href="#Project-2796"><span class="linenos">2796</span></a>            <span class="n">pars</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Project-2797"><a href="#Project-2797"><span class="linenos">2797</span></a>        <span class="n">data_type</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span>
</span><span id="Project-2798"><a href="#Project-2798"><span class="linenos">2798</span></a>        <span class="n">annotation_type</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;annotation_type&quot;</span><span class="p">]</span>
</span><span id="Project-2799"><a href="#Project-2799"><span class="linenos">2799</span></a>        <span class="k">return</span> <span class="n">annotation_type</span><span class="p">,</span> <span class="n">data_type</span>
</span><span id="Project-2800"><a href="#Project-2800"><span class="linenos">2800</span></a>
</span><span id="Project-2801"><a href="#Project-2801"><span class="linenos">2801</span></a>    <span class="k">def</span> <span class="nf">_read_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="Project-2802"><a href="#Project-2802"><span class="linenos">2802</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2803"><a href="#Project-2803"><span class="linenos">2803</span></a><span class="sd">        Get data type and annotation type from existing project files</span>
</span><span id="Project-2804"><a href="#Project-2804"><span class="linenos">2804</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2805"><a href="#Project-2805"><span class="linenos">2805</span></a>
</span><span id="Project-2806"><a href="#Project-2806"><span class="linenos">2806</span></a>        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;data.yaml&quot;</span><span class="p">)</span>
</span><span id="Project-2807"><a href="#Project-2807"><span class="linenos">2807</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2808"><a href="#Project-2808"><span class="linenos">2808</span></a>            <span class="n">pars</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Project-2809"><a href="#Project-2809"><span class="linenos">2809</span></a>        <span class="n">data_path</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data_path&quot;</span><span class="p">]</span>
</span><span id="Project-2810"><a href="#Project-2810"><span class="linenos">2810</span></a>        <span class="n">annotation_path</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;annotation_path&quot;</span><span class="p">]</span>
</span><span id="Project-2811"><a href="#Project-2811"><span class="linenos">2811</span></a>        <span class="k">return</span> <span class="n">annotation_path</span><span class="p">,</span> <span class="n">data_path</span>
</span><span id="Project-2812"><a href="#Project-2812"><span class="linenos">2812</span></a>
</span><span id="Project-2813"><a href="#Project-2813"><span class="linenos">2813</span></a>    <span class="k">def</span> <span class="nf">_generate_config</span><span class="p">(</span>
</span><span id="Project-2814"><a href="#Project-2814"><span class="linenos">2814</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">annotation_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">annotation_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Project-2815"><a href="#Project-2815"><span class="linenos">2815</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2816"><a href="#Project-2816"><span class="linenos">2816</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2817"><a href="#Project-2817"><span class="linenos">2817</span></a><span class="sd">        Initialize the config files</span>
</span><span id="Project-2818"><a href="#Project-2818"><span class="linenos">2818</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2819"><a href="#Project-2819"><span class="linenos">2819</span></a>
</span><span id="Project-2820"><a href="#Project-2820"><span class="linenos">2820</span></a>        <span class="n">default_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2821"><a href="#Project-2821"><span class="linenos">2821</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s2">&quot;config&quot;</span>
</span><span id="Project-2822"><a href="#Project-2822"><span class="linenos">2822</span></a>        <span class="p">)</span>
</span><span id="Project-2823"><a href="#Project-2823"><span class="linenos">2823</span></a>        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span>
</span><span id="Project-2824"><a href="#Project-2824"><span class="linenos">2824</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">,</span> <span class="s2">&quot;metrics&quot;</span><span class="p">,</span> <span class="s2">&quot;ssl&quot;</span><span class="p">,</span> <span class="s2">&quot;training&quot;</span><span class="p">]</span>
</span><span id="Project-2825"><a href="#Project-2825"><span class="linenos">2825</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="Project-2826"><a href="#Project-2826"><span class="linenos">2826</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">),</span> <span class="n">config_path</span><span class="p">)</span>
</span><span id="Project-2827"><a href="#Project-2827"><span class="linenos">2827</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="Project-2828"><a href="#Project-2828"><span class="linenos">2828</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="Project-2829"><a href="#Project-2829"><span class="linenos">2829</span></a>        <span class="p">)</span>
</span><span id="Project-2830"><a href="#Project-2830"><span class="linenos">2830</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="Project-2831"><a href="#Project-2831"><span class="linenos">2831</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">),</span>
</span><span id="Project-2832"><a href="#Project-2832"><span class="linenos">2832</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">),</span>
</span><span id="Project-2833"><a href="#Project-2833"><span class="linenos">2833</span></a>        <span class="p">)</span>
</span><span id="Project-2834"><a href="#Project-2834"><span class="linenos">2834</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="Project-2835"><a href="#Project-2835"><span class="linenos">2835</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">),</span>
</span><span id="Project-2836"><a href="#Project-2836"><span class="linenos">2836</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">),</span>
</span><span id="Project-2837"><a href="#Project-2837"><span class="linenos">2837</span></a>        <span class="p">)</span>
</span><span id="Project-2838"><a href="#Project-2838"><span class="linenos">2838</span></a>        <span class="n">yaml</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span>
</span><span id="Project-2839"><a href="#Project-2839"><span class="linenos">2839</span></a>        <span class="n">data_param_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="Project-2840"><a href="#Project-2840"><span class="linenos">2840</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_param_path</span><span class="p">):</span>
</span><span id="Project-2841"><a href="#Project-2841"><span class="linenos">2841</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_param_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2842"><a href="#Project-2842"><span class="linenos">2842</span></a>                <span class="n">data_params</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Project-2843"><a href="#Project-2843"><span class="linenos">2843</span></a>        <span class="k">if</span> <span class="n">data_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2844"><a href="#Project-2844"><span class="linenos">2844</span></a>            <span class="n">data_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-2845"><a href="#Project-2845"><span class="linenos">2845</span></a>        <span class="k">if</span> <span class="n">annotation_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2846"><a href="#Project-2846"><span class="linenos">2846</span></a>            <span class="n">ann_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-2847"><a href="#Project-2847"><span class="linenos">2847</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2848"><a href="#Project-2848"><span class="linenos">2848</span></a>            <span class="n">ann_param_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2849"><a href="#Project-2849"><span class="linenos">2849</span></a>                <span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;annotation&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project-2850"><a href="#Project-2850"><span class="linenos">2850</span></a>            <span class="p">)</span>
</span><span id="Project-2851"><a href="#Project-2851"><span class="linenos">2851</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ann_param_path</span><span class="p">):</span>
</span><span id="Project-2852"><a href="#Project-2852"><span class="linenos">2852</span></a>                <span class="n">ann_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span><span class="n">ann_param_path</span><span class="p">)</span>
</span><span id="Project-2853"><a href="#Project-2853"><span class="linenos">2853</span></a>            <span class="k">elif</span> <span class="n">annotation_type</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="Project-2854"><a href="#Project-2854"><span class="linenos">2854</span></a>                <span class="n">ann_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-2855"><a href="#Project-2855"><span class="linenos">2855</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2856"><a href="#Project-2856"><span class="linenos">2856</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-2857"><a href="#Project-2857"><span class="linenos">2857</span></a>                    <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2"> data type is not available. &quot;</span>
</span><span id="Project-2858"><a href="#Project-2858"><span class="linenos">2858</span></a>                    <span class="sa">f</span><span class="s2">&quot;Please choose from </span><span class="si">{</span><span class="n">BehaviorDataset</span><span class="o">.</span><span class="n">annotation_types</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-2859"><a href="#Project-2859"><span class="linenos">2859</span></a>                <span class="p">)</span>
</span><span id="Project-2860"><a href="#Project-2860"><span class="linenos">2860</span></a>        <span class="k">if</span> <span class="n">ann_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2861"><a href="#Project-2861"><span class="linenos">2861</span></a>            <span class="n">ann_params</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-2862"><a href="#Project-2862"><span class="linenos">2862</span></a>        <span class="n">data_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">data_params</span><span class="p">,</span> <span class="n">ann_params</span><span class="p">)</span>
</span><span id="Project-2863"><a href="#Project-2863"><span class="linenos">2863</span></a>        <span class="n">data_params</span><span class="p">[</span><span class="s2">&quot;data_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_path</span>
</span><span id="Project-2864"><a href="#Project-2864"><span class="linenos">2864</span></a>        <span class="n">data_params</span><span class="p">[</span><span class="s2">&quot;annotation_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">annotation_path</span>
</span><span id="Project-2865"><a href="#Project-2865"><span class="linenos">2865</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;data.yaml&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2866"><a href="#Project-2866"><span class="linenos">2866</span></a>            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data_params</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project-2867"><a href="#Project-2867"><span class="linenos">2867</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">default_path</span><span class="p">,</span> <span class="s2">&quot;general.yaml&quot;</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2868"><a href="#Project-2868"><span class="linenos">2868</span></a>            <span class="n">general_params</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Project-2869"><a href="#Project-2869"><span class="linenos">2869</span></a>        <span class="n">general_params</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_type</span>
</span><span id="Project-2870"><a href="#Project-2870"><span class="linenos">2870</span></a>        <span class="n">general_params</span><span class="p">[</span><span class="s2">&quot;annotation_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">annotation_type</span>
</span><span id="Project-2871"><a href="#Project-2871"><span class="linenos">2871</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;general.yaml&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2872"><a href="#Project-2872"><span class="linenos">2872</span></a>            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">general_params</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project-2873"><a href="#Project-2873"><span class="linenos">2873</span></a>
</span><span id="Project-2874"><a href="#Project-2874"><span class="linenos">2874</span></a>    <span class="k">def</span> <span class="nf">_generate_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2875"><a href="#Project-2875"><span class="linenos">2875</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2876"><a href="#Project-2876"><span class="linenos">2876</span></a><span class="sd">        Initialize the meta files</span>
</span><span id="Project-2877"><a href="#Project-2877"><span class="linenos">2877</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2878"><a href="#Project-2878"><span class="linenos">2878</span></a>
</span><span id="Project-2879"><a href="#Project-2879"><span class="linenos">2879</span></a>        <span class="n">config_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span>
</span><span id="Project-2880"><a href="#Project-2880"><span class="linenos">2880</span></a>        <span class="n">meta_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="Project-2881"><a href="#Project-2881"><span class="linenos">2881</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">meta_fields</span><span class="p">]</span>
</span><span id="Project-2882"><a href="#Project-2882"><span class="linenos">2882</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span>
</span><span id="Project-2883"><a href="#Project-2883"><span class="linenos">2883</span></a>        <span class="n">episodes</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes_path</span><span class="p">())</span>
</span><span id="Project-2884"><a href="#Project-2884"><span class="linenos">2884</span></a>        <span class="n">meta_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;objective&quot;</span><span class="p">]</span>
</span><span id="Project-2885"><a href="#Project-2885"><span class="linenos">2885</span></a>        <span class="n">result_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;best_params&quot;</span><span class="p">,</span> <span class="s2">&quot;best_value&quot;</span><span class="p">]</span>
</span><span id="Project-2886"><a href="#Project-2886"><span class="linenos">2886</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">meta_fields</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
</span><span id="Project-2887"><a href="#Project-2887"><span class="linenos">2887</span></a>            <span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">result_fields</span>
</span><span id="Project-2888"><a href="#Project-2888"><span class="linenos">2888</span></a>        <span class="p">]</span>
</span><span id="Project-2889"><a href="#Project-2889"><span class="linenos">2889</span></a>        <span class="n">searches</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span>
</span><span id="Project-2890"><a href="#Project-2890"><span class="linenos">2890</span></a>        <span class="n">searches</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_searches_path</span><span class="p">())</span>
</span><span id="Project-2891"><a href="#Project-2891"><span class="linenos">2891</span></a>        <span class="n">meta_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
</span><span id="Project-2892"><a href="#Project-2892"><span class="linenos">2892</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">meta_fields</span><span class="p">]</span>
</span><span id="Project-2893"><a href="#Project-2893"><span class="linenos">2893</span></a>        <span class="n">predictions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span>
</span><span id="Project-2894"><a href="#Project-2894"><span class="linenos">2894</span></a>        <span class="n">predictions</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">())</span>
</span><span id="Project-2895"><a href="#Project-2895"><span class="linenos">2895</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s2">&quot;data.yaml&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2896"><a href="#Project-2896"><span class="linenos">2896</span></a>            <span class="n">data_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Project-2897"><a href="#Project-2897"><span class="linenos">2897</span></a>        <span class="n">saved_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">data_keys</span><span class="p">)</span>
</span><span id="Project-2898"><a href="#Project-2898"><span class="linenos">2898</span></a>        <span class="n">saved_data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets_path</span><span class="p">())</span>
</span><span id="Project-2899"><a href="#Project-2899"><span class="linenos">2899</span></a>        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_thresholds_path</span><span class="p">())</span>
</span><span id="Project-2900"><a href="#Project-2900"><span class="linenos">2900</span></a>        <span class="c1"># with open(self._version_path()) as f:</span>
</span><span id="Project-2901"><a href="#Project-2901"><span class="linenos">2901</span></a>        <span class="c1">#     f.write(__version__)</span>
</span><span id="Project-2902"><a href="#Project-2902"><span class="linenos">2902</span></a>
</span><span id="Project-2903"><a href="#Project-2903"><span class="linenos">2903</span></a>    <span class="k">def</span> <span class="nf">_open_yaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CommentedMap</span><span class="p">:</span>
</span><span id="Project-2904"><a href="#Project-2904"><span class="linenos">2904</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2905"><a href="#Project-2905"><span class="linenos">2905</span></a><span class="sd">        Load a parameter dictionary from a .yaml file</span>
</span><span id="Project-2906"><a href="#Project-2906"><span class="linenos">2906</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2907"><a href="#Project-2907"><span class="linenos">2907</span></a>
</span><span id="Project-2908"><a href="#Project-2908"><span class="linenos">2908</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-2909"><a href="#Project-2909"><span class="linenos">2909</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Project-2910"><a href="#Project-2910"><span class="linenos">2910</span></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2911"><a href="#Project-2911"><span class="linenos">2911</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-2912"><a href="#Project-2912"><span class="linenos">2912</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="Project-2913"><a href="#Project-2913"><span class="linenos">2913</span></a>
</span><span id="Project-2914"><a href="#Project-2914"><span class="linenos">2914</span></a>    <span class="k">def</span> <span class="nf">_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">allow_diff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-7</span><span class="p">):</span>
</span><span id="Project-2915"><a href="#Project-2915"><span class="linenos">2915</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2916"><a href="#Project-2916"><span class="linenos">2916</span></a><span class="sd">        Compare nested dictionaries with &#39;almost equal&#39; condition</span>
</span><span id="Project-2917"><a href="#Project-2917"><span class="linenos">2917</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2918"><a href="#Project-2918"><span class="linenos">2918</span></a>
</span><span id="Project-2919"><a href="#Project-2919"><span class="linenos">2919</span></a>        <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Project-2920"><a href="#Project-2920"><span class="linenos">2920</span></a>        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">!=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Project-2921"><a href="#Project-2921"><span class="linenos">2921</span></a>            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-2922"><a href="#Project-2922"><span class="linenos">2922</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2923"><a href="#Project-2923"><span class="linenos">2923</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-2924"><a href="#Project-2924"><span class="linenos">2924</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="Project-2925"><a href="#Project-2925"><span class="linenos">2925</span></a>                    <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">allow_diff</span><span class="o">=</span><span class="n">allow_diff</span><span class="p">)</span>
</span><span id="Project-2926"><a href="#Project-2926"><span class="linenos">2926</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2927"><a href="#Project-2927"><span class="linenos">2927</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="Project-2928"><a href="#Project-2928"><span class="linenos">2928</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Project-2929"><a href="#Project-2929"><span class="linenos">2929</span></a>                            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-2930"><a href="#Project-2930"><span class="linenos">2930</span></a>                        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Project-2931"><a href="#Project-2931"><span class="linenos">2931</span></a>                            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-2932"><a href="#Project-2932"><span class="linenos">2932</span></a>                        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">allow_diff</span><span class="p">:</span>
</span><span id="Project-2933"><a href="#Project-2933"><span class="linenos">2933</span></a>                            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-2934"><a href="#Project-2934"><span class="linenos">2934</span></a>                    <span class="k">elif</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
</span><span id="Project-2935"><a href="#Project-2935"><span class="linenos">2935</span></a>                        <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-2936"><a href="#Project-2936"><span class="linenos">2936</span></a>        <span class="k">return</span> <span class="n">ok</span>
</span><span id="Project-2937"><a href="#Project-2937"><span class="linenos">2937</span></a>
</span><span id="Project-2938"><a href="#Project-2938"><span class="linenos">2938</span></a>    <span class="k">def</span> <span class="nf">_check_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment_sequence</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Project-2939"><a href="#Project-2939"><span class="linenos">2939</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2940"><a href="#Project-2940"><span class="linenos">2940</span></a><span class="sd">        Check if a comment already exists in a ruamel.yaml comment sequence</span>
</span><span id="Project-2941"><a href="#Project-2941"><span class="linenos">2941</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2942"><a href="#Project-2942"><span class="linenos">2942</span></a>
</span><span id="Project-2943"><a href="#Project-2943"><span class="linenos">2943</span></a>        <span class="k">if</span> <span class="n">comment_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2944"><a href="#Project-2944"><span class="linenos">2944</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Project-2945"><a href="#Project-2945"><span class="linenos">2945</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">comment_sequence</span><span class="p">)</span>
</span><span id="Project-2946"><a href="#Project-2946"><span class="linenos">2946</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="Project-2947"><a href="#Project-2947"><span class="linenos">2947</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="Project-2948"><a href="#Project-2948"><span class="linenos">2948</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2949"><a href="#Project-2949"><span class="linenos">2949</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Project-2950"><a href="#Project-2950"><span class="linenos">2950</span></a>
</span><span id="Project-2951"><a href="#Project-2951"><span class="linenos">2951</span></a>    <span class="k">def</span> <span class="nf">_get_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comment_sequence</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">strip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project-2952"><a href="#Project-2952"><span class="linenos">2952</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2953"><a href="#Project-2953"><span class="linenos">2953</span></a><span class="sd">        Get the comment string from a ruamel.yaml comment sequence</span>
</span><span id="Project-2954"><a href="#Project-2954"><span class="linenos">2954</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2955"><a href="#Project-2955"><span class="linenos">2955</span></a>
</span><span id="Project-2956"><a href="#Project-2956"><span class="linenos">2956</span></a>        <span class="k">if</span> <span class="n">comment_sequence</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2957"><a href="#Project-2957"><span class="linenos">2957</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="Project-2958"><a href="#Project-2958"><span class="linenos">2958</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Project-2959"><a href="#Project-2959"><span class="linenos">2959</span></a>        <span class="k">for</span> <span class="n">cm</span> <span class="ow">in</span> <span class="n">comment_sequence</span><span class="p">:</span>
</span><span id="Project-2960"><a href="#Project-2960"><span class="linenos">2960</span></a>            <span class="k">if</span> <span class="n">cm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2961"><a href="#Project-2961"><span class="linenos">2961</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
</span><span id="Project-2962"><a href="#Project-2962"><span class="linenos">2962</span></a>                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cm</span><span class="p">:</span>
</span><span id="Project-2963"><a href="#Project-2963"><span class="linenos">2963</span></a>                        <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-2964"><a href="#Project-2964"><span class="linenos">2964</span></a>                            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span>
</span><span id="Project-2965"><a href="#Project-2965"><span class="linenos">2965</span></a>                            <span class="k">break</span>
</span><span id="Project-2966"><a href="#Project-2966"><span class="linenos">2966</span></a>                    <span class="k">break</span>
</span><span id="Project-2967"><a href="#Project-2967"><span class="linenos">2967</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project-2968"><a href="#Project-2968"><span class="linenos">2968</span></a>                    <span class="n">c</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">value</span>
</span><span id="Project-2969"><a href="#Project-2969"><span class="linenos">2969</span></a>                    <span class="k">break</span>
</span><span id="Project-2970"><a href="#Project-2970"><span class="linenos">2970</span></a>        <span class="k">if</span> <span class="n">strip</span><span class="p">:</span>
</span><span id="Project-2971"><a href="#Project-2971"><span class="linenos">2971</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="Project-2972"><a href="#Project-2972"><span class="linenos">2972</span></a>        <span class="k">return</span> <span class="n">c</span>
</span><span id="Project-2973"><a href="#Project-2973"><span class="linenos">2973</span></a>
</span><span id="Project-2974"><a href="#Project-2974"><span class="linenos">2974</span></a>    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CommentedMap</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">u</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">CommentedMap</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]):</span>
</span><span id="Project-2975"><a href="#Project-2975"><span class="linenos">2975</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-2976"><a href="#Project-2976"><span class="linenos">2976</span></a><span class="sd">        Update a nested dictionary</span>
</span><span id="Project-2977"><a href="#Project-2977"><span class="linenos">2977</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-2978"><a href="#Project-2978"><span class="linenos">2978</span></a>
</span><span id="Project-2979"><a href="#Project-2979"><span class="linenos">2979</span></a>        <span class="k">if</span> <span class="s2">&quot;general&quot;</span> <span class="ow">in</span> <span class="n">u</span> <span class="ow">and</span> <span class="s2">&quot;model_name&quot;</span> <span class="ow">in</span> <span class="n">u</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
</span><span id="Project-2980"><a href="#Project-2980"><span class="linenos">2980</span></a>            <span class="n">model_name</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="Project-2981"><a href="#Project-2981"><span class="linenos">2981</span></a>            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">model_name</span><span class="p">:</span>
</span><span id="Project-2982"><a href="#Project-2982"><span class="linenos">2982</span></a>                <span class="n">d</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-2983"><a href="#Project-2983"><span class="linenos">2983</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-2984"><a href="#Project-2984"><span class="linenos">2984</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project-2985"><a href="#Project-2985"><span class="linenos">2985</span></a>                    <span class="p">)</span>
</span><span id="Project-2986"><a href="#Project-2986"><span class="linenos">2986</span></a>                <span class="p">)</span>
</span><span id="Project-2987"><a href="#Project-2987"><span class="linenos">2987</span></a>        <span class="n">d_copied</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span><span id="Project-2988"><a href="#Project-2988"><span class="linenos">2988</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-2989"><a href="#Project-2989"><span class="linenos">2989</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="Project-2990"><a href="#Project-2990"><span class="linenos">2990</span></a>                <span class="n">k</span> <span class="ow">in</span> <span class="n">d_copied</span>
</span><span id="Project-2991"><a href="#Project-2991"><span class="linenos">2991</span></a>                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span>
</span><span id="Project-2992"><a href="#Project-2992"><span class="linenos">2992</span></a>                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">)</span>
</span><span id="Project-2993"><a href="#Project-2993"><span class="linenos">2993</span></a>                <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
</span><span id="Project-2994"><a href="#Project-2994"><span class="linenos">2994</span></a>            <span class="p">):</span>
</span><span id="Project-2995"><a href="#Project-2995"><span class="linenos">2995</span></a>                <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-2996"><a href="#Project-2996"><span class="linenos">2996</span></a>                    <span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">vv</span>
</span><span id="Project-2997"><a href="#Project-2997"><span class="linenos">2997</span></a>            <span class="k">elif</span> <span class="p">(</span>
</span><span id="Project-2998"><a href="#Project-2998"><span class="linenos">2998</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">)</span>
</span><span id="Project-2999"><a href="#Project-2999"><span class="linenos">2999</span></a>                <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d_copied</span>
</span><span id="Project-3000"><a href="#Project-3000"><span class="linenos">3000</span></a>                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">)</span>
</span><span id="Project-3001"><a href="#Project-3001"><span class="linenos">3001</span></a>            <span class="p">):</span>
</span><span id="Project-3002"><a href="#Project-3002"><span class="linenos">3002</span></a>                <span class="k">if</span> <span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3003"><a href="#Project-3003"><span class="linenos">3003</span></a>                    <span class="n">d_k</span> <span class="o">=</span> <span class="n">CommentedMap</span><span class="p">()</span>
</span><span id="Project-3004"><a href="#Project-3004"><span class="linenos">3004</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project-3005"><a href="#Project-3005"><span class="linenos">3005</span></a>                    <span class="n">d_k</span> <span class="o">=</span> <span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Project-3006"><a href="#Project-3006"><span class="linenos">3006</span></a>                <span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">d_k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="Project-3007"><a href="#Project-3007"><span class="linenos">3007</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-3008"><a href="#Project-3008"><span class="linenos">3008</span></a>                <span class="n">d_copied</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="Project-3009"><a href="#Project-3009"><span class="linenos">3009</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">CommentedMap</span><span class="p">)</span> <span class="ow">and</span> <span class="n">u</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3010"><a href="#Project-3010"><span class="linenos">3010</span></a>                    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">strip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Project-3011"><a href="#Project-3011"><span class="linenos">3011</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d_copied</span><span class="p">,</span> <span class="n">CommentedMap</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_comment</span><span class="p">(</span>
</span><span id="Project-3012"><a href="#Project-3012"><span class="linenos">3012</span></a>                        <span class="n">d_copied</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="Project-3013"><a href="#Project-3013"><span class="linenos">3013</span></a>                    <span class="p">):</span>
</span><span id="Project-3014"><a href="#Project-3014"><span class="linenos">3014</span></a>                        <span class="n">d_copied</span><span class="o">.</span><span class="n">yaml_add_eol_comment</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
</span><span id="Project-3015"><a href="#Project-3015"><span class="linenos">3015</span></a>        <span class="k">return</span> <span class="n">d_copied</span>
</span><span id="Project-3016"><a href="#Project-3016"><span class="linenos">3016</span></a>
</span><span id="Project-3017"><a href="#Project-3017"><span class="linenos">3017</span></a>    <span class="k">def</span> <span class="nf">_update_with_search</span><span class="p">(</span>
</span><span id="Project-3018"><a href="#Project-3018"><span class="linenos">3018</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3019"><a href="#Project-3019"><span class="linenos">3019</span></a>        <span class="n">d</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-3020"><a href="#Project-3020"><span class="linenos">3020</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-3021"><a href="#Project-3021"><span class="linenos">3021</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3022"><a href="#Project-3022"><span class="linenos">3022</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3023"><a href="#Project-3023"><span class="linenos">3023</span></a>    <span class="p">):</span>
</span><span id="Project-3024"><a href="#Project-3024"><span class="linenos">3024</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3025"><a href="#Project-3025"><span class="linenos">3025</span></a><span class="sd">        Update a dictionary with best parameters from a hyperparameter search</span>
</span><span id="Project-3026"><a href="#Project-3026"><span class="linenos">3026</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3027"><a href="#Project-3027"><span class="linenos">3027</span></a>
</span><span id="Project-3028"><a href="#Project-3028"><span class="linenos">3028</span></a>        <span class="n">u</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">get_best_params</span><span class="p">(</span>
</span><span id="Project-3029"><a href="#Project-3029"><span class="linenos">3029</span></a>            <span class="n">search_name</span><span class="p">,</span> <span class="n">load_parameters</span><span class="p">,</span> <span class="n">round_to_binary</span>
</span><span id="Project-3030"><a href="#Project-3030"><span class="linenos">3030</span></a>        <span class="p">)</span>
</span><span id="Project-3031"><a href="#Project-3031"><span class="linenos">3031</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</span><span id="Project-3032"><a href="#Project-3032"><span class="linenos">3032</span></a>
</span><span id="Project-3033"><a href="#Project-3033"><span class="linenos">3033</span></a>    <span class="k">def</span> <span class="nf">_read_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catch_blanks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-3034"><a href="#Project-3034"><span class="linenos">3034</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3035"><a href="#Project-3035"><span class="linenos">3035</span></a><span class="sd">        Compose a parameter dictionary to create a task from the config files</span>
</span><span id="Project-3036"><a href="#Project-3036"><span class="linenos">3036</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3037"><a href="#Project-3037"><span class="linenos">3037</span></a>
</span><span id="Project-3038"><a href="#Project-3038"><span class="linenos">3038</span></a>        <span class="n">config_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">)</span>
</span><span id="Project-3039"><a href="#Project-3039"><span class="linenos">3039</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-3040"><a href="#Project-3040"><span class="linenos">3040</span></a>            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
</span><span id="Project-3041"><a href="#Project-3041"><span class="linenos">3041</span></a>            <span class="s2">&quot;general&quot;</span><span class="p">,</span>
</span><span id="Project-3042"><a href="#Project-3042"><span class="linenos">3042</span></a>            <span class="s2">&quot;losses&quot;</span><span class="p">,</span>
</span><span id="Project-3043"><a href="#Project-3043"><span class="linenos">3043</span></a>            <span class="s2">&quot;metrics&quot;</span><span class="p">,</span>
</span><span id="Project-3044"><a href="#Project-3044"><span class="linenos">3044</span></a>            <span class="s2">&quot;ssl&quot;</span><span class="p">,</span>
</span><span id="Project-3045"><a href="#Project-3045"><span class="linenos">3045</span></a>            <span class="s2">&quot;training&quot;</span><span class="p">,</span>
</span><span id="Project-3046"><a href="#Project-3046"><span class="linenos">3046</span></a>        <span class="p">]</span>
</span><span id="Project-3047"><a href="#Project-3047"><span class="linenos">3047</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-3048"><a href="#Project-3048"><span class="linenos">3048</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="Project-3049"><a href="#Project-3049"><span class="linenos">3049</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">))</span>
</span><span id="Project-3050"><a href="#Project-3050"><span class="linenos">3050</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="Project-3051"><a href="#Project-3051"><span class="linenos">3051</span></a>        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-3052"><a href="#Project-3052"><span class="linenos">3052</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">features</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="Project-3053"><a href="#Project-3053"><span class="linenos">3053</span></a>        <span class="p">)</span>
</span><span id="Project-3054"><a href="#Project-3054"><span class="linenos">3054</span></a>        <span class="n">transformer</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">extractor_to_transformer</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
</span><span id="Project-3055"><a href="#Project-3055"><span class="linenos">3055</span></a>        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-3056"><a href="#Project-3056"><span class="linenos">3056</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">transformer</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="Project-3057"><a href="#Project-3057"><span class="linenos">3057</span></a>        <span class="p">)</span>
</span><span id="Project-3058"><a href="#Project-3058"><span class="linenos">3058</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="Project-3059"><a href="#Project-3059"><span class="linenos">3059</span></a>        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project-3060"><a href="#Project-3060"><span class="linenos">3060</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="Project-3061"><a href="#Project-3061"><span class="linenos">3061</span></a>        <span class="p">)</span>
</span><span id="Project-3062"><a href="#Project-3062"><span class="linenos">3062</span></a>        <span class="c1"># input = parameters[&quot;general&quot;][&quot;input&quot;]</span>
</span><span id="Project-3063"><a href="#Project-3063"><span class="linenos">3063</span></a>        <span class="c1"># parameters[&quot;model&quot;] = self._open_yaml(</span>
</span><span id="Project-3064"><a href="#Project-3064"><span class="linenos">3064</span></a>        <span class="c1">#     os.path.join(config_path, &quot;model&quot;, f&quot;{model}.yaml&quot;)</span>
</span><span id="Project-3065"><a href="#Project-3065"><span class="linenos">3065</span></a>        <span class="c1"># )</span>
</span><span id="Project-3066"><a href="#Project-3066"><span class="linenos">3066</span></a>        <span class="k">if</span> <span class="n">catch_blanks</span><span class="p">:</span>
</span><span id="Project-3067"><a href="#Project-3067"><span class="linenos">3067</span></a>            <span class="n">blanks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_blanks</span><span class="p">()</span>
</span><span id="Project-3068"><a href="#Project-3068"><span class="linenos">3068</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blanks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-3069"><a href="#Project-3069"><span class="linenos">3069</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">list_blanks</span><span class="p">()</span>
</span><span id="Project-3070"><a href="#Project-3070"><span class="linenos">3070</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-3071"><a href="#Project-3071"><span class="linenos">3071</span></a>                    <span class="sa">f</span><span class="s2">&quot;Please fill in all the blanks before running experiments&quot;</span>
</span><span id="Project-3072"><a href="#Project-3072"><span class="linenos">3072</span></a>                <span class="p">)</span>
</span><span id="Project-3073"><a href="#Project-3073"><span class="linenos">3073</span></a>        <span class="k">return</span> <span class="n">parameters</span>
</span><span id="Project-3074"><a href="#Project-3074"><span class="linenos">3074</span></a>
</span><span id="Project-3075"><a href="#Project-3075"><span class="linenos">3075</span></a>    <span class="k">def</span> <span class="nf">set_main_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Project-3076"><a href="#Project-3076"><span class="linenos">3076</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3077"><a href="#Project-3077"><span class="linenos">3077</span></a><span class="sd">        Select the model and the metrics</span>
</span><span id="Project-3078"><a href="#Project-3078"><span class="linenos">3078</span></a>
</span><span id="Project-3079"><a href="#Project-3079"><span class="linenos">3079</span></a><span class="sd">        Parameters</span>
</span><span id="Project-3080"><a href="#Project-3080"><span class="linenos">3080</span></a><span class="sd">        ----------</span>
</span><span id="Project-3081"><a href="#Project-3081"><span class="linenos">3081</span></a><span class="sd">        model_name : str, optional</span>
</span><span id="Project-3082"><a href="#Project-3082"><span class="linenos">3082</span></a><span class="sd">            model name; run `project.help(&quot;model&quot;) to find out more</span>
</span><span id="Project-3083"><a href="#Project-3083"><span class="linenos">3083</span></a><span class="sd">        metric_names : list, optional</span>
</span><span id="Project-3084"><a href="#Project-3084"><span class="linenos">3084</span></a><span class="sd">            a list of metric function names; run `project.help(&quot;metrics&quot;) to find out more</span>
</span><span id="Project-3085"><a href="#Project-3085"><span class="linenos">3085</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3086"><a href="#Project-3086"><span class="linenos">3086</span></a>
</span><span id="Project-3087"><a href="#Project-3087"><span class="linenos">3087</span></a>        <span class="n">pars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="Project-3088"><a href="#Project-3088"><span class="linenos">3088</span></a>        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3089"><a href="#Project-3089"><span class="linenos">3089</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">models</span>
</span><span id="Project-3090"><a href="#Project-3090"><span class="linenos">3090</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_name</span>
</span><span id="Project-3091"><a href="#Project-3091"><span class="linenos">3091</span></a>        <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3092"><a href="#Project-3092"><span class="linenos">3092</span></a>            <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
</span><span id="Project-3093"><a href="#Project-3093"><span class="linenos">3093</span></a>                <span class="k">assert</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">metrics</span>
</span><span id="Project-3094"><a href="#Project-3094"><span class="linenos">3094</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;metric_functions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_names</span>
</span><span id="Project-3095"><a href="#Project-3095"><span class="linenos">3095</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
</span><span id="Project-3096"><a href="#Project-3096"><span class="linenos">3096</span></a>
</span><span id="Project-3097"><a href="#Project-3097"><span class="linenos">3097</span></a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Project-3098"><a href="#Project-3098"><span class="linenos">3098</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3099"><a href="#Project-3099"><span class="linenos">3099</span></a><span class="sd">        Get information on available options</span>
</span><span id="Project-3100"><a href="#Project-3100"><span class="linenos">3100</span></a>
</span><span id="Project-3101"><a href="#Project-3101"><span class="linenos">3101</span></a><span class="sd">        Parameters</span>
</span><span id="Project-3102"><a href="#Project-3102"><span class="linenos">3102</span></a><span class="sd">        ----------</span>
</span><span id="Project-3103"><a href="#Project-3103"><span class="linenos">3103</span></a><span class="sd">        keyword : str, optional</span>
</span><span id="Project-3104"><a href="#Project-3104"><span class="linenos">3104</span></a><span class="sd">            the keyword for options (run without arguments to see which keywords are available)</span>
</span><span id="Project-3105"><a href="#Project-3105"><span class="linenos">3105</span></a>
</span><span id="Project-3106"><a href="#Project-3106"><span class="linenos">3106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3107"><a href="#Project-3107"><span class="linenos">3107</span></a>
</span><span id="Project-3108"><a href="#Project-3108"><span class="linenos">3108</span></a>        <span class="k">if</span> <span class="n">keyword</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3109"><a href="#Project-3109"><span class="linenos">3109</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AVAILABLE HELP FUNCTIONS:&quot;</span><span class="p">)</span>
</span><span id="Project-3110"><a href="#Project-3110"><span class="linenos">3110</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Try running `project.help(keyword)` with the following keywords:&quot;</span><span class="p">)</span>
</span><span id="Project-3111"><a href="#Project-3111"><span class="linenos">3111</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - model: to get more information on available models,&quot;</span><span class="p">)</span>
</span><span id="Project-3112"><a href="#Project-3112"><span class="linenos">3112</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3113"><a href="#Project-3113"><span class="linenos">3113</span></a>                <span class="s2">&quot;    - features: to get more information on available feature extraction modes,&quot;</span>
</span><span id="Project-3114"><a href="#Project-3114"><span class="linenos">3114</span></a>            <span class="p">)</span>
</span><span id="Project-3115"><a href="#Project-3115"><span class="linenos">3115</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3116"><a href="#Project-3116"><span class="linenos">3116</span></a>                <span class="s2">&quot;    - partition_method: to get more information on available train/test/val partitioning methods,&quot;</span>
</span><span id="Project-3117"><a href="#Project-3117"><span class="linenos">3117</span></a>            <span class="p">)</span>
</span><span id="Project-3118"><a href="#Project-3118"><span class="linenos">3118</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - metrics: to see a list of available metric functions.&quot;</span><span class="p">)</span>
</span><span id="Project-3119"><a href="#Project-3119"><span class="linenos">3119</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - data: to see help for expected data structure&quot;</span><span class="p">)</span>
</span><span id="Project-3120"><a href="#Project-3120"><span class="linenos">3120</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3121"><a href="#Project-3121"><span class="linenos">3121</span></a>                <span class="s2">&quot;- To start working with this project, first run `project.list_blanks()` to check which parameters need to be filled in.&quot;</span>
</span><span id="Project-3122"><a href="#Project-3122"><span class="linenos">3122</span></a>            <span class="p">)</span>
</span><span id="Project-3123"><a href="#Project-3123"><span class="linenos">3123</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3124"><a href="#Project-3124"><span class="linenos">3124</span></a>                <span class="s2">&quot;- After a model and metrics are set, run `project.list_basic_parameters()` to see a list of the most important parameters that you might want to modify&quot;</span>
</span><span id="Project-3125"><a href="#Project-3125"><span class="linenos">3125</span></a>            <span class="p">)</span>
</span><span id="Project-3126"><a href="#Project-3126"><span class="linenos">3126</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3127"><a href="#Project-3127"><span class="linenos">3127</span></a>                <span class="sa">f</span><span class="s2">&quot;- If you want to dig deeper, get the full dictionary with project._read_parameters() (it is a `ruamel.yaml.comments.CommentedMap` instance).&quot;</span>
</span><span id="Project-3128"><a href="#Project-3128"><span class="linenos">3128</span></a>            <span class="p">)</span>
</span><span id="Project-3129"><a href="#Project-3129"><span class="linenos">3129</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span>
</span><span id="Project-3130"><a href="#Project-3130"><span class="linenos">3130</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MODELS:&quot;</span><span class="p">)</span>
</span><span id="Project-3131"><a href="#Project-3131"><span class="linenos">3131</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-3132"><a href="#Project-3132"><span class="linenos">3132</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project-3133"><a href="#Project-3133"><span class="linenos">3133</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project-3134"><a href="#Project-3134"><span class="linenos">3134</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span>
</span><span id="Project-3135"><a href="#Project-3135"><span class="linenos">3135</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FEATURE EXTRACTORS:&quot;</span><span class="p">)</span>
</span><span id="Project-3136"><a href="#Project-3136"><span class="linenos">3136</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">extractor</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">feature_extractors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-3137"><a href="#Project-3137"><span class="linenos">3137</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project-3138"><a href="#Project-3138"><span class="linenos">3138</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">extractor</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project-3139"><a href="#Project-3139"><span class="linenos">3139</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;partition_method&quot;</span><span class="p">:</span>
</span><span id="Project-3140"><a href="#Project-3140"><span class="linenos">3140</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PARTITION METHODS:&quot;</span><span class="p">)</span>
</span><span id="Project-3141"><a href="#Project-3141"><span class="linenos">3141</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3142"><a href="#Project-3142"><span class="linenos">3142</span></a>                <span class="n">BehaviorDataset</span><span class="o">.</span><span class="n">partition_train_test_val</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
</span><span id="Project-3143"><a href="#Project-3143"><span class="linenos">3143</span></a>                    <span class="s2">&quot;The partitioning method:&quot;</span>
</span><span id="Project-3144"><a href="#Project-3144"><span class="linenos">3144</span></a>                <span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;val_frac :&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-3145"><a href="#Project-3145"><span class="linenos">3145</span></a>            <span class="p">)</span>
</span><span id="Project-3146"><a href="#Project-3146"><span class="linenos">3146</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;metrics&quot;</span><span class="p">:</span>
</span><span id="Project-3147"><a href="#Project-3147"><span class="linenos">3147</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;METRICS:&quot;</span><span class="p">)</span>
</span><span id="Project-3148"><a href="#Project-3148"><span class="linenos">3148</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-3149"><a href="#Project-3149"><span class="linenos">3149</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project-3150"><a href="#Project-3150"><span class="linenos">3150</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project-3151"><a href="#Project-3151"><span class="linenos">3151</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
</span><span id="Project-3152"><a href="#Project-3152"><span class="linenos">3152</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DATA:&quot;</span><span class="p">)</span>
</span><span id="Project-3153"><a href="#Project-3153"><span class="linenos">3153</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video data: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-3154"><a href="#Project-3154"><span class="linenos">3154</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">input_stores</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">]</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project-3155"><a href="#Project-3155"><span class="linenos">3155</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Annotation data: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-3156"><a href="#Project-3156"><span class="linenos">3156</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">annotation_stores</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="p">]</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project-3157"><a href="#Project-3157"><span class="linenos">3157</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3158"><a href="#Project-3158"><span class="linenos">3158</span></a>                <span class="s2">&quot;Annotation path and data path don&#39;t have to be separate, you can keep everything in one folder.&quot;</span>
</span><span id="Project-3159"><a href="#Project-3159"><span class="linenos">3159</span></a>            <span class="p">)</span>
</span><span id="Project-3160"><a href="#Project-3160"><span class="linenos">3160</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-3161"><a href="#Project-3161"><span class="linenos">3161</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="s2"> keyword is not recognized&quot;</span><span class="p">)</span>
</span><span id="Project-3162"><a href="#Project-3162"><span class="linenos">3162</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-3163"><a href="#Project-3163"><span class="linenos">3163</span></a>
</span><span id="Project-3164"><a href="#Project-3164"><span class="linenos">3164</span></a>    <span class="k">def</span> <span class="nf">_process_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span id="Project-3165"><a href="#Project-3165"><span class="linenos">3165</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Project-3166"><a href="#Project-3166"><span class="linenos">3166</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
</span><span id="Project-3167"><a href="#Project-3167"><span class="linenos">3167</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">CommentedSet</span><span class="p">):</span>
</span><span id="Project-3168"><a href="#Project-3168"><span class="linenos">3168</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">}</span>
</span><span id="Project-3169"><a href="#Project-3169"><span class="linenos">3169</span></a>        <span class="k">return</span> <span class="n">value</span>
</span><span id="Project-3170"><a href="#Project-3170"><span class="linenos">3170</span></a>
</span><span id="Project-3171"><a href="#Project-3171"><span class="linenos">3171</span></a>    <span class="k">def</span> <span class="nf">_get_blanks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Project-3172"><a href="#Project-3172"><span class="linenos">3172</span></a>        <span class="n">caught</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-3173"><a href="#Project-3173"><span class="linenos">3173</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">(</span><span class="n">catch_blanks</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Project-3174"><a href="#Project-3174"><span class="linenos">3174</span></a>        <span class="k">for</span> <span class="n">big_key</span><span class="p">,</span> <span class="n">big_value</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-3175"><a href="#Project-3175"><span class="linenos">3175</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">big_value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-3176"><a href="#Project-3176"><span class="linenos">3176</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;???&quot;</span><span class="p">:</span>
</span><span id="Project-3177"><a href="#Project-3177"><span class="linenos">3177</span></a>                    <span class="n">caught</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Project-3178"><a href="#Project-3178"><span class="linenos">3178</span></a>                        <span class="p">(</span><span class="n">big_key</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">big_value</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
</span><span id="Project-3179"><a href="#Project-3179"><span class="linenos">3179</span></a>                    <span class="p">)</span>
</span><span id="Project-3180"><a href="#Project-3180"><span class="linenos">3180</span></a>        <span class="k">return</span> <span class="n">caught</span>
</span><span id="Project-3181"><a href="#Project-3181"><span class="linenos">3181</span></a>
</span><span id="Project-3182"><a href="#Project-3182"><span class="linenos">3182</span></a>    <span class="k">def</span> <span class="nf">list_blanks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blanks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Project-3183"><a href="#Project-3183"><span class="linenos">3183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3184"><a href="#Project-3184"><span class="linenos">3184</span></a><span class="sd">        List parameters that need to be filled in</span>
</span><span id="Project-3185"><a href="#Project-3185"><span class="linenos">3185</span></a>
</span><span id="Project-3186"><a href="#Project-3186"><span class="linenos">3186</span></a><span class="sd">        Parameters</span>
</span><span id="Project-3187"><a href="#Project-3187"><span class="linenos">3187</span></a><span class="sd">        ----------</span>
</span><span id="Project-3188"><a href="#Project-3188"><span class="linenos">3188</span></a><span class="sd">        blanks : list, optional</span>
</span><span id="Project-3189"><a href="#Project-3189"><span class="linenos">3189</span></a><span class="sd">            a list of the parameters to list, if already known</span>
</span><span id="Project-3190"><a href="#Project-3190"><span class="linenos">3190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3191"><a href="#Project-3191"><span class="linenos">3191</span></a>
</span><span id="Project-3192"><a href="#Project-3192"><span class="linenos">3192</span></a>        <span class="k">if</span> <span class="n">blanks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3193"><a href="#Project-3193"><span class="linenos">3193</span></a>            <span class="n">blanks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_blanks</span><span class="p">()</span>
</span><span id="Project-3194"><a href="#Project-3194"><span class="linenos">3194</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blanks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-3195"><a href="#Project-3195"><span class="linenos">3195</span></a>            <span class="n">to_update</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="Project-3196"><a href="#Project-3196"><span class="linenos">3196</span></a>            <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">blanks</span><span class="p">:</span>
</span><span id="Project-3197"><a href="#Project-3197"><span class="linenos">3197</span></a>                <span class="n">to_update</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</span><span id="Project-3198"><a href="#Project-3198"><span class="linenos">3198</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before running experiments, please update all the blanks.&quot;</span><span class="p">)</span>
</span><span id="Project-3199"><a href="#Project-3199"><span class="linenos">3199</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To do that, you can run this.&quot;</span><span class="p">)</span>
</span><span id="Project-3200"><a href="#Project-3200"><span class="linenos">3200</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="Project-3201"><a href="#Project-3201"><span class="linenos">3201</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;project.update_parameters(&quot;</span><span class="p">)</span>
</span><span id="Project-3202"><a href="#Project-3202"><span class="linenos">3202</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="se">{{</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-3203"><a href="#Project-3203"><span class="linenos">3203</span></a>            <span class="k">for</span> <span class="n">big_key</span><span class="p">,</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">to_update</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-3204"><a href="#Project-3204"><span class="linenos">3204</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;        &quot;</span><span class="si">{</span><span class="n">big_key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project-3205"><a href="#Project-3205"><span class="linenos">3205</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="Project-3206"><a href="#Project-3206"><span class="linenos">3206</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: ..., </span><span class="si">{</span><span class="n">comment</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project-3207"><a href="#Project-3207"><span class="linenos">3207</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="se">}}</span><span class="s2">,&quot;</span><span class="p">)</span>
</span><span id="Project-3208"><a href="#Project-3208"><span class="linenos">3208</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="se">}}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-3209"><a href="#Project-3209"><span class="linenos">3209</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="Project-3210"><a href="#Project-3210"><span class="linenos">3210</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="Project-3211"><a href="#Project-3211"><span class="linenos">3211</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Replace ... with relevant values.&quot;</span><span class="p">)</span>
</span><span id="Project-3212"><a href="#Project-3212"><span class="linenos">3212</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-3213"><a href="#Project-3213"><span class="linenos">3213</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no blanks left!&quot;</span><span class="p">)</span>
</span><span id="Project-3214"><a href="#Project-3214"><span class="linenos">3214</span></a>
</span><span id="Project-3215"><a href="#Project-3215"><span class="linenos">3215</span></a>    <span class="k">def</span> <span class="nf">list_basic_parameters</span><span class="p">(</span>
</span><span id="Project-3216"><a href="#Project-3216"><span class="linenos">3216</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3217"><a href="#Project-3217"><span class="linenos">3217</span></a>    <span class="p">):</span>
</span><span id="Project-3218"><a href="#Project-3218"><span class="linenos">3218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3219"><a href="#Project-3219"><span class="linenos">3219</span></a><span class="sd">        Get a list of most relevant parameters and code to modify them</span>
</span><span id="Project-3220"><a href="#Project-3220"><span class="linenos">3220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3221"><a href="#Project-3221"><span class="linenos">3221</span></a>
</span><span id="Project-3222"><a href="#Project-3222"><span class="linenos">3222</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="Project-3223"><a href="#Project-3223"><span class="linenos">3223</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BASIC PARAMETERS:&quot;</span><span class="p">)</span>
</span><span id="Project-3224"><a href="#Project-3224"><span class="linenos">3224</span></a>        <span class="n">model_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="Project-3225"><a href="#Project-3225"><span class="linenos">3225</span></a>        <span class="n">metric_names</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;metric_functions&quot;</span><span class="p">]</span>
</span><span id="Project-3226"><a href="#Project-3226"><span class="linenos">3226</span></a>        <span class="n">loss_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;loss_function&quot;</span><span class="p">]</span>
</span><span id="Project-3227"><a href="#Project-3227"><span class="linenos">3227</span></a>        <span class="n">feature_extraction</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="Project-3228"><a href="#Project-3228"><span class="linenos">3228</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Here is a list of current parameters.&quot;</span><span class="p">)</span>
</span><span id="Project-3229"><a href="#Project-3229"><span class="linenos">3229</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3230"><a href="#Project-3230"><span class="linenos">3230</span></a>            <span class="s2">&quot;You can copy this code, change the parameters you want to set and run it to update the project config.&quot;</span>
</span><span id="Project-3231"><a href="#Project-3231"><span class="linenos">3231</span></a>        <span class="p">)</span>
</span><span id="Project-3232"><a href="#Project-3232"><span class="linenos">3232</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="Project-3233"><a href="#Project-3233"><span class="linenos">3233</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;project.update_parameters(&quot;</span><span class="p">)</span>
</span><span id="Project-3234"><a href="#Project-3234"><span class="linenos">3234</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    {&quot;</span><span class="p">)</span>
</span><span id="Project-3235"><a href="#Project-3235"><span class="linenos">3235</span></a>        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;training&quot;</span><span class="p">]:</span>
</span><span id="Project-3236"><a href="#Project-3236"><span class="linenos">3236</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;        &quot;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project-3237"><a href="#Project-3237"><span class="linenos">3237</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>
</span><span id="Project-3238"><a href="#Project-3238"><span class="linenos">3238</span></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>
</span><span id="Project-3239"><a href="#Project-3239"><span class="linenos">3239</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3240"><a href="#Project-3240"><span class="linenos">3240</span></a>                        <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project-3241"><a href="#Project-3241"><span class="linenos">3241</span></a>                    <span class="p">)</span>
</span><span id="Project-3242"><a href="#Project-3242"><span class="linenos">3242</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project-3243"><a href="#Project-3243"><span class="linenos">3243</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;losses&quot;: {&#39;</span><span class="p">)</span>
</span><span id="Project-3244"><a href="#Project-3244"><span class="linenos">3244</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">loss_name</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project-3245"><a href="#Project-3245"><span class="linenos">3245</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">]:</span>
</span><span id="Project-3246"><a href="#Project-3246"><span class="linenos">3246</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">]:</span>
</span><span id="Project-3247"><a href="#Project-3247"><span class="linenos">3247</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3248"><a href="#Project-3248"><span class="linenos">3248</span></a>                    <span class="sa">f</span><span class="s1">&#39;                &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project-3249"><a href="#Project-3249"><span class="linenos">3249</span></a>                <span class="p">)</span>
</span><span id="Project-3250"><a href="#Project-3250"><span class="linenos">3250</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;            },&quot;</span><span class="p">)</span>
</span><span id="Project-3251"><a href="#Project-3251"><span class="linenos">3251</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project-3252"><a href="#Project-3252"><span class="linenos">3252</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;metrics&quot;: {&#39;</span><span class="p">)</span>
</span><span id="Project-3253"><a href="#Project-3253"><span class="linenos">3253</span></a>        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
</span><span id="Project-3254"><a href="#Project-3254"><span class="linenos">3254</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project-3255"><a href="#Project-3255"><span class="linenos">3255</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]:</span>
</span><span id="Project-3256"><a href="#Project-3256"><span class="linenos">3256</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3257"><a href="#Project-3257"><span class="linenos">3257</span></a>                    <span class="sa">f</span><span class="s1">&#39;                &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project-3258"><a href="#Project-3258"><span class="linenos">3258</span></a>                <span class="p">)</span>
</span><span id="Project-3259"><a href="#Project-3259"><span class="linenos">3259</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;            },&quot;</span><span class="p">)</span>
</span><span id="Project-3260"><a href="#Project-3260"><span class="linenos">3260</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project-3261"><a href="#Project-3261"><span class="linenos">3261</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;model&quot;: {&#39;</span><span class="p">)</span>
</span><span id="Project-3262"><a href="#Project-3262"><span class="linenos">3262</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="n">model_name</span><span class="p">]:</span>
</span><span id="Project-3263"><a href="#Project-3263"><span class="linenos">3263</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]:</span>
</span><span id="Project-3264"><a href="#Project-3264"><span class="linenos">3264</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3265"><a href="#Project-3265"><span class="linenos">3265</span></a>                    <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project-3266"><a href="#Project-3266"><span class="linenos">3266</span></a>                <span class="p">)</span>
</span><span id="Project-3267"><a href="#Project-3267"><span class="linenos">3267</span></a>
</span><span id="Project-3268"><a href="#Project-3268"><span class="linenos">3268</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project-3269"><a href="#Project-3269"><span class="linenos">3269</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;features&quot;: {&#39;</span><span class="p">)</span>
</span><span id="Project-3270"><a href="#Project-3270"><span class="linenos">3270</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="n">feature_extraction</span><span class="p">]:</span>
</span><span id="Project-3271"><a href="#Project-3271"><span class="linenos">3271</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]:</span>
</span><span id="Project-3272"><a href="#Project-3272"><span class="linenos">3272</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3273"><a href="#Project-3273"><span class="linenos">3273</span></a>                    <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project-3274"><a href="#Project-3274"><span class="linenos">3274</span></a>                <span class="p">)</span>
</span><span id="Project-3275"><a href="#Project-3275"><span class="linenos">3275</span></a>
</span><span id="Project-3276"><a href="#Project-3276"><span class="linenos">3276</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project-3277"><a href="#Project-3277"><span class="linenos">3277</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;augmentations&quot;: {&#39;</span><span class="p">)</span>
</span><span id="Project-3278"><a href="#Project-3278"><span class="linenos">3278</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">][</span><span class="n">feature_extraction</span><span class="p">]:</span>
</span><span id="Project-3279"><a href="#Project-3279"><span class="linenos">3279</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]:</span>
</span><span id="Project-3280"><a href="#Project-3280"><span class="linenos">3280</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Project-3281"><a href="#Project-3281"><span class="linenos">3281</span></a>                    <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project-3282"><a href="#Project-3282"><span class="linenos">3282</span></a>                <span class="p">)</span>
</span><span id="Project-3283"><a href="#Project-3283"><span class="linenos">3283</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project-3284"><a href="#Project-3284"><span class="linenos">3284</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    },&quot;</span><span class="p">)</span>
</span><span id="Project-3285"><a href="#Project-3285"><span class="linenos">3285</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="Project-3286"><a href="#Project-3286"><span class="linenos">3286</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="Project-3287"><a href="#Project-3287"><span class="linenos">3287</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-3288"><a href="#Project-3288"><span class="linenos">3288</span></a>
</span><span id="Project-3289"><a href="#Project-3289"><span class="linenos">3289</span></a>    <span class="k">def</span> <span class="nf">_create_record</span><span class="p">(</span>
</span><span id="Project-3290"><a href="#Project-3290"><span class="linenos">3290</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3291"><a href="#Project-3291"><span class="linenos">3291</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-3292"><a href="#Project-3292"><span class="linenos">3292</span></a>        <span class="n">behaviors_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-3293"><a href="#Project-3293"><span class="linenos">3293</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3294"><a href="#Project-3294"><span class="linenos">3294</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3295"><a href="#Project-3295"><span class="linenos">3295</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3296"><a href="#Project-3296"><span class="linenos">3296</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3297"><a href="#Project-3297"><span class="linenos">3297</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3298"><a href="#Project-3298"><span class="linenos">3298</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3299"><a href="#Project-3299"><span class="linenos">3299</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3300"><a href="#Project-3300"><span class="linenos">3300</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-3301"><a href="#Project-3301"><span class="linenos">3301</span></a>        <span class="n">n_seeds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project-3302"><a href="#Project-3302"><span class="linenos">3302</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskDispatcher</span><span class="p">:</span>
</span><span id="Project-3303"><a href="#Project-3303"><span class="linenos">3303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3304"><a href="#Project-3304"><span class="linenos">3304</span></a><span class="sd">        Create a meta data episode record</span>
</span><span id="Project-3305"><a href="#Project-3305"><span class="linenos">3305</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3306"><a href="#Project-3306"><span class="linenos">3306</span></a>
</span><span id="Project-3307"><a href="#Project-3307"><span class="linenos">3307</span></a>        <span class="k">if</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="Project-3308"><a href="#Project-3308"><span class="linenos">3308</span></a>            <span class="k">return</span>
</span><span id="Project-3309"><a href="#Project-3309"><span class="linenos">3309</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span> <span class="ow">or</span> <span class="n">n_seeds</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project-3310"><a href="#Project-3310"><span class="linenos">3310</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-3311"><a href="#Project-3311"><span class="linenos">3311</span></a>                <span class="sa">f</span><span class="s2">&quot;The n_seeds parameter has to be an integer larger than 0; got </span><span class="si">{</span><span class="n">n_seeds</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-3312"><a href="#Project-3312"><span class="linenos">3312</span></a>            <span class="p">)</span>
</span><span id="Project-3313"><a href="#Project-3313"><span class="linenos">3313</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3314"><a href="#Project-3314"><span class="linenos">3314</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-3315"><a href="#Project-3315"><span class="linenos">3315</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="Project-3316"><a href="#Project-3316"><span class="linenos">3316</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">parameters_update</span><span class="p">)</span>
</span><span id="Project-3317"><a href="#Project-3317"><span class="linenos">3317</span></a>        <span class="k">if</span> <span class="n">load_search</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3318"><a href="#Project-3318"><span class="linenos">3318</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_with_search</span><span class="p">(</span>
</span><span id="Project-3319"><a href="#Project-3319"><span class="linenos">3319</span></a>                <span class="n">parameters</span><span class="p">,</span> <span class="n">load_search</span><span class="p">,</span> <span class="n">load_parameters</span><span class="p">,</span> <span class="n">round_to_binary</span>
</span><span id="Project-3320"><a href="#Project-3320"><span class="linenos">3320</span></a>            <span class="p">)</span>
</span><span id="Project-3321"><a href="#Project-3321"><span class="linenos">3321</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span><span class="p">(</span>
</span><span id="Project-3322"><a href="#Project-3322"><span class="linenos">3322</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-3323"><a href="#Project-3323"><span class="linenos">3323</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-3324"><a href="#Project-3324"><span class="linenos">3324</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-3325"><a href="#Project-3325"><span class="linenos">3325</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-3326"><a href="#Project-3326"><span class="linenos">3326</span></a>            <span class="n">only_load_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-3327"><a href="#Project-3327"><span class="linenos">3327</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project-3328"><a href="#Project-3328"><span class="linenos">3328</span></a>            <span class="n">continuing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project-3329"><a href="#Project-3329"><span class="linenos">3329</span></a>        <span class="p">)</span>
</span><span id="Project-3330"><a href="#Project-3330"><span class="linenos">3330</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">behaviors_dict</span><span class="p">)</span>
</span><span id="Project-3331"><a href="#Project-3331"><span class="linenos">3331</span></a>        <span class="k">return</span> <span class="n">task</span>
</span><span id="Project-3332"><a href="#Project-3332"><span class="linenos">3332</span></a>
</span><span id="Project-3333"><a href="#Project-3333"><span class="linenos">3333</span></a>    <span class="k">def</span> <span class="nf">_save_thresholds</span><span class="p">(</span>
</span><span id="Project-3334"><a href="#Project-3334"><span class="linenos">3334</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3335"><a href="#Project-3335"><span class="linenos">3335</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-3336"><a href="#Project-3336"><span class="linenos">3336</span></a>        <span class="n">metric_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-3337"><a href="#Project-3337"><span class="linenos">3337</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-3338"><a href="#Project-3338"><span class="linenos">3338</span></a>        <span class="n">thresholds</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-3339"><a href="#Project-3339"><span class="linenos">3339</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-3340"><a href="#Project-3340"><span class="linenos">3340</span></a>    <span class="p">):</span>
</span><span id="Project-3341"><a href="#Project-3341"><span class="linenos">3341</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3342"><a href="#Project-3342"><span class="linenos">3342</span></a><span class="sd">        Save optimal decision thresholds in the meta records</span>
</span><span id="Project-3343"><a href="#Project-3343"><span class="linenos">3343</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3344"><a href="#Project-3344"><span class="linenos">3344</span></a>
</span><span id="Project-3345"><a href="#Project-3345"><span class="linenos">3345</span></a>        <span class="n">metric_parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span>
</span><span id="Project-3346"><a href="#Project-3346"><span class="linenos">3346</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_thresholds</span><span class="p">()</span><span class="o">.</span><span class="n">save_thresholds</span><span class="p">(</span>
</span><span id="Project-3347"><a href="#Project-3347"><span class="linenos">3347</span></a>            <span class="n">episode_names</span><span class="p">,</span> <span class="n">load_epochs</span><span class="p">,</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">,</span> <span class="n">thresholds</span>
</span><span id="Project-3348"><a href="#Project-3348"><span class="linenos">3348</span></a>        <span class="p">)</span>
</span><span id="Project-3349"><a href="#Project-3349"><span class="linenos">3349</span></a>
</span><span id="Project-3350"><a href="#Project-3350"><span class="linenos">3350</span></a>    <span class="k">def</span> <span class="nf">_save_episode</span><span class="p">(</span>
</span><span id="Project-3351"><a href="#Project-3351"><span class="linenos">3351</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3352"><a href="#Project-3352"><span class="linenos">3352</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-3353"><a href="#Project-3353"><span class="linenos">3353</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-3354"><a href="#Project-3354"><span class="linenos">3354</span></a>        <span class="n">behaviors_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-3355"><a href="#Project-3355"><span class="linenos">3355</span></a>        <span class="n">suppress_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-3356"><a href="#Project-3356"><span class="linenos">3356</span></a>        <span class="n">training_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3357"><a href="#Project-3357"><span class="linenos">3357</span></a>        <span class="n">norm_stats</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3358"><a href="#Project-3358"><span class="linenos">3358</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3359"><a href="#Project-3359"><span class="linenos">3359</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3360"><a href="#Project-3360"><span class="linenos">3360</span></a><span class="sd">        Save an episode in the meta files</span>
</span><span id="Project-3361"><a href="#Project-3361"><span class="linenos">3361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3362"><a href="#Project-3362"><span class="linenos">3362</span></a>
</span><span id="Project-3363"><a href="#Project-3363"><span class="linenos">3363</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Project-3364"><a href="#Project-3364"><span class="linenos">3364</span></a>            <span class="n">split_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_info_from_filename</span><span class="p">(</span>
</span><span id="Project-3365"><a href="#Project-3365"><span class="linenos">3365</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span>
</span><span id="Project-3366"><a href="#Project-3366"><span class="linenos">3366</span></a>            <span class="p">)</span>
</span><span id="Project-3367"><a href="#Project-3367"><span class="linenos">3367</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span>
</span><span id="Project-3368"><a href="#Project-3368"><span class="linenos">3368</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Project-3369"><a href="#Project-3369"><span class="linenos">3369</span></a>            <span class="k">pass</span>
</span><span id="Project-3370"><a href="#Project-3370"><span class="linenos">3370</span></a>        <span class="k">if</span> <span class="n">norm_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3371"><a href="#Project-3371"><span class="linenos">3371</span></a>            <span class="n">norm_stats</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">norm_stats</span><span class="p">)</span>
</span><span id="Project-3372"><a href="#Project-3372"><span class="linenos">3372</span></a>        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm_stats</span>
</span><span id="Project-3373"><a href="#Project-3373"><span class="linenos">3373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">save_episode</span><span class="p">(</span>
</span><span id="Project-3374"><a href="#Project-3374"><span class="linenos">3374</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-3375"><a href="#Project-3375"><span class="linenos">3375</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-3376"><a href="#Project-3376"><span class="linenos">3376</span></a>            <span class="n">behaviors_dict</span><span class="p">,</span>
</span><span id="Project-3377"><a href="#Project-3377"><span class="linenos">3377</span></a>            <span class="n">suppress_validation</span><span class="o">=</span><span class="n">suppress_validation</span><span class="p">,</span>
</span><span id="Project-3378"><a href="#Project-3378"><span class="linenos">3378</span></a>            <span class="n">training_time</span><span class="o">=</span><span class="n">training_time</span><span class="p">,</span>
</span><span id="Project-3379"><a href="#Project-3379"><span class="linenos">3379</span></a>        <span class="p">)</span>
</span><span id="Project-3380"><a href="#Project-3380"><span class="linenos">3380</span></a>
</span><span id="Project-3381"><a href="#Project-3381"><span class="linenos">3381</span></a>    <span class="k">def</span> <span class="nf">_update_episode_results</span><span class="p">(</span>
</span><span id="Project-3382"><a href="#Project-3382"><span class="linenos">3382</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3383"><a href="#Project-3383"><span class="linenos">3383</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-3384"><a href="#Project-3384"><span class="linenos">3384</span></a>        <span class="n">logs</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">,</span>
</span><span id="Project-3385"><a href="#Project-3385"><span class="linenos">3385</span></a>        <span class="n">training_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3386"><a href="#Project-3386"><span class="linenos">3386</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3387"><a href="#Project-3387"><span class="linenos">3387</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3388"><a href="#Project-3388"><span class="linenos">3388</span></a><span class="sd">        Save the results of a run in the meta files</span>
</span><span id="Project-3389"><a href="#Project-3389"><span class="linenos">3389</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3390"><a href="#Project-3390"><span class="linenos">3390</span></a>
</span><span id="Project-3391"><a href="#Project-3391"><span class="linenos">3391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">update_episode_results</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">logs</span><span class="p">,</span> <span class="n">training_time</span><span class="p">)</span>
</span><span id="Project-3392"><a href="#Project-3392"><span class="linenos">3392</span></a>
</span><span id="Project-3393"><a href="#Project-3393"><span class="linenos">3393</span></a>    <span class="k">def</span> <span class="nf">_save_prediction</span><span class="p">(</span>
</span><span id="Project-3394"><a href="#Project-3394"><span class="linenos">3394</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3395"><a href="#Project-3395"><span class="linenos">3395</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-3396"><a href="#Project-3396"><span class="linenos">3396</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-3397"><a href="#Project-3397"><span class="linenos">3397</span></a>        <span class="n">behaviors_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-3398"><a href="#Project-3398"><span class="linenos">3398</span></a>        <span class="n">embedding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-3399"><a href="#Project-3399"><span class="linenos">3399</span></a>        <span class="n">inference_time</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3400"><a href="#Project-3400"><span class="linenos">3400</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3401"><a href="#Project-3401"><span class="linenos">3401</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3402"><a href="#Project-3402"><span class="linenos">3402</span></a><span class="sd">        Save a prediction in the meta files</span>
</span><span id="Project-3403"><a href="#Project-3403"><span class="linenos">3403</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3404"><a href="#Project-3404"><span class="linenos">3404</span></a>
</span><span id="Project-3405"><a href="#Project-3405"><span class="linenos">3405</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project-3406"><a href="#Project-3406"><span class="linenos">3406</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-3407"><a href="#Project-3407"><span class="linenos">3407</span></a>            <span class="p">{</span><span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;embedding&quot;</span><span class="p">:</span> <span class="n">embedding</span><span class="p">,</span> <span class="s2">&quot;inference_time&quot;</span><span class="p">:</span> <span class="n">inference_time</span><span class="p">}},</span>
</span><span id="Project-3408"><a href="#Project-3408"><span class="linenos">3408</span></a>        <span class="p">)</span>
</span><span id="Project-3409"><a href="#Project-3409"><span class="linenos">3409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">save_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">behaviors_dict</span><span class="p">)</span>
</span><span id="Project-3410"><a href="#Project-3410"><span class="linenos">3410</span></a>
</span><span id="Project-3411"><a href="#Project-3411"><span class="linenos">3411</span></a>    <span class="k">def</span> <span class="nf">_save_search</span><span class="p">(</span>
</span><span id="Project-3412"><a href="#Project-3412"><span class="linenos">3412</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3413"><a href="#Project-3413"><span class="linenos">3413</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-3414"><a href="#Project-3414"><span class="linenos">3414</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-3415"><a href="#Project-3415"><span class="linenos">3415</span></a>        <span class="n">n_trials</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Project-3416"><a href="#Project-3416"><span class="linenos">3416</span></a>        <span class="n">best_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-3417"><a href="#Project-3417"><span class="linenos">3417</span></a>        <span class="n">best_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="Project-3418"><a href="#Project-3418"><span class="linenos">3418</span></a>        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-3419"><a href="#Project-3419"><span class="linenos">3419</span></a>        <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-3420"><a href="#Project-3420"><span class="linenos">3420</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3421"><a href="#Project-3421"><span class="linenos">3421</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3422"><a href="#Project-3422"><span class="linenos">3422</span></a><span class="sd">        Save a hyperparameter search in the meta files</span>
</span><span id="Project-3423"><a href="#Project-3423"><span class="linenos">3423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3424"><a href="#Project-3424"><span class="linenos">3424</span></a>
</span><span id="Project-3425"><a href="#Project-3425"><span class="linenos">3425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">save_search</span><span class="p">(</span>
</span><span id="Project-3426"><a href="#Project-3426"><span class="linenos">3426</span></a>            <span class="n">search_name</span><span class="p">,</span>
</span><span id="Project-3427"><a href="#Project-3427"><span class="linenos">3427</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project-3428"><a href="#Project-3428"><span class="linenos">3428</span></a>            <span class="n">n_trials</span><span class="p">,</span>
</span><span id="Project-3429"><a href="#Project-3429"><span class="linenos">3429</span></a>            <span class="n">best_params</span><span class="p">,</span>
</span><span id="Project-3430"><a href="#Project-3430"><span class="linenos">3430</span></a>            <span class="n">best_value</span><span class="p">,</span>
</span><span id="Project-3431"><a href="#Project-3431"><span class="linenos">3431</span></a>            <span class="n">metric</span><span class="p">,</span>
</span><span id="Project-3432"><a href="#Project-3432"><span class="linenos">3432</span></a>            <span class="n">search_space</span><span class="p">,</span>
</span><span id="Project-3433"><a href="#Project-3433"><span class="linenos">3433</span></a>        <span class="p">)</span>
</span><span id="Project-3434"><a href="#Project-3434"><span class="linenos">3434</span></a>
</span><span id="Project-3435"><a href="#Project-3435"><span class="linenos">3435</span></a>    <span class="k">def</span> <span class="nf">_save_stores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3436"><a href="#Project-3436"><span class="linenos">3436</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3437"><a href="#Project-3437"><span class="linenos">3437</span></a><span class="sd">        Save a pickled dataset in the meta files</span>
</span><span id="Project-3438"><a href="#Project-3438"><span class="linenos">3438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3439"><a href="#Project-3439"><span class="linenos">3439</span></a>
</span><span id="Project-3440"><a href="#Project-3440"><span class="linenos">3440</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">])</span>
</span><span id="Project-3441"><a href="#Project-3441"><span class="linenos">3441</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets</span><span class="p">()</span><span class="o">.</span><span class="n">save_store</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_pars</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
</span><span id="Project-3442"><a href="#Project-3442"><span class="linenos">3442</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">create_metadata_backup</span><span class="p">()</span>
</span><span id="Project-3443"><a href="#Project-3443"><span class="linenos">3443</span></a>
</span><span id="Project-3444"><a href="#Project-3444"><span class="linenos">3444</span></a>    <span class="k">def</span> <span class="nf">_remove_stores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">remove_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3445"><a href="#Project-3445"><span class="linenos">3445</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3446"><a href="#Project-3446"><span class="linenos">3446</span></a><span class="sd">        Remove the pre-computed features folder</span>
</span><span id="Project-3447"><a href="#Project-3447"><span class="linenos">3447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3448"><a href="#Project-3448"><span class="linenos">3448</span></a>
</span><span id="Project-3449"><a href="#Project-3449"><span class="linenos">3449</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">])</span>
</span><span id="Project-3450"><a href="#Project-3450"><span class="linenos">3450</span></a>        <span class="k">if</span> <span class="n">remove_active</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_active_datasets</span><span class="p">():</span>
</span><span id="Project-3451"><a href="#Project-3451"><span class="linenos">3451</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_saved_features</span><span class="p">([</span><span class="n">name</span><span class="p">])</span>
</span><span id="Project-3452"><a href="#Project-3452"><span class="linenos">3452</span></a>
</span><span id="Project-3453"><a href="#Project-3453"><span class="linenos">3453</span></a>    <span class="k">def</span> <span class="nf">_check_episode_validity</span><span class="p">(</span>
</span><span id="Project-3454"><a href="#Project-3454"><span class="linenos">3454</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">allow_doublecolon</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-3455"><a href="#Project-3455"><span class="linenos">3455</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3456"><a href="#Project-3456"><span class="linenos">3456</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3457"><a href="#Project-3457"><span class="linenos">3457</span></a><span class="sd">        Check whether the episode name is valid</span>
</span><span id="Project-3458"><a href="#Project-3458"><span class="linenos">3458</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3459"><a href="#Project-3459"><span class="linenos">3459</span></a>
</span><span id="Project-3460"><a href="#Project-3460"><span class="linenos">3460</span></a>        <span class="k">if</span> <span class="n">episode_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
</span><span id="Project-3461"><a href="#Project-3461"><span class="linenos">3461</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-3462"><a href="#Project-3462"><span class="linenos">3462</span></a>                <span class="s2">&quot;Names starting with an underscore are reserved by dlc2action and cannot be used!&quot;</span>
</span><span id="Project-3463"><a href="#Project-3463"><span class="linenos">3463</span></a>            <span class="p">)</span>
</span><span id="Project-3464"><a href="#Project-3464"><span class="linenos">3464</span></a>        <span class="k">elif</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">episode_name</span><span class="p">:</span>
</span><span id="Project-3465"><a href="#Project-3465"><span class="linenos">3465</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Names containing &#39;.&#39; cannot be used!&quot;</span><span class="p">)</span>
</span><span id="Project-3466"><a href="#Project-3466"><span class="linenos">3466</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_doublecolon</span> <span class="ow">and</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">episode_name</span><span class="p">:</span>
</span><span id="Project-3467"><a href="#Project-3467"><span class="linenos">3467</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-3468"><a href="#Project-3468"><span class="linenos">3468</span></a>                <span class="s2">&quot;Names containing &#39;#&#39; are reserved by dlc2action and cannot be used!&quot;</span>
</span><span id="Project-3469"><a href="#Project-3469"><span class="linenos">3469</span></a>            <span class="p">)</span>
</span><span id="Project-3470"><a href="#Project-3470"><span class="linenos">3470</span></a>        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Project-3471"><a href="#Project-3471"><span class="linenos">3471</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-3472"><a href="#Project-3472"><span class="linenos">3472</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">episode_name</span><span class="p">):</span>
</span><span id="Project-3473"><a href="#Project-3473"><span class="linenos">3473</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-3474"><a href="#Project-3474"><span class="linenos">3474</span></a>                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> name is already taken! Set force=True to overwrite.&quot;</span>
</span><span id="Project-3475"><a href="#Project-3475"><span class="linenos">3475</span></a>            <span class="p">)</span>
</span><span id="Project-3476"><a href="#Project-3476"><span class="linenos">3476</span></a>
</span><span id="Project-3477"><a href="#Project-3477"><span class="linenos">3477</span></a>    <span class="k">def</span> <span class="nf">_check_search_validity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3478"><a href="#Project-3478"><span class="linenos">3478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3479"><a href="#Project-3479"><span class="linenos">3479</span></a><span class="sd">        Check whether the search name is valid</span>
</span><span id="Project-3480"><a href="#Project-3480"><span class="linenos">3480</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3481"><a href="#Project-3481"><span class="linenos">3481</span></a>
</span><span id="Project-3482"><a href="#Project-3482"><span class="linenos">3482</span></a>        <span class="k">if</span> <span class="n">search_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
</span><span id="Project-3483"><a href="#Project-3483"><span class="linenos">3483</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-3484"><a href="#Project-3484"><span class="linenos">3484</span></a>                <span class="s2">&quot;Names starting with an underscore are reserved by dlc2action and cannot be used!&quot;</span>
</span><span id="Project-3485"><a href="#Project-3485"><span class="linenos">3485</span></a>            <span class="p">)</span>
</span><span id="Project-3486"><a href="#Project-3486"><span class="linenos">3486</span></a>        <span class="k">elif</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">search_name</span><span class="p">:</span>
</span><span id="Project-3487"><a href="#Project-3487"><span class="linenos">3487</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Names containing &#39;.&#39; cannot be used!&quot;</span><span class="p">)</span>
</span><span id="Project-3488"><a href="#Project-3488"><span class="linenos">3488</span></a>        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Project-3489"><a href="#Project-3489"><span class="linenos">3489</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_search</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="Project-3490"><a href="#Project-3490"><span class="linenos">3490</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">search_name</span><span class="p">):</span>
</span><span id="Project-3491"><a href="#Project-3491"><span class="linenos">3491</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2"> name is already taken!&quot;</span><span class="p">)</span>
</span><span id="Project-3492"><a href="#Project-3492"><span class="linenos">3492</span></a>
</span><span id="Project-3493"><a href="#Project-3493"><span class="linenos">3493</span></a>    <span class="k">def</span> <span class="nf">_check_prediction_validity</span><span class="p">(</span>
</span><span id="Project-3494"><a href="#Project-3494"><span class="linenos">3494</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-3495"><a href="#Project-3495"><span class="linenos">3495</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3496"><a href="#Project-3496"><span class="linenos">3496</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3497"><a href="#Project-3497"><span class="linenos">3497</span></a><span class="sd">        Check whether the prediction name is valid</span>
</span><span id="Project-3498"><a href="#Project-3498"><span class="linenos">3498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3499"><a href="#Project-3499"><span class="linenos">3499</span></a>
</span><span id="Project-3500"><a href="#Project-3500"><span class="linenos">3500</span></a>        <span class="k">if</span> <span class="n">prediction_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
</span><span id="Project-3501"><a href="#Project-3501"><span class="linenos">3501</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-3502"><a href="#Project-3502"><span class="linenos">3502</span></a>                <span class="s2">&quot;Names starting with an underscore are reserved by dlc2action and cannot be used!&quot;</span>
</span><span id="Project-3503"><a href="#Project-3503"><span class="linenos">3503</span></a>            <span class="p">)</span>
</span><span id="Project-3504"><a href="#Project-3504"><span class="linenos">3504</span></a>        <span class="k">elif</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">prediction_name</span><span class="p">:</span>
</span><span id="Project-3505"><a href="#Project-3505"><span class="linenos">3505</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Names containing &#39;.&#39; cannot be used!&quot;</span><span class="p">)</span>
</span><span id="Project-3506"><a href="#Project-3506"><span class="linenos">3506</span></a>        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
</span><span id="Project-3507"><a href="#Project-3507"><span class="linenos">3507</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_prediction</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">)</span>
</span><span id="Project-3508"><a href="#Project-3508"><span class="linenos">3508</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">):</span>
</span><span id="Project-3509"><a href="#Project-3509"><span class="linenos">3509</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2"> name is already taken!&quot;</span><span class="p">)</span>
</span><span id="Project-3510"><a href="#Project-3510"><span class="linenos">3510</span></a>
</span><span id="Project-3511"><a href="#Project-3511"><span class="linenos">3511</span></a>    <span class="k">def</span> <span class="nf">_training_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Project-3512"><a href="#Project-3512"><span class="linenos">3512</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3513"><a href="#Project-3513"><span class="linenos">3513</span></a><span class="sd">        Get the training time of an episode in seconds</span>
</span><span id="Project-3514"><a href="#Project-3514"><span class="linenos">3514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3515"><a href="#Project-3515"><span class="linenos">3515</span></a>
</span><span id="Project-3516"><a href="#Project-3516"><span class="linenos">3516</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span><span class="o">.</span><span class="n">training_time</span><span class="p">()</span>
</span><span id="Project-3517"><a href="#Project-3517"><span class="linenos">3517</span></a>
</span><span id="Project-3518"><a href="#Project-3518"><span class="linenos">3518</span></a>    <span class="k">def</span> <span class="nf">_mask_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project-3519"><a href="#Project-3519"><span class="linenos">3519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3520"><a href="#Project-3520"><span class="linenos">3520</span></a><span class="sd">        Get the path to the masks folder</span>
</span><span id="Project-3521"><a href="#Project-3521"><span class="linenos">3521</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3522"><a href="#Project-3522"><span class="linenos">3522</span></a>
</span><span id="Project-3523"><a href="#Project-3523"><span class="linenos">3523</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">)</span>
</span><span id="Project-3524"><a href="#Project-3524"><span class="linenos">3524</span></a>
</span><span id="Project-3525"><a href="#Project-3525"><span class="linenos">3525</span></a>    <span class="k">def</span> <span class="nf">_thresholds_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project-3526"><a href="#Project-3526"><span class="linenos">3526</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3527"><a href="#Project-3527"><span class="linenos">3527</span></a><span class="sd">        Get the path to the thresholds meta file</span>
</span><span id="Project-3528"><a href="#Project-3528"><span class="linenos">3528</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3529"><a href="#Project-3529"><span class="linenos">3529</span></a>
</span><span id="Project-3530"><a href="#Project-3530"><span class="linenos">3530</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;thresholds.pickle&quot;</span><span class="p">)</span>
</span><span id="Project-3531"><a href="#Project-3531"><span class="linenos">3531</span></a>
</span><span id="Project-3532"><a href="#Project-3532"><span class="linenos">3532</span></a>    <span class="k">def</span> <span class="nf">_episodes_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project-3533"><a href="#Project-3533"><span class="linenos">3533</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3534"><a href="#Project-3534"><span class="linenos">3534</span></a><span class="sd">        Get the path to the episodes meta file</span>
</span><span id="Project-3535"><a href="#Project-3535"><span class="linenos">3535</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3536"><a href="#Project-3536"><span class="linenos">3536</span></a>
</span><span id="Project-3537"><a href="#Project-3537"><span class="linenos">3537</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;episodes.pickle&quot;</span><span class="p">)</span>
</span><span id="Project-3538"><a href="#Project-3538"><span class="linenos">3538</span></a>
</span><span id="Project-3539"><a href="#Project-3539"><span class="linenos">3539</span></a>    <span class="k">def</span> <span class="nf">_saved_datasets_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project-3540"><a href="#Project-3540"><span class="linenos">3540</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3541"><a href="#Project-3541"><span class="linenos">3541</span></a><span class="sd">        Get the path to the datasets meta file</span>
</span><span id="Project-3542"><a href="#Project-3542"><span class="linenos">3542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3543"><a href="#Project-3543"><span class="linenos">3543</span></a>
</span><span id="Project-3544"><a href="#Project-3544"><span class="linenos">3544</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;saved_datasets.pickle&quot;</span><span class="p">)</span>
</span><span id="Project-3545"><a href="#Project-3545"><span class="linenos">3545</span></a>
</span><span id="Project-3546"><a href="#Project-3546"><span class="linenos">3546</span></a>    <span class="k">def</span> <span class="nf">_predictions_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project-3547"><a href="#Project-3547"><span class="linenos">3547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3548"><a href="#Project-3548"><span class="linenos">3548</span></a><span class="sd">        Get the path to the predictions meta file</span>
</span><span id="Project-3549"><a href="#Project-3549"><span class="linenos">3549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3550"><a href="#Project-3550"><span class="linenos">3550</span></a>
</span><span id="Project-3551"><a href="#Project-3551"><span class="linenos">3551</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;predictions.pickle&quot;</span><span class="p">)</span>
</span><span id="Project-3552"><a href="#Project-3552"><span class="linenos">3552</span></a>
</span><span id="Project-3553"><a href="#Project-3553"><span class="linenos">3553</span></a>    <span class="k">def</span> <span class="nf">_dataset_store_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project-3554"><a href="#Project-3554"><span class="linenos">3554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3555"><a href="#Project-3555"><span class="linenos">3555</span></a><span class="sd">        Get the path to a specific pickled dataset</span>
</span><span id="Project-3556"><a href="#Project-3556"><span class="linenos">3556</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3557"><a href="#Project-3557"><span class="linenos">3557</span></a>
</span><span id="Project-3558"><a href="#Project-3558"><span class="linenos">3558</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;saved_datasets&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.pickle&quot;</span><span class="p">)</span>
</span><span id="Project-3559"><a href="#Project-3559"><span class="linenos">3559</span></a>
</span><span id="Project-3560"><a href="#Project-3560"><span class="linenos">3560</span></a>    <span class="k">def</span> <span class="nf">_searches_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project-3561"><a href="#Project-3561"><span class="linenos">3561</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3562"><a href="#Project-3562"><span class="linenos">3562</span></a><span class="sd">        Get the path to the hyperparameter search meta file</span>
</span><span id="Project-3563"><a href="#Project-3563"><span class="linenos">3563</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3564"><a href="#Project-3564"><span class="linenos">3564</span></a>
</span><span id="Project-3565"><a href="#Project-3565"><span class="linenos">3565</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;searches.pickle&quot;</span><span class="p">)</span>
</span><span id="Project-3566"><a href="#Project-3566"><span class="linenos">3566</span></a>
</span><span id="Project-3567"><a href="#Project-3567"><span class="linenos">3567</span></a>    <span class="k">def</span> <span class="nf">_search_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project-3568"><a href="#Project-3568"><span class="linenos">3568</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3569"><a href="#Project-3569"><span class="linenos">3569</span></a><span class="sd">        Get the default path to the graph folder for a specific hyperparameter search</span>
</span><span id="Project-3570"><a href="#Project-3570"><span class="linenos">3570</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3571"><a href="#Project-3571"><span class="linenos">3571</span></a>
</span><span id="Project-3572"><a href="#Project-3572"><span class="linenos">3572</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;searches&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="Project-3573"><a href="#Project-3573"><span class="linenos">3573</span></a>
</span><span id="Project-3574"><a href="#Project-3574"><span class="linenos">3574</span></a>    <span class="k">def</span> <span class="nf">_version_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project-3575"><a href="#Project-3575"><span class="linenos">3575</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3576"><a href="#Project-3576"><span class="linenos">3576</span></a><span class="sd">        Get the path to the version file</span>
</span><span id="Project-3577"><a href="#Project-3577"><span class="linenos">3577</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3578"><a href="#Project-3578"><span class="linenos">3578</span></a>
</span><span id="Project-3579"><a href="#Project-3579"><span class="linenos">3579</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;version.txt&quot;</span><span class="p">)</span>
</span><span id="Project-3580"><a href="#Project-3580"><span class="linenos">3580</span></a>
</span><span id="Project-3581"><a href="#Project-3581"><span class="linenos">3581</span></a>    <span class="k">def</span> <span class="nf">_default_split_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="Project-3582"><a href="#Project-3582"><span class="linenos">3582</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3583"><a href="#Project-3583"><span class="linenos">3583</span></a><span class="sd">        Generate a path to a split file from split parameters</span>
</span><span id="Project-3584"><a href="#Project-3584"><span class="linenos">3584</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3585"><a href="#Project-3585"><span class="linenos">3585</span></a>
</span><span id="Project-3586"><a href="#Project-3586"><span class="linenos">3586</span></a>        <span class="k">if</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">):</span>
</span><span id="Project-3587"><a href="#Project-3587"><span class="linenos">3587</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Project-3588"><a href="#Project-3588"><span class="linenos">3588</span></a>        <span class="n">val_frac</span> <span class="o">=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;val_frac&quot;</span><span class="p">]</span>
</span><span id="Project-3589"><a href="#Project-3589"><span class="linenos">3589</span></a>        <span class="n">test_frac</span> <span class="o">=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;test_frac&quot;</span><span class="p">]</span>
</span><span id="Project-3590"><a href="#Project-3590"><span class="linenos">3590</span></a>        <span class="n">split_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_val</span><span class="si">{</span><span class="n">val_frac</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s1">%_test</span><span class="si">{</span><span class="n">test_frac</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s1">%_len</span><span class="si">{</span><span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_overlap</span><span class="si">{</span><span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project-3591"><a href="#Project-3591"><span class="linenos">3591</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;only_load_annotated&quot;</span><span class="p">]:</span>
</span><span id="Project-3592"><a href="#Project-3592"><span class="linenos">3592</span></a>            <span class="n">split_name</span> <span class="o">+=</span> <span class="s2">&quot;_all&quot;</span>
</span><span id="Project-3593"><a href="#Project-3593"><span class="linenos">3593</span></a>        <span class="n">split_name</span> <span class="o">+=</span> <span class="s2">&quot;.txt&quot;</span>
</span><span id="Project-3594"><a href="#Project-3594"><span class="linenos">3594</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;splits&quot;</span><span class="p">,</span> <span class="n">split_name</span><span class="p">)</span>
</span><span id="Project-3595"><a href="#Project-3595"><span class="linenos">3595</span></a>
</span><span id="Project-3596"><a href="#Project-3596"><span class="linenos">3596</span></a>    <span class="k">def</span> <span class="nf">_split_info_from_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">split_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-3597"><a href="#Project-3597"><span class="linenos">3597</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3598"><a href="#Project-3598"><span class="linenos">3598</span></a><span class="sd">        Get split parameters from default path to a split file</span>
</span><span id="Project-3599"><a href="#Project-3599"><span class="linenos">3599</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3600"><a href="#Project-3600"><span class="linenos">3600</span></a>
</span><span id="Project-3601"><a href="#Project-3601"><span class="linenos">3601</span></a>        <span class="k">if</span> <span class="n">split_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3602"><a href="#Project-3602"><span class="linenos">3602</span></a>            <span class="k">return</span> <span class="p">{}</span>
</span><span id="Project-3603"><a href="#Project-3603"><span class="linenos">3603</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Project-3604"><a href="#Project-3604"><span class="linenos">3604</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">split_name</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Project-3605"><a href="#Project-3605"><span class="linenos">3605</span></a>            <span class="n">split</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="Project-3606"><a href="#Project-3606"><span class="linenos">3606</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
</span><span id="Project-3607"><a href="#Project-3607"><span class="linenos">3607</span></a>                <span class="n">only_load_annotated</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-3608"><a href="#Project-3608"><span class="linenos">3608</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-3609"><a href="#Project-3609"><span class="linenos">3609</span></a>                <span class="n">only_load_annotated</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Project-3610"><a href="#Project-3610"><span class="linenos">3610</span></a>            <span class="n">len_segment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">:])</span>
</span><span id="Project-3611"><a href="#Project-3611"><span class="linenos">3611</span></a>            <span class="n">overlap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">7</span><span class="p">:])</span>
</span><span id="Project-3612"><a href="#Project-3612"><span class="linenos">3612</span></a>            <span class="n">method</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">split</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</span><span id="Project-3613"><a href="#Project-3613"><span class="linenos">3613</span></a>            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span>
</span><span id="Project-3614"><a href="#Project-3614"><span class="linenos">3614</span></a>            <span class="n">test</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">100</span>
</span><span id="Project-3615"><a href="#Project-3615"><span class="linenos">3615</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="Project-3616"><a href="#Project-3616"><span class="linenos">3616</span></a>                <span class="s2">&quot;partition_method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
</span><span id="Project-3617"><a href="#Project-3617"><span class="linenos">3617</span></a>                <span class="s2">&quot;val_frac&quot;</span><span class="p">:</span> <span class="n">val</span><span class="p">,</span>
</span><span id="Project-3618"><a href="#Project-3618"><span class="linenos">3618</span></a>                <span class="s2">&quot;test_frac&quot;</span><span class="p">:</span> <span class="n">test</span><span class="p">,</span>
</span><span id="Project-3619"><a href="#Project-3619"><span class="linenos">3619</span></a>                <span class="s2">&quot;only_load_annotated&quot;</span><span class="p">:</span> <span class="n">only_load_annotated</span><span class="p">,</span>
</span><span id="Project-3620"><a href="#Project-3620"><span class="linenos">3620</span></a>                <span class="s2">&quot;len_segment&quot;</span><span class="p">:</span> <span class="n">len_segment</span><span class="p">,</span>
</span><span id="Project-3621"><a href="#Project-3621"><span class="linenos">3621</span></a>                <span class="s2">&quot;overlap&quot;</span><span class="p">:</span> <span class="n">overlap</span><span class="p">,</span>
</span><span id="Project-3622"><a href="#Project-3622"><span class="linenos">3622</span></a>            <span class="p">}</span>
</span><span id="Project-3623"><a href="#Project-3623"><span class="linenos">3623</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Project-3624"><a href="#Project-3624"><span class="linenos">3624</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;partition_method&quot;</span><span class="p">:</span> <span class="s2">&quot;file&quot;</span><span class="p">}</span>
</span><span id="Project-3625"><a href="#Project-3625"><span class="linenos">3625</span></a>
</span><span id="Project-3626"><a href="#Project-3626"><span class="linenos">3626</span></a>    <span class="k">def</span> <span class="nf">_fill</span><span class="p">(</span>
</span><span id="Project-3627"><a href="#Project-3627"><span class="linenos">3627</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3628"><a href="#Project-3628"><span class="linenos">3628</span></a>        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-3629"><a href="#Project-3629"><span class="linenos">3629</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-3630"><a href="#Project-3630"><span class="linenos">3630</span></a>        <span class="n">load_experiment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3631"><a href="#Project-3631"><span class="linenos">3631</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3632"><a href="#Project-3632"><span class="linenos">3632</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-3633"><a href="#Project-3633"><span class="linenos">3633</span></a>        <span class="n">only_load_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-3634"><a href="#Project-3634"><span class="linenos">3634</span></a>        <span class="n">continuing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-3635"><a href="#Project-3635"><span class="linenos">3635</span></a>        <span class="n">enforce_split_parameters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-3636"><a href="#Project-3636"><span class="linenos">3636</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-3637"><a href="#Project-3637"><span class="linenos">3637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3638"><a href="#Project-3638"><span class="linenos">3638</span></a><span class="sd">        Update the parameters from the config files with project specific information</span>
</span><span id="Project-3639"><a href="#Project-3639"><span class="linenos">3639</span></a>
</span><span id="Project-3640"><a href="#Project-3640"><span class="linenos">3640</span></a><span class="sd">        Fill in the constant file path parameters and generate a unique log file and a model folder.</span>
</span><span id="Project-3641"><a href="#Project-3641"><span class="linenos">3641</span></a><span class="sd">        Fill in the split file if the same split has been run before in the project and change partition method to</span>
</span><span id="Project-3642"><a href="#Project-3642"><span class="linenos">3642</span></a><span class="sd">        from_file.</span>
</span><span id="Project-3643"><a href="#Project-3643"><span class="linenos">3643</span></a><span class="sd">        Fill in saved data path if a dataset with the same data parameters already exists in the project.</span>
</span><span id="Project-3644"><a href="#Project-3644"><span class="linenos">3644</span></a><span class="sd">        If load_experiment is not None, fill in the checkpoint path as well.</span>
</span><span id="Project-3645"><a href="#Project-3645"><span class="linenos">3645</span></a><span class="sd">        The only_load_model training parameter is defined by the corresponding argument.</span>
</span><span id="Project-3646"><a href="#Project-3646"><span class="linenos">3646</span></a><span class="sd">        If continuing is True, new files are not created and all information is loaded from load_experiment.</span>
</span><span id="Project-3647"><a href="#Project-3647"><span class="linenos">3647</span></a><span class="sd">        If prediction is True, log and model files are not created.</span>
</span><span id="Project-3648"><a href="#Project-3648"><span class="linenos">3648</span></a><span class="sd">        The enforce_split_parameters parameter is used to resolve conflicts</span>
</span><span id="Project-3649"><a href="#Project-3649"><span class="linenos">3649</span></a><span class="sd">        between split file path and split parameters when they arise.</span>
</span><span id="Project-3650"><a href="#Project-3650"><span class="linenos">3650</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3651"><a href="#Project-3651"><span class="linenos">3651</span></a>
</span><span id="Project-3652"><a href="#Project-3652"><span class="linenos">3652</span></a>        <span class="n">pars</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-3653"><a href="#Project-3653"><span class="linenos">3653</span></a>        <span class="k">if</span> <span class="n">episode_name</span> <span class="o">==</span> <span class="s2">&quot;_&quot;</span><span class="p">:</span>
</span><span id="Project-3654"><a href="#Project-3654"><span class="linenos">3654</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="Project-3655"><a href="#Project-3655"><span class="linenos">3655</span></a>        <span class="n">log</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>
</span><span id="Project-3656"><a href="#Project-3656"><span class="linenos">3656</span></a>        <span class="n">model_save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-3657"><a href="#Project-3657"><span class="linenos">3657</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">episode_name</span>
</span><span id="Project-3658"><a href="#Project-3658"><span class="linenos">3658</span></a>        <span class="p">)</span>
</span><span id="Project-3659"><a href="#Project-3659"><span class="linenos">3659</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">continuing</span> <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_save_path</span><span class="p">)):</span>
</span><span id="Project-3660"><a href="#Project-3660"><span class="linenos">3660</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-3661"><a href="#Project-3661"><span class="linenos">3661</span></a>                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> episode name is already in use! Set force=True to overwrite.&quot;</span>
</span><span id="Project-3662"><a href="#Project-3662"><span class="linenos">3662</span></a>            <span class="p">)</span>
</span><span id="Project-3663"><a href="#Project-3663"><span class="linenos">3663</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;val_frac&quot;</span><span class="p">,</span> <span class="s2">&quot;test_frac&quot;</span><span class="p">,</span> <span class="s2">&quot;partition_method&quot;</span><span class="p">]</span>
</span><span id="Project-3664"><a href="#Project-3664"><span class="linenos">3664</span></a>        <span class="k">if</span> <span class="s2">&quot;len_segment&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;len_segment&quot;</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
</span><span id="Project-3665"><a href="#Project-3665"><span class="linenos">3665</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span>
</span><span id="Project-3666"><a href="#Project-3666"><span class="linenos">3666</span></a>        <span class="k">if</span> <span class="s2">&quot;overlap&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="s2">&quot;overlap&quot;</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
</span><span id="Project-3667"><a href="#Project-3667"><span class="linenos">3667</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span>
</span><span id="Project-3668"><a href="#Project-3668"><span class="linenos">3668</span></a>        <span class="k">if</span> <span class="s2">&quot;len_segment&quot;</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
</span><span id="Project-3669"><a href="#Project-3669"><span class="linenos">3669</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;len_segment&quot;</span><span class="p">)</span>
</span><span id="Project-3670"><a href="#Project-3670"><span class="linenos">3670</span></a>        <span class="k">if</span> <span class="s2">&quot;overlap&quot;</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>
</span><span id="Project-3671"><a href="#Project-3671"><span class="linenos">3671</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;overlap&quot;</span><span class="p">)</span>
</span><span id="Project-3672"><a href="#Project-3672"><span class="linenos">3672</span></a>        <span class="n">split_info</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">}</span>
</span><span id="Project-3673"><a href="#Project-3673"><span class="linenos">3673</span></a>        <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;only_load_annotated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;only_load_annotated&quot;</span><span class="p">]</span>
</span><span id="Project-3674"><a href="#Project-3674"><span class="linenos">3674</span></a>        <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;len_segment&quot;</span><span class="p">]</span>
</span><span id="Project-3675"><a href="#Project-3675"><span class="linenos">3675</span></a>        <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;overlap&quot;</span><span class="p">]</span>
</span><span id="Project-3676"><a href="#Project-3676"><span class="linenos">3676</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;log_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span>
</span><span id="Project-3677"><a href="#Project-3677"><span class="linenos">3677</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">model_save_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Project-3678"><a href="#Project-3678"><span class="linenos">3678</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;model_save_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_save_path</span>
</span><span id="Project-3679"><a href="#Project-3679"><span class="linenos">3679</span></a>        <span class="k">if</span> <span class="n">load_experiment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3680"><a href="#Project-3680"><span class="linenos">3680</span></a>            <span class="k">if</span> <span class="n">load_experiment</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="Project-3681"><a href="#Project-3681"><span class="linenos">3681</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">load_experiment</span><span class="si">}</span><span class="s2"> episode does not exist!&quot;</span><span class="p">)</span>
</span><span id="Project-3682"><a href="#Project-3682"><span class="linenos">3682</span></a>            <span class="n">old_episode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">load_experiment</span><span class="p">)</span>
</span><span id="Project-3683"><a href="#Project-3683"><span class="linenos">3683</span></a>            <span class="n">old_file</span> <span class="o">=</span> <span class="n">old_episode</span><span class="o">.</span><span class="n">split_file</span><span class="p">()</span>
</span><span id="Project-3684"><a href="#Project-3684"><span class="linenos">3684</span></a>            <span class="n">old_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_info_from_filename</span><span class="p">(</span><span class="n">old_file</span><span class="p">)</span>
</span><span id="Project-3685"><a href="#Project-3685"><span class="linenos">3685</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-3686"><a href="#Project-3686"><span class="linenos">3686</span></a>                <span class="n">old_info</span> <span class="o">=</span> <span class="n">old_episode</span><span class="o">.</span><span class="n">split_info</span><span class="p">()</span>
</span><span id="Project-3687"><a href="#Project-3687"><span class="linenos">3687</span></a>            <span class="k">if</span> <span class="n">enforce_split_parameters</span><span class="p">:</span>
</span><span id="Project-3688"><a href="#Project-3688"><span class="linenos">3688</span></a>                <span class="k">if</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
</span><span id="Project-3689"><a href="#Project-3689"><span class="linenos">3689</span></a>                    <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_split_file</span><span class="p">(</span>
</span><span id="Project-3690"><a href="#Project-3690"><span class="linenos">3690</span></a>                        <span class="n">split_info</span>
</span><span id="Project-3691"><a href="#Project-3691"><span class="linenos">3691</span></a>                    <span class="p">)</span>
</span><span id="Project-3692"><a href="#Project-3692"><span class="linenos">3692</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-3693"><a href="#Project-3693"><span class="linenos">3693</span></a>                <span class="n">equal</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Project-3694"><a href="#Project-3694"><span class="linenos">3694</span></a>                <span class="k">if</span> <span class="n">old_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]:</span>
</span><span id="Project-3695"><a href="#Project-3695"><span class="linenos">3695</span></a>                    <span class="n">equal</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-3696"><a href="#Project-3696"><span class="linenos">3696</span></a>                <span class="k">if</span> <span class="n">old_info</span><span class="p">[</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
</span><span id="Project-3697"><a href="#Project-3697"><span class="linenos">3697</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="Project-3698"><a href="#Project-3698"><span class="linenos">3698</span></a>                        <span class="n">old_info</span><span class="p">[</span><span class="s2">&quot;val_frac&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;val_frac&quot;</span><span class="p">]</span>
</span><span id="Project-3699"><a href="#Project-3699"><span class="linenos">3699</span></a>                        <span class="ow">or</span> <span class="n">old_info</span><span class="p">[</span><span class="s2">&quot;test_frac&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">split_info</span><span class="p">[</span><span class="s2">&quot;test_frac&quot;</span><span class="p">]</span>
</span><span id="Project-3700"><a href="#Project-3700"><span class="linenos">3700</span></a>                    <span class="p">):</span>
</span><span id="Project-3701"><a href="#Project-3701"><span class="linenos">3701</span></a>                        <span class="n">equal</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-3702"><a href="#Project-3702"><span class="linenos">3702</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">continuing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">equal</span><span class="p">:</span>
</span><span id="Project-3703"><a href="#Project-3703"><span class="linenos">3703</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Project-3704"><a href="#Project-3704"><span class="linenos">3704</span></a>                        <span class="sa">f</span><span class="s2">&quot;The partitioning parameters in the loaded experiment (</span><span class="si">{</span><span class="n">old_info</span><span class="si">}</span><span class="s2">) &quot;</span>
</span><span id="Project-3705"><a href="#Project-3705"><span class="linenos">3705</span></a>                        <span class="sa">f</span><span class="s2">&quot;are not equal to the current partitioning parameters (</span><span class="si">{</span><span class="n">split_info</span><span class="si">}</span><span class="s2">). &quot;</span>
</span><span id="Project-3706"><a href="#Project-3706"><span class="linenos">3706</span></a>                        <span class="sa">f</span><span class="s2">&quot;The current parameters are replaced.&quot;</span>
</span><span id="Project-3707"><a href="#Project-3707"><span class="linenos">3707</span></a>                    <span class="p">)</span>
</span><span id="Project-3708"><a href="#Project-3708"><span class="linenos">3708</span></a>                <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_file</span>
</span><span id="Project-3709"><a href="#Project-3709"><span class="linenos">3709</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;checkpoint_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_episode</span><span class="o">.</span><span class="n">model_file</span><span class="p">(</span><span class="n">load_epoch</span><span class="p">)</span>
</span><span id="Project-3710"><a href="#Project-3710"><span class="linenos">3710</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;load_strict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_strict</span>
</span><span id="Project-3711"><a href="#Project-3711"><span class="linenos">3711</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-3712"><a href="#Project-3712"><span class="linenos">3712</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;checkpoint_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-3713"><a href="#Project-3713"><span class="linenos">3713</span></a>            <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
</span><span id="Project-3714"><a href="#Project-3714"><span class="linenos">3714</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Project-3715"><a href="#Project-3715"><span class="linenos">3715</span></a>                    <span class="s2">&quot;split_path&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">]</span>
</span><span id="Project-3716"><a href="#Project-3716"><span class="linenos">3716</span></a>                    <span class="ow">or</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="Project-3717"><a href="#Project-3717"><span class="linenos">3717</span></a>                <span class="p">):</span>
</span><span id="Project-3718"><a href="#Project-3718"><span class="linenos">3718</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-3719"><a href="#Project-3719"><span class="linenos">3719</span></a>                        <span class="s2">&quot;The partition_method parameter is set to file but the &quot;</span>
</span><span id="Project-3720"><a href="#Project-3720"><span class="linenos">3720</span></a>                        <span class="s2">&quot;split_path parameter is not set!&quot;</span>
</span><span id="Project-3721"><a href="#Project-3721"><span class="linenos">3721</span></a>                    <span class="p">)</span>
</span><span id="Project-3722"><a href="#Project-3722"><span class="linenos">3722</span></a>                <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]):</span>
</span><span id="Project-3723"><a href="#Project-3723"><span class="linenos">3723</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-3724"><a href="#Project-3724"><span class="linenos">3724</span></a>                        <span class="sa">f</span><span class="s1">&#39;The </span><span class="si">{</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> split file does not exist&#39;</span>
</span><span id="Project-3725"><a href="#Project-3725"><span class="linenos">3725</span></a>                    <span class="p">)</span>
</span><span id="Project-3726"><a href="#Project-3726"><span class="linenos">3726</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-3727"><a href="#Project-3727"><span class="linenos">3727</span></a>                <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_split_file</span><span class="p">(</span><span class="n">split_info</span><span class="p">)</span>
</span><span id="Project-3728"><a href="#Project-3728"><span class="linenos">3728</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;only_load_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">only_load_model</span>
</span><span id="Project-3729"><a href="#Project-3729"><span class="linenos">3729</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;saved_data_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-3730"><a href="#Project-3730"><span class="linenos">3730</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-3731"><a href="#Project-3731"><span class="linenos">3731</span></a>        <span class="n">pars_data_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_pars</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
</span><span id="Project-3732"><a href="#Project-3732"><span class="linenos">3732</span></a>        <span class="n">saved_data_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets</span><span class="p">()</span><span class="o">.</span><span class="n">find_name</span><span class="p">(</span><span class="n">pars_data_copy</span><span class="p">)</span>
</span><span id="Project-3733"><a href="#Project-3733"><span class="linenos">3733</span></a>        <span class="k">if</span> <span class="n">saved_data_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3734"><a href="#Project-3734"><span class="linenos">3734</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;saved_data_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_store_path</span><span class="p">(</span><span class="n">saved_data_name</span><span class="p">)</span>
</span><span id="Project-3735"><a href="#Project-3735"><span class="linenos">3735</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_store_path</span><span class="p">(</span>
</span><span id="Project-3736"><a href="#Project-3736"><span class="linenos">3736</span></a>                <span class="n">saved_data_name</span>
</span><span id="Project-3737"><a href="#Project-3737"><span class="linenos">3737</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-3738"><a href="#Project-3738"><span class="linenos">3738</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-3739"><a href="#Project-3739"><span class="linenos">3739</span></a>            <span class="n">dataset_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_store_path</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-3740"><a href="#Project-3740"><span class="linenos">3740</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">):</span>
</span><span id="Project-3741"><a href="#Project-3741"><span class="linenos">3741</span></a>                <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">dataset_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span id="Project-3742"><a href="#Project-3742"><span class="linenos">3742</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-3743"><a href="#Project-3743"><span class="linenos">3743</span></a>                <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="Project-3744"><a href="#Project-3744"><span class="linenos">3744</span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Project-3745"><a href="#Project-3745"><span class="linenos">3745</span></a>                <span class="n">dataset_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-3746"><a href="#Project-3746"><span class="linenos">3746</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;saved_data_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_path</span>
</span><span id="Project-3747"><a href="#Project-3747"><span class="linenos">3747</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;feature_save_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-3748"><a href="#Project-3748"><span class="linenos">3748</span></a>        <span class="n">split_split</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="Project-3749"><a href="#Project-3749"><span class="linenos">3749</span></a>        <span class="n">random</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Project-3750"><a href="#Project-3750"><span class="linenos">3750</span></a>        <span class="k">for</span> <span class="n">partition_method</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">partition_methods</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">]:</span>
</span><span id="Project-3751"><a href="#Project-3751"><span class="linenos">3751</span></a>            <span class="n">method_split</span> <span class="o">=</span> <span class="n">partition_method</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span id="Project-3752"><a href="#Project-3752"><span class="linenos">3752</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_split</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">method_split</span><span class="p">):</span>
</span><span id="Project-3753"><a href="#Project-3753"><span class="linenos">3753</span></a>                <span class="k">continue</span>
</span><span id="Project-3754"><a href="#Project-3754"><span class="linenos">3754</span></a>            <span class="n">equal</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Project-3755"><a href="#Project-3755"><span class="linenos">3755</span></a>            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">split_split</span><span class="p">,</span> <span class="n">method_split</span><span class="p">):</span>
</span><span id="Project-3756"><a href="#Project-3756"><span class="linenos">3756</span></a>                <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">):</span>
</span><span id="Project-3757"><a href="#Project-3757"><span class="linenos">3757</span></a>                    <span class="k">continue</span>
</span><span id="Project-3758"><a href="#Project-3758"><span class="linenos">3758</span></a>                <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">y</span><span class="p">:</span>
</span><span id="Project-3759"><a href="#Project-3759"><span class="linenos">3759</span></a>                    <span class="n">equal</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-3760"><a href="#Project-3760"><span class="linenos">3760</span></a>                    <span class="k">break</span>
</span><span id="Project-3761"><a href="#Project-3761"><span class="linenos">3761</span></a>            <span class="k">if</span> <span class="n">equal</span><span class="p">:</span>
</span><span id="Project-3762"><a href="#Project-3762"><span class="linenos">3762</span></a>                <span class="n">random</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project-3763"><a href="#Project-3763"><span class="linenos">3763</span></a>                <span class="k">break</span>
</span><span id="Project-3764"><a href="#Project-3764"><span class="linenos">3764</span></a>        <span class="k">if</span> <span class="n">random</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;split_path&quot;</span><span class="p">]):</span>
</span><span id="Project-3765"><a href="#Project-3765"><span class="linenos">3765</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;partition_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;file&quot;</span>
</span><span id="Project-3766"><a href="#Project-3766"><span class="linenos">3766</span></a>        <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;save_dataset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Project-3767"><a href="#Project-3767"><span class="linenos">3767</span></a>        <span class="k">return</span> <span class="n">pars</span>
</span><span id="Project-3768"><a href="#Project-3768"><span class="linenos">3768</span></a>
</span><span id="Project-3769"><a href="#Project-3769"><span class="linenos">3769</span></a>    <span class="k">def</span> <span class="nf">_get_data_pars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-3770"><a href="#Project-3770"><span class="linenos">3770</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3771"><a href="#Project-3771"><span class="linenos">3771</span></a><span class="sd">        Get a complete description of the data from a general parameters dictionary</span>
</span><span id="Project-3772"><a href="#Project-3772"><span class="linenos">3772</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3773"><a href="#Project-3773"><span class="linenos">3773</span></a>
</span><span id="Project-3774"><a href="#Project-3774"><span class="linenos">3774</span></a>        <span class="n">pars_data_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
</span><span id="Project-3775"><a href="#Project-3775"><span class="linenos">3775</span></a>        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="Project-3776"><a href="#Project-3776"><span class="linenos">3776</span></a>            <span class="s2">&quot;only_load_annotated&quot;</span><span class="p">,</span>
</span><span id="Project-3777"><a href="#Project-3777"><span class="linenos">3777</span></a>            <span class="s2">&quot;exclusive&quot;</span><span class="p">,</span>
</span><span id="Project-3778"><a href="#Project-3778"><span class="linenos">3778</span></a>            <span class="s2">&quot;feature_extraction&quot;</span><span class="p">,</span>
</span><span id="Project-3779"><a href="#Project-3779"><span class="linenos">3779</span></a>            <span class="s2">&quot;ignored_clips&quot;</span><span class="p">,</span>
</span><span id="Project-3780"><a href="#Project-3780"><span class="linenos">3780</span></a>            <span class="s2">&quot;len_segment&quot;</span><span class="p">,</span>
</span><span id="Project-3781"><a href="#Project-3781"><span class="linenos">3781</span></a>            <span class="s2">&quot;overlap&quot;</span><span class="p">,</span>
</span><span id="Project-3782"><a href="#Project-3782"><span class="linenos">3782</span></a>        <span class="p">]:</span>
</span><span id="Project-3783"><a href="#Project-3783"><span class="linenos">3783</span></a>            <span class="n">pars_data_copy</span><span class="p">[</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Project-3784"><a href="#Project-3784"><span class="linenos">3784</span></a>        <span class="n">pars_data_copy</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">])</span>
</span><span id="Project-3785"><a href="#Project-3785"><span class="linenos">3785</span></a>        <span class="k">return</span> <span class="n">pars_data_copy</span>
</span><span id="Project-3786"><a href="#Project-3786"><span class="linenos">3786</span></a>
</span><span id="Project-3787"><a href="#Project-3787"><span class="linenos">3787</span></a>    <span class="k">def</span> <span class="nf">count_classes</span><span class="p">(</span>
</span><span id="Project-3788"><a href="#Project-3788"><span class="linenos">3788</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3789"><a href="#Project-3789"><span class="linenos">3789</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3790"><a href="#Project-3790"><span class="linenos">3790</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3791"><a href="#Project-3791"><span class="linenos">3791</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-3792"><a href="#Project-3792"><span class="linenos">3792</span></a>        <span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-3793"><a href="#Project-3793"><span class="linenos">3793</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-3794"><a href="#Project-3794"><span class="linenos">3794</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3795"><a href="#Project-3795"><span class="linenos">3795</span></a><span class="sd">        Get a dictionary of class counts in different modes</span>
</span><span id="Project-3796"><a href="#Project-3796"><span class="linenos">3796</span></a>
</span><span id="Project-3797"><a href="#Project-3797"><span class="linenos">3797</span></a><span class="sd">        Parameters</span>
</span><span id="Project-3798"><a href="#Project-3798"><span class="linenos">3798</span></a><span class="sd">        ----------</span>
</span><span id="Project-3799"><a href="#Project-3799"><span class="linenos">3799</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="Project-3800"><a href="#Project-3800"><span class="linenos">3800</span></a><span class="sd">            the episode settings to load</span>
</span><span id="Project-3801"><a href="#Project-3801"><span class="linenos">3801</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-3802"><a href="#Project-3802"><span class="linenos">3802</span></a><span class="sd">            a dictionary of parameter updates (only for &quot;data&quot; and &quot;general&quot; categories)</span>
</span><span id="Project-3803"><a href="#Project-3803"><span class="linenos">3803</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project-3804"><a href="#Project-3804"><span class="linenos">3804</span></a><span class="sd">            if `True`, the dataset that is used for computation is then deleted</span>
</span><span id="Project-3805"><a href="#Project-3805"><span class="linenos">3805</span></a><span class="sd">        bouts : bool, default False</span>
</span><span id="Project-3806"><a href="#Project-3806"><span class="linenos">3806</span></a><span class="sd">            if `True`, instead of frame counts segment counts are returned</span>
</span><span id="Project-3807"><a href="#Project-3807"><span class="linenos">3807</span></a>
</span><span id="Project-3808"><a href="#Project-3808"><span class="linenos">3808</span></a><span class="sd">        Returns</span>
</span><span id="Project-3809"><a href="#Project-3809"><span class="linenos">3809</span></a><span class="sd">        -------</span>
</span><span id="Project-3810"><a href="#Project-3810"><span class="linenos">3810</span></a><span class="sd">        class_counts : dict</span>
</span><span id="Project-3811"><a href="#Project-3811"><span class="linenos">3811</span></a><span class="sd">            a dictionary where first-level keys are &quot;train&quot;, &quot;val&quot; and &quot;test&quot;, second-level keys are</span>
</span><span id="Project-3812"><a href="#Project-3812"><span class="linenos">3812</span></a><span class="sd">            class names and values are class counts (in frames)</span>
</span><span id="Project-3813"><a href="#Project-3813"><span class="linenos">3813</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3814"><a href="#Project-3814"><span class="linenos">3814</span></a>
</span><span id="Project-3815"><a href="#Project-3815"><span class="linenos">3815</span></a>        <span class="k">if</span> <span class="n">load_episode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3816"><a href="#Project-3816"><span class="linenos">3816</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="Project-3817"><a href="#Project-3817"><span class="linenos">3817</span></a>                <span class="n">episode_name</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span> <span class="n">throwaway</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Project-3818"><a href="#Project-3818"><span class="linenos">3818</span></a>            <span class="p">)</span>
</span><span id="Project-3819"><a href="#Project-3819"><span class="linenos">3819</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-3820"><a href="#Project-3820"><span class="linenos">3820</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project-3821"><a href="#Project-3821"><span class="linenos">3821</span></a>                <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project-3822"><a href="#Project-3822"><span class="linenos">3822</span></a>                <span class="n">load_episode</span><span class="o">=</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project-3823"><a href="#Project-3823"><span class="linenos">3823</span></a>                <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-3824"><a href="#Project-3824"><span class="linenos">3824</span></a>            <span class="p">)</span>
</span><span id="Project-3825"><a href="#Project-3825"><span class="linenos">3825</span></a>        <span class="n">class_counts</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">count_classes</span><span class="p">(</span><span class="n">bouts</span><span class="o">=</span><span class="n">bouts</span><span class="p">)</span>
</span><span id="Project-3826"><a href="#Project-3826"><span class="linenos">3826</span></a>        <span class="n">behaviors</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span>
</span><span id="Project-3827"><a href="#Project-3827"><span class="linenos">3827</span></a>        <span class="n">class_counts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project-3828"><a href="#Project-3828"><span class="linenos">3828</span></a>            <span class="n">kk</span><span class="p">:</span> <span class="p">{</span><span class="n">behaviors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="Project-3829"><a href="#Project-3829"><span class="linenos">3829</span></a>            <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Project-3830"><a href="#Project-3830"><span class="linenos">3830</span></a>        <span class="p">}</span>
</span><span id="Project-3831"><a href="#Project-3831"><span class="linenos">3831</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project-3832"><a href="#Project-3832"><span class="linenos">3832</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-3833"><a href="#Project-3833"><span class="linenos">3833</span></a>        <span class="k">return</span> <span class="n">class_counts</span>
</span><span id="Project-3834"><a href="#Project-3834"><span class="linenos">3834</span></a>
</span><span id="Project-3835"><a href="#Project-3835"><span class="linenos">3835</span></a>    <span class="k">def</span> <span class="nf">plot_class_distribution</span><span class="p">(</span>
</span><span id="Project-3836"><a href="#Project-3836"><span class="linenos">3836</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3837"><a href="#Project-3837"><span class="linenos">3837</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3838"><a href="#Project-3838"><span class="linenos">3838</span></a>        <span class="n">frame_cutoff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project-3839"><a href="#Project-3839"><span class="linenos">3839</span></a>        <span class="n">bout_cutoff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project-3840"><a href="#Project-3840"><span class="linenos">3840</span></a>        <span class="n">print_full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-3841"><a href="#Project-3841"><span class="linenos">3841</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-3842"><a href="#Project-3842"><span class="linenos">3842</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3843"><a href="#Project-3843"><span class="linenos">3843</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3844"><a href="#Project-3844"><span class="linenos">3844</span></a><span class="sd">        Make a class distribution plot</span>
</span><span id="Project-3845"><a href="#Project-3845"><span class="linenos">3845</span></a>
</span><span id="Project-3846"><a href="#Project-3846"><span class="linenos">3846</span></a><span class="sd">        You can either specify the parameters, choose an existing dataset or do neither (in that case a dataset</span>
</span><span id="Project-3847"><a href="#Project-3847"><span class="linenos">3847</span></a><span class="sd">        is created or laoded for the computation with the default parameters).</span>
</span><span id="Project-3848"><a href="#Project-3848"><span class="linenos">3848</span></a>
</span><span id="Project-3849"><a href="#Project-3849"><span class="linenos">3849</span></a><span class="sd">        Parameters</span>
</span><span id="Project-3850"><a href="#Project-3850"><span class="linenos">3850</span></a><span class="sd">        ----------</span>
</span><span id="Project-3851"><a href="#Project-3851"><span class="linenos">3851</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-3852"><a href="#Project-3852"><span class="linenos">3852</span></a><span class="sd">            a dictionary of parameter updates (only for &quot;data&quot; and &quot;general&quot; categories)</span>
</span><span id="Project-3853"><a href="#Project-3853"><span class="linenos">3853</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project-3854"><a href="#Project-3854"><span class="linenos">3854</span></a><span class="sd">            if `True`, the dataset that is used for computation is then deleted</span>
</span><span id="Project-3855"><a href="#Project-3855"><span class="linenos">3855</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3856"><a href="#Project-3856"><span class="linenos">3856</span></a>
</span><span id="Project-3857"><a href="#Project-3857"><span class="linenos">3857</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="Project-3858"><a href="#Project-3858"><span class="linenos">3858</span></a>            <span class="n">episode_name</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span> <span class="n">throwaway</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Project-3859"><a href="#Project-3859"><span class="linenos">3859</span></a>        <span class="p">)</span>
</span><span id="Project-3860"><a href="#Project-3860"><span class="linenos">3860</span></a>        <span class="n">cutoff</span> <span class="o">=</span> <span class="p">{</span><span class="kc">True</span><span class="p">:</span> <span class="n">bout_cutoff</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="n">frame_cutoff</span><span class="p">}</span>
</span><span id="Project-3861"><a href="#Project-3861"><span class="linenos">3861</span></a>        <span class="k">for</span> <span class="n">bouts</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
</span><span id="Project-3862"><a href="#Project-3862"><span class="linenos">3862</span></a>            <span class="n">class_counts</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">count_classes</span><span class="p">(</span><span class="n">bouts</span><span class="o">=</span><span class="n">bouts</span><span class="p">)</span>
</span><span id="Project-3863"><a href="#Project-3863"><span class="linenos">3863</span></a>            <span class="k">if</span> <span class="n">print_full</span><span class="p">:</span>
</span><span id="Project-3864"><a href="#Project-3864"><span class="linenos">3864</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bouts:&quot;</span> <span class="k">if</span> <span class="n">bouts</span> <span class="k">else</span> <span class="s2">&quot;Frames:&quot;</span><span class="p">)</span>
</span><span id="Project-3865"><a href="#Project-3865"><span class="linenos">3865</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-3866"><a href="#Project-3866"><span class="linenos">3866</span></a>                    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-3867"><a href="#Project-3867"><span class="linenos">3867</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project-3868"><a href="#Project-3868"><span class="linenos">3868</span></a>                        <span class="n">values</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Project-3869"><a href="#Project-3869"><span class="linenos">3869</span></a>                            <span class="o">*</span><span class="p">[</span>
</span><span id="Project-3870"><a href="#Project-3870"><span class="linenos">3870</span></a>                                <span class="n">x</span>
</span><span id="Project-3871"><a href="#Project-3871"><span class="linenos">3871</span></a>                                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Project-3872"><a href="#Project-3872"><span class="linenos">3872</span></a>                                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="Project-3873"><a href="#Project-3873"><span class="linenos">3873</span></a>                            <span class="p">]</span>
</span><span id="Project-3874"><a href="#Project-3874"><span class="linenos">3874</span></a>                        <span class="p">)</span>
</span><span id="Project-3875"><a href="#Project-3875"><span class="linenos">3875</span></a>                        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
</span><span id="Project-3876"><a href="#Project-3876"><span class="linenos">3876</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">kk</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">vv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-3877"><a href="#Project-3877"><span class="linenos">3877</span></a>            <span class="n">class_counts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project-3878"><a href="#Project-3878"><span class="linenos">3878</span></a>                <span class="n">kk</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">cutoff</span><span class="p">[</span><span class="n">bouts</span><span class="p">]}</span>
</span><span id="Project-3879"><a href="#Project-3879"><span class="linenos">3879</span></a>                <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Project-3880"><a href="#Project-3880"><span class="linenos">3880</span></a>            <span class="p">}</span>
</span><span id="Project-3881"><a href="#Project-3881"><span class="linenos">3881</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-3882"><a href="#Project-3882"><span class="linenos">3882</span></a>                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-3883"><a href="#Project-3883"><span class="linenos">3883</span></a>                    <span class="n">values</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Project-3884"><a href="#Project-3884"><span class="linenos">3884</span></a>                        <span class="o">*</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="Project-3885"><a href="#Project-3885"><span class="linenos">3885</span></a>                    <span class="p">)</span>
</span><span id="Project-3886"><a href="#Project-3886"><span class="linenos">3886</span></a>                    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
</span><span id="Project-3887"><a href="#Project-3887"><span class="linenos">3887</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Project-3888"><a href="#Project-3888"><span class="linenos">3888</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Project-3889"><a href="#Project-3889"><span class="linenos">3889</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="Project-3890"><a href="#Project-3890"><span class="linenos">3890</span></a>                    <span class="k">if</span> <span class="n">bouts</span><span class="p">:</span>
</span><span id="Project-3891"><a href="#Project-3891"><span class="linenos">3891</span></a>                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;bouts&quot;</span><span class="p">)</span>
</span><span id="Project-3892"><a href="#Project-3892"><span class="linenos">3892</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project-3893"><a href="#Project-3893"><span class="linenos">3893</span></a>                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;frames&quot;</span><span class="p">)</span>
</span><span id="Project-3894"><a href="#Project-3894"><span class="linenos">3894</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Project-3895"><a href="#Project-3895"><span class="linenos">3895</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Project-3896"><a href="#Project-3896"><span class="linenos">3896</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project-3897"><a href="#Project-3897"><span class="linenos">3897</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-3898"><a href="#Project-3898"><span class="linenos">3898</span></a>
</span><span id="Project-3899"><a href="#Project-3899"><span class="linenos">3899</span></a>    <span class="k">def</span> <span class="nf">_generate_mask</span><span class="p">(</span>
</span><span id="Project-3900"><a href="#Project-3900"><span class="linenos">3900</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3901"><a href="#Project-3901"><span class="linenos">3901</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-3902"><a href="#Project-3902"><span class="linenos">3902</span></a>        <span class="n">perc_annotated</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="Project-3903"><a href="#Project-3903"><span class="linenos">3903</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3904"><a href="#Project-3904"><span class="linenos">3904</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-3905"><a href="#Project-3905"><span class="linenos">3905</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-3906"><a href="#Project-3906"><span class="linenos">3906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3907"><a href="#Project-3907"><span class="linenos">3907</span></a><span class="sd">        Generate a real_lens for active learning simulation</span>
</span><span id="Project-3908"><a href="#Project-3908"><span class="linenos">3908</span></a>
</span><span id="Project-3909"><a href="#Project-3909"><span class="linenos">3909</span></a><span class="sd">        Parameters</span>
</span><span id="Project-3910"><a href="#Project-3910"><span class="linenos">3910</span></a><span class="sd">        ----------</span>
</span><span id="Project-3911"><a href="#Project-3911"><span class="linenos">3911</span></a><span class="sd">        mask_name : str</span>
</span><span id="Project-3912"><a href="#Project-3912"><span class="linenos">3912</span></a><span class="sd">            the name of the real_lens</span>
</span><span id="Project-3913"><a href="#Project-3913"><span class="linenos">3913</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3914"><a href="#Project-3914"><span class="linenos">3914</span></a>
</span><span id="Project-3915"><a href="#Project-3915"><span class="linenos">3915</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GENERATING </span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-3916"><a href="#Project-3916"><span class="linenos">3916</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="Project-3917"><a href="#Project-3917"><span class="linenos">3917</span></a>            <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span> <span class="n">throwaway</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Project-3918"><a href="#Project-3918"><span class="linenos">3918</span></a>        <span class="p">)</span>
</span><span id="Project-3919"><a href="#Project-3919"><span class="linenos">3919</span></a>        <span class="n">val_intervals</span><span class="p">,</span> <span class="n">val_ids</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_intervals</span><span class="p">()</span>  <span class="c1"># 1</span>
</span><span id="Project-3920"><a href="#Project-3920"><span class="linenos">3920</span></a>        <span class="n">unannotated_intervals</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_unannotated_intervals</span><span class="p">()</span>  <span class="c1"># 2</span>
</span><span id="Project-3921"><a href="#Project-3921"><span class="linenos">3921</span></a>        <span class="n">unannotated_intervals</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_unannotated_intervals</span><span class="p">(</span>
</span><span id="Project-3922"><a href="#Project-3922"><span class="linenos">3922</span></a>            <span class="n">first_intervals</span><span class="o">=</span><span class="n">unannotated_intervals</span>
</span><span id="Project-3923"><a href="#Project-3923"><span class="linenos">3923</span></a>        <span class="p">)</span>
</span><span id="Project-3924"><a href="#Project-3924"><span class="linenos">3924</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_ids</span><span class="p">()</span>
</span><span id="Project-3925"><a href="#Project-3925"><span class="linenos">3925</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="p">{</span><span class="n">video_id</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">}</span>
</span><span id="Project-3926"><a href="#Project-3926"><span class="linenos">3926</span></a>        <span class="n">total_all</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-3927"><a href="#Project-3927"><span class="linenos">3927</span></a>        <span class="n">total_masked</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-3928"><a href="#Project-3928"><span class="linenos">3928</span></a>        <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">clip_ids</span> <span class="ow">in</span> <span class="n">ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-3929"><a href="#Project-3929"><span class="linenos">3929</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">clip_ids</span><span class="p">:</span>
</span><span id="Project-3930"><a href="#Project-3930"><span class="linenos">3930</span></a>                <span class="n">frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_len</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">))</span>
</span><span id="Project-3931"><a href="#Project-3931"><span class="linenos">3931</span></a>                <span class="k">if</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">val_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="Project-3932"><a href="#Project-3932"><span class="linenos">3932</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">val_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="Project-3933"><a href="#Project-3933"><span class="linenos">3933</span></a>                        <span class="n">frames</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-3934"><a href="#Project-3934"><span class="linenos">3934</span></a>                <span class="k">if</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">unannotated_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="Project-3935"><a href="#Project-3935"><span class="linenos">3935</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">unannotated_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="Project-3936"><a href="#Project-3936"><span class="linenos">3936</span></a>                        <span class="n">frames</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-3937"><a href="#Project-3937"><span class="linenos">3937</span></a>                <span class="n">annotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">frames</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-3938"><a href="#Project-3938"><span class="linenos">3938</span></a>                <span class="n">total_all</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">annotated</span><span class="p">)</span>
</span><span id="Project-3939"><a href="#Project-3939"><span class="linenos">3939</span></a>                <span class="n">masked</span> <span class="o">=</span> <span class="n">annotated</span><span class="p">[</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">annotated</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">perc_annotated</span><span class="p">))</span> <span class="p">:]</span>
</span><span id="Project-3940"><a href="#Project-3940"><span class="linenos">3940</span></a>                <span class="n">total_masked</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">masked</span><span class="p">)</span>
</span><span id="Project-3941"><a href="#Project-3941"><span class="linenos">3941</span></a>                <span class="n">mask</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_intervals</span><span class="p">(</span><span class="n">masked</span><span class="p">)</span>
</span><span id="Project-3942"><a href="#Project-3942"><span class="linenos">3942</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project-3943"><a href="#Project-3943"><span class="linenos">3943</span></a>            <span class="s2">&quot;masked&quot;</span><span class="p">:</span> <span class="n">mask</span><span class="p">,</span>
</span><span id="Project-3944"><a href="#Project-3944"><span class="linenos">3944</span></a>            <span class="s2">&quot;val_intervals&quot;</span><span class="p">:</span> <span class="n">val_intervals</span><span class="p">,</span>
</span><span id="Project-3945"><a href="#Project-3945"><span class="linenos">3945</span></a>            <span class="s2">&quot;val_ids&quot;</span><span class="p">:</span> <span class="n">val_ids</span><span class="p">,</span>
</span><span id="Project-3946"><a href="#Project-3946"><span class="linenos">3946</span></a>            <span class="s2">&quot;unannotated&quot;</span><span class="p">:</span> <span class="n">unannotated_intervals</span><span class="p">,</span>
</span><span id="Project-3947"><a href="#Project-3947"><span class="linenos">3947</span></a>        <span class="p">}</span>
</span><span id="Project-3948"><a href="#Project-3948"><span class="linenos">3948</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_mask</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">)</span>
</span><span id="Project-3949"><a href="#Project-3949"><span class="linenos">3949</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project-3950"><a href="#Project-3950"><span class="linenos">3950</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-3951"><a href="#Project-3951"><span class="linenos">3951</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-3952"><a href="#Project-3952"><span class="linenos">3952</span></a>        <span class="c1"># print(f&#39;Unmasked: {sum([(vv == 0).sum() for v in real_lens.values() for vv in v.values()])} frames&#39;)</span>
</span><span id="Project-3953"><a href="#Project-3953"><span class="linenos">3953</span></a>
</span><span id="Project-3954"><a href="#Project-3954"><span class="linenos">3954</span></a>    <span class="k">def</span> <span class="nf">_get_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Project-3955"><a href="#Project-3955"><span class="linenos">3955</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3956"><a href="#Project-3956"><span class="linenos">3956</span></a><span class="sd">        Get a list of intervals from a list of frame indices</span>
</span><span id="Project-3957"><a href="#Project-3957"><span class="linenos">3957</span></a>
</span><span id="Project-3958"><a href="#Project-3958"><span class="linenos">3958</span></a><span class="sd">        Example: `[0, 1, 2, 5, 6, 8] -&gt; [[0, 3], [5, 7], [8, 9]]`.</span>
</span><span id="Project-3959"><a href="#Project-3959"><span class="linenos">3959</span></a>
</span><span id="Project-3960"><a href="#Project-3960"><span class="linenos">3960</span></a><span class="sd">        Parameters</span>
</span><span id="Project-3961"><a href="#Project-3961"><span class="linenos">3961</span></a><span class="sd">        ----------</span>
</span><span id="Project-3962"><a href="#Project-3962"><span class="linenos">3962</span></a><span class="sd">        frame_indices : np.ndarray</span>
</span><span id="Project-3963"><a href="#Project-3963"><span class="linenos">3963</span></a><span class="sd">            a list of frame indices</span>
</span><span id="Project-3964"><a href="#Project-3964"><span class="linenos">3964</span></a>
</span><span id="Project-3965"><a href="#Project-3965"><span class="linenos">3965</span></a><span class="sd">        Returns</span>
</span><span id="Project-3966"><a href="#Project-3966"><span class="linenos">3966</span></a><span class="sd">        -------</span>
</span><span id="Project-3967"><a href="#Project-3967"><span class="linenos">3967</span></a><span class="sd">        intervals : list</span>
</span><span id="Project-3968"><a href="#Project-3968"><span class="linenos">3968</span></a><span class="sd">            a list of interval boundaries</span>
</span><span id="Project-3969"><a href="#Project-3969"><span class="linenos">3969</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-3970"><a href="#Project-3970"><span class="linenos">3970</span></a>
</span><span id="Project-3971"><a href="#Project-3971"><span class="linenos">3971</span></a>        <span class="n">masked_intervals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-3972"><a href="#Project-3972"><span class="linenos">3972</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-3973"><a href="#Project-3973"><span class="linenos">3973</span></a>            <span class="n">breaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">frame_indices</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-3974"><a href="#Project-3974"><span class="linenos">3974</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="n">frame_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-3975"><a href="#Project-3975"><span class="linenos">3975</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">breaks</span><span class="p">:</span>
</span><span id="Project-3976"><a href="#Project-3976"><span class="linenos">3976</span></a>                <span class="n">masked_intervals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">frame_indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Project-3977"><a href="#Project-3977"><span class="linenos">3977</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">frame_indices</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Project-3978"><a href="#Project-3978"><span class="linenos">3978</span></a>            <span class="n">masked_intervals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">frame_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Project-3979"><a href="#Project-3979"><span class="linenos">3979</span></a>        <span class="k">return</span> <span class="n">masked_intervals</span>
</span><span id="Project-3980"><a href="#Project-3980"><span class="linenos">3980</span></a>
</span><span id="Project-3981"><a href="#Project-3981"><span class="linenos">3981</span></a>    <span class="k">def</span> <span class="nf">_update_mask_with_uncertainty</span><span class="p">(</span>
</span><span id="Project-3982"><a href="#Project-3982"><span class="linenos">3982</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-3983"><a href="#Project-3983"><span class="linenos">3983</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-3984"><a href="#Project-3984"><span class="linenos">3984</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
</span><span id="Project-3985"><a href="#Project-3985"><span class="linenos">3985</span></a>        <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-3986"><a href="#Project-3986"><span class="linenos">3986</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3987"><a href="#Project-3987"><span class="linenos">3987</span></a>        <span class="n">n_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
</span><span id="Project-3988"><a href="#Project-3988"><span class="linenos">3988</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;least_confidence&quot;</span><span class="p">,</span>
</span><span id="Project-3989"><a href="#Project-3989"><span class="linenos">3989</span></a>        <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="Project-3990"><a href="#Project-3990"><span class="linenos">3990</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project-3991"><a href="#Project-3991"><span class="linenos">3991</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-3992"><a href="#Project-3992"><span class="linenos">3992</span></a>    <span class="p">):</span>
</span><span id="Project-3993"><a href="#Project-3993"><span class="linenos">3993</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-3994"><a href="#Project-3994"><span class="linenos">3994</span></a><span class="sd">        Update real_lens with frame-wise uncertainty scores for active learning</span>
</span><span id="Project-3995"><a href="#Project-3995"><span class="linenos">3995</span></a>
</span><span id="Project-3996"><a href="#Project-3996"><span class="linenos">3996</span></a><span class="sd">        Parameters</span>
</span><span id="Project-3997"><a href="#Project-3997"><span class="linenos">3997</span></a><span class="sd">        ----------</span>
</span><span id="Project-3998"><a href="#Project-3998"><span class="linenos">3998</span></a><span class="sd">        mask_name : str</span>
</span><span id="Project-3999"><a href="#Project-3999"><span class="linenos">3999</span></a><span class="sd">            the name of the real_lens</span>
</span><span id="Project-4000"><a href="#Project-4000"><span class="linenos">4000</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project-4001"><a href="#Project-4001"><span class="linenos">4001</span></a><span class="sd">            the name of the episode to load</span>
</span><span id="Project-4002"><a href="#Project-4002"><span class="linenos">4002</span></a><span class="sd">        classes : list</span>
</span><span id="Project-4003"><a href="#Project-4003"><span class="linenos">4003</span></a><span class="sd">            a list of class names or indices; their uncertainty scores will be computed separately and stacked</span>
</span><span id="Project-4004"><a href="#Project-4004"><span class="linenos">4004</span></a><span class="sd">        n_frames : int, default 10000</span>
</span><span id="Project-4005"><a href="#Project-4005"><span class="linenos">4005</span></a><span class="sd">            the number of frames to &quot;annotate&quot;</span>
</span><span id="Project-4006"><a href="#Project-4006"><span class="linenos">4006</span></a><span class="sd">        method : {&quot;least_confidence&quot;, &quot;entropy&quot;}</span>
</span><span id="Project-4007"><a href="#Project-4007"><span class="linenos">4007</span></a><span class="sd">            the method used to calculate the scores from the probability predictions (`&quot;least_confidence&quot;`: `1 - p_i` if</span>
</span><span id="Project-4008"><a href="#Project-4008"><span class="linenos">4008</span></a><span class="sd">            `p_i &gt; 0.5` or `p_i` if `p_i &lt; 0.5`; `&quot;entropy&quot;`: `- p_i * log(p_i) - (1 - p_i) * log(1 - p_i)`)</span>
</span><span id="Project-4009"><a href="#Project-4009"><span class="linenos">4009</span></a><span class="sd">        min_length : int</span>
</span><span id="Project-4010"><a href="#Project-4010"><span class="linenos">4010</span></a><span class="sd">            the minimum length (in frames) of the annotated intervals</span>
</span><span id="Project-4011"><a href="#Project-4011"><span class="linenos">4011</span></a><span class="sd">        augment_n : int, default 0</span>
</span><span id="Project-4012"><a href="#Project-4012"><span class="linenos">4012</span></a><span class="sd">            the number of augmentations to average over</span>
</span><span id="Project-4013"><a href="#Project-4013"><span class="linenos">4013</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-4014"><a href="#Project-4014"><span class="linenos">4014</span></a><span class="sd">            the dictionary used to update the parameters from the config</span>
</span><span id="Project-4015"><a href="#Project-4015"><span class="linenos">4015</span></a>
</span><span id="Project-4016"><a href="#Project-4016"><span class="linenos">4016</span></a><span class="sd">        Returns</span>
</span><span id="Project-4017"><a href="#Project-4017"><span class="linenos">4017</span></a><span class="sd">        -------</span>
</span><span id="Project-4018"><a href="#Project-4018"><span class="linenos">4018</span></a><span class="sd">        score_dicts : dict</span>
</span><span id="Project-4019"><a href="#Project-4019"><span class="linenos">4019</span></a><span class="sd">            a nested dictionary where first level keys are video ids, second level keys are clip ids and values</span>
</span><span id="Project-4020"><a href="#Project-4020"><span class="linenos">4020</span></a><span class="sd">            are score tensors</span>
</span><span id="Project-4021"><a href="#Project-4021"><span class="linenos">4021</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4022"><a href="#Project-4022"><span class="linenos">4022</span></a>
</span><span id="Project-4023"><a href="#Project-4023"><span class="linenos">4023</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATING </span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-4024"><a href="#Project-4024"><span class="linenos">4024</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project-4025"><a href="#Project-4025"><span class="linenos">4025</span></a>            <span class="n">prediction_name</span><span class="o">=</span><span class="n">mask_name</span><span class="p">,</span>
</span><span id="Project-4026"><a href="#Project-4026"><span class="linenos">4026</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-4027"><a href="#Project-4027"><span class="linenos">4027</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-4028"><a href="#Project-4028"><span class="linenos">4028</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-4029"><a href="#Project-4029"><span class="linenos">4029</span></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span>
</span><span id="Project-4030"><a href="#Project-4030"><span class="linenos">4030</span></a>        <span class="p">)</span>
</span><span id="Project-4031"><a href="#Project-4031"><span class="linenos">4031</span></a>        <span class="n">score_tensors</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">generate_uncertainty_score</span><span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">augment_n</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
</span><span id="Project-4032"><a href="#Project-4032"><span class="linenos">4032</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_mask</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">,</span> <span class="n">score_tensors</span><span class="p">,</span> <span class="n">n_frames</span><span class="p">,</span> <span class="n">min_length</span><span class="p">)</span>
</span><span id="Project-4033"><a href="#Project-4033"><span class="linenos">4033</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-4034"><a href="#Project-4034"><span class="linenos">4034</span></a>
</span><span id="Project-4035"><a href="#Project-4035"><span class="linenos">4035</span></a>    <span class="k">def</span> <span class="nf">_update_mask_with_BALD</span><span class="p">(</span>
</span><span id="Project-4036"><a href="#Project-4036"><span class="linenos">4036</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-4037"><a href="#Project-4037"><span class="linenos">4037</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-4038"><a href="#Project-4038"><span class="linenos">4038</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-4039"><a href="#Project-4039"><span class="linenos">4039</span></a>        <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-4040"><a href="#Project-4040"><span class="linenos">4040</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4041"><a href="#Project-4041"><span class="linenos">4041</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project-4042"><a href="#Project-4042"><span class="linenos">4042</span></a>        <span class="n">n_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
</span><span id="Project-4043"><a href="#Project-4043"><span class="linenos">4043</span></a>        <span class="n">num_models</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Project-4044"><a href="#Project-4044"><span class="linenos">4044</span></a>        <span class="n">kernel_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
</span><span id="Project-4045"><a href="#Project-4045"><span class="linenos">4045</span></a>        <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="Project-4046"><a href="#Project-4046"><span class="linenos">4046</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4047"><a href="#Project-4047"><span class="linenos">4047</span></a>    <span class="p">):</span>
</span><span id="Project-4048"><a href="#Project-4048"><span class="linenos">4048</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4049"><a href="#Project-4049"><span class="linenos">4049</span></a><span class="sd">        Update real_lens with frame-wise Bayesian Active Learning by Disagreement scores for active learning</span>
</span><span id="Project-4050"><a href="#Project-4050"><span class="linenos">4050</span></a>
</span><span id="Project-4051"><a href="#Project-4051"><span class="linenos">4051</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4052"><a href="#Project-4052"><span class="linenos">4052</span></a><span class="sd">        ----------</span>
</span><span id="Project-4053"><a href="#Project-4053"><span class="linenos">4053</span></a><span class="sd">        mask_name : str</span>
</span><span id="Project-4054"><a href="#Project-4054"><span class="linenos">4054</span></a><span class="sd">            the name of the real_lens</span>
</span><span id="Project-4055"><a href="#Project-4055"><span class="linenos">4055</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project-4056"><a href="#Project-4056"><span class="linenos">4056</span></a><span class="sd">            the name of the episode to load</span>
</span><span id="Project-4057"><a href="#Project-4057"><span class="linenos">4057</span></a><span class="sd">        classes : list</span>
</span><span id="Project-4058"><a href="#Project-4058"><span class="linenos">4058</span></a><span class="sd">            a list of class names or indices; their uncertainty scores will be computed separately and stacked</span>
</span><span id="Project-4059"><a href="#Project-4059"><span class="linenos">4059</span></a><span class="sd">        augment_n : int, default 0</span>
</span><span id="Project-4060"><a href="#Project-4060"><span class="linenos">4060</span></a><span class="sd">            the number of augmentations to average over</span>
</span><span id="Project-4061"><a href="#Project-4061"><span class="linenos">4061</span></a><span class="sd">        n_frames : int, default 10000</span>
</span><span id="Project-4062"><a href="#Project-4062"><span class="linenos">4062</span></a><span class="sd">            the number of frames to &quot;annotate&quot;</span>
</span><span id="Project-4063"><a href="#Project-4063"><span class="linenos">4063</span></a><span class="sd">        num_models : int, default 10</span>
</span><span id="Project-4064"><a href="#Project-4064"><span class="linenos">4064</span></a><span class="sd">            the number of dropout masks to apply</span>
</span><span id="Project-4065"><a href="#Project-4065"><span class="linenos">4065</span></a><span class="sd">        kernel_size : int, default 11</span>
</span><span id="Project-4066"><a href="#Project-4066"><span class="linenos">4066</span></a><span class="sd">            the size of the smoothing gaussian kernel</span>
</span><span id="Project-4067"><a href="#Project-4067"><span class="linenos">4067</span></a><span class="sd">        min_length : int</span>
</span><span id="Project-4068"><a href="#Project-4068"><span class="linenos">4068</span></a><span class="sd">            the minimum length (in frames) of the annotated intervals</span>
</span><span id="Project-4069"><a href="#Project-4069"><span class="linenos">4069</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-4070"><a href="#Project-4070"><span class="linenos">4070</span></a><span class="sd">            the dictionary used to update the parameters from the config</span>
</span><span id="Project-4071"><a href="#Project-4071"><span class="linenos">4071</span></a>
</span><span id="Project-4072"><a href="#Project-4072"><span class="linenos">4072</span></a><span class="sd">        Returns</span>
</span><span id="Project-4073"><a href="#Project-4073"><span class="linenos">4073</span></a><span class="sd">        -------</span>
</span><span id="Project-4074"><a href="#Project-4074"><span class="linenos">4074</span></a><span class="sd">        score_dicts : dict</span>
</span><span id="Project-4075"><a href="#Project-4075"><span class="linenos">4075</span></a><span class="sd">            a nested dictionary where first level keys are video ids, second level keys are clip ids and values</span>
</span><span id="Project-4076"><a href="#Project-4076"><span class="linenos">4076</span></a><span class="sd">            are score tensors</span>
</span><span id="Project-4077"><a href="#Project-4077"><span class="linenos">4077</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4078"><a href="#Project-4078"><span class="linenos">4078</span></a>
</span><span id="Project-4079"><a href="#Project-4079"><span class="linenos">4079</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATING </span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-4080"><a href="#Project-4080"><span class="linenos">4080</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project-4081"><a href="#Project-4081"><span class="linenos">4081</span></a>            <span class="n">mask_name</span><span class="p">,</span>
</span><span id="Project-4082"><a href="#Project-4082"><span class="linenos">4082</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-4083"><a href="#Project-4083"><span class="linenos">4083</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-4084"><a href="#Project-4084"><span class="linenos">4084</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-4085"><a href="#Project-4085"><span class="linenos">4085</span></a>        <span class="p">)</span>
</span><span id="Project-4086"><a href="#Project-4086"><span class="linenos">4086</span></a>        <span class="n">score_tensors</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">generate_bald_score</span><span class="p">(</span>
</span><span id="Project-4087"><a href="#Project-4087"><span class="linenos">4087</span></a>            <span class="n">classes</span><span class="p">,</span> <span class="n">augment_n</span><span class="p">,</span> <span class="n">num_models</span><span class="p">,</span> <span class="n">kernel_size</span>
</span><span id="Project-4088"><a href="#Project-4088"><span class="linenos">4088</span></a>        <span class="p">)</span>
</span><span id="Project-4089"><a href="#Project-4089"><span class="linenos">4089</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_mask</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">,</span> <span class="n">score_tensors</span><span class="p">,</span> <span class="n">n_frames</span><span class="p">,</span> <span class="n">min_length</span><span class="p">)</span>
</span><span id="Project-4090"><a href="#Project-4090"><span class="linenos">4090</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-4091"><a href="#Project-4091"><span class="linenos">4091</span></a>
</span><span id="Project-4092"><a href="#Project-4092"><span class="linenos">4092</span></a>    <span class="k">def</span> <span class="nf">_suggest_intervals</span><span class="p">(</span>
</span><span id="Project-4093"><a href="#Project-4093"><span class="linenos">4093</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-4094"><a href="#Project-4094"><span class="linenos">4094</span></a>        <span class="n">dataset</span><span class="p">:</span> <span class="n">BehaviorDataset</span><span class="p">,</span>
</span><span id="Project-4095"><a href="#Project-4095"><span class="linenos">4095</span></a>        <span class="n">score_tensors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-4096"><a href="#Project-4096"><span class="linenos">4096</span></a>        <span class="n">n_frames</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Project-4097"><a href="#Project-4097"><span class="linenos">4097</span></a>        <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Project-4098"><a href="#Project-4098"><span class="linenos">4098</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-4099"><a href="#Project-4099"><span class="linenos">4099</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4100"><a href="#Project-4100"><span class="linenos">4100</span></a><span class="sd">        Suggest intervals with highest score of total length `n_frames`</span>
</span><span id="Project-4101"><a href="#Project-4101"><span class="linenos">4101</span></a>
</span><span id="Project-4102"><a href="#Project-4102"><span class="linenos">4102</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4103"><a href="#Project-4103"><span class="linenos">4103</span></a><span class="sd">        ----------</span>
</span><span id="Project-4104"><a href="#Project-4104"><span class="linenos">4104</span></a><span class="sd">        dataset : BehaviorDataset</span>
</span><span id="Project-4105"><a href="#Project-4105"><span class="linenos">4105</span></a><span class="sd">            the dataset</span>
</span><span id="Project-4106"><a href="#Project-4106"><span class="linenos">4106</span></a><span class="sd">        score_tensors : dict</span>
</span><span id="Project-4107"><a href="#Project-4107"><span class="linenos">4107</span></a><span class="sd">            a dictionary where keys are clip ids and values are framewise score tensors</span>
</span><span id="Project-4108"><a href="#Project-4108"><span class="linenos">4108</span></a><span class="sd">        n_frames : int</span>
</span><span id="Project-4109"><a href="#Project-4109"><span class="linenos">4109</span></a><span class="sd">            the number of frames to &quot;annotate&quot;</span>
</span><span id="Project-4110"><a href="#Project-4110"><span class="linenos">4110</span></a><span class="sd">        min_length : int</span>
</span><span id="Project-4111"><a href="#Project-4111"><span class="linenos">4111</span></a>
</span><span id="Project-4112"><a href="#Project-4112"><span class="linenos">4112</span></a><span class="sd">        Returns</span>
</span><span id="Project-4113"><a href="#Project-4113"><span class="linenos">4113</span></a><span class="sd">        -------</span>
</span><span id="Project-4114"><a href="#Project-4114"><span class="linenos">4114</span></a><span class="sd">        active_learning_intervals : Dict</span>
</span><span id="Project-4115"><a href="#Project-4115"><span class="linenos">4115</span></a><span class="sd">            active learning dictionary with suggested intervals</span>
</span><span id="Project-4116"><a href="#Project-4116"><span class="linenos">4116</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4117"><a href="#Project-4117"><span class="linenos">4117</span></a>
</span><span id="Project-4118"><a href="#Project-4118"><span class="linenos">4118</span></a>        <span class="n">video_intervals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_intervals</span><span class="p">()</span>
</span><span id="Project-4119"><a href="#Project-4119"><span class="linenos">4119</span></a>        <span class="n">taken</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project-4120"><a href="#Project-4120"><span class="linenos">4120</span></a>            <span class="n">video_id</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span> <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="Project-4121"><a href="#Project-4121"><span class="linenos">4121</span></a>        <span class="p">}</span>
</span><span id="Project-4122"><a href="#Project-4122"><span class="linenos">4122</span></a>        <span class="n">annotated</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_annotated_intervals</span><span class="p">()</span>
</span><span id="Project-4123"><a href="#Project-4123"><span class="linenos">4123</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">:</span>
</span><span id="Project-4124"><a href="#Project-4124"><span class="linenos">4124</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="Project-4125"><a href="#Project-4125"><span class="linenos">4125</span></a>                <span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="Project-4126"><a href="#Project-4126"><span class="linenos">4126</span></a>                    <span class="n">dataset</span><span class="o">.</span><span class="n">get_len</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">)</span>
</span><span id="Project-4127"><a href="#Project-4127"><span class="linenos">4127</span></a>                <span class="p">)</span>
</span><span id="Project-4128"><a href="#Project-4128"><span class="linenos">4128</span></a>                <span class="k">if</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">annotated</span> <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">annotated</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="Project-4129"><a href="#Project-4129"><span class="linenos">4129</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">annotated</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="Project-4130"><a href="#Project-4130"><span class="linenos">4130</span></a>                        <span class="n">score_tensors</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
</span><span id="Project-4131"><a href="#Project-4131"><span class="linenos">4131</span></a>                        <span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Project-4132"><a href="#Project-4132"><span class="linenos">4132</span></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Project-4133"><a href="#Project-4133"><span class="linenos">4133</span></a>            <span class="nb">sum</span><span class="p">([(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">taken</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</span><span id="Project-4134"><a href="#Project-4134"><span class="linenos">4134</span></a>            <span class="o">+</span> <span class="n">n_frames</span>
</span><span id="Project-4135"><a href="#Project-4135"><span class="linenos">4135</span></a>        <span class="p">)</span>
</span><span id="Project-4136"><a href="#Project-4136"><span class="linenos">4136</span></a>        <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Project-4137"><a href="#Project-4137"><span class="linenos">4137</span></a>        <span class="n">threshold_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Project-4138"><a href="#Project-4138"><span class="linenos">4138</span></a>            <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Project-4139"><a href="#Project-4139"><span class="linenos">4139</span></a>                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="Project-4140"><a href="#Project-4140"><span class="linenos">4140</span></a>                    <span class="p">[</span>
</span><span id="Project-4141"><a href="#Project-4141"><span class="linenos">4141</span></a>                        <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Project-4142"><a href="#Project-4142"><span class="linenos">4142</span></a>                            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</span><span id="Project-4143"><a href="#Project-4143"><span class="linenos">4143</span></a>                        <span class="p">)</span>
</span><span id="Project-4144"><a href="#Project-4144"><span class="linenos">4144</span></a>                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">score_tensors</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Project-4145"><a href="#Project-4145"><span class="linenos">4145</span></a>                    <span class="p">]</span>
</span><span id="Project-4146"><a href="#Project-4146"><span class="linenos">4146</span></a>                <span class="p">)</span>
</span><span id="Project-4147"><a href="#Project-4147"><span class="linenos">4147</span></a>            <span class="p">)</span>
</span><span id="Project-4148"><a href="#Project-4148"><span class="linenos">4148</span></a>        <span class="p">)</span>
</span><span id="Project-4149"><a href="#Project-4149"><span class="linenos">4149</span></a>        <span class="k">while</span> <span class="p">(</span>
</span><span id="Project-4150"><a href="#Project-4150"><span class="linenos">4150</span></a>            <span class="nb">sum</span><span class="p">([(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">taken</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</span><span id="Project-4151"><a href="#Project-4151"><span class="linenos">4151</span></a>            <span class="o">&lt;</span> <span class="n">n_frames</span>
</span><span id="Project-4152"><a href="#Project-4152"><span class="linenos">4152</span></a>        <span class="p">):</span>
</span><span id="Project-4153"><a href="#Project-4153"><span class="linenos">4153</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold_start</span> <span class="o">*</span> <span class="n">factor</span>
</span><span id="Project-4154"><a href="#Project-4154"><span class="linenos">4154</span></a>            <span class="n">intervals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-4155"><a href="#Project-4155"><span class="linenos">4155</span></a>            <span class="n">interval_scores</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-4156"><a href="#Project-4156"><span class="linenos">4156</span></a>            <span class="n">key1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">score_tensors</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-4157"><a href="#Project-4157"><span class="linenos">4157</span></a>            <span class="n">key2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">score_tensors</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-4158"><a href="#Project-4158"><span class="linenos">4158</span></a>            <span class="n">num_scores</span> <span class="o">=</span> <span class="n">score_tensors</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-4159"><a href="#Project-4159"><span class="linenos">4159</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_scores</span><span class="p">):</span>
</span><span id="Project-4160"><a href="#Project-4160"><span class="linenos">4160</span></a>                <span class="n">v_dict</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">find_valleys</span><span class="p">(</span>
</span><span id="Project-4161"><a href="#Project-4161"><span class="linenos">4161</span></a>                    <span class="n">predicted</span><span class="o">=</span><span class="n">score_tensors</span><span class="p">,</span>
</span><span id="Project-4162"><a href="#Project-4162"><span class="linenos">4162</span></a>                    <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
</span><span id="Project-4163"><a href="#Project-4163"><span class="linenos">4163</span></a>                    <span class="n">min_frames</span><span class="o">=</span><span class="n">min_length</span><span class="p">,</span>
</span><span id="Project-4164"><a href="#Project-4164"><span class="linenos">4164</span></a>                    <span class="n">main_class</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="Project-4165"><a href="#Project-4165"><span class="linenos">4165</span></a>                    <span class="n">low</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Project-4166"><a href="#Project-4166"><span class="linenos">4166</span></a>                <span class="p">)</span>
</span><span id="Project-4167"><a href="#Project-4167"><span class="linenos">4167</span></a>                <span class="k">for</span> <span class="n">v_id</span><span class="p">,</span> <span class="n">interval_list</span> <span class="ow">in</span> <span class="n">v_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-4168"><a href="#Project-4168"><span class="linenos">4168</span></a>                    <span class="n">intervals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">[</span><span class="n">v_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">interval_list</span><span class="p">]</span>
</span><span id="Project-4169"><a href="#Project-4169"><span class="linenos">4169</span></a>                    <span class="n">interval_scores</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Project-4170"><a href="#Project-4170"><span class="linenos">4170</span></a>                        <span class="nb">float</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">score_tensors</span><span class="p">[</span><span class="n">v_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]))</span>
</span><span id="Project-4171"><a href="#Project-4171"><span class="linenos">4171</span></a>                        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">interval_list</span>
</span><span id="Project-4172"><a href="#Project-4172"><span class="linenos">4172</span></a>                    <span class="p">]</span>
</span><span id="Project-4173"><a href="#Project-4173"><span class="linenos">4173</span></a>            <span class="n">intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intervals</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">interval_scores</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="Project-4174"><a href="#Project-4174"><span class="linenos">4174</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-4175"><a href="#Project-4175"><span class="linenos">4175</span></a>            <span class="k">while</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="Project-4176"><a href="#Project-4176"><span class="linenos">4176</span></a>                <span class="p">[(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">taken</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span><span id="Project-4177"><a href="#Project-4177"><span class="linenos">4177</span></a>            <span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_frames</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
</span><span id="Project-4178"><a href="#Project-4178"><span class="linenos">4178</span></a>                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">video_id</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Project-4179"><a href="#Project-4179"><span class="linenos">4179</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Project-4180"><a href="#Project-4180"><span class="linenos">4180</span></a>                <span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Project-4181"><a href="#Project-4181"><span class="linenos">4181</span></a>            <span class="n">factor</span> <span class="o">*=</span> <span class="mf">0.9</span>
</span><span id="Project-4182"><a href="#Project-4182"><span class="linenos">4182</span></a>            <span class="k">if</span> <span class="n">factor</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
</span><span id="Project-4183"><a href="#Project-4183"><span class="linenos">4183</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find enough frames!&quot;</span><span class="p">)</span>
</span><span id="Project-4184"><a href="#Project-4184"><span class="linenos">4184</span></a>                <span class="k">break</span>
</span><span id="Project-4185"><a href="#Project-4185"><span class="linenos">4185</span></a>        <span class="n">active_learning_intervals</span> <span class="o">=</span> <span class="p">{</span><span class="n">video_id</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">}</span>
</span><span id="Project-4186"><a href="#Project-4186"><span class="linenos">4186</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">taken</span><span class="p">:</span>
</span><span id="Project-4187"><a href="#Project-4187"><span class="linenos">4187</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="Project-4188"><a href="#Project-4188"><span class="linenos">4188</span></a>                <span class="k">if</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">annotated</span> <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">annotated</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="Project-4189"><a href="#Project-4189"><span class="linenos">4189</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">annotated</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="Project-4190"><a href="#Project-4190"><span class="linenos">4190</span></a>                        <span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-4191"><a href="#Project-4191"><span class="linenos">4191</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-4192"><a href="#Project-4192"><span class="linenos">4192</span></a>                    <span class="k">continue</span>
</span><span id="Project-4193"><a href="#Project-4193"><span class="linenos">4193</span></a>                <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">taken</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-4194"><a href="#Project-4194"><span class="linenos">4194</span></a>                <span class="n">boundaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_intervals</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
</span><span id="Project-4195"><a href="#Project-4195"><span class="linenos">4195</span></a>                <span class="n">active_learning_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Project-4196"><a href="#Project-4196"><span class="linenos">4196</span></a>                    <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">boundaries</span>
</span><span id="Project-4197"><a href="#Project-4197"><span class="linenos">4197</span></a>                <span class="p">]</span>
</span><span id="Project-4198"><a href="#Project-4198"><span class="linenos">4198</span></a>        <span class="k">return</span> <span class="n">active_learning_intervals</span>
</span><span id="Project-4199"><a href="#Project-4199"><span class="linenos">4199</span></a>
</span><span id="Project-4200"><a href="#Project-4200"><span class="linenos">4200</span></a>    <span class="k">def</span> <span class="nf">_update_mask</span><span class="p">(</span>
</span><span id="Project-4201"><a href="#Project-4201"><span class="linenos">4201</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-4202"><a href="#Project-4202"><span class="linenos">4202</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span><span class="p">,</span>
</span><span id="Project-4203"><a href="#Project-4203"><span class="linenos">4203</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-4204"><a href="#Project-4204"><span class="linenos">4204</span></a>        <span class="n">score_tensors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project-4205"><a href="#Project-4205"><span class="linenos">4205</span></a>        <span class="n">n_frames</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Project-4206"><a href="#Project-4206"><span class="linenos">4206</span></a>        <span class="n">min_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Project-4207"><a href="#Project-4207"><span class="linenos">4207</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-4208"><a href="#Project-4208"><span class="linenos">4208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4209"><a href="#Project-4209"><span class="linenos">4209</span></a><span class="sd">        Update the real_lens with intervals with the highest score of total length `n_frames`</span>
</span><span id="Project-4210"><a href="#Project-4210"><span class="linenos">4210</span></a>
</span><span id="Project-4211"><a href="#Project-4211"><span class="linenos">4211</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4212"><a href="#Project-4212"><span class="linenos">4212</span></a><span class="sd">        ----------</span>
</span><span id="Project-4213"><a href="#Project-4213"><span class="linenos">4213</span></a><span class="sd">        mask_name : str</span>
</span><span id="Project-4214"><a href="#Project-4214"><span class="linenos">4214</span></a><span class="sd">            the name of the real_lens</span>
</span><span id="Project-4215"><a href="#Project-4215"><span class="linenos">4215</span></a><span class="sd">        score_tensors : dict</span>
</span><span id="Project-4216"><a href="#Project-4216"><span class="linenos">4216</span></a><span class="sd">            a dictionary where keys are clip ids and values are framewise score tensors</span>
</span><span id="Project-4217"><a href="#Project-4217"><span class="linenos">4217</span></a><span class="sd">        n_frames : int</span>
</span><span id="Project-4218"><a href="#Project-4218"><span class="linenos">4218</span></a><span class="sd">            the number of frames to &quot;annotate&quot;</span>
</span><span id="Project-4219"><a href="#Project-4219"><span class="linenos">4219</span></a><span class="sd">        min_length : int</span>
</span><span id="Project-4220"><a href="#Project-4220"><span class="linenos">4220</span></a><span class="sd">            the minimum length of the annotated intervals</span>
</span><span id="Project-4221"><a href="#Project-4221"><span class="linenos">4221</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4222"><a href="#Project-4222"><span class="linenos">4222</span></a>
</span><span id="Project-4223"><a href="#Project-4223"><span class="linenos">4223</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_mask</span><span class="p">(</span><span class="n">mask_name</span><span class="p">)</span>
</span><span id="Project-4224"><a href="#Project-4224"><span class="linenos">4224</span></a>        <span class="n">video_intervals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_intervals</span><span class="p">()</span>
</span><span id="Project-4225"><a href="#Project-4225"><span class="linenos">4225</span></a>        <span class="n">masked</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project-4226"><a href="#Project-4226"><span class="linenos">4226</span></a>            <span class="n">video_id</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span> <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="Project-4227"><a href="#Project-4227"><span class="linenos">4227</span></a>        <span class="p">}</span>
</span><span id="Project-4228"><a href="#Project-4228"><span class="linenos">4228</span></a>        <span class="n">total_masked</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-4229"><a href="#Project-4229"><span class="linenos">4229</span></a>        <span class="n">total_all</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-4230"><a href="#Project-4230"><span class="linenos">4230</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">:</span>
</span><span id="Project-4231"><a href="#Project-4231"><span class="linenos">4231</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="Project-4232"><a href="#Project-4232"><span class="linenos">4232</span></a>                <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="Project-4233"><a href="#Project-4233"><span class="linenos">4233</span></a>                    <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_len</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">)</span>
</span><span id="Project-4234"><a href="#Project-4234"><span class="linenos">4234</span></a>                <span class="p">)</span>
</span><span id="Project-4235"><a href="#Project-4235"><span class="linenos">4235</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Project-4236"><a href="#Project-4236"><span class="linenos">4236</span></a>                    <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">]</span>
</span><span id="Project-4237"><a href="#Project-4237"><span class="linenos">4237</span></a>                    <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]</span>
</span><span id="Project-4238"><a href="#Project-4238"><span class="linenos">4238</span></a>                <span class="p">):</span>
</span><span id="Project-4239"><a href="#Project-4239"><span class="linenos">4239</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="Project-4240"><a href="#Project-4240"><span class="linenos">4240</span></a>                        <span class="n">score_tensors</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
</span><span id="Project-4241"><a href="#Project-4241"><span class="linenos">4241</span></a>                        <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Project-4242"><a href="#Project-4242"><span class="linenos">4242</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Project-4243"><a href="#Project-4243"><span class="linenos">4243</span></a>                    <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">]</span>
</span><span id="Project-4244"><a href="#Project-4244"><span class="linenos">4244</span></a>                    <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]</span>
</span><span id="Project-4245"><a href="#Project-4245"><span class="linenos">4245</span></a>                <span class="p">):</span>
</span><span id="Project-4246"><a href="#Project-4246"><span class="linenos">4246</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="Project-4247"><a href="#Project-4247"><span class="linenos">4247</span></a>                        <span class="n">score_tensors</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
</span><span id="Project-4248"><a href="#Project-4248"><span class="linenos">4248</span></a>                        <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Project-4249"><a href="#Project-4249"><span class="linenos">4249</span></a>                <span class="n">total_all</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Project-4250"><a href="#Project-4250"><span class="linenos">4250</span></a>                <span class="k">if</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="Project-4251"><a href="#Project-4251"><span class="linenos">4251</span></a>                    <span class="c1"># print(f&#39;{real_lens[&quot;masked&quot;][video_id][clip_id]=}&#39;)</span>
</span><span id="Project-4252"><a href="#Project-4252"><span class="linenos">4252</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="Project-4253"><a href="#Project-4253"><span class="linenos">4253</span></a>                        <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Project-4254"><a href="#Project-4254"><span class="linenos">4254</span></a>                        <span class="n">total_masked</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="Project-4255"><a href="#Project-4255"><span class="linenos">4255</span></a>        <span class="n">old_n_frames</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="Project-4256"><a href="#Project-4256"><span class="linenos">4256</span></a>            <span class="p">[(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">masked</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span><span id="Project-4257"><a href="#Project-4257"><span class="linenos">4257</span></a>        <span class="p">)</span>
</span><span id="Project-4258"><a href="#Project-4258"><span class="linenos">4258</span></a>        <span class="n">n_frames</span> <span class="o">=</span> <span class="n">old_n_frames</span> <span class="o">+</span> <span class="n">n_frames</span>
</span><span id="Project-4259"><a href="#Project-4259"><span class="linenos">4259</span></a>        <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Project-4260"><a href="#Project-4260"><span class="linenos">4260</span></a>        <span class="k">while</span> <span class="p">(</span>
</span><span id="Project-4261"><a href="#Project-4261"><span class="linenos">4261</span></a>            <span class="nb">sum</span><span class="p">([(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">masked</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</span><span id="Project-4262"><a href="#Project-4262"><span class="linenos">4262</span></a>            <span class="o">&lt;</span> <span class="n">n_frames</span>
</span><span id="Project-4263"><a href="#Project-4263"><span class="linenos">4263</span></a>        <span class="p">):</span>
</span><span id="Project-4264"><a href="#Project-4264"><span class="linenos">4264</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Project-4265"><a href="#Project-4265"><span class="linenos">4265</span></a>                <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Project-4266"><a href="#Project-4266"><span class="linenos">4266</span></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="Project-4267"><a href="#Project-4267"><span class="linenos">4267</span></a>                        <span class="p">[</span>
</span><span id="Project-4268"><a href="#Project-4268"><span class="linenos">4268</span></a>                            <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="Project-4269"><a href="#Project-4269"><span class="linenos">4269</span></a>                                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
</span><span id="Project-4270"><a href="#Project-4270"><span class="linenos">4270</span></a>                            <span class="p">)</span>
</span><span id="Project-4271"><a href="#Project-4271"><span class="linenos">4271</span></a>                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">score_tensors</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Project-4272"><a href="#Project-4272"><span class="linenos">4272</span></a>                        <span class="p">]</span>
</span><span id="Project-4273"><a href="#Project-4273"><span class="linenos">4273</span></a>                    <span class="p">)</span>
</span><span id="Project-4274"><a href="#Project-4274"><span class="linenos">4274</span></a>                <span class="p">)</span>
</span><span id="Project-4275"><a href="#Project-4275"><span class="linenos">4275</span></a>            <span class="p">)</span>
</span><span id="Project-4276"><a href="#Project-4276"><span class="linenos">4276</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">factor</span>
</span><span id="Project-4277"><a href="#Project-4277"><span class="linenos">4277</span></a>            <span class="n">intervals</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-4278"><a href="#Project-4278"><span class="linenos">4278</span></a>            <span class="n">interval_scores</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-4279"><a href="#Project-4279"><span class="linenos">4279</span></a>            <span class="n">key1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">score_tensors</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-4280"><a href="#Project-4280"><span class="linenos">4280</span></a>            <span class="n">key2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">score_tensors</span><span class="p">[</span><span class="n">key1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-4281"><a href="#Project-4281"><span class="linenos">4281</span></a>            <span class="n">num_scores</span> <span class="o">=</span> <span class="n">score_tensors</span><span class="p">[</span><span class="n">key1</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-4282"><a href="#Project-4282"><span class="linenos">4282</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_scores</span><span class="p">):</span>
</span><span id="Project-4283"><a href="#Project-4283"><span class="linenos">4283</span></a>                <span class="n">v_dict</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_valleys</span><span class="p">(</span>
</span><span id="Project-4284"><a href="#Project-4284"><span class="linenos">4284</span></a>                    <span class="n">predicted</span><span class="o">=</span><span class="n">score_tensors</span><span class="p">,</span>
</span><span id="Project-4285"><a href="#Project-4285"><span class="linenos">4285</span></a>                    <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
</span><span id="Project-4286"><a href="#Project-4286"><span class="linenos">4286</span></a>                    <span class="n">min_frames</span><span class="o">=</span><span class="n">min_length</span><span class="p">,</span>
</span><span id="Project-4287"><a href="#Project-4287"><span class="linenos">4287</span></a>                    <span class="n">main_class</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
</span><span id="Project-4288"><a href="#Project-4288"><span class="linenos">4288</span></a>                    <span class="n">low</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Project-4289"><a href="#Project-4289"><span class="linenos">4289</span></a>                <span class="p">)</span>
</span><span id="Project-4290"><a href="#Project-4290"><span class="linenos">4290</span></a>                <span class="k">for</span> <span class="n">v_id</span><span class="p">,</span> <span class="n">interval_list</span> <span class="ow">in</span> <span class="n">v_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-4291"><a href="#Project-4291"><span class="linenos">4291</span></a>                    <span class="n">intervals</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">[</span><span class="n">v_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">interval_list</span><span class="p">]</span>
</span><span id="Project-4292"><a href="#Project-4292"><span class="linenos">4292</span></a>                    <span class="n">interval_scores</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Project-4293"><a href="#Project-4293"><span class="linenos">4293</span></a>                        <span class="nb">float</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">score_tensors</span><span class="p">[</span><span class="n">v_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]))</span>
</span><span id="Project-4294"><a href="#Project-4294"><span class="linenos">4294</span></a>                        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">interval_list</span>
</span><span id="Project-4295"><a href="#Project-4295"><span class="linenos">4295</span></a>                    <span class="p">]</span>
</span><span id="Project-4296"><a href="#Project-4296"><span class="linenos">4296</span></a>            <span class="n">intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intervals</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">interval_scores</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="Project-4297"><a href="#Project-4297"><span class="linenos">4297</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-4298"><a href="#Project-4298"><span class="linenos">4298</span></a>            <span class="k">while</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="Project-4299"><a href="#Project-4299"><span class="linenos">4299</span></a>                <span class="p">[(</span><span class="n">vv</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">masked</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
</span><span id="Project-4300"><a href="#Project-4300"><span class="linenos">4300</span></a>            <span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_frames</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
</span><span id="Project-4301"><a href="#Project-4301"><span class="linenos">4301</span></a>                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">,</span> <span class="n">video_id</span> <span class="o">=</span> <span class="n">intervals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Project-4302"><a href="#Project-4302"><span class="linenos">4302</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Project-4303"><a href="#Project-4303"><span class="linenos">4303</span></a>                <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-4304"><a href="#Project-4304"><span class="linenos">4304</span></a>            <span class="n">factor</span> <span class="o">*=</span> <span class="mf">0.9</span>
</span><span id="Project-4305"><a href="#Project-4305"><span class="linenos">4305</span></a>            <span class="k">if</span> <span class="n">factor</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
</span><span id="Project-4306"><a href="#Project-4306"><span class="linenos">4306</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find enough frames!&quot;</span><span class="p">)</span>
</span><span id="Project-4307"><a href="#Project-4307"><span class="linenos">4307</span></a>                <span class="k">break</span>
</span><span id="Project-4308"><a href="#Project-4308"><span class="linenos">4308</span></a>        <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">video_id</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">video_intervals</span><span class="p">}</span>
</span><span id="Project-4309"><a href="#Project-4309"><span class="linenos">4309</span></a>        <span class="n">total_masked_new</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-4310"><a href="#Project-4310"><span class="linenos">4310</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">masked</span><span class="p">:</span>
</span><span id="Project-4311"><a href="#Project-4311"><span class="linenos">4311</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="Project-4312"><a href="#Project-4312"><span class="linenos">4312</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Project-4313"><a href="#Project-4313"><span class="linenos">4313</span></a>                    <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">]</span>
</span><span id="Project-4314"><a href="#Project-4314"><span class="linenos">4314</span></a>                    <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]</span>
</span><span id="Project-4315"><a href="#Project-4315"><span class="linenos">4315</span></a>                <span class="p">):</span>
</span><span id="Project-4316"><a href="#Project-4316"><span class="linenos">4316</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;unannotated&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="Project-4317"><a href="#Project-4317"><span class="linenos">4317</span></a>                        <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-4318"><a href="#Project-4318"><span class="linenos">4318</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="Project-4319"><a href="#Project-4319"><span class="linenos">4319</span></a>                    <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">]</span>
</span><span id="Project-4320"><a href="#Project-4320"><span class="linenos">4320</span></a>                    <span class="ow">and</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]</span>
</span><span id="Project-4321"><a href="#Project-4321"><span class="linenos">4321</span></a>                <span class="p">):</span>
</span><span id="Project-4322"><a href="#Project-4322"><span class="linenos">4322</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;val_intervals&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="Project-4323"><a href="#Project-4323"><span class="linenos">4323</span></a>                        <span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project-4324"><a href="#Project-4324"><span class="linenos">4324</span></a>                <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">masked</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-4325"><a href="#Project-4325"><span class="linenos">4325</span></a>                <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_intervals</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
</span><span id="Project-4326"><a href="#Project-4326"><span class="linenos">4326</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">]:</span>
</span><span id="Project-4327"><a href="#Project-4327"><span class="linenos">4327</span></a>            <span class="k">for</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="Project-4328"><a href="#Project-4328"><span class="linenos">4328</span></a>                <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]:</span>
</span><span id="Project-4329"><a href="#Project-4329"><span class="linenos">4329</span></a>                    <span class="n">total_masked_new</span> <span class="o">+=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>
</span><span id="Project-4330"><a href="#Project-4330"><span class="linenos">4330</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask_name</span><span class="p">)</span>
</span><span id="Project-4331"><a href="#Project-4331"><span class="linenos">4331</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="Project-4332"><a href="#Project-4332"><span class="linenos">4332</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mask_name</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;a&quot;</span>
</span><span id="Project-4333"><a href="#Project-4333"><span class="linenos">4333</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project-4334"><a href="#Project-4334"><span class="linenos">4334</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;from </span><span class="si">{</span><span class="n">total_masked</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">total_masked_new</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">total_all</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-4335"><a href="#Project-4335"><span class="linenos">4335</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unmasked from </span><span class="si">{</span><span class="n">total_masked</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">total_masked_new</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">total_all</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-4336"><a href="#Project-4336"><span class="linenos">4336</span></a>
</span><span id="Project-4337"><a href="#Project-4337"><span class="linenos">4337</span></a>    <span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span>
</span><span id="Project-4338"><a href="#Project-4338"><span class="linenos">4338</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-4339"><a href="#Project-4339"><span class="linenos">4339</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-4340"><a href="#Project-4340"><span class="linenos">4340</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4341"><a href="#Project-4341"><span class="linenos">4341</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4342"><a href="#Project-4342"><span class="linenos">4342</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span>
</span><span id="Project-4343"><a href="#Project-4343"><span class="linenos">4343</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
</span><span id="Project-4344"><a href="#Project-4344"><span class="linenos">4344</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-4345"><a href="#Project-4345"><span class="linenos">4345</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">]:</span>
</span><span id="Project-4346"><a href="#Project-4346"><span class="linenos">4346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4347"><a href="#Project-4347"><span class="linenos">4347</span></a><span class="sd">        Make a confusion matrix plot and return the data</span>
</span><span id="Project-4348"><a href="#Project-4348"><span class="linenos">4348</span></a>
</span><span id="Project-4349"><a href="#Project-4349"><span class="linenos">4349</span></a><span class="sd">        If the annotation is non-exclusive, only false positive labels are considered.</span>
</span><span id="Project-4350"><a href="#Project-4350"><span class="linenos">4350</span></a>
</span><span id="Project-4351"><a href="#Project-4351"><span class="linenos">4351</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4352"><a href="#Project-4352"><span class="linenos">4352</span></a><span class="sd">        ----------</span>
</span><span id="Project-4353"><a href="#Project-4353"><span class="linenos">4353</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project-4354"><a href="#Project-4354"><span class="linenos">4354</span></a><span class="sd">            the name of the episode to load</span>
</span><span id="Project-4355"><a href="#Project-4355"><span class="linenos">4355</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="Project-4356"><a href="#Project-4356"><span class="linenos">4356</span></a><span class="sd">            the index of the epoch to load (by default the last one is loaded)</span>
</span><span id="Project-4357"><a href="#Project-4357"><span class="linenos">4357</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-4358"><a href="#Project-4358"><span class="linenos">4358</span></a><span class="sd">            a dictionary of parameter updates (only for &quot;data&quot; and &quot;general&quot; categories)</span>
</span><span id="Project-4359"><a href="#Project-4359"><span class="linenos">4359</span></a><span class="sd">        mode : {&#39;val&#39;, &#39;all&#39;, &#39;test&#39;, &#39;train&#39;}</span>
</span><span id="Project-4360"><a href="#Project-4360"><span class="linenos">4360</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None)</span>
</span><span id="Project-4361"><a href="#Project-4361"><span class="linenos">4361</span></a><span class="sd">        type : {&quot;recall&quot;, &quot;precision&quot;}</span>
</span><span id="Project-4362"><a href="#Project-4362"><span class="linenos">4362</span></a><span class="sd">            for datasets with non-exclusive annotation, if `type` is `&quot;recall&quot;`, only false positives are taken</span>
</span><span id="Project-4363"><a href="#Project-4363"><span class="linenos">4363</span></a><span class="sd">            into account, and if `type` is `&quot;precision&quot;`, only false negatives</span>
</span><span id="Project-4364"><a href="#Project-4364"><span class="linenos">4364</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project-4365"><a href="#Project-4365"><span class="linenos">4365</span></a><span class="sd">            if `True`, the dataset that is used for computation is then deleted</span>
</span><span id="Project-4366"><a href="#Project-4366"><span class="linenos">4366</span></a>
</span><span id="Project-4367"><a href="#Project-4367"><span class="linenos">4367</span></a><span class="sd">        Returns</span>
</span><span id="Project-4368"><a href="#Project-4368"><span class="linenos">4368</span></a><span class="sd">        -------</span>
</span><span id="Project-4369"><a href="#Project-4369"><span class="linenos">4369</span></a><span class="sd">        confusion_matrix : np.ndarray</span>
</span><span id="Project-4370"><a href="#Project-4370"><span class="linenos">4370</span></a><span class="sd">            a confusion matrix of shape `(#classes, #classes)` where `A[i, j] = F_ij/N_i`, `F_ij` is the number of</span>
</span><span id="Project-4371"><a href="#Project-4371"><span class="linenos">4371</span></a><span class="sd">            frames that have the i-th label in the ground truth and a false positive j-th label in the prediction,</span>
</span><span id="Project-4372"><a href="#Project-4372"><span class="linenos">4372</span></a><span class="sd">            `N_i` is the number of frames that have the i-th label in the ground truth</span>
</span><span id="Project-4373"><a href="#Project-4373"><span class="linenos">4373</span></a><span class="sd">        classes : list</span>
</span><span id="Project-4374"><a href="#Project-4374"><span class="linenos">4374</span></a><span class="sd">            a list of labels</span>
</span><span id="Project-4375"><a href="#Project-4375"><span class="linenos">4375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4376"><a href="#Project-4376"><span class="linenos">4376</span></a>
</span><span id="Project-4377"><a href="#Project-4377"><span class="linenos">4377</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project-4378"><a href="#Project-4378"><span class="linenos">4378</span></a>            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project-4379"><a href="#Project-4379"><span class="linenos">4379</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-4380"><a href="#Project-4380"><span class="linenos">4380</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-4381"><a href="#Project-4381"><span class="linenos">4381</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-4382"><a href="#Project-4382"><span class="linenos">4382</span></a>            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project-4383"><a href="#Project-4383"><span class="linenos">4383</span></a>        <span class="p">)</span>
</span><span id="Project-4384"><a href="#Project-4384"><span class="linenos">4384</span></a>        <span class="n">dataset</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project-4385"><a href="#Project-4385"><span class="linenos">4385</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">raw_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Project-4386"><a href="#Project-4386"><span class="linenos">4386</span></a>        <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_confusion_matrix</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="Project-4387"><a href="#Project-4387"><span class="linenos">4387</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project-4388"><a href="#Project-4388"><span class="linenos">4388</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-4389"><a href="#Project-4389"><span class="linenos">4389</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)))</span>
</span><span id="Project-4390"><a href="#Project-4390"><span class="linenos">4390</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">)</span>
</span><span id="Project-4391"><a href="#Project-4391"><span class="linenos">4391</span></a>        <span class="c1"># Show all ticks and label them with the respective list entries</span>
</span><span id="Project-4392"><a href="#Project-4392"><span class="linenos">4392</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)))</span>
</span><span id="Project-4393"><a href="#Project-4393"><span class="linenos">4393</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
</span><span id="Project-4394"><a href="#Project-4394"><span class="linenos">4394</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)))</span>
</span><span id="Project-4395"><a href="#Project-4395"><span class="linenos">4395</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
</span><span id="Project-4396"><a href="#Project-4396"><span class="linenos">4396</span></a>        <span class="c1"># Rotate the tick labels and set their alignment.</span>
</span><span id="Project-4397"><a href="#Project-4397"><span class="linenos">4397</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>
</span><span id="Project-4398"><a href="#Project-4398"><span class="linenos">4398</span></a>        <span class="c1"># Loop over data dimensions and create text annotations.</span>
</span><span id="Project-4399"><a href="#Project-4399"><span class="linenos">4399</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
</span><span id="Project-4400"><a href="#Project-4400"><span class="linenos">4400</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
</span><span id="Project-4401"><a href="#Project-4401"><span class="linenos">4401</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="Project-4402"><a href="#Project-4402"><span class="linenos">4402</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="Project-4403"><a href="#Project-4403"><span class="linenos">4403</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Project-4404"><a href="#Project-4404"><span class="linenos">4404</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Project-4405"><a href="#Project-4405"><span class="linenos">4405</span></a>                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="Project-4406"><a href="#Project-4406"><span class="linenos">4406</span></a>                    <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="Project-4407"><a href="#Project-4407"><span class="linenos">4407</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
</span><span id="Project-4408"><a href="#Project-4408"><span class="linenos">4408</span></a>                <span class="p">)</span>
</span><span id="Project-4409"><a href="#Project-4409"><span class="linenos">4409</span></a>        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-4410"><a href="#Project-4410"><span class="linenos">4410</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-4411"><a href="#Project-4411"><span class="linenos">4411</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-4412"><a href="#Project-4412"><span class="linenos">4412</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-4413"><a href="#Project-4413"><span class="linenos">4413</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Project-4414"><a href="#Project-4414"><span class="linenos">4414</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Project-4415"><a href="#Project-4415"><span class="linenos">4415</span></a>        <span class="k">return</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classes</span>
</span><span id="Project-4416"><a href="#Project-4416"><span class="linenos">4416</span></a>
</span><span id="Project-4417"><a href="#Project-4417"><span class="linenos">4417</span></a>    <span class="k">def</span> <span class="nf">plot_predictions</span><span class="p">(</span>
</span><span id="Project-4418"><a href="#Project-4418"><span class="linenos">4418</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-4419"><a href="#Project-4419"><span class="linenos">4419</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-4420"><a href="#Project-4420"><span class="linenos">4420</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4421"><a href="#Project-4421"><span class="linenos">4421</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4422"><a href="#Project-4422"><span class="linenos">4422</span></a>        <span class="n">add_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-4423"><a href="#Project-4423"><span class="linenos">4423</span></a>        <span class="n">ground_truth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project-4424"><a href="#Project-4424"><span class="linenos">4424</span></a>        <span class="n">colormap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
</span><span id="Project-4425"><a href="#Project-4425"><span class="linenos">4425</span></a>        <span class="n">hide_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-4426"><a href="#Project-4426"><span class="linenos">4426</span></a>        <span class="n">min_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project-4427"><a href="#Project-4427"><span class="linenos">4427</span></a>        <span class="n">width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Project-4428"><a href="#Project-4428"><span class="linenos">4428</span></a>        <span class="n">whole_video</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-4429"><a href="#Project-4429"><span class="linenos">4429</span></a>        <span class="n">transparent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-4430"><a href="#Project-4430"><span class="linenos">4430</span></a>        <span class="n">drop_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4431"><a href="#Project-4431"><span class="linenos">4431</span></a>        <span class="n">search_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4432"><a href="#Project-4432"><span class="linenos">4432</span></a>        <span class="n">num_plots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project-4433"><a href="#Project-4433"><span class="linenos">4433</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-4434"><a href="#Project-4434"><span class="linenos">4434</span></a>        <span class="n">smooth_interval_prediction</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project-4435"><a href="#Project-4435"><span class="linenos">4435</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4436"><a href="#Project-4436"><span class="linenos">4436</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4437"><a href="#Project-4437"><span class="linenos">4437</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
</span><span id="Project-4438"><a href="#Project-4438"><span class="linenos">4438</span></a>        <span class="n">behavior_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4439"><a href="#Project-4439"><span class="linenos">4439</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-4440"><a href="#Project-4440"><span class="linenos">4440</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4441"><a href="#Project-4441"><span class="linenos">4441</span></a><span class="sd">        Visualize random predictions</span>
</span><span id="Project-4442"><a href="#Project-4442"><span class="linenos">4442</span></a>
</span><span id="Project-4443"><a href="#Project-4443"><span class="linenos">4443</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4444"><a href="#Project-4444"><span class="linenos">4444</span></a><span class="sd">        ----------</span>
</span><span id="Project-4445"><a href="#Project-4445"><span class="linenos">4445</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project-4446"><a href="#Project-4446"><span class="linenos">4446</span></a><span class="sd">            the name of the episode to load</span>
</span><span id="Project-4447"><a href="#Project-4447"><span class="linenos">4447</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="Project-4448"><a href="#Project-4448"><span class="linenos">4448</span></a><span class="sd">            the epoch to load (by default last)</span>
</span><span id="Project-4449"><a href="#Project-4449"><span class="linenos">4449</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project-4450"><a href="#Project-4450"><span class="linenos">4450</span></a><span class="sd">            parameter update dictionary</span>
</span><span id="Project-4451"><a href="#Project-4451"><span class="linenos">4451</span></a><span class="sd">        add_legend : bool, default True</span>
</span><span id="Project-4452"><a href="#Project-4452"><span class="linenos">4452</span></a><span class="sd">            if True, legend will be added to the plot</span>
</span><span id="Project-4453"><a href="#Project-4453"><span class="linenos">4453</span></a><span class="sd">        ground_truth : bool, default True</span>
</span><span id="Project-4454"><a href="#Project-4454"><span class="linenos">4454</span></a><span class="sd">            if True, ground truth will be added to the plot</span>
</span><span id="Project-4455"><a href="#Project-4455"><span class="linenos">4455</span></a><span class="sd">        colormap : str, default &#39;Accent&#39;</span>
</span><span id="Project-4456"><a href="#Project-4456"><span class="linenos">4456</span></a><span class="sd">            the `matplotlib` colormap to use</span>
</span><span id="Project-4457"><a href="#Project-4457"><span class="linenos">4457</span></a><span class="sd">        hide_axes : bool, default True</span>
</span><span id="Project-4458"><a href="#Project-4458"><span class="linenos">4458</span></a><span class="sd">            if `True`, the axes will be hidden on the plot</span>
</span><span id="Project-4459"><a href="#Project-4459"><span class="linenos">4459</span></a><span class="sd">        min_classes : int, default 1</span>
</span><span id="Project-4460"><a href="#Project-4460"><span class="linenos">4460</span></a><span class="sd">            the minimum number of classes in a displayed interval</span>
</span><span id="Project-4461"><a href="#Project-4461"><span class="linenos">4461</span></a><span class="sd">        width : float, default 10</span>
</span><span id="Project-4462"><a href="#Project-4462"><span class="linenos">4462</span></a><span class="sd">            the width of the plot</span>
</span><span id="Project-4463"><a href="#Project-4463"><span class="linenos">4463</span></a><span class="sd">        whole_video : bool, default False</span>
</span><span id="Project-4464"><a href="#Project-4464"><span class="linenos">4464</span></a><span class="sd">            if `True`, whole videos are plotted instead of segments</span>
</span><span id="Project-4465"><a href="#Project-4465"><span class="linenos">4465</span></a><span class="sd">        transparent : bool, default False</span>
</span><span id="Project-4466"><a href="#Project-4466"><span class="linenos">4466</span></a><span class="sd">            if `True`, the background on the plot is transparent</span>
</span><span id="Project-4467"><a href="#Project-4467"><span class="linenos">4467</span></a><span class="sd">        drop_classes : set, optional</span>
</span><span id="Project-4468"><a href="#Project-4468"><span class="linenos">4468</span></a><span class="sd">            a set of class names to not be displayed</span>
</span><span id="Project-4469"><a href="#Project-4469"><span class="linenos">4469</span></a><span class="sd">        search_classes : set, optional</span>
</span><span id="Project-4470"><a href="#Project-4470"><span class="linenos">4470</span></a><span class="sd">            if given, only intervals where at least one of the classes is in ground truth will be shown</span>
</span><span id="Project-4471"><a href="#Project-4471"><span class="linenos">4471</span></a><span class="sd">        num_plots : int, default 1</span>
</span><span id="Project-4472"><a href="#Project-4472"><span class="linenos">4472</span></a><span class="sd">            the number of plots to make</span>
</span><span id="Project-4473"><a href="#Project-4473"><span class="linenos">4473</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project-4474"><a href="#Project-4474"><span class="linenos">4474</span></a><span class="sd">            if `True`, the dataset will be deleted after computation</span>
</span><span id="Project-4475"><a href="#Project-4475"><span class="linenos">4475</span></a><span class="sd">        smooth_interval_prediction : int, default 0</span>
</span><span id="Project-4476"><a href="#Project-4476"><span class="linenos">4476</span></a><span class="sd">            if &gt;0, predictions shorter than this number of frames are removed (filled with prediction for the previous frame)</span>
</span><span id="Project-4477"><a href="#Project-4477"><span class="linenos">4477</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="Project-4478"><a href="#Project-4478"><span class="linenos">4478</span></a><span class="sd">            the data path to run the prediction for</span>
</span><span id="Project-4479"><a href="#Project-4479"><span class="linenos">4479</span></a><span class="sd">        mode : {&#39;all&#39;, &#39;test&#39;, &#39;val&#39;, &#39;train&#39;}</span>
</span><span id="Project-4480"><a href="#Project-4480"><span class="linenos">4480</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None)</span>
</span><span id="Project-4481"><a href="#Project-4481"><span class="linenos">4481</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="Project-4482"><a href="#Project-4482"><span class="linenos">4482</span></a><span class="sd">            a set of string file paths (data with all prefixes + feature files, in any order) to run the prediction</span>
</span><span id="Project-4483"><a href="#Project-4483"><span class="linenos">4483</span></a><span class="sd">            for</span>
</span><span id="Project-4484"><a href="#Project-4484"><span class="linenos">4484</span></a><span class="sd">        behavior_name : str, optional</span>
</span><span id="Project-4485"><a href="#Project-4485"><span class="linenos">4485</span></a><span class="sd">            for non-exclusive classificaton datasets, choose which behavior to visualize (by default first in list)</span>
</span><span id="Project-4486"><a href="#Project-4486"><span class="linenos">4486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4487"><a href="#Project-4487"><span class="linenos">4487</span></a>
</span><span id="Project-4488"><a href="#Project-4488"><span class="linenos">4488</span></a>        <span class="n">other_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">)</span>
</span><span id="Project-4489"><a href="#Project-4489"><span class="linenos">4489</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project-4490"><a href="#Project-4490"><span class="linenos">4490</span></a>            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project-4491"><a href="#Project-4491"><span class="linenos">4491</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project-4492"><a href="#Project-4492"><span class="linenos">4492</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project-4493"><a href="#Project-4493"><span class="linenos">4493</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project-4494"><a href="#Project-4494"><span class="linenos">4494</span></a>            <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-4495"><a href="#Project-4495"><span class="linenos">4495</span></a>            <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project-4496"><a href="#Project-4496"><span class="linenos">4496</span></a>            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project-4497"><a href="#Project-4497"><span class="linenos">4497</span></a>        <span class="p">)</span>
</span><span id="Project-4498"><a href="#Project-4498"><span class="linenos">4498</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">other_path</span><span class="p">):</span>
</span><span id="Project-4499"><a href="#Project-4499"><span class="linenos">4499</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">other_path</span><span class="p">)</span>
</span><span id="Project-4500"><a href="#Project-4500"><span class="linenos">4500</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_plots</span><span class="p">):</span>
</span><span id="Project-4501"><a href="#Project-4501"><span class="linenos">4501</span></a>            <span class="n">task</span><span class="o">.</span><span class="n">visualize_results</span><span class="p">(</span>
</span><span id="Project-4502"><a href="#Project-4502"><span class="linenos">4502</span></a>                <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-4503"><a href="#Project-4503"><span class="linenos">4503</span></a>                    <span class="n">other_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">_prediction_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.jpg&quot;</span>
</span><span id="Project-4504"><a href="#Project-4504"><span class="linenos">4504</span></a>                <span class="p">),</span>
</span><span id="Project-4505"><a href="#Project-4505"><span class="linenos">4505</span></a>                <span class="n">add_legend</span><span class="o">=</span><span class="n">add_legend</span><span class="p">,</span>
</span><span id="Project-4506"><a href="#Project-4506"><span class="linenos">4506</span></a>                <span class="n">ground_truth</span><span class="o">=</span><span class="n">ground_truth</span><span class="p">,</span>
</span><span id="Project-4507"><a href="#Project-4507"><span class="linenos">4507</span></a>                <span class="n">colormap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span>
</span><span id="Project-4508"><a href="#Project-4508"><span class="linenos">4508</span></a>                <span class="n">hide_axes</span><span class="o">=</span><span class="n">hide_axes</span><span class="p">,</span>
</span><span id="Project-4509"><a href="#Project-4509"><span class="linenos">4509</span></a>                <span class="n">min_classes</span><span class="o">=</span><span class="n">min_classes</span><span class="p">,</span>
</span><span id="Project-4510"><a href="#Project-4510"><span class="linenos">4510</span></a>                <span class="n">whole_video</span><span class="o">=</span><span class="n">whole_video</span><span class="p">,</span>
</span><span id="Project-4511"><a href="#Project-4511"><span class="linenos">4511</span></a>                <span class="n">transparent</span><span class="o">=</span><span class="n">transparent</span><span class="p">,</span>
</span><span id="Project-4512"><a href="#Project-4512"><span class="linenos">4512</span></a>                <span class="n">dataset</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project-4513"><a href="#Project-4513"><span class="linenos">4513</span></a>                <span class="n">drop_classes</span><span class="o">=</span><span class="n">drop_classes</span><span class="p">,</span>
</span><span id="Project-4514"><a href="#Project-4514"><span class="linenos">4514</span></a>                <span class="n">search_classes</span><span class="o">=</span><span class="n">search_classes</span><span class="p">,</span>
</span><span id="Project-4515"><a href="#Project-4515"><span class="linenos">4515</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="Project-4516"><a href="#Project-4516"><span class="linenos">4516</span></a>                <span class="n">smooth_interval_prediction</span><span class="o">=</span><span class="n">smooth_interval_prediction</span><span class="p">,</span>
</span><span id="Project-4517"><a href="#Project-4517"><span class="linenos">4517</span></a>                <span class="n">behavior_name</span><span class="o">=</span><span class="n">behavior_name</span><span class="p">,</span>
</span><span id="Project-4518"><a href="#Project-4518"><span class="linenos">4518</span></a>            <span class="p">)</span>
</span><span id="Project-4519"><a href="#Project-4519"><span class="linenos">4519</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project-4520"><a href="#Project-4520"><span class="linenos">4520</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project-4521"><a href="#Project-4521"><span class="linenos">4521</span></a>
</span><span id="Project-4522"><a href="#Project-4522"><span class="linenos">4522</span></a>    <span class="k">def</span> <span class="nf">create_metadata_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-4523"><a href="#Project-4523"><span class="linenos">4523</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4524"><a href="#Project-4524"><span class="linenos">4524</span></a><span class="sd">        Create a copy of the meta files</span>
</span><span id="Project-4525"><a href="#Project-4525"><span class="linenos">4525</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4526"><a href="#Project-4526"><span class="linenos">4526</span></a>
</span><span id="Project-4527"><a href="#Project-4527"><span class="linenos">4527</span></a>        <span class="n">meta_copy_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;backup&quot;</span><span class="p">)</span>
</span><span id="Project-4528"><a href="#Project-4528"><span class="linenos">4528</span></a>        <span class="n">meta_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">)</span>
</span><span id="Project-4529"><a href="#Project-4529"><span class="linenos">4529</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">):</span>
</span><span id="Project-4530"><a href="#Project-4530"><span class="linenos">4530</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">)</span>
</span><span id="Project-4531"><a href="#Project-4531"><span class="linenos">4531</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">)</span>
</span><span id="Project-4532"><a href="#Project-4532"><span class="linenos">4532</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">meta_path</span><span class="p">):</span>
</span><span id="Project-4533"><a href="#Project-4533"><span class="linenos">4533</span></a>            <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;backup&quot;</span><span class="p">:</span>
</span><span id="Project-4534"><a href="#Project-4534"><span class="linenos">4534</span></a>                <span class="k">continue</span>
</span><span id="Project-4535"><a href="#Project-4535"><span class="linenos">4535</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="Project-4536"><a href="#Project-4536"><span class="linenos">4536</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="Project-4537"><a href="#Project-4537"><span class="linenos">4537</span></a>            <span class="p">)</span>
</span><span id="Project-4538"><a href="#Project-4538"><span class="linenos">4538</span></a>
</span><span id="Project-4539"><a href="#Project-4539"><span class="linenos">4539</span></a>    <span class="k">def</span> <span class="nf">load_metadata_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-4540"><a href="#Project-4540"><span class="linenos">4540</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4541"><a href="#Project-4541"><span class="linenos">4541</span></a><span class="sd">        Load from previously created meta data backup (in case of corruption)</span>
</span><span id="Project-4542"><a href="#Project-4542"><span class="linenos">4542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4543"><a href="#Project-4543"><span class="linenos">4543</span></a>
</span><span id="Project-4544"><a href="#Project-4544"><span class="linenos">4544</span></a>        <span class="n">meta_copy_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;backup&quot;</span><span class="p">)</span>
</span><span id="Project-4545"><a href="#Project-4545"><span class="linenos">4545</span></a>        <span class="n">meta_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">)</span>
</span><span id="Project-4546"><a href="#Project-4546"><span class="linenos">4546</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">):</span>
</span><span id="Project-4547"><a href="#Project-4547"><span class="linenos">4547</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="Project-4548"><a href="#Project-4548"><span class="linenos">4548</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="Project-4549"><a href="#Project-4549"><span class="linenos">4549</span></a>            <span class="p">)</span>
</span><span id="Project-4550"><a href="#Project-4550"><span class="linenos">4550</span></a>
</span><span id="Project-4551"><a href="#Project-4551"><span class="linenos">4551</span></a>    <span class="k">def</span> <span class="nf">get_behavior_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project-4552"><a href="#Project-4552"><span class="linenos">4552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4553"><a href="#Project-4553"><span class="linenos">4553</span></a><span class="sd">        Get the behavior dictionary for an episode</span>
</span><span id="Project-4554"><a href="#Project-4554"><span class="linenos">4554</span></a>
</span><span id="Project-4555"><a href="#Project-4555"><span class="linenos">4555</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4556"><a href="#Project-4556"><span class="linenos">4556</span></a><span class="sd">        ----------</span>
</span><span id="Project-4557"><a href="#Project-4557"><span class="linenos">4557</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project-4558"><a href="#Project-4558"><span class="linenos">4558</span></a><span class="sd">            the name of the episode</span>
</span><span id="Project-4559"><a href="#Project-4559"><span class="linenos">4559</span></a>
</span><span id="Project-4560"><a href="#Project-4560"><span class="linenos">4560</span></a><span class="sd">        Returns</span>
</span><span id="Project-4561"><a href="#Project-4561"><span class="linenos">4561</span></a><span class="sd">        -------</span>
</span><span id="Project-4562"><a href="#Project-4562"><span class="linenos">4562</span></a><span class="sd">        behaviors_dictionary : dict</span>
</span><span id="Project-4563"><a href="#Project-4563"><span class="linenos">4563</span></a><span class="sd">            a dictionary where keys are label indices and values are label names</span>
</span><span id="Project-4564"><a href="#Project-4564"><span class="linenos">4564</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4565"><a href="#Project-4565"><span class="linenos">4565</span></a>
</span><span id="Project-4566"><a href="#Project-4566"><span class="linenos">4566</span></a>        <span class="n">run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project-4567"><a href="#Project-4567"><span class="linenos">4567</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_behaviors_dict</span><span class="p">()</span>
</span><span id="Project-4568"><a href="#Project-4568"><span class="linenos">4568</span></a>
</span><span id="Project-4569"><a href="#Project-4569"><span class="linenos">4569</span></a>    <span class="k">def</span> <span class="nf">import_episodes</span><span class="p">(</span>
</span><span id="Project-4570"><a href="#Project-4570"><span class="linenos">4570</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-4571"><a href="#Project-4571"><span class="linenos">4571</span></a>        <span class="n">episodes_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project-4572"><a href="#Project-4572"><span class="linenos">4572</span></a>        <span class="n">name_map</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4573"><a href="#Project-4573"><span class="linenos">4573</span></a>        <span class="n">repeat_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="Project-4574"><a href="#Project-4574"><span class="linenos">4574</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-4575"><a href="#Project-4575"><span class="linenos">4575</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4576"><a href="#Project-4576"><span class="linenos">4576</span></a><span class="sd">        Import episodes exported with `Project.export_episodes`</span>
</span><span id="Project-4577"><a href="#Project-4577"><span class="linenos">4577</span></a>
</span><span id="Project-4578"><a href="#Project-4578"><span class="linenos">4578</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4579"><a href="#Project-4579"><span class="linenos">4579</span></a><span class="sd">        ----------</span>
</span><span id="Project-4580"><a href="#Project-4580"><span class="linenos">4580</span></a><span class="sd">        episodes_directory : str</span>
</span><span id="Project-4581"><a href="#Project-4581"><span class="linenos">4581</span></a><span class="sd">            the path to the exported episodes directory</span>
</span><span id="Project-4582"><a href="#Project-4582"><span class="linenos">4582</span></a><span class="sd">        name_map : dict</span>
</span><span id="Project-4583"><a href="#Project-4583"><span class="linenos">4583</span></a><span class="sd">            a name change dictionary for the episodes: keys are old names, values are new names</span>
</span><span id="Project-4584"><a href="#Project-4584"><span class="linenos">4584</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4585"><a href="#Project-4585"><span class="linenos">4585</span></a>
</span><span id="Project-4586"><a href="#Project-4586"><span class="linenos">4586</span></a>        <span class="k">if</span> <span class="n">name_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-4587"><a href="#Project-4587"><span class="linenos">4587</span></a>            <span class="n">name_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-4588"><a href="#Project-4588"><span class="linenos">4588</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">episodes_directory</span><span class="p">,</span> <span class="s2">&quot;episodes.pickle&quot;</span><span class="p">))</span>
</span><span id="Project-4589"><a href="#Project-4589"><span class="linenos">4589</span></a>        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-4590"><a href="#Project-4590"><span class="linenos">4590</span></a>        <span class="n">import_string</span> <span class="o">=</span> <span class="s2">&quot;Imported episodes: &quot;</span>
</span><span id="Project-4591"><a href="#Project-4591"><span class="linenos">4591</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="Project-4592"><a href="#Project-4592"><span class="linenos">4592</span></a>            <span class="k">if</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">name_map</span><span class="p">:</span>
</span><span id="Project-4593"><a href="#Project-4593"><span class="linenos">4593</span></a>                <span class="n">import_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Project-4594"><a href="#Project-4594"><span class="linenos">4594</span></a>                <span class="n">episode_name</span> <span class="o">=</span> <span class="n">name_map</span><span class="p">[</span><span class="n">episode_name</span><span class="p">]</span>
</span><span id="Project-4595"><a href="#Project-4595"><span class="linenos">4595</span></a>                <span class="n">import_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">), &quot;</span>
</span><span id="Project-4596"><a href="#Project-4596"><span class="linenos">4596</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-4597"><a href="#Project-4597"><span class="linenos">4597</span></a>                <span class="n">import_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Project-4598"><a href="#Project-4598"><span class="linenos">4598</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Project-4599"><a href="#Project-4599"><span class="linenos">4599</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_check_episode_validity</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">allow_doublecolon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Project-4600"><a href="#Project-4600"><span class="linenos">4600</span></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Project-4601"><a href="#Project-4601"><span class="linenos">4601</span></a>                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;is already taken!&quot;</span><span class="p">):</span>
</span><span id="Project-4602"><a href="#Project-4602"><span class="linenos">4602</span></a>                    <span class="k">if</span> <span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;skip&quot;</span><span class="p">:</span>
</span><span id="Project-4603"><a href="#Project-4603"><span class="linenos">4603</span></a>                        <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-4604"><a href="#Project-4604"><span class="linenos">4604</span></a>                    <span class="k">elif</span> <span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;force&quot;</span><span class="p">:</span>
</span><span id="Project-4605"><a href="#Project-4605"><span class="linenos">4605</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-4606"><a href="#Project-4606"><span class="linenos">4606</span></a>                    <span class="k">elif</span> <span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
</span><span id="Project-4607"><a href="#Project-4607"><span class="linenos">4607</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-4608"><a href="#Project-4608"><span class="linenos">4608</span></a>                            <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> episode name is already taken; please use the name_map parameter to rename it&quot;</span>
</span><span id="Project-4609"><a href="#Project-4609"><span class="linenos">4609</span></a>                        <span class="p">)</span>
</span><span id="Project-4610"><a href="#Project-4610"><span class="linenos">4610</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project-4611"><a href="#Project-4611"><span class="linenos">4611</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project-4612"><a href="#Project-4612"><span class="linenos">4612</span></a>                            <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">repeat_policy</span><span class="si">}</span><span class="s2"> repeat policy is not recognized; please choose from [&#39;skip&#39;, &#39;force&#39; ans &#39;error&#39;]&quot;</span>
</span><span id="Project-4613"><a href="#Project-4613"><span class="linenos">4613</span></a>                        <span class="p">)</span>
</span><span id="Project-4614"><a href="#Project-4614"><span class="linenos">4614</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="n">episodes</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">to_remove</span><span class="p">)</span>
</span><span id="Project-4615"><a href="#Project-4615"><span class="linenos">4615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="Project-4616"><a href="#Project-4616"><span class="linenos">4616</span></a>            <span class="n">episodes</span><span class="p">,</span>
</span><span id="Project-4617"><a href="#Project-4617"><span class="linenos">4617</span></a>            <span class="n">name_map</span><span class="o">=</span><span class="n">name_map</span><span class="p">,</span>
</span><span id="Project-4618"><a href="#Project-4618"><span class="linenos">4618</span></a>            <span class="n">force</span><span class="o">=</span><span class="p">(</span><span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;force&quot;</span><span class="p">),</span>
</span><span id="Project-4619"><a href="#Project-4619"><span class="linenos">4619</span></a>            <span class="n">data_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project-4620"><a href="#Project-4620"><span class="linenos">4620</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="Project-4621"><a href="#Project-4621"><span class="linenos">4621</span></a>        <span class="p">)</span>
</span><span id="Project-4622"><a href="#Project-4622"><span class="linenos">4622</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="Project-4623"><a href="#Project-4623"><span class="linenos">4623</span></a>            <span class="k">if</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">name_map</span><span class="p">:</span>
</span><span id="Project-4624"><a href="#Project-4624"><span class="linenos">4624</span></a>                <span class="n">new_episode_name</span> <span class="o">=</span> <span class="n">name_map</span><span class="p">[</span><span class="n">episode_name</span><span class="p">]</span>
</span><span id="Project-4625"><a href="#Project-4625"><span class="linenos">4625</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project-4626"><a href="#Project-4626"><span class="linenos">4626</span></a>                <span class="n">new_episode_name</span> <span class="o">=</span> <span class="n">episode_name</span>
</span><span id="Project-4627"><a href="#Project-4627"><span class="linenos">4627</span></a>            <span class="n">model_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-4628"><a href="#Project-4628"><span class="linenos">4628</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">new_episode_name</span>
</span><span id="Project-4629"><a href="#Project-4629"><span class="linenos">4629</span></a>            <span class="p">)</span>
</span><span id="Project-4630"><a href="#Project-4630"><span class="linenos">4630</span></a>            <span class="n">old_model_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">episodes_directory</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-4631"><a href="#Project-4631"><span class="linenos">4631</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_dir</span><span class="p">):</span>
</span><span id="Project-4632"><a href="#Project-4632"><span class="linenos">4632</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
</span><span id="Project-4633"><a href="#Project-4633"><span class="linenos">4633</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
</span><span id="Project-4634"><a href="#Project-4634"><span class="linenos">4634</span></a>            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">old_model_dir</span><span class="p">):</span>
</span><span id="Project-4635"><a href="#Project-4635"><span class="linenos">4635</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span>
</span><span id="Project-4636"><a href="#Project-4636"><span class="linenos">4636</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">old_model_dir</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="Project-4637"><a href="#Project-4637"><span class="linenos">4637</span></a>                <span class="p">)</span>
</span><span id="Project-4638"><a href="#Project-4638"><span class="linenos">4638</span></a>            <span class="n">log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-4639"><a href="#Project-4639"><span class="linenos">4639</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="Project-4640"><a href="#Project-4640"><span class="linenos">4640</span></a>            <span class="p">)</span>
</span><span id="Project-4641"><a href="#Project-4641"><span class="linenos">4641</span></a>            <span class="n">old_log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-4642"><a href="#Project-4642"><span class="linenos">4642</span></a>                <span class="n">episodes_directory</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="Project-4643"><a href="#Project-4643"><span class="linenos">4643</span></a>            <span class="p">)</span>
</span><span id="Project-4644"><a href="#Project-4644"><span class="linenos">4644</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">old_log_file</span><span class="p">,</span> <span class="n">log_file</span><span class="p">)</span>
</span><span id="Project-4645"><a href="#Project-4645"><span class="linenos">4645</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">import_string</span><span class="p">)</span>
</span><span id="Project-4646"><a href="#Project-4646"><span class="linenos">4646</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-4647"><a href="#Project-4647"><span class="linenos">4647</span></a>
</span><span id="Project-4648"><a href="#Project-4648"><span class="linenos">4648</span></a>    <span class="k">def</span> <span class="nf">export_episodes</span><span class="p">(</span>
</span><span id="Project-4649"><a href="#Project-4649"><span class="linenos">4649</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">output_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project-4650"><a href="#Project-4650"><span class="linenos">4650</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-4651"><a href="#Project-4651"><span class="linenos">4651</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4652"><a href="#Project-4652"><span class="linenos">4652</span></a><span class="sd">        Save selected episodes as a file that can be imported into another project with `Project.import_episodes`</span>
</span><span id="Project-4653"><a href="#Project-4653"><span class="linenos">4653</span></a>
</span><span id="Project-4654"><a href="#Project-4654"><span class="linenos">4654</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4655"><a href="#Project-4655"><span class="linenos">4655</span></a><span class="sd">        ----------</span>
</span><span id="Project-4656"><a href="#Project-4656"><span class="linenos">4656</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project-4657"><a href="#Project-4657"><span class="linenos">4657</span></a><span class="sd">            a list of string episode names</span>
</span><span id="Project-4658"><a href="#Project-4658"><span class="linenos">4658</span></a><span class="sd">        output_directory : str</span>
</span><span id="Project-4659"><a href="#Project-4659"><span class="linenos">4659</span></a><span class="sd">            the path to the directory where the episodes will be saved</span>
</span><span id="Project-4660"><a href="#Project-4660"><span class="linenos">4660</span></a><span class="sd">        name : str, optional</span>
</span><span id="Project-4661"><a href="#Project-4661"><span class="linenos">4661</span></a><span class="sd">            the name of the episodes directory (by default `exported_episodes`)</span>
</span><span id="Project-4662"><a href="#Project-4662"><span class="linenos">4662</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4663"><a href="#Project-4663"><span class="linenos">4663</span></a>
</span><span id="Project-4664"><a href="#Project-4664"><span class="linenos">4664</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-4665"><a href="#Project-4665"><span class="linenos">4665</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;exported_episodes&quot;</span>
</span><span id="Project-4666"><a href="#Project-4666"><span class="linenos">4666</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="Project-4667"><a href="#Project-4667"><span class="linenos">4667</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
</span><span id="Project-4668"><a href="#Project-4668"><span class="linenos">4668</span></a>        <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)):</span>
</span><span id="Project-4669"><a href="#Project-4669"><span class="linenos">4669</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Project-4670"><a href="#Project-4670"><span class="linenos">4670</span></a>            <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="Project-4671"><a href="#Project-4671"><span class="linenos">4671</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">)</span>
</span><span id="Project-4672"><a href="#Project-4672"><span class="linenos">4672</span></a>            <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)):</span>
</span><span id="Project-4673"><a href="#Project-4673"><span class="linenos">4673</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Project-4674"><a href="#Project-4674"><span class="linenos">4674</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project-4675"><a href="#Project-4675"><span class="linenos">4675</span></a>        <span class="n">dest_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="Project-4676"><a href="#Project-4676"><span class="linenos">4676</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">)</span>
</span><span id="Project-4677"><a href="#Project-4677"><span class="linenos">4677</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">))</span>
</span><span id="Project-4678"><a href="#Project-4678"><span class="linenos">4678</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">))</span>
</span><span id="Project-4679"><a href="#Project-4679"><span class="linenos">4679</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-4680"><a href="#Project-4680"><span class="linenos">4680</span></a>        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="Project-4681"><a href="#Project-4681"><span class="linenos">4681</span></a>            <span class="n">runs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode</span><span class="p">)</span>
</span><span id="Project-4682"><a href="#Project-4682"><span class="linenos">4682</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project-4683"><a href="#Project-4683"><span class="linenos">4683</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="Project-4684"><a href="#Project-4684"><span class="linenos">4684</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">),</span>
</span><span id="Project-4685"><a href="#Project-4685"><span class="linenos">4685</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">),</span>
</span><span id="Project-4686"><a href="#Project-4686"><span class="linenos">4686</span></a>            <span class="p">)</span>
</span><span id="Project-4687"><a href="#Project-4687"><span class="linenos">4687</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span>
</span><span id="Project-4688"><a href="#Project-4688"><span class="linenos">4688</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
</span><span id="Project-4689"><a href="#Project-4689"><span class="linenos">4689</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
</span><span id="Project-4690"><a href="#Project-4690"><span class="linenos">4690</span></a>            <span class="p">)</span>
</span><span id="Project-4691"><a href="#Project-4691"><span class="linenos">4691</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_subset</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span>
</span><span id="Project-4692"><a href="#Project-4692"><span class="linenos">4692</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;episodes.pickle&quot;</span><span class="p">))</span>
</span><span id="Project-4693"><a href="#Project-4693"><span class="linenos">4693</span></a>
</span><span id="Project-4694"><a href="#Project-4694"><span class="linenos">4694</span></a>    <span class="k">def</span> <span class="nf">get_results_table</span><span class="p">(</span>
</span><span id="Project-4695"><a href="#Project-4695"><span class="linenos">4695</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project-4696"><a href="#Project-4696"><span class="linenos">4696</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project-4697"><a href="#Project-4697"><span class="linenos">4697</span></a>        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4698"><a href="#Project-4698"><span class="linenos">4698</span></a>        <span class="n">include_std</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project-4699"><a href="#Project-4699"><span class="linenos">4699</span></a>        <span class="n">classes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project-4700"><a href="#Project-4700"><span class="linenos">4700</span></a>    <span class="p">):</span>
</span><span id="Project-4701"><a href="#Project-4701"><span class="linenos">4701</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4702"><a href="#Project-4702"><span class="linenos">4702</span></a><span class="sd">        Genererate a `pandas` dataframe with a summary of episode results</span>
</span><span id="Project-4703"><a href="#Project-4703"><span class="linenos">4703</span></a>
</span><span id="Project-4704"><a href="#Project-4704"><span class="linenos">4704</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4705"><a href="#Project-4705"><span class="linenos">4705</span></a><span class="sd">        ----------</span>
</span><span id="Project-4706"><a href="#Project-4706"><span class="linenos">4706</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project-4707"><a href="#Project-4707"><span class="linenos">4707</span></a><span class="sd">            a list of names of episodes to include</span>
</span><span id="Project-4708"><a href="#Project-4708"><span class="linenos">4708</span></a><span class="sd">        metrics : list, optional</span>
</span><span id="Project-4709"><a href="#Project-4709"><span class="linenos">4709</span></a><span class="sd">            a list of metric names to include</span>
</span><span id="Project-4710"><a href="#Project-4710"><span class="linenos">4710</span></a><span class="sd">        include_std : bool, default False</span>
</span><span id="Project-4711"><a href="#Project-4711"><span class="linenos">4711</span></a><span class="sd">            if `True`, for episodes with multiple runs the mean and standard deviation will be displayed;</span>
</span><span id="Project-4712"><a href="#Project-4712"><span class="linenos">4712</span></a><span class="sd">            otherwise only mean</span>
</span><span id="Project-4713"><a href="#Project-4713"><span class="linenos">4713</span></a><span class="sd">        classes : list, optional</span>
</span><span id="Project-4714"><a href="#Project-4714"><span class="linenos">4714</span></a><span class="sd">            a list of names of classes to include (by default all are included)</span>
</span><span id="Project-4715"><a href="#Project-4715"><span class="linenos">4715</span></a>
</span><span id="Project-4716"><a href="#Project-4716"><span class="linenos">4716</span></a><span class="sd">        Returns</span>
</span><span id="Project-4717"><a href="#Project-4717"><span class="linenos">4717</span></a><span class="sd">        -------</span>
</span><span id="Project-4718"><a href="#Project-4718"><span class="linenos">4718</span></a><span class="sd">        results : pd.DataFrame</span>
</span><span id="Project-4719"><a href="#Project-4719"><span class="linenos">4719</span></a><span class="sd">            a table with the results</span>
</span><span id="Project-4720"><a href="#Project-4720"><span class="linenos">4720</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4721"><a href="#Project-4721"><span class="linenos">4721</span></a>
</span><span id="Project-4722"><a href="#Project-4722"><span class="linenos">4722</span></a>        <span class="n">run_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-4723"><a href="#Project-4723"><span class="linenos">4723</span></a>        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="Project-4724"><a href="#Project-4724"><span class="linenos">4724</span></a>            <span class="n">run_names</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode</span><span class="p">)</span>
</span><span id="Project-4725"><a href="#Project-4725"><span class="linenos">4725</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span><span class="n">run_names</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Project-4726"><a href="#Project-4726"><span class="linenos">4726</span></a>        <span class="n">metric_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;results&quot;</span><span class="p">]</span>
</span><span id="Project-4727"><a href="#Project-4727"><span class="linenos">4727</span></a>        <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="Project-4728"><a href="#Project-4728"><span class="linenos">4728</span></a>        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-4729"><a href="#Project-4729"><span class="linenos">4729</span></a>            <span class="n">metric_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-4730"><a href="#Project-4730"><span class="linenos">4730</span></a>                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">metric_columns</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">metrics</span>
</span><span id="Project-4731"><a href="#Project-4731"><span class="linenos">4731</span></a>            <span class="p">]</span>
</span><span id="Project-4732"><a href="#Project-4732"><span class="linenos">4732</span></a>        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="Project-4733"><a href="#Project-4733"><span class="linenos">4733</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-4734"><a href="#Project-4734"><span class="linenos">4734</span></a>            <span class="n">metric_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Project-4735"><a href="#Project-4735"><span class="linenos">4735</span></a>            <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode</span><span class="p">):</span>
</span><span id="Project-4736"><a href="#Project-4736"><span class="linenos">4736</span></a>                <span class="n">beh_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_dictionary</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="Project-4737"><a href="#Project-4737"><span class="linenos">4737</span></a>                <span class="n">res_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="Project-4738"><a href="#Project-4738"><span class="linenos">4738</span></a>                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">metric_columns</span><span class="p">:</span>
</span><span id="Project-4739"><a href="#Project-4739"><span class="linenos">4739</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">episodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">run</span><span class="p">,</span> <span class="n">column</span><span class="p">]):</span>
</span><span id="Project-4740"><a href="#Project-4740"><span class="linenos">4740</span></a>                        <span class="k">continue</span>
</span><span id="Project-4741"><a href="#Project-4741"><span class="linenos">4741</span></a>                    <span class="n">split</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="Project-4742"><a href="#Project-4742"><span class="linenos">4742</span></a>                    <span class="k">if</span> <span class="n">split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
</span><span id="Project-4743"><a href="#Project-4743"><span class="linenos">4743</span></a>                        <span class="n">beh_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Project-4744"><a href="#Project-4744"><span class="linenos">4744</span></a>                        <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Project-4745"><a href="#Project-4745"><span class="linenos">4745</span></a>                        <span class="n">beh</span> <span class="o">=</span> <span class="n">beh_dict</span><span class="p">[</span><span class="n">beh_ind</span><span class="p">]</span>
</span><span id="Project-4746"><a href="#Project-4746"><span class="linenos">4746</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project-4747"><a href="#Project-4747"><span class="linenos">4747</span></a>                        <span class="n">beh</span> <span class="o">=</span> <span class="s2">&quot;average&quot;</span>
</span><span id="Project-4748"><a href="#Project-4748"><span class="linenos">4748</span></a>                        <span class="n">metric_name</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Project-4749"><a href="#Project-4749"><span class="linenos">4749</span></a>                    <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">episodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">run</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span>
</span><span id="Project-4750"><a href="#Project-4750"><span class="linenos">4750</span></a>                    <span class="n">metric_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">metric_name</span><span class="p">)</span>
</span><span id="Project-4751"><a href="#Project-4751"><span class="linenos">4751</span></a>                <span class="k">if</span> <span class="s2">&quot;average&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">:</span>
</span><span id="Project-4752"><a href="#Project-4752"><span class="linenos">4752</span></a>                    <span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-4753"><a href="#Project-4753"><span class="linenos">4753</span></a>                <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_set</span><span class="p">:</span>
</span><span id="Project-4754"><a href="#Project-4754"><span class="linenos">4754</span></a>                    <span class="k">if</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]:</span>
</span><span id="Project-4755"><a href="#Project-4755"><span class="linenos">4755</span></a>                        <span class="n">arr</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project-4756"><a href="#Project-4756"><span class="linenos">4756</span></a>                            <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span>
</span><span id="Project-4757"><a href="#Project-4757"><span class="linenos">4757</span></a>                            <span class="k">for</span> <span class="n">beh</span> <span class="ow">in</span> <span class="n">res_dict</span>
</span><span id="Project-4758"><a href="#Project-4758"><span class="linenos">4758</span></a>                            <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span>
</span><span id="Project-4759"><a href="#Project-4759"><span class="linenos">4759</span></a>                        <span class="p">]</span>
</span><span id="Project-4760"><a href="#Project-4760"><span class="linenos">4760</span></a>                        <span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="Project-4761"><a href="#Project-4761"><span class="linenos">4761</span></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_dict</span><span class="p">)</span>
</span><span id="Project-4762"><a href="#Project-4762"><span class="linenos">4762</span></a>            <span class="n">episode_results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project-4763"><a href="#Project-4763"><span class="linenos">4763</span></a>            <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_set</span><span class="p">:</span>
</span><span id="Project-4764"><a href="#Project-4764"><span class="linenos">4764</span></a>                <span class="k">for</span> <span class="n">beh</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Project-4765"><a href="#Project-4765"><span class="linenos">4765</span></a>                    <span class="k">if</span> <span class="n">classes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">beh</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
</span><span id="Project-4766"><a href="#Project-4766"><span class="linenos">4766</span></a>                        <span class="k">continue</span>
</span><span id="Project-4767"><a href="#Project-4767"><span class="linenos">4767</span></a>                    <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project-4768"><a href="#Project-4768"><span class="linenos">4768</span></a>                    <span class="k">for</span> <span class="n">res_dict</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="Project-4769"><a href="#Project-4769"><span class="linenos">4769</span></a>                        <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">]:</span>
</span><span id="Project-4770"><a href="#Project-4770"><span class="linenos">4770</span></a>                            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">][</span><span class="n">metric</span><span class="p">])</span>
</span><span id="Project-4771"><a href="#Project-4771"><span class="linenos">4771</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project-4772"><a href="#Project-4772"><span class="linenos">4772</span></a>                        <span class="k">if</span> <span class="n">include_std</span><span class="p">:</span>
</span><span id="Project-4773"><a href="#Project-4773"><span class="linenos">4773</span></a>                            <span class="n">episode_results</span><span class="p">[</span>
</span><span id="Project-4774"><a href="#Project-4774"><span class="linenos">4774</span></a>                                <span class="p">(</span><span class="n">beh</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> mean&quot;</span><span class="p">)</span>
</span><span id="Project-4775"><a href="#Project-4775"><span class="linenos">4775</span></a>                            <span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="Project-4776"><a href="#Project-4776"><span class="linenos">4776</span></a>                            <span class="n">episode_results</span><span class="p">[(</span><span class="n">beh</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> std&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span>
</span><span id="Project-4777"><a href="#Project-4777"><span class="linenos">4777</span></a>                                <span class="n">arr</span>
</span><span id="Project-4778"><a href="#Project-4778"><span class="linenos">4778</span></a>                            <span class="p">)</span>
</span><span id="Project-4779"><a href="#Project-4779"><span class="linenos">4779</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Project-4780"><a href="#Project-4780"><span class="linenos">4780</span></a>                            <span class="n">episode_results</span><span class="p">[(</span><span class="n">beh</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="Project-4781"><a href="#Project-4781"><span class="linenos">4781</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">episode_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project-4782"><a href="#Project-4782"><span class="linenos">4782</span></a>                <span class="n">results_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Project-4783"><a href="#Project-4783"><span class="linenos">4783</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RESULTS:&quot;</span><span class="p">)</span>
</span><span id="Project-4784"><a href="#Project-4784"><span class="linenos">4784</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</span><span id="Project-4785"><a href="#Project-4785"><span class="linenos">4785</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project-4786"><a href="#Project-4786"><span class="linenos">4786</span></a>        <span class="k">return</span> <span class="n">results_df</span>
</span><span id="Project-4787"><a href="#Project-4787"><span class="linenos">4787</span></a>
</span><span id="Project-4788"><a href="#Project-4788"><span class="linenos">4788</span></a>    <span class="k">def</span> <span class="nf">episode_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Project-4789"><a href="#Project-4789"><span class="linenos">4789</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4790"><a href="#Project-4790"><span class="linenos">4790</span></a><span class="sd">        Check if an episode already exists</span>
</span><span id="Project-4791"><a href="#Project-4791"><span class="linenos">4791</span></a>
</span><span id="Project-4792"><a href="#Project-4792"><span class="linenos">4792</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4793"><a href="#Project-4793"><span class="linenos">4793</span></a><span class="sd">        ----------</span>
</span><span id="Project-4794"><a href="#Project-4794"><span class="linenos">4794</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project-4795"><a href="#Project-4795"><span class="linenos">4795</span></a><span class="sd">            the episode name</span>
</span><span id="Project-4796"><a href="#Project-4796"><span class="linenos">4796</span></a>
</span><span id="Project-4797"><a href="#Project-4797"><span class="linenos">4797</span></a><span class="sd">        Returns</span>
</span><span id="Project-4798"><a href="#Project-4798"><span class="linenos">4798</span></a><span class="sd">        -------</span>
</span><span id="Project-4799"><a href="#Project-4799"><span class="linenos">4799</span></a><span class="sd">        exists : bool</span>
</span><span id="Project-4800"><a href="#Project-4800"><span class="linenos">4800</span></a><span class="sd">            `True` if the episode exists</span>
</span><span id="Project-4801"><a href="#Project-4801"><span class="linenos">4801</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4802"><a href="#Project-4802"><span class="linenos">4802</span></a>
</span><span id="Project-4803"><a href="#Project-4803"><span class="linenos">4803</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project-4804"><a href="#Project-4804"><span class="linenos">4804</span></a>
</span><span id="Project-4805"><a href="#Project-4805"><span class="linenos">4805</span></a>    <span class="k">def</span> <span class="nf">search_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Project-4806"><a href="#Project-4806"><span class="linenos">4806</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4807"><a href="#Project-4807"><span class="linenos">4807</span></a><span class="sd">        Check if a search already exists</span>
</span><span id="Project-4808"><a href="#Project-4808"><span class="linenos">4808</span></a>
</span><span id="Project-4809"><a href="#Project-4809"><span class="linenos">4809</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4810"><a href="#Project-4810"><span class="linenos">4810</span></a><span class="sd">        ----------</span>
</span><span id="Project-4811"><a href="#Project-4811"><span class="linenos">4811</span></a><span class="sd">        search_name : str</span>
</span><span id="Project-4812"><a href="#Project-4812"><span class="linenos">4812</span></a><span class="sd">            the search name</span>
</span><span id="Project-4813"><a href="#Project-4813"><span class="linenos">4813</span></a>
</span><span id="Project-4814"><a href="#Project-4814"><span class="linenos">4814</span></a><span class="sd">        Returns</span>
</span><span id="Project-4815"><a href="#Project-4815"><span class="linenos">4815</span></a><span class="sd">        -------</span>
</span><span id="Project-4816"><a href="#Project-4816"><span class="linenos">4816</span></a><span class="sd">        exists : bool</span>
</span><span id="Project-4817"><a href="#Project-4817"><span class="linenos">4817</span></a><span class="sd">            `True` if the search exists</span>
</span><span id="Project-4818"><a href="#Project-4818"><span class="linenos">4818</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4819"><a href="#Project-4819"><span class="linenos">4819</span></a>
</span><span id="Project-4820"><a href="#Project-4820"><span class="linenos">4820</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="Project-4821"><a href="#Project-4821"><span class="linenos">4821</span></a>
</span><span id="Project-4822"><a href="#Project-4822"><span class="linenos">4822</span></a>    <span class="k">def</span> <span class="nf">prediction_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Project-4823"><a href="#Project-4823"><span class="linenos">4823</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4824"><a href="#Project-4824"><span class="linenos">4824</span></a><span class="sd">        Check if a prediction already exists</span>
</span><span id="Project-4825"><a href="#Project-4825"><span class="linenos">4825</span></a>
</span><span id="Project-4826"><a href="#Project-4826"><span class="linenos">4826</span></a><span class="sd">        Parameters</span>
</span><span id="Project-4827"><a href="#Project-4827"><span class="linenos">4827</span></a><span class="sd">        ----------</span>
</span><span id="Project-4828"><a href="#Project-4828"><span class="linenos">4828</span></a><span class="sd">        prediction_name : str</span>
</span><span id="Project-4829"><a href="#Project-4829"><span class="linenos">4829</span></a><span class="sd">            the prediction name</span>
</span><span id="Project-4830"><a href="#Project-4830"><span class="linenos">4830</span></a>
</span><span id="Project-4831"><a href="#Project-4831"><span class="linenos">4831</span></a><span class="sd">        Returns</span>
</span><span id="Project-4832"><a href="#Project-4832"><span class="linenos">4832</span></a><span class="sd">        -------</span>
</span><span id="Project-4833"><a href="#Project-4833"><span class="linenos">4833</span></a><span class="sd">        exists : bool</span>
</span><span id="Project-4834"><a href="#Project-4834"><span class="linenos">4834</span></a><span class="sd">            `True` if the prediction exists</span>
</span><span id="Project-4835"><a href="#Project-4835"><span class="linenos">4835</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4836"><a href="#Project-4836"><span class="linenos">4836</span></a>
</span><span id="Project-4837"><a href="#Project-4837"><span class="linenos">4837</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">)</span>
</span><span id="Project-4838"><a href="#Project-4838"><span class="linenos">4838</span></a>
</span><span id="Project-4839"><a href="#Project-4839"><span class="linenos">4839</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Project-4840"><a href="#Project-4840"><span class="linenos">4840</span></a>    <span class="k">def</span> <span class="nf">project_name_available</span><span class="p">(</span><span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Project-4841"><a href="#Project-4841"><span class="linenos">4841</span></a>        <span class="k">if</span> <span class="n">projects_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project-4842"><a href="#Project-4842"><span class="linenos">4842</span></a>            <span class="n">projects_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()),</span> <span class="s2">&quot;DLC2Action&quot;</span><span class="p">)</span>
</span><span id="Project-4843"><a href="#Project-4843"><span class="linenos">4843</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_path</span><span class="p">,</span> <span class="n">project_name</span><span class="p">))</span>
</span><span id="Project-4844"><a href="#Project-4844"><span class="linenos">4844</span></a>
</span><span id="Project-4845"><a href="#Project-4845"><span class="linenos">4845</span></a>    <span class="k">def</span> <span class="nf">_update_episode_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
</span><span id="Project-4846"><a href="#Project-4846"><span class="linenos">4846</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project-4847"><a href="#Project-4847"><span class="linenos">4847</span></a><span class="sd">        Update meta data with evaluation results</span>
</span><span id="Project-4848"><a href="#Project-4848"><span class="linenos">4848</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project-4849"><a href="#Project-4849"><span class="linenos">4849</span></a>
</span><span id="Project-4850"><a href="#Project-4850"><span class="linenos">4850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">update_episode_metrics</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
</span><span id="Project-4851"><a href="#Project-4851"><span class="linenos">4851</span></a>
</span><span id="Project-4852"><a href="#Project-4852"><span class="linenos">4852</span></a>    <span class="k">def</span> <span class="nf">rename_episode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Project-4853"><a href="#Project-4853"><span class="linenos">4853</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
</span><span id="Project-4854"><a href="#Project-4854"><span class="linenos">4854</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">),</span>
</span><span id="Project-4855"><a href="#Project-4855"><span class="linenos">4855</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">new_episode_name</span><span class="p">),</span>
</span><span id="Project-4856"><a href="#Project-4856"><span class="linenos">4856</span></a>        <span class="p">)</span>
</span><span id="Project-4857"><a href="#Project-4857"><span class="linenos">4857</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
</span><span id="Project-4858"><a href="#Project-4858"><span class="linenos">4858</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
</span><span id="Project-4859"><a href="#Project-4859"><span class="linenos">4859</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project-4860"><a href="#Project-4860"><span class="linenos">4860</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="Project-4861"><a href="#Project-4861"><span class="linenos">4861</span></a>            <span class="p">),</span>
</span><span id="Project-4862"><a href="#Project-4862"><span class="linenos">4862</span></a>        <span class="p">)</span>
</span><span id="Project-4863"><a href="#Project-4863"><span class="linenos">4863</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">rename_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">new_episode_name</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A class to create and maintain the project files + keep track of experiments</p>
</div>


                            <div id="Project.__init__" class="classattr">
                                        <input id="Project.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Project</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>,</span><span class="param">	<span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">data_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="Project.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.__init__-56"><a href="#Project.__init__-56"><span class="linenos"> 56</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Project.__init__-57"><a href="#Project.__init__-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.__init__-58"><a href="#Project.__init__-58"><span class="linenos"> 58</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project.__init__-59"><a href="#Project.__init__-59"><span class="linenos"> 59</span></a>        <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.__init__-60"><a href="#Project.__init__-60"><span class="linenos"> 60</span></a>        <span class="n">annotation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
</span><span id="Project.__init__-61"><a href="#Project.__init__-61"><span class="linenos"> 61</span></a>        <span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.__init__-62"><a href="#Project.__init__-62"><span class="linenos"> 62</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.__init__-63"><a href="#Project.__init__-63"><span class="linenos"> 63</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.__init__-64"><a href="#Project.__init__-64"><span class="linenos"> 64</span></a>        <span class="n">copy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.__init__-65"><a href="#Project.__init__-65"><span class="linenos"> 65</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.__init__-66"><a href="#Project.__init__-66"><span class="linenos"> 66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.__init__-67"><a href="#Project.__init__-67"><span class="linenos"> 67</span></a><span class="sd">        Parameters</span>
</span><span id="Project.__init__-68"><a href="#Project.__init__-68"><span class="linenos"> 68</span></a><span class="sd">        ----------</span>
</span><span id="Project.__init__-69"><a href="#Project.__init__-69"><span class="linenos"> 69</span></a><span class="sd">        name : str</span>
</span><span id="Project.__init__-70"><a href="#Project.__init__-70"><span class="linenos"> 70</span></a><span class="sd">            name of the project</span>
</span><span id="Project.__init__-71"><a href="#Project.__init__-71"><span class="linenos"> 71</span></a><span class="sd">        data_type : str, optional</span>
</span><span id="Project.__init__-72"><a href="#Project.__init__-72"><span class="linenos"> 72</span></a><span class="sd">            data type (run Project.data_types() to see available options; has to be provided if the project is being</span>
</span><span id="Project.__init__-73"><a href="#Project.__init__-73"><span class="linenos"> 73</span></a><span class="sd">            created)</span>
</span><span id="Project.__init__-74"><a href="#Project.__init__-74"><span class="linenos"> 74</span></a><span class="sd">        annotation_type : str, default &#39;none&#39;</span>
</span><span id="Project.__init__-75"><a href="#Project.__init__-75"><span class="linenos"> 75</span></a><span class="sd">            annotation type (run Project.annotation_types() to see available options)</span>
</span><span id="Project.__init__-76"><a href="#Project.__init__-76"><span class="linenos"> 76</span></a><span class="sd">        projects_path : str, optional</span>
</span><span id="Project.__init__-77"><a href="#Project.__init__-77"><span class="linenos"> 77</span></a><span class="sd">            path to the projects folder (is filled with ~/DLC2Action by default)</span>
</span><span id="Project.__init__-78"><a href="#Project.__init__-78"><span class="linenos"> 78</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="Project.__init__-79"><a href="#Project.__init__-79"><span class="linenos"> 79</span></a><span class="sd">            path to the folder containing input files for the project (has to be provided if the project is being</span>
</span><span id="Project.__init__-80"><a href="#Project.__init__-80"><span class="linenos"> 80</span></a><span class="sd">            created)</span>
</span><span id="Project.__init__-81"><a href="#Project.__init__-81"><span class="linenos"> 81</span></a><span class="sd">        annotation_path : str, optional</span>
</span><span id="Project.__init__-82"><a href="#Project.__init__-82"><span class="linenos"> 82</span></a><span class="sd">            path to the folder containing annotation files for the project</span>
</span><span id="Project.__init__-83"><a href="#Project.__init__-83"><span class="linenos"> 83</span></a><span class="sd">        copy : bool, default False</span>
</span><span id="Project.__init__-84"><a href="#Project.__init__-84"><span class="linenos"> 84</span></a><span class="sd">            if True, the files from annotation_path and data_path will be copied to the projects folder;</span>
</span><span id="Project.__init__-85"><a href="#Project.__init__-85"><span class="linenos"> 85</span></a><span class="sd">            otherwise they will be moved</span>
</span><span id="Project.__init__-86"><a href="#Project.__init__-86"><span class="linenos"> 86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.__init__-87"><a href="#Project.__init__-87"><span class="linenos"> 87</span></a>
</span><span id="Project.__init__-88"><a href="#Project.__init__-88"><span class="linenos"> 88</span></a>        <span class="k">if</span> <span class="n">projects_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.__init__-89"><a href="#Project.__init__-89"><span class="linenos"> 89</span></a>            <span class="n">projects_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()),</span> <span class="s2">&quot;DLC2Action&quot;</span><span class="p">)</span>
</span><span id="Project.__init__-90"><a href="#Project.__init__-90"><span class="linenos"> 90</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">projects_path</span><span class="p">):</span>
</span><span id="Project.__init__-91"><a href="#Project.__init__-91"><span class="linenos"> 91</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">projects_path</span><span class="p">)</span>
</span><span id="Project.__init__-92"><a href="#Project.__init__-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="Project.__init__-93"><a href="#Project.__init__-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Project.__init__-94"><a href="#Project.__init__-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span>
</span><span id="Project.__init__-95"><a href="#Project.__init__-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span> <span class="o">=</span> <span class="n">annotation_type</span>
</span><span id="Project.__init__-96"><a href="#Project.__init__-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">data_path</span>
</span><span id="Project.__init__-97"><a href="#Project.__init__-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span> <span class="o">=</span> <span class="n">annotation_path</span>
</span><span id="Project.__init__-98"><a href="#Project.__init__-98"><span class="linenos"> 98</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">):</span>
</span><span id="Project.__init__-99"><a href="#Project.__init__-99"><span class="linenos"> 99</span></a>            <span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.__init__-100"><a href="#Project.__init__-100"><span class="linenos">100</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.__init__-101"><a href="#Project.__init__-101"><span class="linenos">101</span></a>                    <span class="s2">&quot;The data_type parameter is necessary when creating a new project!&quot;</span>
</span><span id="Project.__init__-102"><a href="#Project.__init__-102"><span class="linenos">102</span></a>                <span class="p">)</span>
</span><span id="Project.__init__-103"><a href="#Project.__init__-103"><span class="linenos">103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_project</span><span class="p">(</span>
</span><span id="Project.__init__-104"><a href="#Project.__init__-104"><span class="linenos">104</span></a>                <span class="n">data_type</span><span class="p">,</span> <span class="n">annotation_type</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">annotation_path</span><span class="p">,</span> <span class="n">copy</span>
</span><span id="Project.__init__-105"><a href="#Project.__init__-105"><span class="linenos">105</span></a>            <span class="p">)</span>
</span><span id="Project.__init__-106"><a href="#Project.__init__-106"><span class="linenos">106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.__init__-107"><a href="#Project.__init__-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_types</span><span class="p">()</span>
</span><span id="Project.__init__-108"><a href="#Project.__init__-108"><span class="linenos">108</span></a>            <span class="k">if</span> <span class="n">data_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="ow">and</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.__init__-109"><a href="#Project.__init__-109"><span class="linenos">109</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.__init__-110"><a href="#Project.__init__-110"><span class="linenos">110</span></a>                    <span class="sa">f</span><span class="s2">&quot;The project has already been initialized with data_type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span id="Project.__init__-111"><a href="#Project.__init__-111"><span class="linenos">111</span></a>                <span class="p">)</span>
</span><span id="Project.__init__-112"><a href="#Project.__init__-112"><span class="linenos">112</span></a>            <span class="k">if</span> <span class="n">annotation_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span> <span class="ow">and</span> <span class="n">annotation_type</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="Project.__init__-113"><a href="#Project.__init__-113"><span class="linenos">113</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.__init__-114"><a href="#Project.__init__-114"><span class="linenos">114</span></a>                    <span class="sa">f</span><span class="s2">&quot;The project has already been initialized with annotation_type=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span id="Project.__init__-115"><a href="#Project.__init__-115"><span class="linenos">115</span></a>                <span class="p">)</span>
</span><span id="Project.__init__-116"><a href="#Project.__init__-116"><span class="linenos">116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">data_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_paths</span><span class="p">()</span>
</span><span id="Project.__init__-117"><a href="#Project.__init__-117"><span class="linenos">117</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.__init__-118"><a href="#Project.__init__-118"><span class="linenos">118</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="n">data_path</span>
</span><span id="Project.__init__-119"><a href="#Project.__init__-119"><span class="linenos">119</span></a>            <span class="c1"># if data_path != self.data_path and data_path is not None:</span>
</span><span id="Project.__init__-120"><a href="#Project.__init__-120"><span class="linenos">120</span></a>            <span class="c1">#     raise ValueError(</span>
</span><span id="Project.__init__-121"><a href="#Project.__init__-121"><span class="linenos">121</span></a>            <span class="c1">#         f&quot;The project has already been initialized with data_path={self.data_path}!&quot;</span>
</span><span id="Project.__init__-122"><a href="#Project.__init__-122"><span class="linenos">122</span></a>            <span class="c1">#     )</span>
</span><span id="Project.__init__-123"><a href="#Project.__init__-123"><span class="linenos">123</span></a>            <span class="k">if</span> <span class="n">annotation_path</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span> <span class="ow">and</span> <span class="n">annotation_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.__init__-124"><a href="#Project.__init__-124"><span class="linenos">124</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.__init__-125"><a href="#Project.__init__-125"><span class="linenos">125</span></a>                    <span class="sa">f</span><span class="s2">&quot;The project has already been initialized with annotation_path=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span id="Project.__init__-126"><a href="#Project.__init__-126"><span class="linenos">126</span></a>                <span class="p">)</span>
</span><span id="Project.__init__-127"><a href="#Project.__init__-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_configs</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h2 id="parameters">Parameters</h2>

<p>name : str
    name of the project
data_type : str, optional
    data type (run <a href="#Project.data_types">Project.data_types()</a> to see available options; has to be provided if the project is being
    created)
annotation_type : str, default 'none'
    annotation type (run <a href="#Project.annotation_types">Project.annotation_types()</a> to see available options)
projects_path : str, optional
    path to the projects folder (is filled with ~/DLC2Action by default)
data_path : str, optional
    path to the folder containing input files for the project (has to be provided if the project is being
    created)
annotation_path : str, optional
    path to the folder containing annotation files for the project
copy : bool, default False
    if True, the files from annotation_path and data_path will be copied to the projects folder;
    otherwise they will be moved</p>
</div>


                            </div>
                            <div id="Project.project_path" class="classattr">
                                <div class="attr variable">
            <span class="name">project_path</span>

        
    </div>
    <a class="headerlink" href="#Project.project_path"></a>
    
    

                            </div>
                            <div id="Project.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#Project.name"></a>
    
    

                            </div>
                            <div id="Project.data_type" class="classattr">
                                <div class="attr variable">
            <span class="name">data_type</span>

        
    </div>
    <a class="headerlink" href="#Project.data_type"></a>
    
    

                            </div>
                            <div id="Project.annotation_type" class="classattr">
                                <div class="attr variable">
            <span class="name">annotation_type</span>

        
    </div>
    <a class="headerlink" href="#Project.annotation_type"></a>
    
    

                            </div>
                            <div id="Project.data_path" class="classattr">
                                <div class="attr variable">
            <span class="name">data_path</span>

        
    </div>
    <a class="headerlink" href="#Project.data_path"></a>
    
    

                            </div>
                            <div id="Project.annotation_path" class="classattr">
                                <div class="attr variable">
            <span class="name">annotation_path</span>

        
    </div>
    <a class="headerlink" href="#Project.annotation_path"></a>
    
    

                            </div>
                            <div id="Project.run_episode" class="classattr">
                                        <input id="Project.run_episode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_episode</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">task</span><span class="p">:</span> <span class="n"><a href="../task/task_dispatcher.html#TaskDispatcher">dlc2action.task.task_dispatcher.TaskDispatcher</a></span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">n_seeds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">suppress_name_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">autostop_metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">autostop_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>,</span><span class="param">	<span class="n">autostop_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>,</span><span class="param">	<span class="n">loading_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">trial</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="../task/task_dispatcher.html#TaskDispatcher">dlc2action.task.task_dispatcher.TaskDispatcher</a></span>:</span></span>

                <label class="view-source-button" for="Project.run_episode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.run_episode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.run_episode-618"><a href="#Project.run_episode-618"><span class="linenos">618</span></a>    <span class="k">def</span> <span class="nf">run_episode</span><span class="p">(</span>
</span><span id="Project.run_episode-619"><a href="#Project.run_episode-619"><span class="linenos">619</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.run_episode-620"><a href="#Project.run_episode-620"><span class="linenos">620</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project.run_episode-621"><a href="#Project.run_episode-621"><span class="linenos">621</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episode-622"><a href="#Project.run_episode-622"><span class="linenos">622</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episode-623"><a href="#Project.run_episode-623"><span class="linenos">623</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episode-624"><a href="#Project.run_episode-624"><span class="linenos">624</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episode-625"><a href="#Project.run_episode-625"><span class="linenos">625</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episode-626"><a href="#Project.run_episode-626"><span class="linenos">626</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episode-627"><a href="#Project.run_episode-627"><span class="linenos">627</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episode-628"><a href="#Project.run_episode-628"><span class="linenos">628</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project.run_episode-629"><a href="#Project.run_episode-629"><span class="linenos">629</span></a>        <span class="n">n_seeds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project.run_episode-630"><a href="#Project.run_episode-630"><span class="linenos">630</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_episode-631"><a href="#Project.run_episode-631"><span class="linenos">631</span></a>        <span class="n">suppress_name_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_episode-632"><a href="#Project.run_episode-632"><span class="linenos">632</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_episode-633"><a href="#Project.run_episode-633"><span class="linenos">633</span></a>        <span class="n">mask_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episode-634"><a href="#Project.run_episode-634"><span class="linenos">634</span></a>        <span class="n">autostop_metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episode-635"><a href="#Project.run_episode-635"><span class="linenos">635</span></a>        <span class="n">autostop_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="Project.run_episode-636"><a href="#Project.run_episode-636"><span class="linenos">636</span></a>        <span class="n">autostop_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
</span><span id="Project.run_episode-637"><a href="#Project.run_episode-637"><span class="linenos">637</span></a>        <span class="n">loading_bar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_episode-638"><a href="#Project.run_episode-638"><span class="linenos">638</span></a>        <span class="n">trial</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episode-639"><a href="#Project.run_episode-639"><span class="linenos">639</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskDispatcher</span><span class="p">:</span>
</span><span id="Project.run_episode-640"><a href="#Project.run_episode-640"><span class="linenos">640</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.run_episode-641"><a href="#Project.run_episode-641"><span class="linenos">641</span></a><span class="sd">        Run an episode</span>
</span><span id="Project.run_episode-642"><a href="#Project.run_episode-642"><span class="linenos">642</span></a>
</span><span id="Project.run_episode-643"><a href="#Project.run_episode-643"><span class="linenos">643</span></a><span class="sd">        The task parameters are read from the config files and then updated with the</span>
</span><span id="Project.run_episode-644"><a href="#Project.run_episode-644"><span class="linenos">644</span></a><span class="sd">        parameters_update dictionary. The model can be either initialized from scratch or loaded from one of the</span>
</span><span id="Project.run_episode-645"><a href="#Project.run_episode-645"><span class="linenos">645</span></a><span class="sd">        previous experiments. All parameters and results are saved in the meta files and can be accessed with the</span>
</span><span id="Project.run_episode-646"><a href="#Project.run_episode-646"><span class="linenos">646</span></a><span class="sd">        list_episodes() function. The train/test/validation split is saved and loaded from a file whenever the</span>
</span><span id="Project.run_episode-647"><a href="#Project.run_episode-647"><span class="linenos">647</span></a><span class="sd">        same split parameters are used. The pre-computed datasets are also saved and loaded whenever the same</span>
</span><span id="Project.run_episode-648"><a href="#Project.run_episode-648"><span class="linenos">648</span></a><span class="sd">        data parameters are used.</span>
</span><span id="Project.run_episode-649"><a href="#Project.run_episode-649"><span class="linenos">649</span></a>
</span><span id="Project.run_episode-650"><a href="#Project.run_episode-650"><span class="linenos">650</span></a><span class="sd">        You can use the autostop parameters to finish training when the parameters are not improving. It will be</span>
</span><span id="Project.run_episode-651"><a href="#Project.run_episode-651"><span class="linenos">651</span></a><span class="sd">        stopped if the average value of `autostop_metric` over the last `autostop_interval` epochs is smaller than</span>
</span><span id="Project.run_episode-652"><a href="#Project.run_episode-652"><span class="linenos">652</span></a><span class="sd">        the average over the previous `autostop_interval` epochs + `autostop_threshold`. For example, if the</span>
</span><span id="Project.run_episode-653"><a href="#Project.run_episode-653"><span class="linenos">653</span></a><span class="sd">        current epoch is 120 and `autostop_interval` is 50, the averages over epochs 70-120 and 20-70 will be compared.</span>
</span><span id="Project.run_episode-654"><a href="#Project.run_episode-654"><span class="linenos">654</span></a>
</span><span id="Project.run_episode-655"><a href="#Project.run_episode-655"><span class="linenos">655</span></a><span class="sd">        Parameters</span>
</span><span id="Project.run_episode-656"><a href="#Project.run_episode-656"><span class="linenos">656</span></a><span class="sd">        ----------</span>
</span><span id="Project.run_episode-657"><a href="#Project.run_episode-657"><span class="linenos">657</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project.run_episode-658"><a href="#Project.run_episode-658"><span class="linenos">658</span></a><span class="sd">            the episode name</span>
</span><span id="Project.run_episode-659"><a href="#Project.run_episode-659"><span class="linenos">659</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="Project.run_episode-660"><a href="#Project.run_episode-660"><span class="linenos">660</span></a><span class="sd">            the (previously run) episode name to load the model from; if the episode has multiple runs,</span>
</span><span id="Project.run_episode-661"><a href="#Project.run_episode-661"><span class="linenos">661</span></a><span class="sd">            the new episode will have the same number of runs, each starting with one of the pre-trained models</span>
</span><span id="Project.run_episode-662"><a href="#Project.run_episode-662"><span class="linenos">662</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project.run_episode-663"><a href="#Project.run_episode-663"><span class="linenos">663</span></a><span class="sd">            the dictionary used to update the parameters from the config files</span>
</span><span id="Project.run_episode-664"><a href="#Project.run_episode-664"><span class="linenos">664</span></a><span class="sd">        task : TaskDispatcher, optional</span>
</span><span id="Project.run_episode-665"><a href="#Project.run_episode-665"><span class="linenos">665</span></a><span class="sd">            a pre-existing `TaskDispatcher` object (if provided, the method will update it instead of creating</span>
</span><span id="Project.run_episode-666"><a href="#Project.run_episode-666"><span class="linenos">666</span></a><span class="sd">            a new instance)</span>
</span><span id="Project.run_episode-667"><a href="#Project.run_episode-667"><span class="linenos">667</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="Project.run_episode-668"><a href="#Project.run_episode-668"><span class="linenos">668</span></a><span class="sd">            the epoch to load (if load_episodes is not None); if not provided, the last epoch is used</span>
</span><span id="Project.run_episode-669"><a href="#Project.run_episode-669"><span class="linenos">669</span></a><span class="sd">        load_search : str, optional</span>
</span><span id="Project.run_episode-670"><a href="#Project.run_episode-670"><span class="linenos">670</span></a><span class="sd">            the hyperparameter search result to load</span>
</span><span id="Project.run_episode-671"><a href="#Project.run_episode-671"><span class="linenos">671</span></a><span class="sd">        load_parameters : list, optional</span>
</span><span id="Project.run_episode-672"><a href="#Project.run_episode-672"><span class="linenos">672</span></a><span class="sd">            a list of string names of the parameters to load from load_search (if not provided, all parameters</span>
</span><span id="Project.run_episode-673"><a href="#Project.run_episode-673"><span class="linenos">673</span></a><span class="sd">            are loaded)</span>
</span><span id="Project.run_episode-674"><a href="#Project.run_episode-674"><span class="linenos">674</span></a><span class="sd">        round_to_binary : list, optional</span>
</span><span id="Project.run_episode-675"><a href="#Project.run_episode-675"><span class="linenos">675</span></a><span class="sd">            a list of string names of the loaded parameters that should be rounded to the nearest power of two</span>
</span><span id="Project.run_episode-676"><a href="#Project.run_episode-676"><span class="linenos">676</span></a><span class="sd">        load_strict : bool, default True</span>
</span><span id="Project.run_episode-677"><a href="#Project.run_episode-677"><span class="linenos">677</span></a><span class="sd">            if `False`, matching weights will be loaded from `load_episode` and differences in parameter name lists and</span>
</span><span id="Project.run_episode-678"><a href="#Project.run_episode-678"><span class="linenos">678</span></a><span class="sd">            weight shapes will be ignored; otherwise mismatches will prompt a `RuntimeError`</span>
</span><span id="Project.run_episode-679"><a href="#Project.run_episode-679"><span class="linenos">679</span></a><span class="sd">        n_seeds : int, default 1</span>
</span><span id="Project.run_episode-680"><a href="#Project.run_episode-680"><span class="linenos">680</span></a><span class="sd">            the number of runs to perform with different random seeds; if `n_seeds &gt; 1`, the episodes will be named</span>
</span><span id="Project.run_episode-681"><a href="#Project.run_episode-681"><span class="linenos">681</span></a><span class="sd">            `episode_name#seed_index`, e.g. `test_episode#0` and `test_episode#1`</span>
</span><span id="Project.run_episode-682"><a href="#Project.run_episode-682"><span class="linenos">682</span></a><span class="sd">        force : bool, default False</span>
</span><span id="Project.run_episode-683"><a href="#Project.run_episode-683"><span class="linenos">683</span></a><span class="sd">            if `True` and an episode with name `episode_name` already exists, it will be overwritten (use with caution!)</span>
</span><span id="Project.run_episode-684"><a href="#Project.run_episode-684"><span class="linenos">684</span></a><span class="sd">        suppress_name_check : bool, default False</span>
</span><span id="Project.run_episode-685"><a href="#Project.run_episode-685"><span class="linenos">685</span></a><span class="sd">            if `True`, episode names with a double colon are allowed (please don&#39;t use this option unless you understand</span>
</span><span id="Project.run_episode-686"><a href="#Project.run_episode-686"><span class="linenos">686</span></a><span class="sd">            why they are usually forbidden)</span>
</span><span id="Project.run_episode-687"><a href="#Project.run_episode-687"><span class="linenos">687</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project.run_episode-688"><a href="#Project.run_episode-688"><span class="linenos">688</span></a><span class="sd">            if `True`, the dataset will be deleted after training</span>
</span><span id="Project.run_episode-689"><a href="#Project.run_episode-689"><span class="linenos">689</span></a><span class="sd">        mask_name : str, optional</span>
</span><span id="Project.run_episode-690"><a href="#Project.run_episode-690"><span class="linenos">690</span></a><span class="sd">            the name of the real_lens to apply</span>
</span><span id="Project.run_episode-691"><a href="#Project.run_episode-691"><span class="linenos">691</span></a><span class="sd">        autostop_interval : int, default 50</span>
</span><span id="Project.run_episode-692"><a href="#Project.run_episode-692"><span class="linenos">692</span></a><span class="sd">            the number of epochs to average the autostop metric over</span>
</span><span id="Project.run_episode-693"><a href="#Project.run_episode-693"><span class="linenos">693</span></a><span class="sd">        autostop_threshold : float, default 0.001</span>
</span><span id="Project.run_episode-694"><a href="#Project.run_episode-694"><span class="linenos">694</span></a><span class="sd">            the autostop difference threshold</span>
</span><span id="Project.run_episode-695"><a href="#Project.run_episode-695"><span class="linenos">695</span></a><span class="sd">        autostop_metric : str, optional</span>
</span><span id="Project.run_episode-696"><a href="#Project.run_episode-696"><span class="linenos">696</span></a><span class="sd">            the autostop metric (can be any one of the tracked metrics of `&#39;loss&#39;`)</span>
</span><span id="Project.run_episode-697"><a href="#Project.run_episode-697"><span class="linenos">697</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.run_episode-698"><a href="#Project.run_episode-698"><span class="linenos">698</span></a>
</span><span id="Project.run_episode-699"><a href="#Project.run_episode-699"><span class="linenos">699</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span> <span class="ow">or</span> <span class="n">n_seeds</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.run_episode-700"><a href="#Project.run_episode-700"><span class="linenos">700</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.run_episode-701"><a href="#Project.run_episode-701"><span class="linenos">701</span></a>                <span class="sa">f</span><span class="s2">&quot;The n_seeds parameter has to be an integer larger than 0; got </span><span class="si">{</span><span class="n">n_seeds</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project.run_episode-702"><a href="#Project.run_episode-702"><span class="linenos">702</span></a>            <span class="p">)</span>
</span><span id="Project.run_episode-703"><a href="#Project.run_episode-703"><span class="linenos">703</span></a>        <span class="k">if</span> <span class="n">n_seeds</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mask_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_episode-704"><a href="#Project.run_episode-704"><span class="linenos">704</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot apply a real_lens with n_seeds &gt; 1&quot;</span><span class="p">)</span>
</span><span id="Project.run_episode-705"><a href="#Project.run_episode-705"><span class="linenos">705</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_episode_validity</span><span class="p">(</span>
</span><span id="Project.run_episode-706"><a href="#Project.run_episode-706"><span class="linenos">706</span></a>            <span class="n">episode_name</span><span class="p">,</span> <span class="n">allow_doublecolon</span><span class="o">=</span><span class="n">suppress_name_check</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span>
</span><span id="Project.run_episode-707"><a href="#Project.run_episode-707"><span class="linenos">707</span></a>        <span class="p">)</span>
</span><span id="Project.run_episode-708"><a href="#Project.run_episode-708"><span class="linenos">708</span></a>        <span class="n">load_runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">load_episode</span><span class="p">)</span>
</span><span id="Project.run_episode-709"><a href="#Project.run_episode-709"><span class="linenos">709</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">load_runs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.run_episode-710"><a href="#Project.run_episode-710"><span class="linenos">710</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_episodes</span><span class="p">(</span>
</span><span id="Project.run_episode-711"><a href="#Project.run_episode-711"><span class="linenos">711</span></a>                <span class="n">episode_names</span><span class="o">=</span><span class="p">[</span>
</span><span id="Project.run_episode-712"><a href="#Project.run_episode-712"><span class="linenos">712</span></a>                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s1">#</span><span class="si">{</span><span class="n">run</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">load_runs</span>
</span><span id="Project.run_episode-713"><a href="#Project.run_episode-713"><span class="linenos">713</span></a>                <span class="p">],</span>
</span><span id="Project.run_episode-714"><a href="#Project.run_episode-714"><span class="linenos">714</span></a>                <span class="n">load_episodes</span><span class="o">=</span><span class="n">load_runs</span><span class="p">,</span>
</span><span id="Project.run_episode-715"><a href="#Project.run_episode-715"><span class="linenos">715</span></a>                <span class="n">parameters_updates</span><span class="o">=</span><span class="p">[</span><span class="n">parameters_update</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project.run_episode-716"><a href="#Project.run_episode-716"><span class="linenos">716</span></a>                <span class="n">load_epochs</span><span class="o">=</span><span class="p">[</span><span class="n">load_epoch</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project.run_episode-717"><a href="#Project.run_episode-717"><span class="linenos">717</span></a>                <span class="n">load_searches</span><span class="o">=</span><span class="p">[</span><span class="n">load_search</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project.run_episode-718"><a href="#Project.run_episode-718"><span class="linenos">718</span></a>                <span class="n">load_parameters</span><span class="o">=</span><span class="p">[</span><span class="n">load_parameters</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project.run_episode-719"><a href="#Project.run_episode-719"><span class="linenos">719</span></a>                <span class="n">round_to_binary</span><span class="o">=</span><span class="p">[</span><span class="n">round_to_binary</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project.run_episode-720"><a href="#Project.run_episode-720"><span class="linenos">720</span></a>                <span class="n">load_strict</span><span class="o">=</span><span class="p">[</span><span class="n">load_strict</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">load_runs</span><span class="p">],</span>
</span><span id="Project.run_episode-721"><a href="#Project.run_episode-721"><span class="linenos">721</span></a>                <span class="n">suppress_name_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project.run_episode-722"><a href="#Project.run_episode-722"><span class="linenos">722</span></a>                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="Project.run_episode-723"><a href="#Project.run_episode-723"><span class="linenos">723</span></a>                <span class="n">remove_saved_features</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_episode-724"><a href="#Project.run_episode-724"><span class="linenos">724</span></a>            <span class="p">)</span>
</span><span id="Project.run_episode-725"><a href="#Project.run_episode-725"><span class="linenos">725</span></a>            <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project.run_episode-726"><a href="#Project.run_episode-726"><span class="linenos">726</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span>
</span><span id="Project.run_episode-727"><a href="#Project.run_episode-727"><span class="linenos">727</span></a>                    <span class="p">{</span>
</span><span id="Project.run_episode-728"><a href="#Project.run_episode-728"><span class="linenos">728</span></a>                        <span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">general_parameters</span><span class="p">,</span>
</span><span id="Project.run_episode-729"><a href="#Project.run_episode-729"><span class="linenos">729</span></a>                        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">data_parameters</span><span class="p">,</span>
</span><span id="Project.run_episode-730"><a href="#Project.run_episode-730"><span class="linenos">730</span></a>                        <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">feature_parameters</span><span class="p">,</span>
</span><span id="Project.run_episode-731"><a href="#Project.run_episode-731"><span class="linenos">731</span></a>                    <span class="p">}</span>
</span><span id="Project.run_episode-732"><a href="#Project.run_episode-732"><span class="linenos">732</span></a>                <span class="p">)</span>
</span><span id="Project.run_episode-733"><a href="#Project.run_episode-733"><span class="linenos">733</span></a>            <span class="k">if</span> <span class="n">n_seeds</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.run_episode-734"><a href="#Project.run_episode-734"><span class="linenos">734</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Project.run_episode-735"><a href="#Project.run_episode-735"><span class="linenos">735</span></a>                    <span class="sa">f</span><span class="s2">&quot;The n_seeds parameter is disregarded since load_episode=</span><span class="si">{</span><span class="n">load_episode</span><span class="si">}</span><span class="s2"> has multiple runs&quot;</span>
</span><span id="Project.run_episode-736"><a href="#Project.run_episode-736"><span class="linenos">736</span></a>                <span class="p">)</span>
</span><span id="Project.run_episode-737"><a href="#Project.run_episode-737"><span class="linenos">737</span></a>        <span class="k">elif</span> <span class="n">n_seeds</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.run_episode-738"><a href="#Project.run_episode-738"><span class="linenos">738</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_episodes</span><span class="p">(</span>
</span><span id="Project.run_episode-739"><a href="#Project.run_episode-739"><span class="linenos">739</span></a>                <span class="n">episode_names</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project.run_episode-740"><a href="#Project.run_episode-740"><span class="linenos">740</span></a>                <span class="n">load_episodes</span><span class="o">=</span><span class="p">[</span><span class="n">load_episode</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project.run_episode-741"><a href="#Project.run_episode-741"><span class="linenos">741</span></a>                <span class="n">parameters_updates</span><span class="o">=</span><span class="p">[</span><span class="n">parameters_update</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project.run_episode-742"><a href="#Project.run_episode-742"><span class="linenos">742</span></a>                <span class="n">load_epochs</span><span class="o">=</span><span class="p">[</span><span class="n">load_epoch</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project.run_episode-743"><a href="#Project.run_episode-743"><span class="linenos">743</span></a>                <span class="n">load_searches</span><span class="o">=</span><span class="p">[</span><span class="n">load_search</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project.run_episode-744"><a href="#Project.run_episode-744"><span class="linenos">744</span></a>                <span class="n">load_parameters</span><span class="o">=</span><span class="p">[</span><span class="n">load_parameters</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project.run_episode-745"><a href="#Project.run_episode-745"><span class="linenos">745</span></a>                <span class="n">round_to_binary</span><span class="o">=</span><span class="p">[</span><span class="n">round_to_binary</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project.run_episode-746"><a href="#Project.run_episode-746"><span class="linenos">746</span></a>                <span class="n">load_strict</span><span class="o">=</span><span class="p">[</span><span class="n">load_strict</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_seeds</span><span class="p">)],</span>
</span><span id="Project.run_episode-747"><a href="#Project.run_episode-747"><span class="linenos">747</span></a>                <span class="n">suppress_name_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project.run_episode-748"><a href="#Project.run_episode-748"><span class="linenos">748</span></a>                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="Project.run_episode-749"><a href="#Project.run_episode-749"><span class="linenos">749</span></a>                <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="Project.run_episode-750"><a href="#Project.run_episode-750"><span class="linenos">750</span></a>            <span class="p">)</span>
</span><span id="Project.run_episode-751"><a href="#Project.run_episode-751"><span class="linenos">751</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.run_episode-752"><a href="#Project.run_episode-752"><span class="linenos">752</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAINING </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.run_episode-753"><a href="#Project.run_episode-753"><span class="linenos">753</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Project.run_episode-754"><a href="#Project.run_episode-754"><span class="linenos">754</span></a>                <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="Project.run_episode-755"><a href="#Project.run_episode-755"><span class="linenos">755</span></a>                    <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project.run_episode-756"><a href="#Project.run_episode-756"><span class="linenos">756</span></a>                    <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project.run_episode-757"><a href="#Project.run_episode-757"><span class="linenos">757</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.run_episode-758"><a href="#Project.run_episode-758"><span class="linenos">758</span></a>                    <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project.run_episode-759"><a href="#Project.run_episode-759"><span class="linenos">759</span></a>                    <span class="n">load_search</span><span class="p">,</span>
</span><span id="Project.run_episode-760"><a href="#Project.run_episode-760"><span class="linenos">760</span></a>                    <span class="n">load_parameters</span><span class="p">,</span>
</span><span id="Project.run_episode-761"><a href="#Project.run_episode-761"><span class="linenos">761</span></a>                    <span class="n">round_to_binary</span><span class="p">,</span>
</span><span id="Project.run_episode-762"><a href="#Project.run_episode-762"><span class="linenos">762</span></a>                    <span class="n">continuing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_episode-763"><a href="#Project.run_episode-763"><span class="linenos">763</span></a>                    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project.run_episode-764"><a href="#Project.run_episode-764"><span class="linenos">764</span></a>                    <span class="n">mask_name</span><span class="o">=</span><span class="n">mask_name</span><span class="p">,</span>
</span><span id="Project.run_episode-765"><a href="#Project.run_episode-765"><span class="linenos">765</span></a>                    <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project.run_episode-766"><a href="#Project.run_episode-766"><span class="linenos">766</span></a>                <span class="p">)</span>
</span><span id="Project.run_episode-767"><a href="#Project.run_episode-767"><span class="linenos">767</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_save_episode</span><span class="p">(</span>
</span><span id="Project.run_episode-768"><a href="#Project.run_episode-768"><span class="linenos">768</span></a>                    <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project.run_episode-769"><a href="#Project.run_episode-769"><span class="linenos">769</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project.run_episode-770"><a href="#Project.run_episode-770"><span class="linenos">770</span></a>                    <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">(),</span>
</span><span id="Project.run_episode-771"><a href="#Project.run_episode-771"><span class="linenos">771</span></a>                    <span class="n">norm_stats</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">get_normalization_stats</span><span class="p">(),</span>
</span><span id="Project.run_episode-772"><a href="#Project.run_episode-772"><span class="linenos">772</span></a>                <span class="p">)</span>
</span><span id="Project.run_episode-773"><a href="#Project.run_episode-773"><span class="linenos">773</span></a>                <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Project.run_episode-774"><a href="#Project.run_episode-774"><span class="linenos">774</span></a>                <span class="k">if</span> <span class="n">trial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_episode-775"><a href="#Project.run_episode-775"><span class="linenos">775</span></a>                    <span class="n">trial</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="n">trial</span>
</span><span id="Project.run_episode-776"><a href="#Project.run_episode-776"><span class="linenos">776</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project.run_episode-777"><a href="#Project.run_episode-777"><span class="linenos">777</span></a>                    <span class="n">trial</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="Project.run_episode-778"><a href="#Project.run_episode-778"><span class="linenos">778</span></a>                <span class="n">logs</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
</span><span id="Project.run_episode-779"><a href="#Project.run_episode-779"><span class="linenos">779</span></a>                    <span class="n">autostop_metric</span><span class="o">=</span><span class="n">autostop_metric</span><span class="p">,</span>
</span><span id="Project.run_episode-780"><a href="#Project.run_episode-780"><span class="linenos">780</span></a>                    <span class="n">autostop_interval</span><span class="o">=</span><span class="n">autostop_interval</span><span class="p">,</span>
</span><span id="Project.run_episode-781"><a href="#Project.run_episode-781"><span class="linenos">781</span></a>                    <span class="n">autostop_threshold</span><span class="o">=</span><span class="n">autostop_threshold</span><span class="p">,</span>
</span><span id="Project.run_episode-782"><a href="#Project.run_episode-782"><span class="linenos">782</span></a>                    <span class="n">loading_bar</span><span class="o">=</span><span class="n">loading_bar</span><span class="p">,</span>
</span><span id="Project.run_episode-783"><a href="#Project.run_episode-783"><span class="linenos">783</span></a>                    <span class="n">trial</span><span class="o">=</span><span class="n">trial</span><span class="p">,</span>
</span><span id="Project.run_episode-784"><a href="#Project.run_episode-784"><span class="linenos">784</span></a>                    <span class="n">optimized_metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
</span><span id="Project.run_episode-785"><a href="#Project.run_episode-785"><span class="linenos">785</span></a>                <span class="p">)</span>
</span><span id="Project.run_episode-786"><a href="#Project.run_episode-786"><span class="linenos">786</span></a>                <span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Project.run_episode-787"><a href="#Project.run_episode-787"><span class="linenos">787</span></a>                <span class="n">time_total</span> <span class="o">=</span> <span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span>
</span><span id="Project.run_episode-788"><a href="#Project.run_episode-788"><span class="linenos">788</span></a>                <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span>
</span><span id="Project.run_episode-789"><a href="#Project.run_episode-789"><span class="linenos">789</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span>
</span><span id="Project.run_episode-790"><a href="#Project.run_episode-790"><span class="linenos">790</span></a>                <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="Project.run_episode-791"><a href="#Project.run_episode-791"><span class="linenos">791</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>
</span><span id="Project.run_episode-792"><a href="#Project.run_episode-792"><span class="linenos">792</span></a>                <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span><span class="p">)</span>
</span><span id="Project.run_episode-793"><a href="#Project.run_episode-793"><span class="linenos">793</span></a>                <span class="n">training_time</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">minutes</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">seconds</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project.run_episode-794"><a href="#Project.run_episode-794"><span class="linenos">794</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_results</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">logs</span><span class="p">,</span> <span class="n">training_time</span><span class="p">)</span>
</span><span id="Project.run_episode-795"><a href="#Project.run_episode-795"><span class="linenos">795</span></a>                <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project.run_episode-796"><a href="#Project.run_episode-796"><span class="linenos">796</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project.run_episode-797"><a href="#Project.run_episode-797"><span class="linenos">797</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.run_episode-798"><a href="#Project.run_episode-798"><span class="linenos">798</span></a>                <span class="k">return</span> <span class="n">task</span>
</span><span id="Project.run_episode-799"><a href="#Project.run_episode-799"><span class="linenos">799</span></a>
</span><span id="Project.run_episode-800"><a href="#Project.run_episode-800"><span class="linenos">800</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Project.run_episode-801"><a href="#Project.run_episode-801"><span class="linenos">801</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">optuna</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">TrialPruned</span><span class="p">):</span>
</span><span id="Project.run_episode-802"><a href="#Project.run_episode-802"><span class="linenos">802</span></a>                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="Project.run_episode-803"><a href="#Project.run_episode-803"><span class="linenos">803</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project.run_episode-804"><a href="#Project.run_episode-804"><span class="linenos">804</span></a>                    <span class="c1"># if str(e) != f&quot;The {episode_name} episode name is already in use!&quot;:</span>
</span><span id="Project.run_episode-805"><a href="#Project.run_episode-805"><span class="linenos">805</span></a>                    <span class="c1">#     self.remove_episode(episode_name)</span>
</span><span id="Project.run_episode-806"><a href="#Project.run_episode-806"><span class="linenos">806</span></a>                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Episode </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> could not run&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Run an episode</p>

<p>The task parameters are read from the config files and then updated with the
parameters_update dictionary. The model can be either initialized from scratch or loaded from one of the
previous experiments. All parameters and results are saved in the meta files and can be accessed with the
list_episodes() function. The train/test/validation split is saved and loaded from a file whenever the
same split parameters are used. The pre-computed datasets are also saved and loaded whenever the same
data parameters are used.</p>

<p>You can use the autostop parameters to finish training when the parameters are not improving. It will be
stopped if the average value of <code>autostop_metric</code> over the last <code>autostop_interval</code> epochs is smaller than
the average over the previous <code>autostop_interval</code> epochs + <code>autostop_threshold</code>. For example, if the
current epoch is 120 and <code>autostop_interval</code> is 50, the averages over epochs 70-120 and 20-70 will be compared.</p>

<h2 id="parameters">Parameters</h2>

<p>episode_name : str
    the episode name
load_episode : str, optional
    the (previously run) episode name to load the model from; if the episode has multiple runs,
    the new episode will have the same number of runs, each starting with one of the pre-trained models
parameters_update : dict, optional
    the dictionary used to update the parameters from the config files
task : TaskDispatcher, optional
    a pre-existing <code>TaskDispatcher</code> object (if provided, the method will update it instead of creating
    a new instance)
load_epoch : int, optional
    the epoch to load (if load_episodes is not None); if not provided, the last epoch is used
load_search : str, optional
    the hyperparameter search result to load
load_parameters : list, optional
    a list of string names of the parameters to load from load_search (if not provided, all parameters
    are loaded)
round_to_binary : list, optional
    a list of string names of the loaded parameters that should be rounded to the nearest power of two
load_strict : bool, default True
    if <code>False</code>, matching weights will be loaded from <code>load_episode</code> and differences in parameter name lists and
    weight shapes will be ignored; otherwise mismatches will prompt a <code>RuntimeError</code>
n_seeds : int, default 1
    the number of runs to perform with different random seeds; if <code>n_seeds &gt; 1</code>, the episodes will be named
    <code>episode_name#seed_index</code>, e.g. <code>test_episode#0</code> and <code>test_episode#1</code>
force : bool, default False
    if <code>True</code> and an episode with name <code>episode_name</code> already exists, it will be overwritten (use with caution!)
suppress_name_check : bool, default False
    if <code>True</code>, episode names with a double colon are allowed (please don't use this option unless you understand
    why they are usually forbidden)
remove_saved_features : bool, default False
    if <code>True</code>, the dataset will be deleted after training
mask_name : str, optional
    the name of the real_lens to apply
autostop_interval : int, default 50
    the number of epochs to average the autostop metric over
autostop_threshold : float, default 0.001
    the autostop difference threshold
autostop_metric : str, optional
    the autostop metric (can be any one of the tracked metrics of <code>'loss'</code>)</p>
</div>


                            </div>
                            <div id="Project.run_episodes" class="classattr">
                                        <input id="Project.run_episodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_episodes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">load_episodes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parameters_updates</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_searches</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_strict</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">suppress_name_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="../task/task_dispatcher.html#TaskDispatcher">dlc2action.task.task_dispatcher.TaskDispatcher</a></span>:</span></span>

                <label class="view-source-button" for="Project.run_episodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.run_episodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.run_episodes-808"><a href="#Project.run_episodes-808"><span class="linenos">808</span></a>    <span class="k">def</span> <span class="nf">run_episodes</span><span class="p">(</span>
</span><span id="Project.run_episodes-809"><a href="#Project.run_episodes-809"><span class="linenos">809</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.run_episodes-810"><a href="#Project.run_episodes-810"><span class="linenos">810</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project.run_episodes-811"><a href="#Project.run_episodes-811"><span class="linenos">811</span></a>        <span class="n">load_episodes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episodes-812"><a href="#Project.run_episodes-812"><span class="linenos">812</span></a>        <span class="n">parameters_updates</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episodes-813"><a href="#Project.run_episodes-813"><span class="linenos">813</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episodes-814"><a href="#Project.run_episodes-814"><span class="linenos">814</span></a>        <span class="n">load_searches</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episodes-815"><a href="#Project.run_episodes-815"><span class="linenos">815</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episodes-816"><a href="#Project.run_episodes-816"><span class="linenos">816</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episodes-817"><a href="#Project.run_episodes-817"><span class="linenos">817</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_episodes-818"><a href="#Project.run_episodes-818"><span class="linenos">818</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_episodes-819"><a href="#Project.run_episodes-819"><span class="linenos">819</span></a>        <span class="n">suppress_name_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_episodes-820"><a href="#Project.run_episodes-820"><span class="linenos">820</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_episodes-821"><a href="#Project.run_episodes-821"><span class="linenos">821</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskDispatcher</span><span class="p">:</span>
</span><span id="Project.run_episodes-822"><a href="#Project.run_episodes-822"><span class="linenos">822</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.run_episodes-823"><a href="#Project.run_episodes-823"><span class="linenos">823</span></a><span class="sd">        Run multiple episodes in sequence (and re-use previously loaded information)</span>
</span><span id="Project.run_episodes-824"><a href="#Project.run_episodes-824"><span class="linenos">824</span></a>
</span><span id="Project.run_episodes-825"><a href="#Project.run_episodes-825"><span class="linenos">825</span></a><span class="sd">        For each episode, the task parameters are read from the config files and then updated with the</span>
</span><span id="Project.run_episodes-826"><a href="#Project.run_episodes-826"><span class="linenos">826</span></a><span class="sd">        parameter_update dictionary. The model can be either initialized from scratch or loaded from one of the</span>
</span><span id="Project.run_episodes-827"><a href="#Project.run_episodes-827"><span class="linenos">827</span></a><span class="sd">        previous experiments. All parameters and results are saved in the meta files and can be accessed with the</span>
</span><span id="Project.run_episodes-828"><a href="#Project.run_episodes-828"><span class="linenos">828</span></a><span class="sd">        list_episodes() function. The train/test/validation split is saved and loaded from a file whenever the</span>
</span><span id="Project.run_episodes-829"><a href="#Project.run_episodes-829"><span class="linenos">829</span></a><span class="sd">        same split parameters are used. The pre-computed datasets are also saved and loaded whenever the same</span>
</span><span id="Project.run_episodes-830"><a href="#Project.run_episodes-830"><span class="linenos">830</span></a><span class="sd">        data parameters are used.</span>
</span><span id="Project.run_episodes-831"><a href="#Project.run_episodes-831"><span class="linenos">831</span></a>
</span><span id="Project.run_episodes-832"><a href="#Project.run_episodes-832"><span class="linenos">832</span></a><span class="sd">        Parameters</span>
</span><span id="Project.run_episodes-833"><a href="#Project.run_episodes-833"><span class="linenos">833</span></a><span class="sd">        ----------</span>
</span><span id="Project.run_episodes-834"><a href="#Project.run_episodes-834"><span class="linenos">834</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project.run_episodes-835"><a href="#Project.run_episodes-835"><span class="linenos">835</span></a><span class="sd">            a list of strings of episode names</span>
</span><span id="Project.run_episodes-836"><a href="#Project.run_episodes-836"><span class="linenos">836</span></a><span class="sd">        load_episodes : list, optional</span>
</span><span id="Project.run_episodes-837"><a href="#Project.run_episodes-837"><span class="linenos">837</span></a><span class="sd">            a list of strings of (previously run) episode names to load the model from; if the episode has multiple runs,</span>
</span><span id="Project.run_episodes-838"><a href="#Project.run_episodes-838"><span class="linenos">838</span></a><span class="sd">            the new episode will have the same number of runs, each starting with one of the pre-trained models</span>
</span><span id="Project.run_episodes-839"><a href="#Project.run_episodes-839"><span class="linenos">839</span></a><span class="sd">        parameters_updates : list, optional</span>
</span><span id="Project.run_episodes-840"><a href="#Project.run_episodes-840"><span class="linenos">840</span></a><span class="sd">            a list of dictionaries used to update the parameters from the config</span>
</span><span id="Project.run_episodes-841"><a href="#Project.run_episodes-841"><span class="linenos">841</span></a><span class="sd">        load_epochs : list, optional</span>
</span><span id="Project.run_episodes-842"><a href="#Project.run_episodes-842"><span class="linenos">842</span></a><span class="sd">            a list of integers used to specify the epoch to load (if load_episodes is not None)</span>
</span><span id="Project.run_episodes-843"><a href="#Project.run_episodes-843"><span class="linenos">843</span></a><span class="sd">        load_searches : list, optional</span>
</span><span id="Project.run_episodes-844"><a href="#Project.run_episodes-844"><span class="linenos">844</span></a><span class="sd">            a list of strings of hyperparameter search results to load</span>
</span><span id="Project.run_episodes-845"><a href="#Project.run_episodes-845"><span class="linenos">845</span></a><span class="sd">        load_parameters : list, optional</span>
</span><span id="Project.run_episodes-846"><a href="#Project.run_episodes-846"><span class="linenos">846</span></a><span class="sd">            a list of lists of string names of the parameters to load from the searches</span>
</span><span id="Project.run_episodes-847"><a href="#Project.run_episodes-847"><span class="linenos">847</span></a><span class="sd">        round_to_binary : list, optional</span>
</span><span id="Project.run_episodes-848"><a href="#Project.run_episodes-848"><span class="linenos">848</span></a><span class="sd">            a list of string names of the loaded parameters that should be rounded to the nearest power of two</span>
</span><span id="Project.run_episodes-849"><a href="#Project.run_episodes-849"><span class="linenos">849</span></a><span class="sd">        load_strict : list, optional</span>
</span><span id="Project.run_episodes-850"><a href="#Project.run_episodes-850"><span class="linenos">850</span></a><span class="sd">            a list of boolean values specifying weight loading policy: if `False`, matching weights will be loaded from</span>
</span><span id="Project.run_episodes-851"><a href="#Project.run_episodes-851"><span class="linenos">851</span></a><span class="sd">            the corresponding episode and differences in parameter name lists and</span>
</span><span id="Project.run_episodes-852"><a href="#Project.run_episodes-852"><span class="linenos">852</span></a><span class="sd">            weight shapes will be ignored; otherwise mismatches will prompt a `RuntimeError` (by default `True` for</span>
</span><span id="Project.run_episodes-853"><a href="#Project.run_episodes-853"><span class="linenos">853</span></a><span class="sd">            every episode)</span>
</span><span id="Project.run_episodes-854"><a href="#Project.run_episodes-854"><span class="linenos">854</span></a><span class="sd">        force : bool, default False</span>
</span><span id="Project.run_episodes-855"><a href="#Project.run_episodes-855"><span class="linenos">855</span></a><span class="sd">            if `True` and an episode name is already taken, it will be overwritten (use with caution!)</span>
</span><span id="Project.run_episodes-856"><a href="#Project.run_episodes-856"><span class="linenos">856</span></a><span class="sd">        suppress_name_check : bool, default False</span>
</span><span id="Project.run_episodes-857"><a href="#Project.run_episodes-857"><span class="linenos">857</span></a><span class="sd">            if `True`, episode names with a double colon are allowed (please don&#39;t use this option unless you understand</span>
</span><span id="Project.run_episodes-858"><a href="#Project.run_episodes-858"><span class="linenos">858</span></a><span class="sd">            why they are usually forbidden)</span>
</span><span id="Project.run_episodes-859"><a href="#Project.run_episodes-859"><span class="linenos">859</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project.run_episodes-860"><a href="#Project.run_episodes-860"><span class="linenos">860</span></a><span class="sd">            if `True`, the dataset will be deleted after training</span>
</span><span id="Project.run_episodes-861"><a href="#Project.run_episodes-861"><span class="linenos">861</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.run_episodes-862"><a href="#Project.run_episodes-862"><span class="linenos">862</span></a>
</span><span id="Project.run_episodes-863"><a href="#Project.run_episodes-863"><span class="linenos">863</span></a>        <span class="n">task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project.run_episodes-864"><a href="#Project.run_episodes-864"><span class="linenos">864</span></a>        <span class="k">if</span> <span class="n">load_searches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_episodes-865"><a href="#Project.run_episodes-865"><span class="linenos">865</span></a>            <span class="n">load_searches</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project.run_episodes-866"><a href="#Project.run_episodes-866"><span class="linenos">866</span></a>        <span class="k">if</span> <span class="n">load_episodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_episodes-867"><a href="#Project.run_episodes-867"><span class="linenos">867</span></a>            <span class="n">load_episodes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project.run_episodes-868"><a href="#Project.run_episodes-868"><span class="linenos">868</span></a>        <span class="k">if</span> <span class="n">parameters_updates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_episodes-869"><a href="#Project.run_episodes-869"><span class="linenos">869</span></a>            <span class="n">parameters_updates</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project.run_episodes-870"><a href="#Project.run_episodes-870"><span class="linenos">870</span></a>        <span class="k">if</span> <span class="n">load_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_episodes-871"><a href="#Project.run_episodes-871"><span class="linenos">871</span></a>            <span class="n">load_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project.run_episodes-872"><a href="#Project.run_episodes-872"><span class="linenos">872</span></a>        <span class="k">if</span> <span class="n">load_epochs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_episodes-873"><a href="#Project.run_episodes-873"><span class="linenos">873</span></a>            <span class="n">load_epochs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project.run_episodes-874"><a href="#Project.run_episodes-874"><span class="linenos">874</span></a>        <span class="k">if</span> <span class="n">load_strict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_episodes-875"><a href="#Project.run_episodes-875"><span class="linenos">875</span></a>            <span class="n">load_strict</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">]</span>
</span><span id="Project.run_episodes-876"><a href="#Project.run_episodes-876"><span class="linenos">876</span></a>        <span class="k">for</span> <span class="p">(</span>
</span><span id="Project.run_episodes-877"><a href="#Project.run_episodes-877"><span class="linenos">877</span></a>            <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.run_episodes-878"><a href="#Project.run_episodes-878"><span class="linenos">878</span></a>            <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project.run_episodes-879"><a href="#Project.run_episodes-879"><span class="linenos">879</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project.run_episodes-880"><a href="#Project.run_episodes-880"><span class="linenos">880</span></a>            <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project.run_episodes-881"><a href="#Project.run_episodes-881"><span class="linenos">881</span></a>            <span class="n">load_search</span><span class="p">,</span>
</span><span id="Project.run_episodes-882"><a href="#Project.run_episodes-882"><span class="linenos">882</span></a>            <span class="n">load_parameters_list</span><span class="p">,</span>
</span><span id="Project.run_episodes-883"><a href="#Project.run_episodes-883"><span class="linenos">883</span></a>            <span class="n">load_strict_value</span><span class="p">,</span>
</span><span id="Project.run_episodes-884"><a href="#Project.run_episodes-884"><span class="linenos">884</span></a>        <span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Project.run_episodes-885"><a href="#Project.run_episodes-885"><span class="linenos">885</span></a>            <span class="n">parameters_updates</span><span class="p">,</span>
</span><span id="Project.run_episodes-886"><a href="#Project.run_episodes-886"><span class="linenos">886</span></a>            <span class="n">episode_names</span><span class="p">,</span>
</span><span id="Project.run_episodes-887"><a href="#Project.run_episodes-887"><span class="linenos">887</span></a>            <span class="n">load_episodes</span><span class="p">,</span>
</span><span id="Project.run_episodes-888"><a href="#Project.run_episodes-888"><span class="linenos">888</span></a>            <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project.run_episodes-889"><a href="#Project.run_episodes-889"><span class="linenos">889</span></a>            <span class="n">load_searches</span><span class="p">,</span>
</span><span id="Project.run_episodes-890"><a href="#Project.run_episodes-890"><span class="linenos">890</span></a>            <span class="n">load_parameters</span><span class="p">,</span>
</span><span id="Project.run_episodes-891"><a href="#Project.run_episodes-891"><span class="linenos">891</span></a>            <span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project.run_episodes-892"><a href="#Project.run_episodes-892"><span class="linenos">892</span></a>        <span class="p">):</span>
</span><span id="Project.run_episodes-893"><a href="#Project.run_episodes-893"><span class="linenos">893</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_episode</span><span class="p">(</span>
</span><span id="Project.run_episodes-894"><a href="#Project.run_episodes-894"><span class="linenos">894</span></a>                <span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project.run_episodes-895"><a href="#Project.run_episodes-895"><span class="linenos">895</span></a>                <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project.run_episodes-896"><a href="#Project.run_episodes-896"><span class="linenos">896</span></a>                <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.run_episodes-897"><a href="#Project.run_episodes-897"><span class="linenos">897</span></a>                <span class="n">task</span><span class="p">,</span>
</span><span id="Project.run_episodes-898"><a href="#Project.run_episodes-898"><span class="linenos">898</span></a>                <span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project.run_episodes-899"><a href="#Project.run_episodes-899"><span class="linenos">899</span></a>                <span class="n">load_search</span><span class="p">,</span>
</span><span id="Project.run_episodes-900"><a href="#Project.run_episodes-900"><span class="linenos">900</span></a>                <span class="n">load_parameters_list</span><span class="p">,</span>
</span><span id="Project.run_episodes-901"><a href="#Project.run_episodes-901"><span class="linenos">901</span></a>                <span class="n">round_to_binary</span><span class="p">,</span>
</span><span id="Project.run_episodes-902"><a href="#Project.run_episodes-902"><span class="linenos">902</span></a>                <span class="n">load_strict_value</span><span class="p">,</span>
</span><span id="Project.run_episodes-903"><a href="#Project.run_episodes-903"><span class="linenos">903</span></a>                <span class="n">suppress_name_check</span><span class="o">=</span><span class="n">suppress_name_check</span><span class="p">,</span>
</span><span id="Project.run_episodes-904"><a href="#Project.run_episodes-904"><span class="linenos">904</span></a>                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="Project.run_episodes-905"><a href="#Project.run_episodes-905"><span class="linenos">905</span></a>                <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="Project.run_episodes-906"><a href="#Project.run_episodes-906"><span class="linenos">906</span></a>            <span class="p">)</span>
</span><span id="Project.run_episodes-907"><a href="#Project.run_episodes-907"><span class="linenos">907</span></a>        <span class="k">return</span> <span class="n">task</span>
</span></pre></div>


            <div class="docstring"><p>Run multiple episodes in sequence (and re-use previously loaded information)</p>

<p>For each episode, the task parameters are read from the config files and then updated with the
parameter_update dictionary. The model can be either initialized from scratch or loaded from one of the
previous experiments. All parameters and results are saved in the meta files and can be accessed with the
list_episodes() function. The train/test/validation split is saved and loaded from a file whenever the
same split parameters are used. The pre-computed datasets are also saved and loaded whenever the same
data parameters are used.</p>

<h2 id="parameters">Parameters</h2>

<p>episode_names : list
    a list of strings of episode names
load_episodes : list, optional
    a list of strings of (previously run) episode names to load the model from; if the episode has multiple runs,
    the new episode will have the same number of runs, each starting with one of the pre-trained models
parameters_updates : list, optional
    a list of dictionaries used to update the parameters from the config
load_epochs : list, optional
    a list of integers used to specify the epoch to load (if load_episodes is not None)
load_searches : list, optional
    a list of strings of hyperparameter search results to load
load_parameters : list, optional
    a list of lists of string names of the parameters to load from the searches
round_to_binary : list, optional
    a list of string names of the loaded parameters that should be rounded to the nearest power of two
load_strict : list, optional
    a list of boolean values specifying weight loading policy: if <code>False</code>, matching weights will be loaded from
    the corresponding episode and differences in parameter name lists and
    weight shapes will be ignored; otherwise mismatches will prompt a <code>RuntimeError</code> (by default <code>True</code> for
    every episode)
force : bool, default False
    if <code>True</code> and an episode name is already taken, it will be overwritten (use with caution!)
suppress_name_check : bool, default False
    if <code>True</code>, episode names with a double colon are allowed (please don't use this option unless you understand
    why they are usually forbidden)
remove_saved_features : bool, default False
    if <code>True</code>, the dataset will be deleted after training</p>
</div>


                            </div>
                            <div id="Project.continue_episode" class="classattr">
                                        <input id="Project.continue_episode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">continue_episode</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">num_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">task</span><span class="p">:</span> <span class="n"><a href="../task/task_dispatcher.html#TaskDispatcher">dlc2action.task.task_dispatcher.TaskDispatcher</a></span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">n_seeds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cuda&#39;</span>,</span><span class="param">	<span class="n">num_cpus</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="../task/task_dispatcher.html#TaskDispatcher">dlc2action.task.task_dispatcher.TaskDispatcher</a></span>:</span></span>

                <label class="view-source-button" for="Project.continue_episode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.continue_episode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.continue_episode-909"><a href="#Project.continue_episode-909"><span class="linenos">909</span></a>    <span class="k">def</span> <span class="nf">continue_episode</span><span class="p">(</span>
</span><span id="Project.continue_episode-910"><a href="#Project.continue_episode-910"><span class="linenos">910</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.continue_episode-911"><a href="#Project.continue_episode-911"><span class="linenos">911</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project.continue_episode-912"><a href="#Project.continue_episode-912"><span class="linenos">912</span></a>        <span class="n">num_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.continue_episode-913"><a href="#Project.continue_episode-913"><span class="linenos">913</span></a>        <span class="n">task</span><span class="p">:</span> <span class="n">TaskDispatcher</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.continue_episode-914"><a href="#Project.continue_episode-914"><span class="linenos">914</span></a>        <span class="n">n_seeds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project.continue_episode-915"><a href="#Project.continue_episode-915"><span class="linenos">915</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.continue_episode-916"><a href="#Project.continue_episode-916"><span class="linenos">916</span></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
</span><span id="Project.continue_episode-917"><a href="#Project.continue_episode-917"><span class="linenos">917</span></a>        <span class="n">num_cpus</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.continue_episode-918"><a href="#Project.continue_episode-918"><span class="linenos">918</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TaskDispatcher</span><span class="p">:</span>
</span><span id="Project.continue_episode-919"><a href="#Project.continue_episode-919"><span class="linenos">919</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.continue_episode-920"><a href="#Project.continue_episode-920"><span class="linenos">920</span></a><span class="sd">        Load an older episode and continue running from the latest checkpoint</span>
</span><span id="Project.continue_episode-921"><a href="#Project.continue_episode-921"><span class="linenos">921</span></a>
</span><span id="Project.continue_episode-922"><a href="#Project.continue_episode-922"><span class="linenos">922</span></a><span class="sd">        All parameters as well as the model and optimizer state dictionaries are loaded from the episode.</span>
</span><span id="Project.continue_episode-923"><a href="#Project.continue_episode-923"><span class="linenos">923</span></a>
</span><span id="Project.continue_episode-924"><a href="#Project.continue_episode-924"><span class="linenos">924</span></a><span class="sd">        Parameters</span>
</span><span id="Project.continue_episode-925"><a href="#Project.continue_episode-925"><span class="linenos">925</span></a><span class="sd">        ----------</span>
</span><span id="Project.continue_episode-926"><a href="#Project.continue_episode-926"><span class="linenos">926</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project.continue_episode-927"><a href="#Project.continue_episode-927"><span class="linenos">927</span></a><span class="sd">            the name of the episode to continue</span>
</span><span id="Project.continue_episode-928"><a href="#Project.continue_episode-928"><span class="linenos">928</span></a><span class="sd">        num_epochs : int, optional</span>
</span><span id="Project.continue_episode-929"><a href="#Project.continue_episode-929"><span class="linenos">929</span></a><span class="sd">            the new number of epochs</span>
</span><span id="Project.continue_episode-930"><a href="#Project.continue_episode-930"><span class="linenos">930</span></a><span class="sd">        task : TaskDispatcher, optional</span>
</span><span id="Project.continue_episode-931"><a href="#Project.continue_episode-931"><span class="linenos">931</span></a><span class="sd">            a pre-existing task; if provided, the method will update the task instead of creating a new one</span>
</span><span id="Project.continue_episode-932"><a href="#Project.continue_episode-932"><span class="linenos">932</span></a><span class="sd">            (this might save time, mainly on dataset loading)</span>
</span><span id="Project.continue_episode-933"><a href="#Project.continue_episode-933"><span class="linenos">933</span></a><span class="sd">        result_average_interval : int, default 5</span>
</span><span id="Project.continue_episode-934"><a href="#Project.continue_episode-934"><span class="linenos">934</span></a><span class="sd">            the metric are averaged over the last result_average_interval to be stored in the episodes meta file</span>
</span><span id="Project.continue_episode-935"><a href="#Project.continue_episode-935"><span class="linenos">935</span></a><span class="sd">            and displayed by list_episodes() function (the full log is still always available)</span>
</span><span id="Project.continue_episode-936"><a href="#Project.continue_episode-936"><span class="linenos">936</span></a><span class="sd">        n_seeds : int, default 1</span>
</span><span id="Project.continue_episode-937"><a href="#Project.continue_episode-937"><span class="linenos">937</span></a><span class="sd">            the number of runs to perform; if `n_seeds &gt; 1`, the episodes will be named `episode_name#run_index`, e.g.</span>
</span><span id="Project.continue_episode-938"><a href="#Project.continue_episode-938"><span class="linenos">938</span></a><span class="sd">            `test_episode#0` and `test_episode#1`</span>
</span><span id="Project.continue_episode-939"><a href="#Project.continue_episode-939"><span class="linenos">939</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project.continue_episode-940"><a href="#Project.continue_episode-940"><span class="linenos">940</span></a><span class="sd">            if `True`, pre-computed features will be deleted after the run</span>
</span><span id="Project.continue_episode-941"><a href="#Project.continue_episode-941"><span class="linenos">941</span></a><span class="sd">        device : str, default &quot;cuda&quot;</span>
</span><span id="Project.continue_episode-942"><a href="#Project.continue_episode-942"><span class="linenos">942</span></a><span class="sd">            the torch device to use</span>
</span><span id="Project.continue_episode-943"><a href="#Project.continue_episode-943"><span class="linenos">943</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.continue_episode-944"><a href="#Project.continue_episode-944"><span class="linenos">944</span></a>
</span><span id="Project.continue_episode-945"><a href="#Project.continue_episode-945"><span class="linenos">945</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project.continue_episode-946"><a href="#Project.continue_episode-946"><span class="linenos">946</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project.continue_episode-947"><a href="#Project.continue_episode-947"><span class="linenos">947</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAINING </span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.continue_episode-948"><a href="#Project.continue_episode-948"><span class="linenos">948</span></a>            <span class="k">if</span> <span class="n">num_epochs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">unfinished</span><span class="p">():</span>
</span><span id="Project.continue_episode-949"><a href="#Project.continue_episode-949"><span class="linenos">949</span></a>                <span class="k">continue</span>
</span><span id="Project.continue_episode-950"><a href="#Project.continue_episode-950"><span class="linenos">950</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project.continue_episode-951"><a href="#Project.continue_episode-951"><span class="linenos">951</span></a>                <span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="Project.continue_episode-952"><a href="#Project.continue_episode-952"><span class="linenos">952</span></a>                    <span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="n">num_epochs</span><span class="p">,</span>
</span><span id="Project.continue_episode-953"><a href="#Project.continue_episode-953"><span class="linenos">953</span></a>                    <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="n">device</span><span class="p">,</span>
</span><span id="Project.continue_episode-954"><a href="#Project.continue_episode-954"><span class="linenos">954</span></a>                <span class="p">},</span>
</span><span id="Project.continue_episode-955"><a href="#Project.continue_episode-955"><span class="linenos">955</span></a>                <span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;num_cpus&quot;</span><span class="p">:</span> <span class="n">num_cpus</span><span class="p">},</span>
</span><span id="Project.continue_episode-956"><a href="#Project.continue_episode-956"><span class="linenos">956</span></a>            <span class="p">}</span>
</span><span id="Project.continue_episode-957"><a href="#Project.continue_episode-957"><span class="linenos">957</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="Project.continue_episode-958"><a href="#Project.continue_episode-958"><span class="linenos">958</span></a>                <span class="n">run</span><span class="p">,</span>
</span><span id="Project.continue_episode-959"><a href="#Project.continue_episode-959"><span class="linenos">959</span></a>                <span class="n">load_episode</span><span class="o">=</span><span class="n">run</span><span class="p">,</span>
</span><span id="Project.continue_episode-960"><a href="#Project.continue_episode-960"><span class="linenos">960</span></a>                <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.continue_episode-961"><a href="#Project.continue_episode-961"><span class="linenos">961</span></a>                <span class="n">continuing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project.continue_episode-962"><a href="#Project.continue_episode-962"><span class="linenos">962</span></a>                <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project.continue_episode-963"><a href="#Project.continue_episode-963"><span class="linenos">963</span></a>            <span class="p">)</span>
</span><span id="Project.continue_episode-964"><a href="#Project.continue_episode-964"><span class="linenos">964</span></a>            <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Project.continue_episode-965"><a href="#Project.continue_episode-965"><span class="linenos">965</span></a>            <span class="n">logs</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="Project.continue_episode-966"><a href="#Project.continue_episode-966"><span class="linenos">966</span></a>            <span class="n">time_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="Project.continue_episode-967"><a href="#Project.continue_episode-967"><span class="linenos">967</span></a>            <span class="n">old_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_training_time</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="Project.continue_episode-968"><a href="#Project.continue_episode-968"><span class="linenos">968</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">old_time</span><span class="p">):</span>
</span><span id="Project.continue_episode-969"><a href="#Project.continue_episode-969"><span class="linenos">969</span></a>                <span class="n">time_end</span> <span class="o">+=</span> <span class="n">old_time</span>
</span><span id="Project.continue_episode-970"><a href="#Project.continue_episode-970"><span class="linenos">970</span></a>                <span class="n">time_total</span> <span class="o">=</span> <span class="n">time_end</span> <span class="o">-</span> <span class="n">time_start</span>
</span><span id="Project.continue_episode-971"><a href="#Project.continue_episode-971"><span class="linenos">971</span></a>                <span class="n">hours</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">)</span>
</span><span id="Project.continue_episode-972"><a href="#Project.continue_episode-972"><span class="linenos">972</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">hours</span> <span class="o">*</span> <span class="mi">3600</span>
</span><span id="Project.continue_episode-973"><a href="#Project.continue_episode-973"><span class="linenos">973</span></a>                <span class="n">minutes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span>
</span><span id="Project.continue_episode-974"><a href="#Project.continue_episode-974"><span class="linenos">974</span></a>                <span class="n">time_total</span> <span class="o">-=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>
</span><span id="Project.continue_episode-975"><a href="#Project.continue_episode-975"><span class="linenos">975</span></a>                <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_total</span><span class="p">)</span>
</span><span id="Project.continue_episode-976"><a href="#Project.continue_episode-976"><span class="linenos">976</span></a>                <span class="n">training_time</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">minutes</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">seconds</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project.continue_episode-977"><a href="#Project.continue_episode-977"><span class="linenos">977</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project.continue_episode-978"><a href="#Project.continue_episode-978"><span class="linenos">978</span></a>                <span class="n">training_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span><span id="Project.continue_episode-979"><a href="#Project.continue_episode-979"><span class="linenos">979</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_episode</span><span class="p">(</span>
</span><span id="Project.continue_episode-980"><a href="#Project.continue_episode-980"><span class="linenos">980</span></a>                <span class="n">run</span><span class="p">,</span>
</span><span id="Project.continue_episode-981"><a href="#Project.continue_episode-981"><span class="linenos">981</span></a>                <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project.continue_episode-982"><a href="#Project.continue_episode-982"><span class="linenos">982</span></a>                <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">(),</span>
</span><span id="Project.continue_episode-983"><a href="#Project.continue_episode-983"><span class="linenos">983</span></a>                <span class="n">suppress_validation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project.continue_episode-984"><a href="#Project.continue_episode-984"><span class="linenos">984</span></a>                <span class="n">training_time</span><span class="o">=</span><span class="n">training_time</span><span class="p">,</span>
</span><span id="Project.continue_episode-985"><a href="#Project.continue_episode-985"><span class="linenos">985</span></a>                <span class="n">norm_stats</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">get_normalization_stats</span><span class="p">(),</span>
</span><span id="Project.continue_episode-986"><a href="#Project.continue_episode-986"><span class="linenos">986</span></a>            <span class="p">)</span>
</span><span id="Project.continue_episode-987"><a href="#Project.continue_episode-987"><span class="linenos">987</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_results</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">logs</span><span class="p">)</span>
</span><span id="Project.continue_episode-988"><a href="#Project.continue_episode-988"><span class="linenos">988</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.continue_episode-989"><a href="#Project.continue_episode-989"><span class="linenos">989</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n_seeds</span><span class="p">:</span>
</span><span id="Project.continue_episode-990"><a href="#Project.continue_episode-990"><span class="linenos">990</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">),</span> <span class="n">n_seeds</span><span class="p">):</span>
</span><span id="Project.continue_episode-991"><a href="#Project.continue_episode-991"><span class="linenos">991</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">run_episode</span><span class="p">(</span>
</span><span id="Project.continue_episode-992"><a href="#Project.continue_episode-992"><span class="linenos">992</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Project.continue_episode-993"><a href="#Project.continue_episode-993"><span class="linenos">993</span></a>                    <span class="n">parameters_update</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="Project.continue_episode-994"><a href="#Project.continue_episode-994"><span class="linenos">994</span></a>                    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project.continue_episode-995"><a href="#Project.continue_episode-995"><span class="linenos">995</span></a>                    <span class="n">suppress_name_check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Project.continue_episode-996"><a href="#Project.continue_episode-996"><span class="linenos">996</span></a>                <span class="p">)</span>
</span><span id="Project.continue_episode-997"><a href="#Project.continue_episode-997"><span class="linenos">997</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project.continue_episode-998"><a href="#Project.continue_episode-998"><span class="linenos">998</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project.continue_episode-999"><a href="#Project.continue_episode-999"><span class="linenos">999</span></a>        <span class="k">return</span> <span class="n">task</span>
</span></pre></div>


            <div class="docstring"><p>Load an older episode and continue running from the latest checkpoint</p>

<p>All parameters as well as the model and optimizer state dictionaries are loaded from the episode.</p>

<h2 id="parameters">Parameters</h2>

<p>episode_name : str
    the name of the episode to continue
num_epochs : int, optional
    the new number of epochs
task : TaskDispatcher, optional
    a pre-existing task; if provided, the method will update the task instead of creating a new one
    (this might save time, mainly on dataset loading)
result_average_interval : int, default 5
    the metric are averaged over the last result_average_interval to be stored in the episodes meta file
    and displayed by list_episodes() function (the full log is still always available)
n_seeds : int, default 1
    the number of runs to perform; if <code>n_seeds &gt; 1</code>, the episodes will be named <code>episode_name#run_index</code>, e.g.
    <code>test_episode#0</code> and <code>test_episode#1</code>
remove_saved_features : bool, default False
    if <code>True</code>, pre-computed features will be deleted after the run
device : str, default "cuda"
    the torch device to use</p>
</div>


                            </div>
                            <div id="Project.run_default_hyperparameter_search" class="classattr">
                                        <input id="Project.run_default_hyperparameter_search-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_default_hyperparameter_search</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;f1&#39;</span>,</span><span class="param">	<span class="n">best_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>,</span><span class="param">	<span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;maximize&#39;</span>,</span><span class="param">	<span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">num_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>,</span><span class="param">	<span class="n">test_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">n_trials</span><span class="o">=</span><span class="mi">150</span>,</span><span class="param">	<span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Project.run_default_hyperparameter_search-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.run_default_hyperparameter_search"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.run_default_hyperparameter_search-1001"><a href="#Project.run_default_hyperparameter_search-1001"><span class="linenos">1001</span></a>    <span class="k">def</span> <span class="nf">run_default_hyperparameter_search</span><span class="p">(</span>
</span><span id="Project.run_default_hyperparameter_search-1002"><a href="#Project.run_default_hyperparameter_search-1002"><span class="linenos">1002</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1003"><a href="#Project.run_default_hyperparameter_search-1003"><span class="linenos">1003</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1004"><a href="#Project.run_default_hyperparameter_search-1004"><span class="linenos">1004</span></a>        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1005"><a href="#Project.run_default_hyperparameter_search-1005"><span class="linenos">1005</span></a>        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1006"><a href="#Project.run_default_hyperparameter_search-1006"><span class="linenos">1006</span></a>        <span class="n">best_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1007"><a href="#Project.run_default_hyperparameter_search-1007"><span class="linenos">1007</span></a>        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;maximize&quot;</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1008"><a href="#Project.run_default_hyperparameter_search-1008"><span class="linenos">1008</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1009"><a href="#Project.run_default_hyperparameter_search-1009"><span class="linenos">1009</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1010"><a href="#Project.run_default_hyperparameter_search-1010"><span class="linenos">1010</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1011"><a href="#Project.run_default_hyperparameter_search-1011"><span class="linenos">1011</span></a>        <span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1012"><a href="#Project.run_default_hyperparameter_search-1012"><span class="linenos">1012</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1013"><a href="#Project.run_default_hyperparameter_search-1013"><span class="linenos">1013</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1014"><a href="#Project.run_default_hyperparameter_search-1014"><span class="linenos">1014</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1015"><a href="#Project.run_default_hyperparameter_search-1015"><span class="linenos">1015</span></a>        <span class="n">num_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1016"><a href="#Project.run_default_hyperparameter_search-1016"><span class="linenos">1016</span></a>        <span class="n">test_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1017"><a href="#Project.run_default_hyperparameter_search-1017"><span class="linenos">1017</span></a>        <span class="n">n_trials</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1018"><a href="#Project.run_default_hyperparameter_search-1018"><span class="linenos">1018</span></a>        <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1019"><a href="#Project.run_default_hyperparameter_search-1019"><span class="linenos">1019</span></a>    <span class="p">):</span>
</span><span id="Project.run_default_hyperparameter_search-1020"><a href="#Project.run_default_hyperparameter_search-1020"><span class="linenos">1020</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.run_default_hyperparameter_search-1021"><a href="#Project.run_default_hyperparameter_search-1021"><span class="linenos">1021</span></a><span class="sd">        Run an optuna hyperparameter search with default parameters for a model</span>
</span><span id="Project.run_default_hyperparameter_search-1022"><a href="#Project.run_default_hyperparameter_search-1022"><span class="linenos">1022</span></a>
</span><span id="Project.run_default_hyperparameter_search-1023"><a href="#Project.run_default_hyperparameter_search-1023"><span class="linenos">1023</span></a><span class="sd">        For the vast majority of cases, optimizing the default parameters should be enough.</span>
</span><span id="Project.run_default_hyperparameter_search-1024"><a href="#Project.run_default_hyperparameter_search-1024"><span class="linenos">1024</span></a><span class="sd">        Check out `dlc2action.options.model_hyperparameters` for the lists of parameters.</span>
</span><span id="Project.run_default_hyperparameter_search-1025"><a href="#Project.run_default_hyperparameter_search-1025"><span class="linenos">1025</span></a><span class="sd">        There are also options to set overlap, test fraction and number of epochs parameters for the search without</span>
</span><span id="Project.run_default_hyperparameter_search-1026"><a href="#Project.run_default_hyperparameter_search-1026"><span class="linenos">1026</span></a><span class="sd">        modifying the project config files. However, if you want something more complex, look into</span>
</span><span id="Project.run_default_hyperparameter_search-1027"><a href="#Project.run_default_hyperparameter_search-1027"><span class="linenos">1027</span></a><span class="sd">        `Project.run_hyperparameter_search`.</span>
</span><span id="Project.run_default_hyperparameter_search-1028"><a href="#Project.run_default_hyperparameter_search-1028"><span class="linenos">1028</span></a>
</span><span id="Project.run_default_hyperparameter_search-1029"><a href="#Project.run_default_hyperparameter_search-1029"><span class="linenos">1029</span></a><span class="sd">        The task parameters are read from the config files and updated with the parameters_update dictionary.</span>
</span><span id="Project.run_default_hyperparameter_search-1030"><a href="#Project.run_default_hyperparameter_search-1030"><span class="linenos">1030</span></a><span class="sd">        The model can be either initialized from scratch or loaded from a previously run episode.</span>
</span><span id="Project.run_default_hyperparameter_search-1031"><a href="#Project.run_default_hyperparameter_search-1031"><span class="linenos">1031</span></a><span class="sd">        For each trial, the objective metric is averaged over a few best epochs.</span>
</span><span id="Project.run_default_hyperparameter_search-1032"><a href="#Project.run_default_hyperparameter_search-1032"><span class="linenos">1032</span></a>
</span><span id="Project.run_default_hyperparameter_search-1033"><a href="#Project.run_default_hyperparameter_search-1033"><span class="linenos">1033</span></a><span class="sd">        Parameters</span>
</span><span id="Project.run_default_hyperparameter_search-1034"><a href="#Project.run_default_hyperparameter_search-1034"><span class="linenos">1034</span></a><span class="sd">        ----------</span>
</span><span id="Project.run_default_hyperparameter_search-1035"><a href="#Project.run_default_hyperparameter_search-1035"><span class="linenos">1035</span></a><span class="sd">        search_name : str</span>
</span><span id="Project.run_default_hyperparameter_search-1036"><a href="#Project.run_default_hyperparameter_search-1036"><span class="linenos">1036</span></a><span class="sd">            the name of the search to store it in the meta files and load in run_episode</span>
</span><span id="Project.run_default_hyperparameter_search-1037"><a href="#Project.run_default_hyperparameter_search-1037"><span class="linenos">1037</span></a><span class="sd">        model_name : str, optional</span>
</span><span id="Project.run_default_hyperparameter_search-1038"><a href="#Project.run_default_hyperparameter_search-1038"><span class="linenos">1038</span></a><span class="sd">            the name of the model (by default loaded from the project settings, see `project.help(&#39;models&#39;)` for options)</span>
</span><span id="Project.run_default_hyperparameter_search-1039"><a href="#Project.run_default_hyperparameter_search-1039"><span class="linenos">1039</span></a><span class="sd">        metric : str, default f1</span>
</span><span id="Project.run_default_hyperparameter_search-1040"><a href="#Project.run_default_hyperparameter_search-1040"><span class="linenos">1040</span></a><span class="sd">            the metric to maximize/minimize (see direction); if the metric has an `&quot;average&quot;` parameter and it is set to</span>
</span><span id="Project.run_default_hyperparameter_search-1041"><a href="#Project.run_default_hyperparameter_search-1041"><span class="linenos">1041</span></a><span class="sd">            `&quot;none&quot;` in the config files, it will be reset to `&quot;macro&quot;` for the search; see `project.help(&#39;metrics&#39;)` for options</span>
</span><span id="Project.run_default_hyperparameter_search-1042"><a href="#Project.run_default_hyperparameter_search-1042"><span class="linenos">1042</span></a><span class="sd">        n_trials : int, default 20</span>
</span><span id="Project.run_default_hyperparameter_search-1043"><a href="#Project.run_default_hyperparameter_search-1043"><span class="linenos">1043</span></a><span class="sd">            the number of optimization trials to run</span>
</span><span id="Project.run_default_hyperparameter_search-1044"><a href="#Project.run_default_hyperparameter_search-1044"><span class="linenos">1044</span></a><span class="sd">        best_n : int, default 1</span>
</span><span id="Project.run_default_hyperparameter_search-1045"><a href="#Project.run_default_hyperparameter_search-1045"><span class="linenos">1045</span></a><span class="sd">            the number of epochs to average the metric; if 0, the last value is taken</span>
</span><span id="Project.run_default_hyperparameter_search-1046"><a href="#Project.run_default_hyperparameter_search-1046"><span class="linenos">1046</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project.run_default_hyperparameter_search-1047"><a href="#Project.run_default_hyperparameter_search-1047"><span class="linenos">1047</span></a><span class="sd">            the parameters update dictionary</span>
</span><span id="Project.run_default_hyperparameter_search-1048"><a href="#Project.run_default_hyperparameter_search-1048"><span class="linenos">1048</span></a><span class="sd">        direction : {&#39;maximize&#39;, &#39;minimize&#39;}</span>
</span><span id="Project.run_default_hyperparameter_search-1049"><a href="#Project.run_default_hyperparameter_search-1049"><span class="linenos">1049</span></a><span class="sd">            optimization direction</span>
</span><span id="Project.run_default_hyperparameter_search-1050"><a href="#Project.run_default_hyperparameter_search-1050"><span class="linenos">1050</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="Project.run_default_hyperparameter_search-1051"><a href="#Project.run_default_hyperparameter_search-1051"><span class="linenos">1051</span></a><span class="sd">            the name of the episode to load the model from</span>
</span><span id="Project.run_default_hyperparameter_search-1052"><a href="#Project.run_default_hyperparameter_search-1052"><span class="linenos">1052</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="Project.run_default_hyperparameter_search-1053"><a href="#Project.run_default_hyperparameter_search-1053"><span class="linenos">1053</span></a><span class="sd">            the epoch to load the model from (if not provided, the last checkpoint is used)</span>
</span><span id="Project.run_default_hyperparameter_search-1054"><a href="#Project.run_default_hyperparameter_search-1054"><span class="linenos">1054</span></a><span class="sd">        prune : bool, default False</span>
</span><span id="Project.run_default_hyperparameter_search-1055"><a href="#Project.run_default_hyperparameter_search-1055"><span class="linenos">1055</span></a><span class="sd">            if `True`, experiments where the optimized metric is improving too slowly will be terminated</span>
</span><span id="Project.run_default_hyperparameter_search-1056"><a href="#Project.run_default_hyperparameter_search-1056"><span class="linenos">1056</span></a><span class="sd">            (with optuna HyperBand pruner)</span>
</span><span id="Project.run_default_hyperparameter_search-1057"><a href="#Project.run_default_hyperparameter_search-1057"><span class="linenos">1057</span></a><span class="sd">        force : bool, default False</span>
</span><span id="Project.run_default_hyperparameter_search-1058"><a href="#Project.run_default_hyperparameter_search-1058"><span class="linenos">1058</span></a><span class="sd">            if `True`, existing searches with the same name will be overwritten</span>
</span><span id="Project.run_default_hyperparameter_search-1059"><a href="#Project.run_default_hyperparameter_search-1059"><span class="linenos">1059</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project.run_default_hyperparameter_search-1060"><a href="#Project.run_default_hyperparameter_search-1060"><span class="linenos">1060</span></a><span class="sd">            if `True`, pre-computed features will be deleted after each run (if the data parameters change)</span>
</span><span id="Project.run_default_hyperparameter_search-1061"><a href="#Project.run_default_hyperparameter_search-1061"><span class="linenos">1061</span></a><span class="sd">        device : str, optional</span>
</span><span id="Project.run_default_hyperparameter_search-1062"><a href="#Project.run_default_hyperparameter_search-1062"><span class="linenos">1062</span></a><span class="sd">            cuda:{i} or cpu, if not given it is read from the default parameters</span>
</span><span id="Project.run_default_hyperparameter_search-1063"><a href="#Project.run_default_hyperparameter_search-1063"><span class="linenos">1063</span></a>
</span><span id="Project.run_default_hyperparameter_search-1064"><a href="#Project.run_default_hyperparameter_search-1064"><span class="linenos">1064</span></a><span class="sd">        Returns</span>
</span><span id="Project.run_default_hyperparameter_search-1065"><a href="#Project.run_default_hyperparameter_search-1065"><span class="linenos">1065</span></a><span class="sd">        -------</span>
</span><span id="Project.run_default_hyperparameter_search-1066"><a href="#Project.run_default_hyperparameter_search-1066"><span class="linenos">1066</span></a><span class="sd">        dict</span>
</span><span id="Project.run_default_hyperparameter_search-1067"><a href="#Project.run_default_hyperparameter_search-1067"><span class="linenos">1067</span></a><span class="sd">            a dictionary of best parameters</span>
</span><span id="Project.run_default_hyperparameter_search-1068"><a href="#Project.run_default_hyperparameter_search-1068"><span class="linenos">1068</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.run_default_hyperparameter_search-1069"><a href="#Project.run_default_hyperparameter_search-1069"><span class="linenos">1069</span></a>
</span><span id="Project.run_default_hyperparameter_search-1070"><a href="#Project.run_default_hyperparameter_search-1070"><span class="linenos">1070</span></a>        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_default_hyperparameter_search-1071"><a href="#Project.run_default_hyperparameter_search-1071"><span class="linenos">1071</span></a>            <span class="n">model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="Project.run_default_hyperparameter_search-1072"><a href="#Project.run_default_hyperparameter_search-1072"><span class="linenos">1072</span></a>        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">model_hyperparameters</span><span class="p">:</span>
</span><span id="Project.run_default_hyperparameter_search-1073"><a href="#Project.run_default_hyperparameter_search-1073"><span class="linenos">1073</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.run_default_hyperparameter_search-1074"><a href="#Project.run_default_hyperparameter_search-1074"><span class="linenos">1074</span></a>                <span class="sa">f</span><span class="s2">&quot;There is no default search space for </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">! Please choose from </span><span class="si">{</span><span class="n">options</span><span class="o">.</span><span class="n">model_hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2"> or try project.run_hyperparameter_search()&quot;</span>
</span><span id="Project.run_default_hyperparameter_search-1075"><a href="#Project.run_default_hyperparameter_search-1075"><span class="linenos">1075</span></a>            <span class="p">)</span>
</span><span id="Project.run_default_hyperparameter_search-1076"><a href="#Project.run_default_hyperparameter_search-1076"><span class="linenos">1076</span></a>        <span class="n">pars</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project.run_default_hyperparameter_search-1077"><a href="#Project.run_default_hyperparameter_search-1077"><span class="linenos">1077</span></a>            <span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="Project.run_default_hyperparameter_search-1078"><a href="#Project.run_default_hyperparameter_search-1078"><span class="linenos">1078</span></a>                <span class="s2">&quot;overlap&quot;</span><span class="p">:</span> <span class="n">overlap</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1079"><a href="#Project.run_default_hyperparameter_search-1079"><span class="linenos">1079</span></a>                <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1080"><a href="#Project.run_default_hyperparameter_search-1080"><span class="linenos">1080</span></a>                <span class="s2">&quot;metric_functions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">metric</span><span class="p">},</span>
</span><span id="Project.run_default_hyperparameter_search-1081"><a href="#Project.run_default_hyperparameter_search-1081"><span class="linenos">1081</span></a>            <span class="p">},</span>
</span><span id="Project.run_default_hyperparameter_search-1082"><a href="#Project.run_default_hyperparameter_search-1082"><span class="linenos">1082</span></a>            <span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;num_epochs&quot;</span><span class="p">:</span> <span class="n">num_epochs</span><span class="p">},</span>
</span><span id="Project.run_default_hyperparameter_search-1083"><a href="#Project.run_default_hyperparameter_search-1083"><span class="linenos">1083</span></a>        <span class="p">}</span>
</span><span id="Project.run_default_hyperparameter_search-1084"><a href="#Project.run_default_hyperparameter_search-1084"><span class="linenos">1084</span></a>        <span class="k">if</span> <span class="n">test_frac</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_default_hyperparameter_search-1085"><a href="#Project.run_default_hyperparameter_search-1085"><span class="linenos">1085</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;test_frac&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_frac</span>
</span><span id="Project.run_default_hyperparameter_search-1086"><a href="#Project.run_default_hyperparameter_search-1086"><span class="linenos">1086</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">metric</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
</span><span id="Project.run_default_hyperparameter_search-1087"><a href="#Project.run_default_hyperparameter_search-1087"><span class="linenos">1087</span></a>            <span class="n">project_pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="Project.run_default_hyperparameter_search-1088"><a href="#Project.run_default_hyperparameter_search-1088"><span class="linenos">1088</span></a>            <span class="k">if</span> <span class="n">project_pars</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;average&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span id="Project.run_default_hyperparameter_search-1089"><a href="#Project.run_default_hyperparameter_search-1089"><span class="linenos">1089</span></a>                <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">metric</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;average&quot;</span><span class="p">:</span> <span class="s2">&quot;macro&quot;</span><span class="p">}}</span>
</span><span id="Project.run_default_hyperparameter_search-1090"><a href="#Project.run_default_hyperparameter_search-1090"><span class="linenos">1090</span></a>        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_default_hyperparameter_search-1091"><a href="#Project.run_default_hyperparameter_search-1091"><span class="linenos">1091</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;device&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="Project.run_default_hyperparameter_search-1092"><a href="#Project.run_default_hyperparameter_search-1092"><span class="linenos">1092</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_hyperparameter_search</span><span class="p">(</span>
</span><span id="Project.run_default_hyperparameter_search-1093"><a href="#Project.run_default_hyperparameter_search-1093"><span class="linenos">1093</span></a>            <span class="n">search_name</span><span class="o">=</span><span class="n">search_name</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1094"><a href="#Project.run_default_hyperparameter_search-1094"><span class="linenos">1094</span></a>            <span class="n">search_space</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">model_hyperparameters</span><span class="p">[</span><span class="n">model_name</span><span class="p">],</span>
</span><span id="Project.run_default_hyperparameter_search-1095"><a href="#Project.run_default_hyperparameter_search-1095"><span class="linenos">1095</span></a>            <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1096"><a href="#Project.run_default_hyperparameter_search-1096"><span class="linenos">1096</span></a>            <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1097"><a href="#Project.run_default_hyperparameter_search-1097"><span class="linenos">1097</span></a>            <span class="n">best_n</span><span class="o">=</span><span class="n">best_n</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1098"><a href="#Project.run_default_hyperparameter_search-1098"><span class="linenos">1098</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">pars</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1099"><a href="#Project.run_default_hyperparameter_search-1099"><span class="linenos">1099</span></a>            <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1100"><a href="#Project.run_default_hyperparameter_search-1100"><span class="linenos">1100</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1101"><a href="#Project.run_default_hyperparameter_search-1101"><span class="linenos">1101</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1102"><a href="#Project.run_default_hyperparameter_search-1102"><span class="linenos">1102</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1103"><a href="#Project.run_default_hyperparameter_search-1103"><span class="linenos">1103</span></a>            <span class="n">prune</span><span class="o">=</span><span class="n">prune</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1104"><a href="#Project.run_default_hyperparameter_search-1104"><span class="linenos">1104</span></a>            <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1105"><a href="#Project.run_default_hyperparameter_search-1105"><span class="linenos">1105</span></a>            <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="Project.run_default_hyperparameter_search-1106"><a href="#Project.run_default_hyperparameter_search-1106"><span class="linenos">1106</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Run an optuna hyperparameter search with default parameters for a model</p>

<p>For the vast majority of cases, optimizing the default parameters should be enough.
Check out <code><a href="../options.html#model_hyperparameters">dlc2action.options.model_hyperparameters</a></code> for the lists of parameters.
There are also options to set overlap, test fraction and number of epochs parameters for the search without
modifying the project config files. However, if you want something more complex, look into
<code><a href="#Project.run_hyperparameter_search">Project.run_hyperparameter_search</a></code>.</p>

<p>The task parameters are read from the config files and updated with the parameters_update dictionary.
The model can be either initialized from scratch or loaded from a previously run episode.
For each trial, the objective metric is averaged over a few best epochs.</p>

<h2 id="parameters">Parameters</h2>

<p>search_name : str
    the name of the search to store it in the meta files and load in run_episode
model_name : str, optional
    the name of the model (by default loaded from the project settings, see <code>project.help('models')</code> for options)
metric : str, default f1
    the metric to maximize/minimize (see direction); if the metric has an <code>"average"</code> parameter and it is set to
    <code>"none"</code> in the config files, it will be reset to <code>"macro"</code> for the search; see <code>project.help('metrics')</code> for options
n_trials : int, default 20
    the number of optimization trials to run
best_n : int, default 1
    the number of epochs to average the metric; if 0, the last value is taken
parameters_update : dict, optional
    the parameters update dictionary
direction : {'maximize', 'minimize'}
    optimization direction
load_episode : str, optional
    the name of the episode to load the model from
load_epoch : int, optional
    the epoch to load the model from (if not provided, the last checkpoint is used)
prune : bool, default False
    if <code>True</code>, experiments where the optimized metric is improving too slowly will be terminated
    (with optuna HyperBand pruner)
force : bool, default False
    if <code>True</code>, existing searches with the same name will be overwritten
remove_saved_features : bool, default False
    if <code>True</code>, pre-computed features will be deleted after each run (if the data parameters change)
device : str, optional
    cuda:{i} or cpu, if not given it is read from the default parameters</p>

<h2 id="returns">Returns</h2>

<p>dict
    a dictionary of best parameters</p>
</div>


                            </div>
                            <div id="Project.run_hyperparameter_search" class="classattr">
                                        <input id="Project.run_hyperparameter_search-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_hyperparameter_search</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span>,</span><span class="param">	<span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;f1&#39;</span>,</span><span class="param">	<span class="n">n_trials</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>,</span><span class="param">	<span class="n">best_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;maximize&#39;</span>,</span><span class="param">	<span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="Project.run_hyperparameter_search-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.run_hyperparameter_search"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.run_hyperparameter_search-1108"><a href="#Project.run_hyperparameter_search-1108"><span class="linenos">1108</span></a>    <span class="k">def</span> <span class="nf">run_hyperparameter_search</span><span class="p">(</span>
</span><span id="Project.run_hyperparameter_search-1109"><a href="#Project.run_hyperparameter_search-1109"><span class="linenos">1109</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1110"><a href="#Project.run_hyperparameter_search-1110"><span class="linenos">1110</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1111"><a href="#Project.run_hyperparameter_search-1111"><span class="linenos">1111</span></a>        <span class="n">search_space</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1112"><a href="#Project.run_hyperparameter_search-1112"><span class="linenos">1112</span></a>        <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1113"><a href="#Project.run_hyperparameter_search-1113"><span class="linenos">1113</span></a>        <span class="n">n_trials</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1114"><a href="#Project.run_hyperparameter_search-1114"><span class="linenos">1114</span></a>        <span class="n">best_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1115"><a href="#Project.run_hyperparameter_search-1115"><span class="linenos">1115</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1116"><a href="#Project.run_hyperparameter_search-1116"><span class="linenos">1116</span></a>        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;maximize&quot;</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1117"><a href="#Project.run_hyperparameter_search-1117"><span class="linenos">1117</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1118"><a href="#Project.run_hyperparameter_search-1118"><span class="linenos">1118</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1119"><a href="#Project.run_hyperparameter_search-1119"><span class="linenos">1119</span></a>        <span class="n">load_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1120"><a href="#Project.run_hyperparameter_search-1120"><span class="linenos">1120</span></a>        <span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1121"><a href="#Project.run_hyperparameter_search-1121"><span class="linenos">1121</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1122"><a href="#Project.run_hyperparameter_search-1122"><span class="linenos">1122</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1123"><a href="#Project.run_hyperparameter_search-1123"><span class="linenos">1123</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project.run_hyperparameter_search-1124"><a href="#Project.run_hyperparameter_search-1124"><span class="linenos">1124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.run_hyperparameter_search-1125"><a href="#Project.run_hyperparameter_search-1125"><span class="linenos">1125</span></a><span class="sd">        Run an optuna hyperparameter search</span>
</span><span id="Project.run_hyperparameter_search-1126"><a href="#Project.run_hyperparameter_search-1126"><span class="linenos">1126</span></a>
</span><span id="Project.run_hyperparameter_search-1127"><a href="#Project.run_hyperparameter_search-1127"><span class="linenos">1127</span></a><span class="sd">        For a simpler function that fits most use cases, check out `Project.run_default_hyperparameter_search()`.</span>
</span><span id="Project.run_hyperparameter_search-1128"><a href="#Project.run_hyperparameter_search-1128"><span class="linenos">1128</span></a>
</span><span id="Project.run_hyperparameter_search-1129"><a href="#Project.run_hyperparameter_search-1129"><span class="linenos">1129</span></a><span class="sd">        To use a default search space with this method, import `dlc2action.options.model_hyperparameters`. It is</span>
</span><span id="Project.run_hyperparameter_search-1130"><a href="#Project.run_hyperparameter_search-1130"><span class="linenos">1130</span></a><span class="sd">        a dictionary where keys are model names and values are default search spaces.</span>
</span><span id="Project.run_hyperparameter_search-1131"><a href="#Project.run_hyperparameter_search-1131"><span class="linenos">1131</span></a>
</span><span id="Project.run_hyperparameter_search-1132"><a href="#Project.run_hyperparameter_search-1132"><span class="linenos">1132</span></a><span class="sd">        The task parameters are read from the config files and updated with the parameters_update dictionary.</span>
</span><span id="Project.run_hyperparameter_search-1133"><a href="#Project.run_hyperparameter_search-1133"><span class="linenos">1133</span></a><span class="sd">        The model can be either initialized from scratch or loaded from a previously run episode.</span>
</span><span id="Project.run_hyperparameter_search-1134"><a href="#Project.run_hyperparameter_search-1134"><span class="linenos">1134</span></a><span class="sd">        For each trial, the objective metric is averaged over a few best epochs.</span>
</span><span id="Project.run_hyperparameter_search-1135"><a href="#Project.run_hyperparameter_search-1135"><span class="linenos">1135</span></a>
</span><span id="Project.run_hyperparameter_search-1136"><a href="#Project.run_hyperparameter_search-1136"><span class="linenos">1136</span></a><span class="sd">        Parameters</span>
</span><span id="Project.run_hyperparameter_search-1137"><a href="#Project.run_hyperparameter_search-1137"><span class="linenos">1137</span></a><span class="sd">        ----------</span>
</span><span id="Project.run_hyperparameter_search-1138"><a href="#Project.run_hyperparameter_search-1138"><span class="linenos">1138</span></a><span class="sd">        search_name : str</span>
</span><span id="Project.run_hyperparameter_search-1139"><a href="#Project.run_hyperparameter_search-1139"><span class="linenos">1139</span></a><span class="sd">            the name of the search to store it in the meta files and load in run_episode</span>
</span><span id="Project.run_hyperparameter_search-1140"><a href="#Project.run_hyperparameter_search-1140"><span class="linenos">1140</span></a><span class="sd">        search_space : dict</span>
</span><span id="Project.run_hyperparameter_search-1141"><a href="#Project.run_hyperparameter_search-1141"><span class="linenos">1141</span></a><span class="sd">            a dictionary representing the search space; of this general structure:</span>
</span><span id="Project.run_hyperparameter_search-1142"><a href="#Project.run_hyperparameter_search-1142"><span class="linenos">1142</span></a><span class="sd">            {&#39;group/param_name&#39;: (&#39;float/int/float_log/int_log&#39;, start, end),</span>
</span><span id="Project.run_hyperparameter_search-1143"><a href="#Project.run_hyperparameter_search-1143"><span class="linenos">1143</span></a><span class="sd">            &#39;group/param_name&#39;: (&#39;categorical&#39;, [choices])}, e.g.</span>
</span><span id="Project.run_hyperparameter_search-1144"><a href="#Project.run_hyperparameter_search-1144"><span class="linenos">1144</span></a><span class="sd">            {&#39;data/overlap&#39;: (&#39;int&#39;, 5, 100), &#39;training/lr&#39;: (&#39;float_log&#39;, 1e-4, 1e-2),</span>
</span><span id="Project.run_hyperparameter_search-1145"><a href="#Project.run_hyperparameter_search-1145"><span class="linenos">1145</span></a><span class="sd">            &#39;data/feature_extraction&#39;: (&#39;categorical&#39;, [&#39;kinematic&#39;, &#39;bones&#39;])};</span>
</span><span id="Project.run_hyperparameter_search-1146"><a href="#Project.run_hyperparameter_search-1146"><span class="linenos">1146</span></a><span class="sd">        metric : str, default f1</span>
</span><span id="Project.run_hyperparameter_search-1147"><a href="#Project.run_hyperparameter_search-1147"><span class="linenos">1147</span></a><span class="sd">            the metric to maximize/minimize (see direction)</span>
</span><span id="Project.run_hyperparameter_search-1148"><a href="#Project.run_hyperparameter_search-1148"><span class="linenos">1148</span></a><span class="sd">        n_trials : int, default 20</span>
</span><span id="Project.run_hyperparameter_search-1149"><a href="#Project.run_hyperparameter_search-1149"><span class="linenos">1149</span></a><span class="sd">            the number of optimization trials to run</span>
</span><span id="Project.run_hyperparameter_search-1150"><a href="#Project.run_hyperparameter_search-1150"><span class="linenos">1150</span></a><span class="sd">        best_n : int, default 1</span>
</span><span id="Project.run_hyperparameter_search-1151"><a href="#Project.run_hyperparameter_search-1151"><span class="linenos">1151</span></a><span class="sd">            the number of epochs to average the metric; if 0, the last value is taken</span>
</span><span id="Project.run_hyperparameter_search-1152"><a href="#Project.run_hyperparameter_search-1152"><span class="linenos">1152</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project.run_hyperparameter_search-1153"><a href="#Project.run_hyperparameter_search-1153"><span class="linenos">1153</span></a><span class="sd">            the parameters update dictionary</span>
</span><span id="Project.run_hyperparameter_search-1154"><a href="#Project.run_hyperparameter_search-1154"><span class="linenos">1154</span></a><span class="sd">        direction : {&#39;maximize&#39;, &#39;minimize&#39;}</span>
</span><span id="Project.run_hyperparameter_search-1155"><a href="#Project.run_hyperparameter_search-1155"><span class="linenos">1155</span></a><span class="sd">            optimization direction</span>
</span><span id="Project.run_hyperparameter_search-1156"><a href="#Project.run_hyperparameter_search-1156"><span class="linenos">1156</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="Project.run_hyperparameter_search-1157"><a href="#Project.run_hyperparameter_search-1157"><span class="linenos">1157</span></a><span class="sd">            the name of the episode to load the model from</span>
</span><span id="Project.run_hyperparameter_search-1158"><a href="#Project.run_hyperparameter_search-1158"><span class="linenos">1158</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="Project.run_hyperparameter_search-1159"><a href="#Project.run_hyperparameter_search-1159"><span class="linenos">1159</span></a><span class="sd">            the epoch to load the model from (if not provided, the last checkpoint is used)</span>
</span><span id="Project.run_hyperparameter_search-1160"><a href="#Project.run_hyperparameter_search-1160"><span class="linenos">1160</span></a><span class="sd">        prune : bool, default False</span>
</span><span id="Project.run_hyperparameter_search-1161"><a href="#Project.run_hyperparameter_search-1161"><span class="linenos">1161</span></a><span class="sd">            if `True`, experiments where the optimized metric is improving too slowly will be terminated</span>
</span><span id="Project.run_hyperparameter_search-1162"><a href="#Project.run_hyperparameter_search-1162"><span class="linenos">1162</span></a><span class="sd">            (with optuna HyperBand pruner)</span>
</span><span id="Project.run_hyperparameter_search-1163"><a href="#Project.run_hyperparameter_search-1163"><span class="linenos">1163</span></a><span class="sd">        force : bool, default False</span>
</span><span id="Project.run_hyperparameter_search-1164"><a href="#Project.run_hyperparameter_search-1164"><span class="linenos">1164</span></a><span class="sd">            if `True`, existing searches with the same name will be overwritten</span>
</span><span id="Project.run_hyperparameter_search-1165"><a href="#Project.run_hyperparameter_search-1165"><span class="linenos">1165</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project.run_hyperparameter_search-1166"><a href="#Project.run_hyperparameter_search-1166"><span class="linenos">1166</span></a><span class="sd">            if `True`, pre-computed features will be deleted after each run (if the data parameters change)</span>
</span><span id="Project.run_hyperparameter_search-1167"><a href="#Project.run_hyperparameter_search-1167"><span class="linenos">1167</span></a>
</span><span id="Project.run_hyperparameter_search-1168"><a href="#Project.run_hyperparameter_search-1168"><span class="linenos">1168</span></a><span class="sd">        Returns</span>
</span><span id="Project.run_hyperparameter_search-1169"><a href="#Project.run_hyperparameter_search-1169"><span class="linenos">1169</span></a><span class="sd">        -------</span>
</span><span id="Project.run_hyperparameter_search-1170"><a href="#Project.run_hyperparameter_search-1170"><span class="linenos">1170</span></a><span class="sd">        dict</span>
</span><span id="Project.run_hyperparameter_search-1171"><a href="#Project.run_hyperparameter_search-1171"><span class="linenos">1171</span></a><span class="sd">            a dictionary of best parameters</span>
</span><span id="Project.run_hyperparameter_search-1172"><a href="#Project.run_hyperparameter_search-1172"><span class="linenos">1172</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.run_hyperparameter_search-1173"><a href="#Project.run_hyperparameter_search-1173"><span class="linenos">1173</span></a>
</span><span id="Project.run_hyperparameter_search-1174"><a href="#Project.run_hyperparameter_search-1174"><span class="linenos">1174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_search_validity</span><span class="p">(</span><span class="n">search_name</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1175"><a href="#Project.run_hyperparameter_search-1175"><span class="linenos">1175</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SEARCH </span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1176"><a href="#Project.run_hyperparameter_search-1176"><span class="linenos">1176</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1177"><a href="#Project.run_hyperparameter_search-1177"><span class="linenos">1177</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_hyperparameter_search-1178"><a href="#Project.run_hyperparameter_search-1178"><span class="linenos">1178</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project.run_hyperparameter_search-1179"><a href="#Project.run_hyperparameter_search-1179"><span class="linenos">1179</span></a>        <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project.run_hyperparameter_search-1180"><a href="#Project.run_hyperparameter_search-1180"><span class="linenos">1180</span></a>            <span class="n">parameters_update</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;metric_functions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">metric</span><span class="p">}}}</span>
</span><span id="Project.run_hyperparameter_search-1181"><a href="#Project.run_hyperparameter_search-1181"><span class="linenos">1181</span></a>        <span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1182"><a href="#Project.run_hyperparameter_search-1182"><span class="linenos">1182</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_parameters</span><span class="p">(</span>
</span><span id="Project.run_hyperparameter_search-1183"><a href="#Project.run_hyperparameter_search-1183"><span class="linenos">1183</span></a>            <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1184"><a href="#Project.run_hyperparameter_search-1184"><span class="linenos">1184</span></a>            <span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1185"><a href="#Project.run_hyperparameter_search-1185"><span class="linenos">1185</span></a>            <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1186"><a href="#Project.run_hyperparameter_search-1186"><span class="linenos">1186</span></a>            <span class="n">parameters_update_second</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;training&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model_save_path&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}},</span>
</span><span id="Project.run_hyperparameter_search-1187"><a href="#Project.run_hyperparameter_search-1187"><span class="linenos">1187</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1188"><a href="#Project.run_hyperparameter_search-1188"><span class="linenos">1188</span></a>            <span class="n">load_strict</span><span class="o">=</span><span class="n">load_strict</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1189"><a href="#Project.run_hyperparameter_search-1189"><span class="linenos">1189</span></a>        <span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1190"><a href="#Project.run_hyperparameter_search-1190"><span class="linenos">1190</span></a>        <span class="n">task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project.run_hyperparameter_search-1191"><a href="#Project.run_hyperparameter_search-1191"><span class="linenos">1191</span></a>
</span><span id="Project.run_hyperparameter_search-1192"><a href="#Project.run_hyperparameter_search-1192"><span class="linenos">1192</span></a>        <span class="k">if</span> <span class="n">prune</span><span class="p">:</span>
</span><span id="Project.run_hyperparameter_search-1193"><a href="#Project.run_hyperparameter_search-1193"><span class="linenos">1193</span></a>            <span class="n">pruner</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">pruners</span><span class="o">.</span><span class="n">HyperbandPruner</span><span class="p">()</span>
</span><span id="Project.run_hyperparameter_search-1194"><a href="#Project.run_hyperparameter_search-1194"><span class="linenos">1194</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.run_hyperparameter_search-1195"><a href="#Project.run_hyperparameter_search-1195"><span class="linenos">1195</span></a>            <span class="n">pruner</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">pruners</span><span class="o">.</span><span class="n">NopPruner</span><span class="p">()</span>
</span><span id="Project.run_hyperparameter_search-1196"><a href="#Project.run_hyperparameter_search-1196"><span class="linenos">1196</span></a>        <span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span> <span class="n">pruner</span><span class="o">=</span><span class="n">pruner</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1197"><a href="#Project.run_hyperparameter_search-1197"><span class="linenos">1197</span></a>        <span class="n">runner</span> <span class="o">=</span> <span class="n">_Runner</span><span class="p">(</span>
</span><span id="Project.run_hyperparameter_search-1198"><a href="#Project.run_hyperparameter_search-1198"><span class="linenos">1198</span></a>            <span class="n">search_space</span><span class="o">=</span><span class="n">search_space</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1199"><a href="#Project.run_hyperparameter_search-1199"><span class="linenos">1199</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1200"><a href="#Project.run_hyperparameter_search-1200"><span class="linenos">1200</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1201"><a href="#Project.run_hyperparameter_search-1201"><span class="linenos">1201</span></a>            <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1202"><a href="#Project.run_hyperparameter_search-1202"><span class="linenos">1202</span></a>            <span class="n">average</span><span class="o">=</span><span class="n">best_n</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1203"><a href="#Project.run_hyperparameter_search-1203"><span class="linenos">1203</span></a>            <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1204"><a href="#Project.run_hyperparameter_search-1204"><span class="linenos">1204</span></a>            <span class="n">remove_saved_features</span><span class="o">=</span><span class="n">remove_saved_features</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1205"><a href="#Project.run_hyperparameter_search-1205"><span class="linenos">1205</span></a>            <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1206"><a href="#Project.run_hyperparameter_search-1206"><span class="linenos">1206</span></a>            <span class="n">search_name</span><span class="o">=</span><span class="n">search_name</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1207"><a href="#Project.run_hyperparameter_search-1207"><span class="linenos">1207</span></a>        <span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1208"><a href="#Project.run_hyperparameter_search-1208"><span class="linenos">1208</span></a>        <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">trial</span><span class="p">,</span> <span class="n">parameters</span><span class="p">),</span> <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1209"><a href="#Project.run_hyperparameter_search-1209"><span class="linenos">1209</span></a>        <span class="n">search_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_path</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1210"><a href="#Project.run_hyperparameter_search-1210"><span class="linenos">1210</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">search_path</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1211"><a href="#Project.run_hyperparameter_search-1211"><span class="linenos">1211</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_contour</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1212"><a href="#Project.run_hyperparameter_search-1212"><span class="linenos">1212</span></a>        <span class="n">plotly</span><span class="o">.</span><span class="n">offline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Project.run_hyperparameter_search-1213"><a href="#Project.run_hyperparameter_search-1213"><span class="linenos">1213</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">_contour.html&quot;</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1214"><a href="#Project.run_hyperparameter_search-1214"><span class="linenos">1214</span></a>        <span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1215"><a href="#Project.run_hyperparameter_search-1215"><span class="linenos">1215</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">plot_param_importances</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1216"><a href="#Project.run_hyperparameter_search-1216"><span class="linenos">1216</span></a>        <span class="n">plotly</span><span class="o">.</span><span class="n">offline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Project.run_hyperparameter_search-1217"><a href="#Project.run_hyperparameter_search-1217"><span class="linenos">1217</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">_importances.html&quot;</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1218"><a href="#Project.run_hyperparameter_search-1218"><span class="linenos">1218</span></a>        <span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1219"><a href="#Project.run_hyperparameter_search-1219"><span class="linenos">1219</span></a>        <span class="n">best_params</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span>
</span><span id="Project.run_hyperparameter_search-1220"><a href="#Project.run_hyperparameter_search-1220"><span class="linenos">1220</span></a>        <span class="n">best_value</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_value</span>
</span><span id="Project.run_hyperparameter_search-1221"><a href="#Project.run_hyperparameter_search-1221"><span class="linenos">1221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_search</span><span class="p">(</span>
</span><span id="Project.run_hyperparameter_search-1222"><a href="#Project.run_hyperparameter_search-1222"><span class="linenos">1222</span></a>            <span class="n">search_name</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1223"><a href="#Project.run_hyperparameter_search-1223"><span class="linenos">1223</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1224"><a href="#Project.run_hyperparameter_search-1224"><span class="linenos">1224</span></a>            <span class="n">n_trials</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1225"><a href="#Project.run_hyperparameter_search-1225"><span class="linenos">1225</span></a>            <span class="n">best_params</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1226"><a href="#Project.run_hyperparameter_search-1226"><span class="linenos">1226</span></a>            <span class="n">best_value</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1227"><a href="#Project.run_hyperparameter_search-1227"><span class="linenos">1227</span></a>            <span class="n">metric</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1228"><a href="#Project.run_hyperparameter_search-1228"><span class="linenos">1228</span></a>            <span class="n">search_space</span><span class="p">,</span>
</span><span id="Project.run_hyperparameter_search-1229"><a href="#Project.run_hyperparameter_search-1229"><span class="linenos">1229</span></a>        <span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1230"><a href="#Project.run_hyperparameter_search-1230"><span class="linenos">1230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1231"><a href="#Project.run_hyperparameter_search-1231"><span class="linenos">1231</span></a>        <span class="n">runner</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
</span><span id="Project.run_hyperparameter_search-1232"><a href="#Project.run_hyperparameter_search-1232"><span class="linenos">1232</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;best parameters: </span><span class="si">{</span><span class="n">best_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1233"><a href="#Project.run_hyperparameter_search-1233"><span class="linenos">1233</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.run_hyperparameter_search-1234"><a href="#Project.run_hyperparameter_search-1234"><span class="linenos">1234</span></a>        <span class="k">return</span> <span class="n">best_params</span>
</span></pre></div>


            <div class="docstring"><p>Run an optuna hyperparameter search</p>

<p>For a simpler function that fits most use cases, check out <code><a href="#Project.run_default_hyperparameter_search">Project.run_default_hyperparameter_search()</a></code>.</p>

<p>To use a default search space with this method, import <code><a href="../options.html#model_hyperparameters">dlc2action.options.model_hyperparameters</a></code>. It is
a dictionary where keys are model names and values are default search spaces.</p>

<p>The task parameters are read from the config files and updated with the parameters_update dictionary.
The model can be either initialized from scratch or loaded from a previously run episode.
For each trial, the objective metric is averaged over a few best epochs.</p>

<h2 id="parameters">Parameters</h2>

<p>search_name : str
    the name of the search to store it in the meta files and load in run_episode
search_space : dict
    a dictionary representing the search space; of this general structure:
    {'group/param_name': ('float/int/float_log/int_log', start, end),
    'group/param_name': ('categorical', [choices])}, e.g.
    {'data/overlap': ('int', 5, 100), 'training/lr': ('float_log', 1e-4, 1e-2),
    'data/feature_extraction': ('categorical', ['kinematic', 'bones'])};
metric : str, default f1
    the metric to maximize/minimize (see direction)
n_trials : int, default 20
    the number of optimization trials to run
best_n : int, default 1
    the number of epochs to average the metric; if 0, the last value is taken
parameters_update : dict, optional
    the parameters update dictionary
direction : {'maximize', 'minimize'}
    optimization direction
load_episode : str, optional
    the name of the episode to load the model from
load_epoch : int, optional
    the epoch to load the model from (if not provided, the last checkpoint is used)
prune : bool, default False
    if <code>True</code>, experiments where the optimized metric is improving too slowly will be terminated
    (with optuna HyperBand pruner)
force : bool, default False
    if <code>True</code>, existing searches with the same name will be overwritten
remove_saved_features : bool, default False
    if <code>True</code>, pre-computed features will be deleted after each run (if the data parameters change)</p>

<h2 id="returns">Returns</h2>

<p>dict
    a dictionary of best parameters</p>
</div>


                            </div>
                            <div id="Project.run_prediction" class="classattr">
                                        <input id="Project.run_prediction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_prediction</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>,</span><span class="param">	<span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">submission</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">frame_number_map_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">embedding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.run_prediction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.run_prediction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.run_prediction-1236"><a href="#Project.run_prediction-1236"><span class="linenos">1236</span></a>    <span class="k">def</span> <span class="nf">run_prediction</span><span class="p">(</span>
</span><span id="Project.run_prediction-1237"><a href="#Project.run_prediction-1237"><span class="linenos">1237</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.run_prediction-1238"><a href="#Project.run_prediction-1238"><span class="linenos">1238</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project.run_prediction-1239"><a href="#Project.run_prediction-1239"><span class="linenos">1239</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project.run_prediction-1240"><a href="#Project.run_prediction-1240"><span class="linenos">1240</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_prediction-1241"><a href="#Project.run_prediction-1241"><span class="linenos">1241</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_prediction-1242"><a href="#Project.run_prediction-1242"><span class="linenos">1242</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Project.run_prediction-1243"><a href="#Project.run_prediction-1243"><span class="linenos">1243</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_prediction-1244"><a href="#Project.run_prediction-1244"><span class="linenos">1244</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span id="Project.run_prediction-1245"><a href="#Project.run_prediction-1245"><span class="linenos">1245</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_prediction-1246"><a href="#Project.run_prediction-1246"><span class="linenos">1246</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_prediction-1247"><a href="#Project.run_prediction-1247"><span class="linenos">1247</span></a>        <span class="n">submission</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_prediction-1248"><a href="#Project.run_prediction-1248"><span class="linenos">1248</span></a>        <span class="n">frame_number_map_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.run_prediction-1249"><a href="#Project.run_prediction-1249"><span class="linenos">1249</span></a>        <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_prediction-1250"><a href="#Project.run_prediction-1250"><span class="linenos">1250</span></a>        <span class="n">embedding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_prediction-1251"><a href="#Project.run_prediction-1251"><span class="linenos">1251</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.run_prediction-1252"><a href="#Project.run_prediction-1252"><span class="linenos">1252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.run_prediction-1253"><a href="#Project.run_prediction-1253"><span class="linenos">1253</span></a><span class="sd">        Load models from previously run episodes to generate a prediction</span>
</span><span id="Project.run_prediction-1254"><a href="#Project.run_prediction-1254"><span class="linenos">1254</span></a>
</span><span id="Project.run_prediction-1255"><a href="#Project.run_prediction-1255"><span class="linenos">1255</span></a><span class="sd">        The probabilities predicted by the models are averaged.</span>
</span><span id="Project.run_prediction-1256"><a href="#Project.run_prediction-1256"><span class="linenos">1256</span></a><span class="sd">        Unless `submission` is `True`, the prediction results are saved as a pickled dictionary in the project_name/results/predictions folder</span>
</span><span id="Project.run_prediction-1257"><a href="#Project.run_prediction-1257"><span class="linenos">1257</span></a><span class="sd">        under the {episode_name}_{load_epoch}.pickle name. The file is a nested dictionary where the first-level</span>
</span><span id="Project.run_prediction-1258"><a href="#Project.run_prediction-1258"><span class="linenos">1258</span></a><span class="sd">        keys are the video ids, the second-level keys are the clip ids (like individual names) and the values</span>
</span><span id="Project.run_prediction-1259"><a href="#Project.run_prediction-1259"><span class="linenos">1259</span></a><span class="sd">        are the prediction arrays.</span>
</span><span id="Project.run_prediction-1260"><a href="#Project.run_prediction-1260"><span class="linenos">1260</span></a>
</span><span id="Project.run_prediction-1261"><a href="#Project.run_prediction-1261"><span class="linenos">1261</span></a><span class="sd">        Parameters</span>
</span><span id="Project.run_prediction-1262"><a href="#Project.run_prediction-1262"><span class="linenos">1262</span></a><span class="sd">        ----------</span>
</span><span id="Project.run_prediction-1263"><a href="#Project.run_prediction-1263"><span class="linenos">1263</span></a><span class="sd">        prediction_name : str</span>
</span><span id="Project.run_prediction-1264"><a href="#Project.run_prediction-1264"><span class="linenos">1264</span></a><span class="sd">            the name of the prediction</span>
</span><span id="Project.run_prediction-1265"><a href="#Project.run_prediction-1265"><span class="linenos">1265</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project.run_prediction-1266"><a href="#Project.run_prediction-1266"><span class="linenos">1266</span></a><span class="sd">            a list of string episode names to load the models from</span>
</span><span id="Project.run_prediction-1267"><a href="#Project.run_prediction-1267"><span class="linenos">1267</span></a><span class="sd">        load_epochs : list, optional</span>
</span><span id="Project.run_prediction-1268"><a href="#Project.run_prediction-1268"><span class="linenos">1268</span></a><span class="sd">            a list of integer epoch indices to load the model from; if None, the last ones are used</span>
</span><span id="Project.run_prediction-1269"><a href="#Project.run_prediction-1269"><span class="linenos">1269</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project.run_prediction-1270"><a href="#Project.run_prediction-1270"><span class="linenos">1270</span></a><span class="sd">            a dictionary of parameter updates</span>
</span><span id="Project.run_prediction-1271"><a href="#Project.run_prediction-1271"><span class="linenos">1271</span></a><span class="sd">        augment_n : int, default 10</span>
</span><span id="Project.run_prediction-1272"><a href="#Project.run_prediction-1272"><span class="linenos">1272</span></a><span class="sd">            the number of augmentations to average over</span>
</span><span id="Project.run_prediction-1273"><a href="#Project.run_prediction-1273"><span class="linenos">1273</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="Project.run_prediction-1274"><a href="#Project.run_prediction-1274"><span class="linenos">1274</span></a><span class="sd">            the data path to run the prediction for</span>
</span><span id="Project.run_prediction-1275"><a href="#Project.run_prediction-1275"><span class="linenos">1275</span></a><span class="sd">        mode : {&#39;all&#39;, &#39;test&#39;, &#39;val&#39;, &#39;train&#39;}</span>
</span><span id="Project.run_prediction-1276"><a href="#Project.run_prediction-1276"><span class="linenos">1276</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None)</span>
</span><span id="Project.run_prediction-1277"><a href="#Project.run_prediction-1277"><span class="linenos">1277</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="Project.run_prediction-1278"><a href="#Project.run_prediction-1278"><span class="linenos">1278</span></a><span class="sd">            a set of string file paths (data with all prefixes + feature files, in any order) to run the prediction</span>
</span><span id="Project.run_prediction-1279"><a href="#Project.run_prediction-1279"><span class="linenos">1279</span></a><span class="sd">            for</span>
</span><span id="Project.run_prediction-1280"><a href="#Project.run_prediction-1280"><span class="linenos">1280</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project.run_prediction-1281"><a href="#Project.run_prediction-1281"><span class="linenos">1281</span></a><span class="sd">            if `True`, pre-computed features will be deleted</span>
</span><span id="Project.run_prediction-1282"><a href="#Project.run_prediction-1282"><span class="linenos">1282</span></a><span class="sd">        submission : bool, default False</span>
</span><span id="Project.run_prediction-1283"><a href="#Project.run_prediction-1283"><span class="linenos">1283</span></a><span class="sd">            if `True`, a MABe-22 style submission file is generated</span>
</span><span id="Project.run_prediction-1284"><a href="#Project.run_prediction-1284"><span class="linenos">1284</span></a><span class="sd">        frame_number_map_file : str, optional</span>
</span><span id="Project.run_prediction-1285"><a href="#Project.run_prediction-1285"><span class="linenos">1285</span></a><span class="sd">            path to the frame number map file</span>
</span><span id="Project.run_prediction-1286"><a href="#Project.run_prediction-1286"><span class="linenos">1286</span></a><span class="sd">        force : bool, default False</span>
</span><span id="Project.run_prediction-1287"><a href="#Project.run_prediction-1287"><span class="linenos">1287</span></a><span class="sd">            if `True`, existing prediction with this name will be overwritten</span>
</span><span id="Project.run_prediction-1288"><a href="#Project.run_prediction-1288"><span class="linenos">1288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.run_prediction-1289"><a href="#Project.run_prediction-1289"><span class="linenos">1289</span></a>
</span><span id="Project.run_prediction-1290"><a href="#Project.run_prediction-1290"><span class="linenos">1290</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_prediction_validity</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
</span><span id="Project.run_prediction-1291"><a href="#Project.run_prediction-1291"><span class="linenos">1291</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PREDICTION </span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.run_prediction-1292"><a href="#Project.run_prediction-1292"><span class="linenos">1292</span></a>        <span class="k">if</span> <span class="n">submission</span><span class="p">:</span>
</span><span id="Project.run_prediction-1293"><a href="#Project.run_prediction-1293"><span class="linenos">1293</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="o">...</span>
</span><span id="Project.run_prediction-1294"><a href="#Project.run_prediction-1294"><span class="linenos">1294</span></a>            <span class="c1"># TODO: add submission option to _make_prediction</span>
</span><span id="Project.run_prediction-1295"><a href="#Project.run_prediction-1295"><span class="linenos">1295</span></a>            <span class="n">predicted</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">generate_submission</span><span class="p">(</span>
</span><span id="Project.run_prediction-1296"><a href="#Project.run_prediction-1296"><span class="linenos">1296</span></a>                <span class="n">frame_number_map_file</span><span class="o">=</span><span class="n">frame_number_map_file</span><span class="p">,</span>
</span><span id="Project.run_prediction-1297"><a href="#Project.run_prediction-1297"><span class="linenos">1297</span></a>                <span class="n">dataset</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project.run_prediction-1298"><a href="#Project.run_prediction-1298"><span class="linenos">1298</span></a>                <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project.run_prediction-1299"><a href="#Project.run_prediction-1299"><span class="linenos">1299</span></a>            <span class="p">)</span>
</span><span id="Project.run_prediction-1300"><a href="#Project.run_prediction-1300"><span class="linenos">1300</span></a>            <span class="n">folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.run_prediction-1301"><a href="#Project.run_prediction-1301"><span class="linenos">1301</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span>
</span><span id="Project.run_prediction-1302"><a href="#Project.run_prediction-1302"><span class="linenos">1302</span></a>                <span class="s2">&quot;results&quot;</span><span class="p">,</span>
</span><span id="Project.run_prediction-1303"><a href="#Project.run_prediction-1303"><span class="linenos">1303</span></a>                <span class="s2">&quot;predictions&quot;</span><span class="p">,</span>
</span><span id="Project.run_prediction-1304"><a href="#Project.run_prediction-1304"><span class="linenos">1304</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="Project.run_prediction-1305"><a href="#Project.run_prediction-1305"><span class="linenos">1305</span></a>            <span class="p">)</span>
</span><span id="Project.run_prediction-1306"><a href="#Project.run_prediction-1306"><span class="linenos">1306</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="Project.run_prediction-1307"><a href="#Project.run_prediction-1307"><span class="linenos">1307</span></a>            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">predicted</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Project.run_prediction-1308"><a href="#Project.run_prediction-1308"><span class="linenos">1308</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.run_prediction-1309"><a href="#Project.run_prediction-1309"><span class="linenos">1309</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Project.run_prediction-1310"><a href="#Project.run_prediction-1310"><span class="linenos">1310</span></a>                <span class="p">(</span>
</span><span id="Project.run_prediction-1311"><a href="#Project.run_prediction-1311"><span class="linenos">1311</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="Project.run_prediction-1312"><a href="#Project.run_prediction-1312"><span class="linenos">1312</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project.run_prediction-1313"><a href="#Project.run_prediction-1313"><span class="linenos">1313</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project.run_prediction-1314"><a href="#Project.run_prediction-1314"><span class="linenos">1314</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="Project.run_prediction-1315"><a href="#Project.run_prediction-1315"><span class="linenos">1315</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project.run_prediction-1316"><a href="#Project.run_prediction-1316"><span class="linenos">1316</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_prediction</span><span class="p">(</span>
</span><span id="Project.run_prediction-1317"><a href="#Project.run_prediction-1317"><span class="linenos">1317</span></a>                    <span class="n">prediction_name</span><span class="p">,</span>
</span><span id="Project.run_prediction-1318"><a href="#Project.run_prediction-1318"><span class="linenos">1318</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="Project.run_prediction-1319"><a href="#Project.run_prediction-1319"><span class="linenos">1319</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project.run_prediction-1320"><a href="#Project.run_prediction-1320"><span class="linenos">1320</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.run_prediction-1321"><a href="#Project.run_prediction-1321"><span class="linenos">1321</span></a>                    <span class="n">data_path</span><span class="p">,</span>
</span><span id="Project.run_prediction-1322"><a href="#Project.run_prediction-1322"><span class="linenos">1322</span></a>                    <span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project.run_prediction-1323"><a href="#Project.run_prediction-1323"><span class="linenos">1323</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project.run_prediction-1324"><a href="#Project.run_prediction-1324"><span class="linenos">1324</span></a>                    <span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project.run_prediction-1325"><a href="#Project.run_prediction-1325"><span class="linenos">1325</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_prediction-1326"><a href="#Project.run_prediction-1326"><span class="linenos">1326</span></a>                    <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
</span><span id="Project.run_prediction-1327"><a href="#Project.run_prediction-1327"><span class="linenos">1327</span></a>                <span class="p">)</span>
</span><span id="Project.run_prediction-1328"><a href="#Project.run_prediction-1328"><span class="linenos">1328</span></a>                <span class="n">predicted</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span><span class="o">.</span><span class="n">generate_full_length_prediction</span><span class="p">(</span>
</span><span id="Project.run_prediction-1329"><a href="#Project.run_prediction-1329"><span class="linenos">1329</span></a>                    <span class="n">prediction</span>
</span><span id="Project.run_prediction-1330"><a href="#Project.run_prediction-1330"><span class="linenos">1330</span></a>                <span class="p">)</span>
</span><span id="Project.run_prediction-1331"><a href="#Project.run_prediction-1331"><span class="linenos">1331</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="Project.run_prediction-1332"><a href="#Project.run_prediction-1332"><span class="linenos">1332</span></a>                <span class="p">(</span>
</span><span id="Project.run_prediction-1333"><a href="#Project.run_prediction-1333"><span class="linenos">1333</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="Project.run_prediction-1334"><a href="#Project.run_prediction-1334"><span class="linenos">1334</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project.run_prediction-1335"><a href="#Project.run_prediction-1335"><span class="linenos">1335</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project.run_prediction-1336"><a href="#Project.run_prediction-1336"><span class="linenos">1336</span></a>                    <span class="n">predicted</span><span class="p">,</span>
</span><span id="Project.run_prediction-1337"><a href="#Project.run_prediction-1337"><span class="linenos">1337</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project.run_prediction-1338"><a href="#Project.run_prediction-1338"><span class="linenos">1338</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_predictions</span><span class="p">(</span>
</span><span id="Project.run_prediction-1339"><a href="#Project.run_prediction-1339"><span class="linenos">1339</span></a>                    <span class="n">prediction_name</span><span class="p">,</span>
</span><span id="Project.run_prediction-1340"><a href="#Project.run_prediction-1340"><span class="linenos">1340</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="Project.run_prediction-1341"><a href="#Project.run_prediction-1341"><span class="linenos">1341</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project.run_prediction-1342"><a href="#Project.run_prediction-1342"><span class="linenos">1342</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.run_prediction-1343"><a href="#Project.run_prediction-1343"><span class="linenos">1343</span></a>                    <span class="n">data_path</span><span class="p">,</span>
</span><span id="Project.run_prediction-1344"><a href="#Project.run_prediction-1344"><span class="linenos">1344</span></a>                    <span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project.run_prediction-1345"><a href="#Project.run_prediction-1345"><span class="linenos">1345</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project.run_prediction-1346"><a href="#Project.run_prediction-1346"><span class="linenos">1346</span></a>                    <span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project.run_prediction-1347"><a href="#Project.run_prediction-1347"><span class="linenos">1347</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Project.run_prediction-1348"><a href="#Project.run_prediction-1348"><span class="linenos">1348</span></a>                    <span class="n">embedding</span><span class="o">=</span><span class="n">embedding</span><span class="p">,</span>
</span><span id="Project.run_prediction-1349"><a href="#Project.run_prediction-1349"><span class="linenos">1349</span></a>                <span class="p">)</span>
</span><span id="Project.run_prediction-1350"><a href="#Project.run_prediction-1350"><span class="linenos">1350</span></a>            <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_path</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">)</span>
</span><span id="Project.run_prediction-1351"><a href="#Project.run_prediction-1351"><span class="linenos">1351</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="Project.run_prediction-1352"><a href="#Project.run_prediction-1352"><span class="linenos">1352</span></a>            <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">predicted</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.run_prediction-1353"><a href="#Project.run_prediction-1353"><span class="linenos">1353</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="Project.run_prediction-1354"><a href="#Project.run_prediction-1354"><span class="linenos">1354</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.run_prediction-1355"><a href="#Project.run_prediction-1355"><span class="linenos">1355</span></a>                        <span class="n">folder</span><span class="p">,</span> <span class="n">video_id</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">_prediction.pickle&quot;</span>
</span><span id="Project.run_prediction-1356"><a href="#Project.run_prediction-1356"><span class="linenos">1356</span></a>                    <span class="p">),</span>
</span><span id="Project.run_prediction-1357"><a href="#Project.run_prediction-1357"><span class="linenos">1357</span></a>                    <span class="s2">&quot;wb&quot;</span><span class="p">,</span>
</span><span id="Project.run_prediction-1358"><a href="#Project.run_prediction-1358"><span class="linenos">1358</span></a>                <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project.run_prediction-1359"><a href="#Project.run_prediction-1359"><span class="linenos">1359</span></a>                    <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;min_frames&quot;</span><span class="p">],</span> <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;max_frames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span>
</span><span id="Project.run_prediction-1360"><a href="#Project.run_prediction-1360"><span class="linenos">1360</span></a>                        <span class="n">mode</span>
</span><span id="Project.run_prediction-1361"><a href="#Project.run_prediction-1361"><span class="linenos">1361</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">get_min_max_frames</span><span class="p">(</span><span class="n">video_id</span><span class="p">)</span>
</span><span id="Project.run_prediction-1362"><a href="#Project.run_prediction-1362"><span class="linenos">1362</span></a>                    <span class="n">behavior_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="Project.run_prediction-1363"><a href="#Project.run_prediction-1363"><span class="linenos">1363</span></a>                        <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="Project.run_prediction-1364"><a href="#Project.run_prediction-1364"><span class="linenos">1364</span></a>                    <span class="p">)</span>
</span><span id="Project.run_prediction-1365"><a href="#Project.run_prediction-1365"><span class="linenos">1365</span></a>                    <span class="n">prediction</span><span class="p">[</span><span class="s2">&quot;behaviors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project.run_prediction-1366"><a href="#Project.run_prediction-1366"><span class="linenos">1366</span></a>                        <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">behavior_indices</span>
</span><span id="Project.run_prediction-1367"><a href="#Project.run_prediction-1367"><span class="linenos">1367</span></a>                    <span class="p">]</span>
</span><span id="Project.run_prediction-1368"><a href="#Project.run_prediction-1368"><span class="linenos">1368</span></a>                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project.run_prediction-1369"><a href="#Project.run_prediction-1369"><span class="linenos">1369</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project.run_prediction-1370"><a href="#Project.run_prediction-1370"><span class="linenos">1370</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project.run_prediction-1371"><a href="#Project.run_prediction-1371"><span class="linenos">1371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_prediction</span><span class="p">(</span>
</span><span id="Project.run_prediction-1372"><a href="#Project.run_prediction-1372"><span class="linenos">1372</span></a>            <span class="n">prediction_name</span><span class="p">,</span>
</span><span id="Project.run_prediction-1373"><a href="#Project.run_prediction-1373"><span class="linenos">1373</span></a>            <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project.run_prediction-1374"><a href="#Project.run_prediction-1374"><span class="linenos">1374</span></a>            <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">(),</span>
</span><span id="Project.run_prediction-1375"><a href="#Project.run_prediction-1375"><span class="linenos">1375</span></a>            <span class="n">embedding</span><span class="p">,</span>
</span><span id="Project.run_prediction-1376"><a href="#Project.run_prediction-1376"><span class="linenos">1376</span></a>            <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project.run_prediction-1377"><a href="#Project.run_prediction-1377"><span class="linenos">1377</span></a>        <span class="p">)</span>
</span><span id="Project.run_prediction-1378"><a href="#Project.run_prediction-1378"><span class="linenos">1378</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load models from previously run episodes to generate a prediction</p>

<p>The probabilities predicted by the models are averaged.
Unless <code>submission</code> is <code>True</code>, the prediction results are saved as a pickled dictionary in the project_name/results/predictions folder
under the {episode_name}_{load_epoch}.pickle name. The file is a nested dictionary where the first-level
keys are the video ids, the second-level keys are the clip ids (like individual names) and the values
are the prediction arrays.</p>

<h2 id="parameters">Parameters</h2>

<p>prediction_name : str
    the name of the prediction
episode_names : list
    a list of string episode names to load the models from
load_epochs : list, optional
    a list of integer epoch indices to load the model from; if None, the last ones are used
parameters_update : dict, optional
    a dictionary of parameter updates
augment_n : int, default 10
    the number of augmentations to average over
data_path : str, optional
    the data path to run the prediction for
mode : {'all', 'test', 'val', 'train'}
    the subset of the data to make the prediction for (forced to 'all' if data_path is not None)
file_paths : set, optional
    a set of string file paths (data with all prefixes + feature files, in any order) to run the prediction
    for
remove_saved_features : bool, default False
    if <code>True</code>, pre-computed features will be deleted
submission : bool, default False
    if <code>True</code>, a MABe-22 style submission file is generated
frame_number_map_file : str, optional
    path to the frame number map file
force : bool, default False
    if <code>True</code>, existing prediction with this name will be overwritten</p>
</div>


                            </div>
                            <div id="Project.evaluate_prediction" class="classattr">
                                        <input id="Project.evaluate_prediction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">evaluate_prediction</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Project.evaluate_prediction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.evaluate_prediction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.evaluate_prediction-1380"><a href="#Project.evaluate_prediction-1380"><span class="linenos">1380</span></a>    <span class="k">def</span> <span class="nf">evaluate_prediction</span><span class="p">(</span>
</span><span id="Project.evaluate_prediction-1381"><a href="#Project.evaluate_prediction-1381"><span class="linenos">1381</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1382"><a href="#Project.evaluate_prediction-1382"><span class="linenos">1382</span></a>        <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1383"><a href="#Project.evaluate_prediction-1383"><span class="linenos">1383</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1384"><a href="#Project.evaluate_prediction-1384"><span class="linenos">1384</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1385"><a href="#Project.evaluate_prediction-1385"><span class="linenos">1385</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1386"><a href="#Project.evaluate_prediction-1386"><span class="linenos">1386</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1387"><a href="#Project.evaluate_prediction-1387"><span class="linenos">1387</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1388"><a href="#Project.evaluate_prediction-1388"><span class="linenos">1388</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
</span><span id="Project.evaluate_prediction-1389"><a href="#Project.evaluate_prediction-1389"><span class="linenos">1389</span></a>
</span><span id="Project.evaluate_prediction-1390"><a href="#Project.evaluate_prediction-1390"><span class="linenos">1390</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="Project.evaluate_prediction-1391"><a href="#Project.evaluate_prediction-1391"><span class="linenos">1391</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.evaluate_prediction-1392"><a href="#Project.evaluate_prediction-1392"><span class="linenos">1392</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;predictions&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">.pickle&quot;</span>
</span><span id="Project.evaluate_prediction-1393"><a href="#Project.evaluate_prediction-1393"><span class="linenos">1393</span></a>            <span class="p">),</span>
</span><span id="Project.evaluate_prediction-1394"><a href="#Project.evaluate_prediction-1394"><span class="linenos">1394</span></a>            <span class="s2">&quot;rb&quot;</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1395"><a href="#Project.evaluate_prediction-1395"><span class="linenos">1395</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project.evaluate_prediction-1396"><a href="#Project.evaluate_prediction-1396"><span class="linenos">1396</span></a>            <span class="n">prediction</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="Project.evaluate_prediction-1397"><a href="#Project.evaluate_prediction-1397"><span class="linenos">1397</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.evaluate_prediction-1398"><a href="#Project.evaluate_prediction-1398"><span class="linenos">1398</span></a>            <span class="n">parameters_update</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project.evaluate_prediction-1399"><a href="#Project.evaluate_prediction-1399"><span class="linenos">1399</span></a>        <span class="n">parameters_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project.evaluate_prediction-1400"><a href="#Project.evaluate_prediction-1400"><span class="linenos">1400</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">),</span> <span class="n">parameters_update</span>
</span><span id="Project.evaluate_prediction-1401"><a href="#Project.evaluate_prediction-1401"><span class="linenos">1401</span></a>        <span class="p">)</span>
</span><span id="Project.evaluate_prediction-1402"><a href="#Project.evaluate_prediction-1402"><span class="linenos">1402</span></a>        <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="Project.evaluate_prediction-1403"><a href="#Project.evaluate_prediction-1403"><span class="linenos">1403</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project.evaluate_prediction-1404"><a href="#Project.evaluate_prediction-1404"><span class="linenos">1404</span></a>            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1405"><a href="#Project.evaluate_prediction-1405"><span class="linenos">1405</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1406"><a href="#Project.evaluate_prediction-1406"><span class="linenos">1406</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1407"><a href="#Project.evaluate_prediction-1407"><span class="linenos">1407</span></a>            <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1408"><a href="#Project.evaluate_prediction-1408"><span class="linenos">1408</span></a>            <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1409"><a href="#Project.evaluate_prediction-1409"><span class="linenos">1409</span></a>            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project.evaluate_prediction-1410"><a href="#Project.evaluate_prediction-1410"><span class="linenos">1410</span></a>        <span class="p">)</span>
</span><span id="Project.evaluate_prediction-1411"><a href="#Project.evaluate_prediction-1411"><span class="linenos">1411</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">evaluate_prediction</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project.evaluate_prediction-1412"><a href="#Project.evaluate_prediction-1412"><span class="linenos">1412</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project.evaluate_prediction-1413"><a href="#Project.evaluate_prediction-1413"><span class="linenos">1413</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project.evaluate_prediction-1414"><a href="#Project.evaluate_prediction-1414"><span class="linenos">1414</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.evaluate_prediction-1415"><a href="#Project.evaluate_prediction-1415"><span class="linenos">1415</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


    

                            </div>
                            <div id="Project.evaluate" class="classattr">
                                        <input id="Project.evaluate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">evaluate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">multiple_episode_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;average&#39;</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">skip_updating_meta</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="Project.evaluate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.evaluate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.evaluate-1417"><a href="#Project.evaluate-1417"><span class="linenos">1417</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="Project.evaluate-1418"><a href="#Project.evaluate-1418"><span class="linenos">1418</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.evaluate-1419"><a href="#Project.evaluate-1419"><span class="linenos">1419</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project.evaluate-1420"><a href="#Project.evaluate-1420"><span class="linenos">1420</span></a>        <span class="n">load_epochs</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.evaluate-1421"><a href="#Project.evaluate-1421"><span class="linenos">1421</span></a>        <span class="n">augment_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project.evaluate-1422"><a href="#Project.evaluate-1422"><span class="linenos">1422</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.evaluate-1423"><a href="#Project.evaluate-1423"><span class="linenos">1423</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.evaluate-1424"><a href="#Project.evaluate-1424"><span class="linenos">1424</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.evaluate-1425"><a href="#Project.evaluate-1425"><span class="linenos">1425</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.evaluate-1426"><a href="#Project.evaluate-1426"><span class="linenos">1426</span></a>        <span class="n">multiple_episode_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;average&quot;</span><span class="p">,</span>
</span><span id="Project.evaluate-1427"><a href="#Project.evaluate-1427"><span class="linenos">1427</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.evaluate-1428"><a href="#Project.evaluate-1428"><span class="linenos">1428</span></a>        <span class="n">skip_updating_meta</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project.evaluate-1429"><a href="#Project.evaluate-1429"><span class="linenos">1429</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project.evaluate-1430"><a href="#Project.evaluate-1430"><span class="linenos">1430</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.evaluate-1431"><a href="#Project.evaluate-1431"><span class="linenos">1431</span></a><span class="sd">        Load one or several models from previously run episodes to make an evaluation</span>
</span><span id="Project.evaluate-1432"><a href="#Project.evaluate-1432"><span class="linenos">1432</span></a>
</span><span id="Project.evaluate-1433"><a href="#Project.evaluate-1433"><span class="linenos">1433</span></a><span class="sd">        By default it will run on the test (or validation, if there is no test) subset of the project dataset.</span>
</span><span id="Project.evaluate-1434"><a href="#Project.evaluate-1434"><span class="linenos">1434</span></a>
</span><span id="Project.evaluate-1435"><a href="#Project.evaluate-1435"><span class="linenos">1435</span></a><span class="sd">        Parameters</span>
</span><span id="Project.evaluate-1436"><a href="#Project.evaluate-1436"><span class="linenos">1436</span></a><span class="sd">        ----------</span>
</span><span id="Project.evaluate-1437"><a href="#Project.evaluate-1437"><span class="linenos">1437</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project.evaluate-1438"><a href="#Project.evaluate-1438"><span class="linenos">1438</span></a><span class="sd">            a list of string episode names to load the models from</span>
</span><span id="Project.evaluate-1439"><a href="#Project.evaluate-1439"><span class="linenos">1439</span></a><span class="sd">        load_epochs : list, optional</span>
</span><span id="Project.evaluate-1440"><a href="#Project.evaluate-1440"><span class="linenos">1440</span></a><span class="sd">            a list of integer epoch indices to load the model from; if None, the last ones are used</span>
</span><span id="Project.evaluate-1441"><a href="#Project.evaluate-1441"><span class="linenos">1441</span></a><span class="sd">        augment_n : int, default 0</span>
</span><span id="Project.evaluate-1442"><a href="#Project.evaluate-1442"><span class="linenos">1442</span></a><span class="sd">            the number of augmentations to average over</span>
</span><span id="Project.evaluate-1443"><a href="#Project.evaluate-1443"><span class="linenos">1443</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="Project.evaluate-1444"><a href="#Project.evaluate-1444"><span class="linenos">1444</span></a><span class="sd">            the data path to run the prediction for</span>
</span><span id="Project.evaluate-1445"><a href="#Project.evaluate-1445"><span class="linenos">1445</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="Project.evaluate-1446"><a href="#Project.evaluate-1446"><span class="linenos">1446</span></a><span class="sd">            a set of files to run the prediction for</span>
</span><span id="Project.evaluate-1447"><a href="#Project.evaluate-1447"><span class="linenos">1447</span></a><span class="sd">        mode : {&#39;test&#39;, &#39;val&#39;, &#39;train&#39;, &#39;all&#39;}</span>
</span><span id="Project.evaluate-1448"><a href="#Project.evaluate-1448"><span class="linenos">1448</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None;</span>
</span><span id="Project.evaluate-1449"><a href="#Project.evaluate-1449"><span class="linenos">1449</span></a><span class="sd">            by default &#39;test&#39; if test subset is not empty and &#39;val&#39; otherwise)</span>
</span><span id="Project.evaluate-1450"><a href="#Project.evaluate-1450"><span class="linenos">1450</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project.evaluate-1451"><a href="#Project.evaluate-1451"><span class="linenos">1451</span></a><span class="sd">            a dictionary with parameter updates (cannot change model parameters)</span>
</span><span id="Project.evaluate-1452"><a href="#Project.evaluate-1452"><span class="linenos">1452</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project.evaluate-1453"><a href="#Project.evaluate-1453"><span class="linenos">1453</span></a><span class="sd">            if `True`, the dataset will be deleted</span>
</span><span id="Project.evaluate-1454"><a href="#Project.evaluate-1454"><span class="linenos">1454</span></a>
</span><span id="Project.evaluate-1455"><a href="#Project.evaluate-1455"><span class="linenos">1455</span></a><span class="sd">        Returns</span>
</span><span id="Project.evaluate-1456"><a href="#Project.evaluate-1456"><span class="linenos">1456</span></a><span class="sd">        -------</span>
</span><span id="Project.evaluate-1457"><a href="#Project.evaluate-1457"><span class="linenos">1457</span></a><span class="sd">        metric : dict</span>
</span><span id="Project.evaluate-1458"><a href="#Project.evaluate-1458"><span class="linenos">1458</span></a><span class="sd">            a dictionary of average values of metric functions</span>
</span><span id="Project.evaluate-1459"><a href="#Project.evaluate-1459"><span class="linenos">1459</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.evaluate-1460"><a href="#Project.evaluate-1460"><span class="linenos">1460</span></a>
</span><span id="Project.evaluate-1461"><a href="#Project.evaluate-1461"><span class="linenos">1461</span></a>        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.evaluate-1462"><a href="#Project.evaluate-1462"><span class="linenos">1462</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="Project.evaluate-1463"><a href="#Project.evaluate-1463"><span class="linenos">1463</span></a>            <span class="n">names</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project.evaluate-1464"><a href="#Project.evaluate-1464"><span class="linenos">1464</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">episode_names</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.evaluate-1465"><a href="#Project.evaluate-1465"><span class="linenos">1465</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVALUATION </span><span class="si">{</span><span class="n">episode_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.evaluate-1466"><a href="#Project.evaluate-1466"><span class="linenos">1466</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.evaluate-1467"><a href="#Project.evaluate-1467"><span class="linenos">1467</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;EVALUATION </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.evaluate-1468"><a href="#Project.evaluate-1468"><span class="linenos">1468</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.evaluate-1469"><a href="#Project.evaluate-1469"><span class="linenos">1469</span></a>            <span class="n">evaluate</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Project.evaluate-1470"><a href="#Project.evaluate-1470"><span class="linenos">1470</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.evaluate-1471"><a href="#Project.evaluate-1471"><span class="linenos">1471</span></a>            <span class="n">evaluate</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Project.evaluate-1472"><a href="#Project.evaluate-1472"><span class="linenos">1472</span></a>        <span class="k">if</span> <span class="n">multiple_episode_policy</span> <span class="o">==</span> <span class="s2">&quot;average&quot;</span><span class="p">:</span>
</span><span id="Project.evaluate-1473"><a href="#Project.evaluate-1473"><span class="linenos">1473</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Project.evaluate-1474"><a href="#Project.evaluate-1474"><span class="linenos">1474</span></a>                <span class="p">(</span>
</span><span id="Project.evaluate-1475"><a href="#Project.evaluate-1475"><span class="linenos">1475</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="Project.evaluate-1476"><a href="#Project.evaluate-1476"><span class="linenos">1476</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project.evaluate-1477"><a href="#Project.evaluate-1477"><span class="linenos">1477</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project.evaluate-1478"><a href="#Project.evaluate-1478"><span class="linenos">1478</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="Project.evaluate-1479"><a href="#Project.evaluate-1479"><span class="linenos">1479</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project.evaluate-1480"><a href="#Project.evaluate-1480"><span class="linenos">1480</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_prediction</span><span class="p">(</span>
</span><span id="Project.evaluate-1481"><a href="#Project.evaluate-1481"><span class="linenos">1481</span></a>                    <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project.evaluate-1482"><a href="#Project.evaluate-1482"><span class="linenos">1482</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="Project.evaluate-1483"><a href="#Project.evaluate-1483"><span class="linenos">1483</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project.evaluate-1484"><a href="#Project.evaluate-1484"><span class="linenos">1484</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.evaluate-1485"><a href="#Project.evaluate-1485"><span class="linenos">1485</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project.evaluate-1486"><a href="#Project.evaluate-1486"><span class="linenos">1486</span></a>                    <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project.evaluate-1487"><a href="#Project.evaluate-1487"><span class="linenos">1487</span></a>                    <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project.evaluate-1488"><a href="#Project.evaluate-1488"><span class="linenos">1488</span></a>                    <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project.evaluate-1489"><a href="#Project.evaluate-1489"><span class="linenos">1489</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="n">evaluate</span><span class="p">,</span>
</span><span id="Project.evaluate-1490"><a href="#Project.evaluate-1490"><span class="linenos">1490</span></a>                <span class="p">)</span>
</span><span id="Project.evaluate-1491"><a href="#Project.evaluate-1491"><span class="linenos">1491</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="Project.evaluate-1492"><a href="#Project.evaluate-1492"><span class="linenos">1492</span></a>                <span class="p">(</span>
</span><span id="Project.evaluate-1493"><a href="#Project.evaluate-1493"><span class="linenos">1493</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="Project.evaluate-1494"><a href="#Project.evaluate-1494"><span class="linenos">1494</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project.evaluate-1495"><a href="#Project.evaluate-1495"><span class="linenos">1495</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project.evaluate-1496"><a href="#Project.evaluate-1496"><span class="linenos">1496</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="Project.evaluate-1497"><a href="#Project.evaluate-1497"><span class="linenos">1497</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project.evaluate-1498"><a href="#Project.evaluate-1498"><span class="linenos">1498</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_predictions</span><span class="p">(</span>
</span><span id="Project.evaluate-1499"><a href="#Project.evaluate-1499"><span class="linenos">1499</span></a>                    <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project.evaluate-1500"><a href="#Project.evaluate-1500"><span class="linenos">1500</span></a>                    <span class="n">episode_names</span><span class="p">,</span>
</span><span id="Project.evaluate-1501"><a href="#Project.evaluate-1501"><span class="linenos">1501</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project.evaluate-1502"><a href="#Project.evaluate-1502"><span class="linenos">1502</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.evaluate-1503"><a href="#Project.evaluate-1503"><span class="linenos">1503</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project.evaluate-1504"><a href="#Project.evaluate-1504"><span class="linenos">1504</span></a>                    <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project.evaluate-1505"><a href="#Project.evaluate-1505"><span class="linenos">1505</span></a>                    <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project.evaluate-1506"><a href="#Project.evaluate-1506"><span class="linenos">1506</span></a>                    <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project.evaluate-1507"><a href="#Project.evaluate-1507"><span class="linenos">1507</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="n">evaluate</span><span class="p">,</span>
</span><span id="Project.evaluate-1508"><a href="#Project.evaluate-1508"><span class="linenos">1508</span></a>                <span class="p">)</span>
</span><span id="Project.evaluate-1509"><a href="#Project.evaluate-1509"><span class="linenos">1509</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AGGREGATED:&quot;</span><span class="p">)</span>
</span><span id="Project.evaluate-1510"><a href="#Project.evaluate-1510"><span class="linenos">1510</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">evaluate_prediction</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project.evaluate-1511"><a href="#Project.evaluate-1511"><span class="linenos">1511</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skip_updating_meta</span><span class="p">:</span>
</span><span id="Project.evaluate-1512"><a href="#Project.evaluate-1512"><span class="linenos">1512</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_metrics</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">results</span><span class="p">)</span>
</span><span id="Project.evaluate-1513"><a href="#Project.evaluate-1513"><span class="linenos">1513</span></a>        <span class="k">elif</span> <span class="n">multiple_episode_policy</span> <span class="o">==</span> <span class="s2">&quot;statistics&quot;</span><span class="p">:</span>
</span><span id="Project.evaluate-1514"><a href="#Project.evaluate-1514"><span class="linenos">1514</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="Project.evaluate-1515"><a href="#Project.evaluate-1515"><span class="linenos">1515</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project.evaluate-1516"><a href="#Project.evaluate-1516"><span class="linenos">1516</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
</span><span id="Project.evaluate-1517"><a href="#Project.evaluate-1517"><span class="linenos">1517</span></a>                <span class="p">(</span>
</span><span id="Project.evaluate-1518"><a href="#Project.evaluate-1518"><span class="linenos">1518</span></a>                    <span class="n">task</span><span class="p">,</span>
</span><span id="Project.evaluate-1519"><a href="#Project.evaluate-1519"><span class="linenos">1519</span></a>                    <span class="n">parameters</span><span class="p">,</span>
</span><span id="Project.evaluate-1520"><a href="#Project.evaluate-1520"><span class="linenos">1520</span></a>                    <span class="n">mode</span><span class="p">,</span>
</span><span id="Project.evaluate-1521"><a href="#Project.evaluate-1521"><span class="linenos">1521</span></a>                    <span class="n">prediction</span><span class="p">,</span>
</span><span id="Project.evaluate-1522"><a href="#Project.evaluate-1522"><span class="linenos">1522</span></a>                    <span class="n">inference_time</span><span class="p">,</span>
</span><span id="Project.evaluate-1523"><a href="#Project.evaluate-1523"><span class="linenos">1523</span></a>                <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_prediction</span><span class="p">(</span>
</span><span id="Project.evaluate-1524"><a href="#Project.evaluate-1524"><span class="linenos">1524</span></a>                    <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project.evaluate-1525"><a href="#Project.evaluate-1525"><span class="linenos">1525</span></a>                    <span class="p">[</span><span class="n">name</span><span class="p">],</span>
</span><span id="Project.evaluate-1526"><a href="#Project.evaluate-1526"><span class="linenos">1526</span></a>                    <span class="n">load_epochs</span><span class="p">,</span>
</span><span id="Project.evaluate-1527"><a href="#Project.evaluate-1527"><span class="linenos">1527</span></a>                    <span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.evaluate-1528"><a href="#Project.evaluate-1528"><span class="linenos">1528</span></a>                    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project.evaluate-1529"><a href="#Project.evaluate-1529"><span class="linenos">1529</span></a>                    <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project.evaluate-1530"><a href="#Project.evaluate-1530"><span class="linenos">1530</span></a>                    <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project.evaluate-1531"><a href="#Project.evaluate-1531"><span class="linenos">1531</span></a>                    <span class="n">augment_n</span><span class="o">=</span><span class="n">augment_n</span><span class="p">,</span>
</span><span id="Project.evaluate-1532"><a href="#Project.evaluate-1532"><span class="linenos">1532</span></a>                    <span class="n">evaluate</span><span class="o">=</span><span class="n">evaluate</span><span class="p">,</span>
</span><span id="Project.evaluate-1533"><a href="#Project.evaluate-1533"><span class="linenos">1533</span></a>                    <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
</span><span id="Project.evaluate-1534"><a href="#Project.evaluate-1534"><span class="linenos">1534</span></a>                <span class="p">)</span>
</span><span id="Project.evaluate-1535"><a href="#Project.evaluate-1535"><span class="linenos">1535</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">evaluate_prediction</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project.evaluate-1536"><a href="#Project.evaluate-1536"><span class="linenos">1536</span></a>                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.evaluate-1537"><a href="#Project.evaluate-1537"><span class="linenos">1537</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Project.evaluate-1538"><a href="#Project.evaluate-1538"><span class="linenos">1538</span></a>                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">skip_updating_meta</span><span class="p">:</span>
</span><span id="Project.evaluate-1539"><a href="#Project.evaluate-1539"><span class="linenos">1539</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_episode_metrics</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
</span><span id="Project.evaluate-1540"><a href="#Project.evaluate-1540"><span class="linenos">1540</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="Project.evaluate-1541"><a href="#Project.evaluate-1541"><span class="linenos">1541</span></a>            <span class="n">mean_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Project.evaluate-1542"><a href="#Project.evaluate-1542"><span class="linenos">1542</span></a>            <span class="n">std_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Project.evaluate-1543"><a href="#Project.evaluate-1543"><span class="linenos">1543</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_list</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.evaluate-1544"><a href="#Project.evaluate-1544"><span class="linenos">1544</span></a>                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span>
</span><span id="Project.evaluate-1545"><a href="#Project.evaluate-1545"><span class="linenos">1545</span></a>                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span>
</span><span id="Project.evaluate-1546"><a href="#Project.evaluate-1546"><span class="linenos">1546</span></a>                <span class="n">mean_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Project.evaluate-1547"><a href="#Project.evaluate-1547"><span class="linenos">1547</span></a>                <span class="n">std_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">value_list</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Project.evaluate-1548"><a href="#Project.evaluate-1548"><span class="linenos">1548</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MEAN:&quot;</span><span class="p">)</span>
</span><span id="Project.evaluate-1549"><a href="#Project.evaluate-1549"><span class="linenos">1549</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">mean_string</span><span class="p">)</span>
</span><span id="Project.evaluate-1550"><a href="#Project.evaluate-1550"><span class="linenos">1550</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;STD:&quot;</span><span class="p">)</span>
</span><span id="Project.evaluate-1551"><a href="#Project.evaluate-1551"><span class="linenos">1551</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">std_string</span><span class="p">)</span>
</span><span id="Project.evaluate-1552"><a href="#Project.evaluate-1552"><span class="linenos">1552</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.evaluate-1553"><a href="#Project.evaluate-1553"><span class="linenos">1553</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.evaluate-1554"><a href="#Project.evaluate-1554"><span class="linenos">1554</span></a>                <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">multiple_episode_policy</span><span class="si">}</span><span class="s2"> multiple episode policy is not recognized; please choose &quot;</span>
</span><span id="Project.evaluate-1555"><a href="#Project.evaluate-1555"><span class="linenos">1555</span></a>                <span class="sa">f</span><span class="s2">&quot;from [&#39;average&#39;, &#39;statistics&#39;]&quot;</span>
</span><span id="Project.evaluate-1556"><a href="#Project.evaluate-1556"><span class="linenos">1556</span></a>            <span class="p">)</span>
</span><span id="Project.evaluate-1557"><a href="#Project.evaluate-1557"><span class="linenos">1557</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project.evaluate-1558"><a href="#Project.evaluate-1558"><span class="linenos">1558</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project.evaluate-1559"><a href="#Project.evaluate-1559"><span class="linenos">1559</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inference time: </span><span class="si">{</span><span class="n">inference_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.evaluate-1560"><a href="#Project.evaluate-1560"><span class="linenos">1560</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.evaluate-1561"><a href="#Project.evaluate-1561"><span class="linenos">1561</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Load one or several models from previously run episodes to make an evaluation</p>

<p>By default it will run on the test (or validation, if there is no test) subset of the project dataset.</p>

<h2 id="parameters">Parameters</h2>

<p>episode_names : list
    a list of string episode names to load the models from
load_epochs : list, optional
    a list of integer epoch indices to load the model from; if None, the last ones are used
augment_n : int, default 0
    the number of augmentations to average over
data_path : str, optional
    the data path to run the prediction for
file_paths : set, optional
    a set of files to run the prediction for
mode : {'test', 'val', 'train', 'all'}
    the subset of the data to make the prediction for (forced to 'all' if data_path is not None;
    by default 'test' if test subset is not empty and 'val' otherwise)
parameters_update : dict, optional
    a dictionary with parameter updates (cannot change model parameters)
remove_saved_features : bool, default False
    if <code>True</code>, the dataset will be deleted</p>

<h2 id="returns">Returns</h2>

<p>metric : dict
    a dictionary of average values of metric functions</p>
</div>


                            </div>
                            <div id="Project.list_episodes" class="classattr">
                                        <input id="Project.list_episodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_episodes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="Project.list_episodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.list_episodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.list_episodes-1639"><a href="#Project.list_episodes-1639"><span class="linenos">1639</span></a>    <span class="k">def</span> <span class="nf">list_episodes</span><span class="p">(</span>
</span><span id="Project.list_episodes-1640"><a href="#Project.list_episodes-1640"><span class="linenos">1640</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.list_episodes-1641"><a href="#Project.list_episodes-1641"><span class="linenos">1641</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.list_episodes-1642"><a href="#Project.list_episodes-1642"><span class="linenos">1642</span></a>        <span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Project.list_episodes-1643"><a href="#Project.list_episodes-1643"><span class="linenos">1643</span></a>        <span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.list_episodes-1644"><a href="#Project.list_episodes-1644"><span class="linenos">1644</span></a>        <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project.list_episodes-1645"><a href="#Project.list_episodes-1645"><span class="linenos">1645</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Project.list_episodes-1646"><a href="#Project.list_episodes-1646"><span class="linenos">1646</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.list_episodes-1647"><a href="#Project.list_episodes-1647"><span class="linenos">1647</span></a><span class="sd">        Get a filtered pandas dataframe with episode metadata</span>
</span><span id="Project.list_episodes-1648"><a href="#Project.list_episodes-1648"><span class="linenos">1648</span></a>
</span><span id="Project.list_episodes-1649"><a href="#Project.list_episodes-1649"><span class="linenos">1649</span></a><span class="sd">        Parameters</span>
</span><span id="Project.list_episodes-1650"><a href="#Project.list_episodes-1650"><span class="linenos">1650</span></a><span class="sd">        ----------</span>
</span><span id="Project.list_episodes-1651"><a href="#Project.list_episodes-1651"><span class="linenos">1651</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project.list_episodes-1652"><a href="#Project.list_episodes-1652"><span class="linenos">1652</span></a><span class="sd">            a list of strings of episode names</span>
</span><span id="Project.list_episodes-1653"><a href="#Project.list_episodes-1653"><span class="linenos">1653</span></a><span class="sd">        value_filter : str</span>
</span><span id="Project.list_episodes-1654"><a href="#Project.list_episodes-1654"><span class="linenos">1654</span></a><span class="sd">            a string of filters to apply; of this general structure:</span>
</span><span id="Project.list_episodes-1655"><a href="#Project.list_episodes-1655"><span class="linenos">1655</span></a><span class="sd">            &#39;group_name1/par_name1::(&lt;/&gt;/&lt;=/&gt;=/=)value1,group_name2/par_name2::(&lt;/&gt;/&lt;=/&gt;=/=)value2&#39;, e.g.</span>
</span><span id="Project.list_episodes-1656"><a href="#Project.list_episodes-1656"><span class="linenos">1656</span></a><span class="sd">            &#39;data/overlap::=50,results/recall::&gt;0.5,data/feature_extraction::=kinematic,meta/training_time::&gt;=00:00:10&#39;</span>
</span><span id="Project.list_episodes-1657"><a href="#Project.list_episodes-1657"><span class="linenos">1657</span></a><span class="sd">        display_parameters : list</span>
</span><span id="Project.list_episodes-1658"><a href="#Project.list_episodes-1658"><span class="linenos">1658</span></a><span class="sd">            list of parameters to display (e.g. [&#39;data/overlap&#39;, &#39;results/recall&#39;])</span>
</span><span id="Project.list_episodes-1659"><a href="#Project.list_episodes-1659"><span class="linenos">1659</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="Project.list_episodes-1660"><a href="#Project.list_episodes-1660"><span class="linenos">1660</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="Project.list_episodes-1661"><a href="#Project.list_episodes-1661"><span class="linenos">1661</span></a>
</span><span id="Project.list_episodes-1662"><a href="#Project.list_episodes-1662"><span class="linenos">1662</span></a><span class="sd">        Returns</span>
</span><span id="Project.list_episodes-1663"><a href="#Project.list_episodes-1663"><span class="linenos">1663</span></a><span class="sd">        -------</span>
</span><span id="Project.list_episodes-1664"><a href="#Project.list_episodes-1664"><span class="linenos">1664</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="Project.list_episodes-1665"><a href="#Project.list_episodes-1665"><span class="linenos">1665</span></a><span class="sd">            the filtered dataframe</span>
</span><span id="Project.list_episodes-1666"><a href="#Project.list_episodes-1666"><span class="linenos">1666</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.list_episodes-1667"><a href="#Project.list_episodes-1667"><span class="linenos">1667</span></a>
</span><span id="Project.list_episodes-1668"><a href="#Project.list_episodes-1668"><span class="linenos">1668</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span>
</span><span id="Project.list_episodes-1669"><a href="#Project.list_episodes-1669"><span class="linenos">1669</span></a>            <span class="n">episode_names</span><span class="p">,</span> <span class="n">value_filter</span><span class="p">,</span> <span class="n">display_parameters</span>
</span><span id="Project.list_episodes-1670"><a href="#Project.list_episodes-1670"><span class="linenos">1670</span></a>        <span class="p">)</span>
</span><span id="Project.list_episodes-1671"><a href="#Project.list_episodes-1671"><span class="linenos">1671</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="Project.list_episodes-1672"><a href="#Project.list_episodes-1672"><span class="linenos">1672</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TRAINING EPISODES&quot;</span><span class="p">)</span>
</span><span id="Project.list_episodes-1673"><a href="#Project.list_episodes-1673"><span class="linenos">1673</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">episodes</span><span class="p">)</span>
</span><span id="Project.list_episodes-1674"><a href="#Project.list_episodes-1674"><span class="linenos">1674</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.list_episodes-1675"><a href="#Project.list_episodes-1675"><span class="linenos">1675</span></a>        <span class="k">return</span> <span class="n">episodes</span>
</span></pre></div>


            <div class="docstring"><p>Get a filtered pandas dataframe with episode metadata</p>

<h2 id="parameters">Parameters</h2>

<p>episode_names : list
    a list of strings of episode names
value_filter : str
    a string of filters to apply; of this general structure:
    'group_name1/par_name1::(</>/&lt;=/>=/=)value1,group_name2/par_name2::(</>/&lt;=/>=/=)value2', e.g.
    'data/overlap::=50,results/recall::&gt;0.5,data/feature_extraction::=kinematic,meta/training_time::&gt;=00:00:10'
display_parameters : list
    list of parameters to display (e.g. ['data/overlap', 'results/recall'])
print_results : bool, default True
    if True, the result will be printed to standard output</p>

<h2 id="returns">Returns</h2>

<p>pd.DataFrame
    the filtered dataframe</p>
</div>


                            </div>
                            <div id="Project.list_predictions" class="classattr">
                                        <input id="Project.list_predictions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_predictions</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="Project.list_predictions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.list_predictions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.list_predictions-1677"><a href="#Project.list_predictions-1677"><span class="linenos">1677</span></a>    <span class="k">def</span> <span class="nf">list_predictions</span><span class="p">(</span>
</span><span id="Project.list_predictions-1678"><a href="#Project.list_predictions-1678"><span class="linenos">1678</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.list_predictions-1679"><a href="#Project.list_predictions-1679"><span class="linenos">1679</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.list_predictions-1680"><a href="#Project.list_predictions-1680"><span class="linenos">1680</span></a>        <span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Project.list_predictions-1681"><a href="#Project.list_predictions-1681"><span class="linenos">1681</span></a>        <span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.list_predictions-1682"><a href="#Project.list_predictions-1682"><span class="linenos">1682</span></a>        <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project.list_predictions-1683"><a href="#Project.list_predictions-1683"><span class="linenos">1683</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Project.list_predictions-1684"><a href="#Project.list_predictions-1684"><span class="linenos">1684</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.list_predictions-1685"><a href="#Project.list_predictions-1685"><span class="linenos">1685</span></a><span class="sd">        Get a filtered pandas dataframe with prediction metadata</span>
</span><span id="Project.list_predictions-1686"><a href="#Project.list_predictions-1686"><span class="linenos">1686</span></a>
</span><span id="Project.list_predictions-1687"><a href="#Project.list_predictions-1687"><span class="linenos">1687</span></a><span class="sd">        Parameters</span>
</span><span id="Project.list_predictions-1688"><a href="#Project.list_predictions-1688"><span class="linenos">1688</span></a><span class="sd">        ----------</span>
</span><span id="Project.list_predictions-1689"><a href="#Project.list_predictions-1689"><span class="linenos">1689</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project.list_predictions-1690"><a href="#Project.list_predictions-1690"><span class="linenos">1690</span></a><span class="sd">            a list of strings of episode names</span>
</span><span id="Project.list_predictions-1691"><a href="#Project.list_predictions-1691"><span class="linenos">1691</span></a><span class="sd">        value_filter : str</span>
</span><span id="Project.list_predictions-1692"><a href="#Project.list_predictions-1692"><span class="linenos">1692</span></a><span class="sd">            a string of filters to apply; of this general structure:</span>
</span><span id="Project.list_predictions-1693"><a href="#Project.list_predictions-1693"><span class="linenos">1693</span></a><span class="sd">            &#39;group_name1/par_name1:(&lt;&gt;=)value1,group_name2/par_name2:(&lt;&gt;=)value2&#39;, e.g.</span>
</span><span id="Project.list_predictions-1694"><a href="#Project.list_predictions-1694"><span class="linenos">1694</span></a><span class="sd">            &#39;data/overlap:=50,results/recall:&gt;0.5,data/feature_extraction:=kinematic&#39;</span>
</span><span id="Project.list_predictions-1695"><a href="#Project.list_predictions-1695"><span class="linenos">1695</span></a><span class="sd">        display_parameters : list</span>
</span><span id="Project.list_predictions-1696"><a href="#Project.list_predictions-1696"><span class="linenos">1696</span></a><span class="sd">            list of parameters to display (e.g. [&#39;data/overlap&#39;, &#39;results/recall&#39;])</span>
</span><span id="Project.list_predictions-1697"><a href="#Project.list_predictions-1697"><span class="linenos">1697</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="Project.list_predictions-1698"><a href="#Project.list_predictions-1698"><span class="linenos">1698</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="Project.list_predictions-1699"><a href="#Project.list_predictions-1699"><span class="linenos">1699</span></a>
</span><span id="Project.list_predictions-1700"><a href="#Project.list_predictions-1700"><span class="linenos">1700</span></a><span class="sd">        Returns</span>
</span><span id="Project.list_predictions-1701"><a href="#Project.list_predictions-1701"><span class="linenos">1701</span></a><span class="sd">        -------</span>
</span><span id="Project.list_predictions-1702"><a href="#Project.list_predictions-1702"><span class="linenos">1702</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="Project.list_predictions-1703"><a href="#Project.list_predictions-1703"><span class="linenos">1703</span></a><span class="sd">            the filtered dataframe</span>
</span><span id="Project.list_predictions-1704"><a href="#Project.list_predictions-1704"><span class="linenos">1704</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.list_predictions-1705"><a href="#Project.list_predictions-1705"><span class="linenos">1705</span></a>
</span><span id="Project.list_predictions-1706"><a href="#Project.list_predictions-1706"><span class="linenos">1706</span></a>        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span>
</span><span id="Project.list_predictions-1707"><a href="#Project.list_predictions-1707"><span class="linenos">1707</span></a>            <span class="n">episode_names</span><span class="p">,</span> <span class="n">value_filter</span><span class="p">,</span> <span class="n">display_parameters</span>
</span><span id="Project.list_predictions-1708"><a href="#Project.list_predictions-1708"><span class="linenos">1708</span></a>        <span class="p">)</span>
</span><span id="Project.list_predictions-1709"><a href="#Project.list_predictions-1709"><span class="linenos">1709</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="Project.list_predictions-1710"><a href="#Project.list_predictions-1710"><span class="linenos">1710</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PREDICTIONS&quot;</span><span class="p">)</span>
</span><span id="Project.list_predictions-1711"><a href="#Project.list_predictions-1711"><span class="linenos">1711</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
</span><span id="Project.list_predictions-1712"><a href="#Project.list_predictions-1712"><span class="linenos">1712</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.list_predictions-1713"><a href="#Project.list_predictions-1713"><span class="linenos">1713</span></a>        <span class="k">return</span> <span class="n">predictions</span>
</span></pre></div>


            <div class="docstring"><p>Get a filtered pandas dataframe with prediction metadata</p>

<h2 id="parameters">Parameters</h2>

<p>episode_names : list
    a list of strings of episode names
value_filter : str
    a string of filters to apply; of this general structure:
    'group_name1/par_name1:(&lt;&gt;=)value1,group_name2/par_name2:(&lt;&gt;=)value2', e.g.
    'data/overlap:=50,results/recall:&gt;0.5,data/feature_extraction:=kinematic'
display_parameters : list
    list of parameters to display (e.g. ['data/overlap', 'results/recall'])
print_results : bool, default True
    if True, the result will be printed to standard output</p>

<h2 id="returns">Returns</h2>

<p>pd.DataFrame
    the filtered dataframe</p>
</div>


                            </div>
                            <div id="Project.list_searches" class="classattr">
                                        <input id="Project.list_searches-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_searches</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">search_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="Project.list_searches-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.list_searches"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.list_searches-1715"><a href="#Project.list_searches-1715"><span class="linenos">1715</span></a>    <span class="k">def</span> <span class="nf">list_searches</span><span class="p">(</span>
</span><span id="Project.list_searches-1716"><a href="#Project.list_searches-1716"><span class="linenos">1716</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.list_searches-1717"><a href="#Project.list_searches-1717"><span class="linenos">1717</span></a>        <span class="n">search_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.list_searches-1718"><a href="#Project.list_searches-1718"><span class="linenos">1718</span></a>        <span class="n">value_filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="Project.list_searches-1719"><a href="#Project.list_searches-1719"><span class="linenos">1719</span></a>        <span class="n">display_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.list_searches-1720"><a href="#Project.list_searches-1720"><span class="linenos">1720</span></a>        <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project.list_searches-1721"><a href="#Project.list_searches-1721"><span class="linenos">1721</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="Project.list_searches-1722"><a href="#Project.list_searches-1722"><span class="linenos">1722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.list_searches-1723"><a href="#Project.list_searches-1723"><span class="linenos">1723</span></a><span class="sd">        Get a filtered pandas dataframe with hyperparameter search metadata</span>
</span><span id="Project.list_searches-1724"><a href="#Project.list_searches-1724"><span class="linenos">1724</span></a>
</span><span id="Project.list_searches-1725"><a href="#Project.list_searches-1725"><span class="linenos">1725</span></a><span class="sd">        Parameters</span>
</span><span id="Project.list_searches-1726"><a href="#Project.list_searches-1726"><span class="linenos">1726</span></a><span class="sd">        ----------</span>
</span><span id="Project.list_searches-1727"><a href="#Project.list_searches-1727"><span class="linenos">1727</span></a><span class="sd">        search_names : list</span>
</span><span id="Project.list_searches-1728"><a href="#Project.list_searches-1728"><span class="linenos">1728</span></a><span class="sd">            a list of strings of search names</span>
</span><span id="Project.list_searches-1729"><a href="#Project.list_searches-1729"><span class="linenos">1729</span></a><span class="sd">        value_filter : str</span>
</span><span id="Project.list_searches-1730"><a href="#Project.list_searches-1730"><span class="linenos">1730</span></a><span class="sd">            a string of filters to apply; of this general structure:</span>
</span><span id="Project.list_searches-1731"><a href="#Project.list_searches-1731"><span class="linenos">1731</span></a><span class="sd">            &#39;group_name1/par_name1:(&lt;&gt;=)value1,group_name2/par_name2:(&lt;&gt;=)value2&#39;, e.g.</span>
</span><span id="Project.list_searches-1732"><a href="#Project.list_searches-1732"><span class="linenos">1732</span></a><span class="sd">            &#39;data/overlap:=50,results/recall:&gt;0.5,data/feature_extraction:=kinematic&#39;</span>
</span><span id="Project.list_searches-1733"><a href="#Project.list_searches-1733"><span class="linenos">1733</span></a><span class="sd">        display_parameters : list</span>
</span><span id="Project.list_searches-1734"><a href="#Project.list_searches-1734"><span class="linenos">1734</span></a><span class="sd">            list of parameters to display (e.g. [&#39;data/overlap&#39;, &#39;results/recall&#39;])</span>
</span><span id="Project.list_searches-1735"><a href="#Project.list_searches-1735"><span class="linenos">1735</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="Project.list_searches-1736"><a href="#Project.list_searches-1736"><span class="linenos">1736</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="Project.list_searches-1737"><a href="#Project.list_searches-1737"><span class="linenos">1737</span></a>
</span><span id="Project.list_searches-1738"><a href="#Project.list_searches-1738"><span class="linenos">1738</span></a><span class="sd">        Returns</span>
</span><span id="Project.list_searches-1739"><a href="#Project.list_searches-1739"><span class="linenos">1739</span></a><span class="sd">        -------</span>
</span><span id="Project.list_searches-1740"><a href="#Project.list_searches-1740"><span class="linenos">1740</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="Project.list_searches-1741"><a href="#Project.list_searches-1741"><span class="linenos">1741</span></a><span class="sd">            the filtered dataframe</span>
</span><span id="Project.list_searches-1742"><a href="#Project.list_searches-1742"><span class="linenos">1742</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.list_searches-1743"><a href="#Project.list_searches-1743"><span class="linenos">1743</span></a>
</span><span id="Project.list_searches-1744"><a href="#Project.list_searches-1744"><span class="linenos">1744</span></a>        <span class="n">searches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span>
</span><span id="Project.list_searches-1745"><a href="#Project.list_searches-1745"><span class="linenos">1745</span></a>            <span class="n">search_names</span><span class="p">,</span> <span class="n">value_filter</span><span class="p">,</span> <span class="n">display_parameters</span>
</span><span id="Project.list_searches-1746"><a href="#Project.list_searches-1746"><span class="linenos">1746</span></a>        <span class="p">)</span>
</span><span id="Project.list_searches-1747"><a href="#Project.list_searches-1747"><span class="linenos">1747</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="Project.list_searches-1748"><a href="#Project.list_searches-1748"><span class="linenos">1748</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SEARCHES&quot;</span><span class="p">)</span>
</span><span id="Project.list_searches-1749"><a href="#Project.list_searches-1749"><span class="linenos">1749</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">searches</span><span class="p">)</span>
</span><span id="Project.list_searches-1750"><a href="#Project.list_searches-1750"><span class="linenos">1750</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.list_searches-1751"><a href="#Project.list_searches-1751"><span class="linenos">1751</span></a>        <span class="k">return</span> <span class="n">searches</span>
</span></pre></div>


            <div class="docstring"><p>Get a filtered pandas dataframe with hyperparameter search metadata</p>

<h2 id="parameters">Parameters</h2>

<p>search_names : list
    a list of strings of search names
value_filter : str
    a string of filters to apply; of this general structure:
    'group_name1/par_name1:(&lt;&gt;=)value1,group_name2/par_name2:(&lt;&gt;=)value2', e.g.
    'data/overlap:=50,results/recall:&gt;0.5,data/feature_extraction:=kinematic'
display_parameters : list
    list of parameters to display (e.g. ['data/overlap', 'results/recall'])
print_results : bool, default True
    if True, the result will be printed to standard output</p>

<h2 id="returns">Returns</h2>

<p>pd.DataFrame
    the filtered dataframe</p>
</div>


                            </div>
                            <div id="Project.get_best_parameters" class="classattr">
                                        <input id="Project.get_best_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_best_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Project.get_best_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.get_best_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.get_best_parameters-1753"><a href="#Project.get_best_parameters-1753"><span class="linenos">1753</span></a>    <span class="k">def</span> <span class="nf">get_best_parameters</span><span class="p">(</span>
</span><span id="Project.get_best_parameters-1754"><a href="#Project.get_best_parameters-1754"><span class="linenos">1754</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.get_best_parameters-1755"><a href="#Project.get_best_parameters-1755"><span class="linenos">1755</span></a>        <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project.get_best_parameters-1756"><a href="#Project.get_best_parameters-1756"><span class="linenos">1756</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.get_best_parameters-1757"><a href="#Project.get_best_parameters-1757"><span class="linenos">1757</span></a>    <span class="p">):</span>
</span><span id="Project.get_best_parameters-1758"><a href="#Project.get_best_parameters-1758"><span class="linenos">1758</span></a>        <span class="n">params</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">get_best_params</span><span class="p">(</span>
</span><span id="Project.get_best_parameters-1759"><a href="#Project.get_best_parameters-1759"><span class="linenos">1759</span></a>            <span class="n">search_name</span><span class="p">,</span> <span class="n">round_to_binary</span><span class="o">=</span><span class="n">round_to_binary</span>
</span><span id="Project.get_best_parameters-1760"><a href="#Project.get_best_parameters-1760"><span class="linenos">1760</span></a>        <span class="p">)</span>
</span><span id="Project.get_best_parameters-1761"><a href="#Project.get_best_parameters-1761"><span class="linenos">1761</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">}})</span>
</span><span id="Project.get_best_parameters-1762"><a href="#Project.get_best_parameters-1762"><span class="linenos">1762</span></a>        <span class="k">return</span> <span class="n">params</span>
</span></pre></div>


    

                            </div>
                            <div id="Project.list_best_parameters" class="classattr">
                                        <input id="Project.list_best_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_best_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="Project.list_best_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.list_best_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.list_best_parameters-1764"><a href="#Project.list_best_parameters-1764"><span class="linenos">1764</span></a>    <span class="k">def</span> <span class="nf">list_best_parameters</span><span class="p">(</span>
</span><span id="Project.list_best_parameters-1765"><a href="#Project.list_best_parameters-1765"><span class="linenos">1765</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">print_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Project.list_best_parameters-1766"><a href="#Project.list_best_parameters-1766"><span class="linenos">1766</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project.list_best_parameters-1767"><a href="#Project.list_best_parameters-1767"><span class="linenos">1767</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.list_best_parameters-1768"><a href="#Project.list_best_parameters-1768"><span class="linenos">1768</span></a><span class="sd">        Get the raw dictionary of best parameters found by a search</span>
</span><span id="Project.list_best_parameters-1769"><a href="#Project.list_best_parameters-1769"><span class="linenos">1769</span></a>
</span><span id="Project.list_best_parameters-1770"><a href="#Project.list_best_parameters-1770"><span class="linenos">1770</span></a><span class="sd">        Parameters</span>
</span><span id="Project.list_best_parameters-1771"><a href="#Project.list_best_parameters-1771"><span class="linenos">1771</span></a><span class="sd">        ----------</span>
</span><span id="Project.list_best_parameters-1772"><a href="#Project.list_best_parameters-1772"><span class="linenos">1772</span></a><span class="sd">        search_name : str</span>
</span><span id="Project.list_best_parameters-1773"><a href="#Project.list_best_parameters-1773"><span class="linenos">1773</span></a><span class="sd">            the name of the search</span>
</span><span id="Project.list_best_parameters-1774"><a href="#Project.list_best_parameters-1774"><span class="linenos">1774</span></a><span class="sd">        print_results : bool, default True</span>
</span><span id="Project.list_best_parameters-1775"><a href="#Project.list_best_parameters-1775"><span class="linenos">1775</span></a><span class="sd">            if True, the result will be printed to standard output</span>
</span><span id="Project.list_best_parameters-1776"><a href="#Project.list_best_parameters-1776"><span class="linenos">1776</span></a>
</span><span id="Project.list_best_parameters-1777"><a href="#Project.list_best_parameters-1777"><span class="linenos">1777</span></a><span class="sd">        Returns</span>
</span><span id="Project.list_best_parameters-1778"><a href="#Project.list_best_parameters-1778"><span class="linenos">1778</span></a><span class="sd">        -------</span>
</span><span id="Project.list_best_parameters-1779"><a href="#Project.list_best_parameters-1779"><span class="linenos">1779</span></a><span class="sd">        best_params : dict</span>
</span><span id="Project.list_best_parameters-1780"><a href="#Project.list_best_parameters-1780"><span class="linenos">1780</span></a><span class="sd">            a dictionary of the best parameters where the keys are in &#39;{group}/{name}&#39; format</span>
</span><span id="Project.list_best_parameters-1781"><a href="#Project.list_best_parameters-1781"><span class="linenos">1781</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.list_best_parameters-1782"><a href="#Project.list_best_parameters-1782"><span class="linenos">1782</span></a>
</span><span id="Project.list_best_parameters-1783"><a href="#Project.list_best_parameters-1783"><span class="linenos">1783</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">get_best_params_raw</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="Project.list_best_parameters-1784"><a href="#Project.list_best_parameters-1784"><span class="linenos">1784</span></a>        <span class="k">if</span> <span class="n">print_results</span><span class="p">:</span>
</span><span id="Project.list_best_parameters-1785"><a href="#Project.list_best_parameters-1785"><span class="linenos">1785</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SEARCH RESULTS </span><span class="si">{</span><span class="n">search_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.list_best_parameters-1786"><a href="#Project.list_best_parameters-1786"><span class="linenos">1786</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.list_best_parameters-1787"><a href="#Project.list_best_parameters-1787"><span class="linenos">1787</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.list_best_parameters-1788"><a href="#Project.list_best_parameters-1788"><span class="linenos">1788</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.list_best_parameters-1789"><a href="#Project.list_best_parameters-1789"><span class="linenos">1789</span></a>        <span class="k">return</span> <span class="n">params</span>
</span></pre></div>


            <div class="docstring"><p>Get the raw dictionary of best parameters found by a search</p>

<h2 id="parameters">Parameters</h2>

<p>search_name : str
    the name of the search
print_results : bool, default True
    if True, the result will be printed to standard output</p>

<h2 id="returns">Returns</h2>

<p>best_params : dict
    a dictionary of the best parameters where the keys are in '{group}/{name}' format</p>
</div>


                            </div>
                            <div id="Project.plot_episodes" class="classattr">
                                        <input id="Project.plot_episodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_episodes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">metrics</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">modes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">episode_labels</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">add_hlines</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">epoch_limits</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">colors</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">add_highpoint_hlines</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.plot_episodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.plot_episodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.plot_episodes-1791"><a href="#Project.plot_episodes-1791"><span class="linenos">1791</span></a>    <span class="k">def</span> <span class="nf">plot_episodes</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1792"><a href="#Project.plot_episodes-1792"><span class="linenos">1792</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1793"><a href="#Project.plot_episodes-1793"><span class="linenos">1793</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1794"><a href="#Project.plot_episodes-1794"><span class="linenos">1794</span></a>        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1795"><a href="#Project.plot_episodes-1795"><span class="linenos">1795</span></a>        <span class="n">modes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1796"><a href="#Project.plot_episodes-1796"><span class="linenos">1796</span></a>        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1797"><a href="#Project.plot_episodes-1797"><span class="linenos">1797</span></a>        <span class="n">episode_labels</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1798"><a href="#Project.plot_episodes-1798"><span class="linenos">1798</span></a>        <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1799"><a href="#Project.plot_episodes-1799"><span class="linenos">1799</span></a>        <span class="n">add_hlines</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1800"><a href="#Project.plot_episodes-1800"><span class="linenos">1800</span></a>        <span class="n">epoch_limits</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1801"><a href="#Project.plot_episodes-1801"><span class="linenos">1801</span></a>        <span class="n">colors</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1802"><a href="#Project.plot_episodes-1802"><span class="linenos">1802</span></a>        <span class="n">add_highpoint_hlines</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1803"><a href="#Project.plot_episodes-1803"><span class="linenos">1803</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1804"><a href="#Project.plot_episodes-1804"><span class="linenos">1804</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.plot_episodes-1805"><a href="#Project.plot_episodes-1805"><span class="linenos">1805</span></a><span class="sd">        Plot episode training curves</span>
</span><span id="Project.plot_episodes-1806"><a href="#Project.plot_episodes-1806"><span class="linenos">1806</span></a>
</span><span id="Project.plot_episodes-1807"><a href="#Project.plot_episodes-1807"><span class="linenos">1807</span></a><span class="sd">        Parameters</span>
</span><span id="Project.plot_episodes-1808"><a href="#Project.plot_episodes-1808"><span class="linenos">1808</span></a><span class="sd">        ----------</span>
</span><span id="Project.plot_episodes-1809"><a href="#Project.plot_episodes-1809"><span class="linenos">1809</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project.plot_episodes-1810"><a href="#Project.plot_episodes-1810"><span class="linenos">1810</span></a><span class="sd">            a list of episode names to plot; to plot to episodes in one line combine them in a list</span>
</span><span id="Project.plot_episodes-1811"><a href="#Project.plot_episodes-1811"><span class="linenos">1811</span></a><span class="sd">            (e.g. [&#39;episode1&#39;, [&#39;episode2&#39;, &#39;episode3&#39;]] to plot episode2 and episode3 as one experiment)</span>
</span><span id="Project.plot_episodes-1812"><a href="#Project.plot_episodes-1812"><span class="linenos">1812</span></a><span class="sd">        metrics : list</span>
</span><span id="Project.plot_episodes-1813"><a href="#Project.plot_episodes-1813"><span class="linenos">1813</span></a><span class="sd">            a list of metric to plot</span>
</span><span id="Project.plot_episodes-1814"><a href="#Project.plot_episodes-1814"><span class="linenos">1814</span></a><span class="sd">        modes : list, optional</span>
</span><span id="Project.plot_episodes-1815"><a href="#Project.plot_episodes-1815"><span class="linenos">1815</span></a><span class="sd">            a list of modes to plot (&#39;train&#39; and/or &#39;val&#39;; `[&#39;val&#39;]` by default)</span>
</span><span id="Project.plot_episodes-1816"><a href="#Project.plot_episodes-1816"><span class="linenos">1816</span></a><span class="sd">        title : str, optional</span>
</span><span id="Project.plot_episodes-1817"><a href="#Project.plot_episodes-1817"><span class="linenos">1817</span></a><span class="sd">            title for the plot</span>
</span><span id="Project.plot_episodes-1818"><a href="#Project.plot_episodes-1818"><span class="linenos">1818</span></a><span class="sd">        episode_labels : list, optional</span>
</span><span id="Project.plot_episodes-1819"><a href="#Project.plot_episodes-1819"><span class="linenos">1819</span></a><span class="sd">            a list of strings used to label the curves (has to be the same length as episode_names)</span>
</span><span id="Project.plot_episodes-1820"><a href="#Project.plot_episodes-1820"><span class="linenos">1820</span></a><span class="sd">        save_path : str, optional</span>
</span><span id="Project.plot_episodes-1821"><a href="#Project.plot_episodes-1821"><span class="linenos">1821</span></a><span class="sd">            the path to save the resulting plot</span>
</span><span id="Project.plot_episodes-1822"><a href="#Project.plot_episodes-1822"><span class="linenos">1822</span></a><span class="sd">        add_hlines : list, optional</span>
</span><span id="Project.plot_episodes-1823"><a href="#Project.plot_episodes-1823"><span class="linenos">1823</span></a><span class="sd">            a list of float values (or (value, label) tuples) to mark with horizontal lines</span>
</span><span id="Project.plot_episodes-1824"><a href="#Project.plot_episodes-1824"><span class="linenos">1824</span></a><span class="sd">        colors: list, optional</span>
</span><span id="Project.plot_episodes-1825"><a href="#Project.plot_episodes-1825"><span class="linenos">1825</span></a><span class="sd">            a list of matplotlib colors</span>
</span><span id="Project.plot_episodes-1826"><a href="#Project.plot_episodes-1826"><span class="linenos">1826</span></a><span class="sd">        add_highpoint_hlines : bool, default False</span>
</span><span id="Project.plot_episodes-1827"><a href="#Project.plot_episodes-1827"><span class="linenos">1827</span></a><span class="sd">            if `True`, horizontal lines will be added at the highest value of each episode</span>
</span><span id="Project.plot_episodes-1828"><a href="#Project.plot_episodes-1828"><span class="linenos">1828</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.plot_episodes-1829"><a href="#Project.plot_episodes-1829"><span class="linenos">1829</span></a>
</span><span id="Project.plot_episodes-1830"><a href="#Project.plot_episodes-1830"><span class="linenos">1830</span></a>        <span class="k">if</span> <span class="n">modes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1831"><a href="#Project.plot_episodes-1831"><span class="linenos">1831</span></a>            <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;val&quot;</span><span class="p">]</span>
</span><span id="Project.plot_episodes-1832"><a href="#Project.plot_episodes-1832"><span class="linenos">1832</span></a>        <span class="k">if</span> <span class="n">add_hlines</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1833"><a href="#Project.plot_episodes-1833"><span class="linenos">1833</span></a>            <span class="n">add_hlines</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.plot_episodes-1834"><a href="#Project.plot_episodes-1834"><span class="linenos">1834</span></a>        <span class="n">logs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.plot_episodes-1835"><a href="#Project.plot_episodes-1835"><span class="linenos">1835</span></a>        <span class="n">epochs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.plot_episodes-1836"><a href="#Project.plot_episodes-1836"><span class="linenos">1836</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.plot_episodes-1837"><a href="#Project.plot_episodes-1837"><span class="linenos">1837</span></a>        <span class="k">if</span> <span class="n">episode_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1838"><a href="#Project.plot_episodes-1838"><span class="linenos">1838</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">episode_labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">episode_names</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1839"><a href="#Project.plot_episodes-1839"><span class="linenos">1839</span></a>        <span class="k">for</span> <span class="n">name_i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">episode_names</span><span class="p">):</span>
</span><span id="Project.plot_episodes-1840"><a href="#Project.plot_episodes-1840"><span class="linenos">1840</span></a>            <span class="n">log_params</span> <span class="o">=</span> <span class="n">product</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">modes</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1841"><a href="#Project.plot_episodes-1841"><span class="linenos">1841</span></a>            <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">log_params</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1842"><a href="#Project.plot_episodes-1842"><span class="linenos">1842</span></a>                <span class="k">if</span> <span class="n">episode_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1843"><a href="#Project.plot_episodes-1843"><span class="linenos">1843</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="n">episode_labels</span><span class="p">[</span><span class="n">name_i</span><span class="p">]</span>
</span><span id="Project.plot_episodes-1844"><a href="#Project.plot_episodes-1844"><span class="linenos">1844</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1845"><a href="#Project.plot_episodes-1845"><span class="linenos">1845</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1846"><a href="#Project.plot_episodes-1846"><span class="linenos">1846</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">modes</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1847"><a href="#Project.plot_episodes-1847"><span class="linenos">1847</span></a>                    <span class="n">label</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project.plot_episodes-1848"><a href="#Project.plot_episodes-1848"><span class="linenos">1848</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1849"><a href="#Project.plot_episodes-1849"><span class="linenos">1849</span></a>                    <span class="n">label</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project.plot_episodes-1850"><a href="#Project.plot_episodes-1850"><span class="linenos">1850</span></a>                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1851"><a href="#Project.plot_episodes-1851"><span class="linenos">1851</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Project.plot_episodes-1852"><a href="#Project.plot_episodes-1852"><span class="linenos">1852</span></a>                    <span class="n">epoch_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="Project.plot_episodes-1853"><a href="#Project.plot_episodes-1853"><span class="linenos">1853</span></a>                    <span class="n">multi_logs</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="Project.plot_episodes-1854"><a href="#Project.plot_episodes-1854"><span class="linenos">1854</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span><span id="Project.plot_episodes-1855"><a href="#Project.plot_episodes-1855"><span class="linenos">1855</span></a>                        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1856"><a href="#Project.plot_episodes-1856"><span class="linenos">1856</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1857"><a href="#Project.plot_episodes-1857"><span class="linenos">1857</span></a>                            <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1858"><a href="#Project.plot_episodes-1858"><span class="linenos">1858</span></a>                                <span class="n">index</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Project.plot_episodes-1859"><a href="#Project.plot_episodes-1859"><span class="linenos">1859</span></a>                                <span class="k">if</span> <span class="n">multi_logs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="Project.plot_episodes-1860"><a href="#Project.plot_episodes-1860"><span class="linenos">1860</span></a>                                    <span class="k">if</span> <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1861"><a href="#Project.plot_episodes-1861"><span class="linenos">1861</span></a>                                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1862"><a href="#Project.plot_episodes-1862"><span class="linenos">1862</span></a>                                            <span class="s2">&quot;The run indices are not consistent across episodes!&quot;</span>
</span><span id="Project.plot_episodes-1863"><a href="#Project.plot_episodes-1863"><span class="linenos">1863</span></a>                                        <span class="p">)</span>
</span><span id="Project.plot_episodes-1864"><a href="#Project.plot_episodes-1864"><span class="linenos">1864</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1865"><a href="#Project.plot_episodes-1865"><span class="linenos">1865</span></a>                                        <span class="n">multi_logs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span>
</span><span id="Project.plot_episodes-1866"><a href="#Project.plot_episodes-1866"><span class="linenos">1866</span></a>                                <span class="n">multi_logs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1867"><a href="#Project.plot_episodes-1867"><span class="linenos">1867</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1868"><a href="#Project.plot_episodes-1868"><span class="linenos">1868</span></a>                                <span class="p">)</span>
</span><span id="Project.plot_episodes-1869"><a href="#Project.plot_episodes-1869"><span class="linenos">1869</span></a>                                <span class="n">start</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Project.plot_episodes-1870"><a href="#Project.plot_episodes-1870"><span class="linenos">1870</span></a>                                    <span class="mi">0</span>
</span><span id="Project.plot_episodes-1871"><a href="#Project.plot_episodes-1871"><span class="linenos">1871</span></a>                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Project.plot_episodes-1872"><a href="#Project.plot_episodes-1872"><span class="linenos">1872</span></a>                                    <span class="k">else</span> <span class="n">epoch_list</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Project.plot_episodes-1873"><a href="#Project.plot_episodes-1873"><span class="linenos">1873</span></a>                                <span class="p">)</span>
</span><span id="Project.plot_episodes-1874"><a href="#Project.plot_episodes-1874"><span class="linenos">1874</span></a>                                <span class="n">epoch_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Project.plot_episodes-1875"><a href="#Project.plot_episodes-1875"><span class="linenos">1875</span></a>                                    <span class="n">x</span> <span class="o">+</span> <span class="n">start</span>
</span><span id="Project.plot_episodes-1876"><a href="#Project.plot_episodes-1876"><span class="linenos">1876</span></a>                                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1877"><a href="#Project.plot_episodes-1877"><span class="linenos">1877</span></a>                                <span class="p">]</span>
</span><span id="Project.plot_episodes-1878"><a href="#Project.plot_episodes-1878"><span class="linenos">1878</span></a>                            <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project.plot_episodes-1879"><a href="#Project.plot_episodes-1879"><span class="linenos">1879</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1880"><a href="#Project.plot_episodes-1880"><span class="linenos">1880</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_logs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1881"><a href="#Project.plot_episodes-1881"><span class="linenos">1881</span></a>                                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1882"><a href="#Project.plot_episodes-1882"><span class="linenos">1882</span></a>                                    <span class="s2">&quot;Cannot plot a single-run episode after a multi-run episode!&quot;</span>
</span><span id="Project.plot_episodes-1883"><a href="#Project.plot_episodes-1883"><span class="linenos">1883</span></a>                                <span class="p">)</span>
</span><span id="Project.plot_episodes-1884"><a href="#Project.plot_episodes-1884"><span class="linenos">1884</span></a>                            <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1885"><a href="#Project.plot_episodes-1885"><span class="linenos">1885</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1886"><a href="#Project.plot_episodes-1886"><span class="linenos">1886</span></a>                            <span class="p">)</span>
</span><span id="Project.plot_episodes-1887"><a href="#Project.plot_episodes-1887"><span class="linenos">1887</span></a>                            <span class="n">start</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Project.plot_episodes-1888"><a href="#Project.plot_episodes-1888"><span class="linenos">1888</span></a>                                <span class="mi">0</span>
</span><span id="Project.plot_episodes-1889"><a href="#Project.plot_episodes-1889"><span class="linenos">1889</span></a>                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Project.plot_episodes-1890"><a href="#Project.plot_episodes-1890"><span class="linenos">1890</span></a>                                <span class="k">else</span> <span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Project.plot_episodes-1891"><a href="#Project.plot_episodes-1891"><span class="linenos">1891</span></a>                            <span class="p">)</span>
</span><span id="Project.plot_episodes-1892"><a href="#Project.plot_episodes-1892"><span class="linenos">1892</span></a>                            <span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Project.plot_episodes-1893"><a href="#Project.plot_episodes-1893"><span class="linenos">1893</span></a>                                <span class="n">x</span> <span class="o">+</span> <span class="n">start</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1894"><a href="#Project.plot_episodes-1894"><span class="linenos">1894</span></a>                            <span class="p">]</span>
</span><span id="Project.plot_episodes-1895"><a href="#Project.plot_episodes-1895"><span class="linenos">1895</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_logs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1896"><a href="#Project.plot_episodes-1896"><span class="linenos">1896</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="n">multi_logs</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">]</span>
</span><span id="Project.plot_episodes-1897"><a href="#Project.plot_episodes-1897"><span class="linenos">1897</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">])</span>
</span><span id="Project.plot_episodes-1898"><a href="#Project.plot_episodes-1898"><span class="linenos">1898</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1899"><a href="#Project.plot_episodes-1899"><span class="linenos">1899</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">multi_logs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;null&quot;</span><span class="p">])</span>
</span><span id="Project.plot_episodes-1900"><a href="#Project.plot_episodes-1900"><span class="linenos">1900</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1901"><a href="#Project.plot_episodes-1901"><span class="linenos">1901</span></a>                            <span class="nb">tuple</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">epoch_list</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;null&quot;</span><span class="p">])</span>
</span><span id="Project.plot_episodes-1902"><a href="#Project.plot_episodes-1902"><span class="linenos">1902</span></a>                        <span class="p">)</span>
</span><span id="Project.plot_episodes-1903"><a href="#Project.plot_episodes-1903"><span class="linenos">1903</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1904"><a href="#Project.plot_episodes-1904"><span class="linenos">1904</span></a>                    <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1905"><a href="#Project.plot_episodes-1905"><span class="linenos">1905</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1906"><a href="#Project.plot_episodes-1906"><span class="linenos">1906</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.plot_episodes-1907"><a href="#Project.plot_episodes-1907"><span class="linenos">1907</span></a>                        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1908"><a href="#Project.plot_episodes-1908"><span class="linenos">1908</span></a>                            <span class="n">tracked_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">()</span>
</span><span id="Project.plot_episodes-1909"><a href="#Project.plot_episodes-1909"><span class="linenos">1909</span></a>                            <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1910"><a href="#Project.plot_episodes-1910"><span class="linenos">1910</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1911"><a href="#Project.plot_episodes-1911"><span class="linenos">1911</span></a>                                    <span class="nb">list</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1912"><a href="#Project.plot_episodes-1912"><span class="linenos">1912</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1913"><a href="#Project.plot_episodes-1913"><span class="linenos">1913</span></a>                                    <span class="p">)</span>
</span><span id="Project.plot_episodes-1914"><a href="#Project.plot_episodes-1914"><span class="linenos">1914</span></a>                                <span class="p">)</span>
</span><span id="Project.plot_episodes-1915"><a href="#Project.plot_episodes-1915"><span class="linenos">1915</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1916"><a href="#Project.plot_episodes-1916"><span class="linenos">1916</span></a>                                <span class="n">relevant</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.plot_episodes-1917"><a href="#Project.plot_episodes-1917"><span class="linenos">1917</span></a>                                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1918"><a href="#Project.plot_episodes-1918"><span class="linenos">1918</span></a>                                    <span class="n">m_split</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1919"><a href="#Project.plot_episodes-1919"><span class="linenos">1919</span></a>                                    <span class="k">if</span> <span class="p">(</span>
</span><span id="Project.plot_episodes-1920"><a href="#Project.plot_episodes-1920"><span class="linenos">1920</span></a>                                        <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m_split</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">metric</span>
</span><span id="Project.plot_episodes-1921"><a href="#Project.plot_episodes-1921"><span class="linenos">1921</span></a>                                        <span class="ow">and</span> <span class="n">m_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span>
</span><span id="Project.plot_episodes-1922"><a href="#Project.plot_episodes-1922"><span class="linenos">1922</span></a>                                    <span class="p">):</span>
</span><span id="Project.plot_episodes-1923"><a href="#Project.plot_episodes-1923"><span class="linenos">1923</span></a>                                        <span class="n">relevant</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1924"><a href="#Project.plot_episodes-1924"><span class="linenos">1924</span></a>                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1925"><a href="#Project.plot_episodes-1925"><span class="linenos">1925</span></a>                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1926"><a href="#Project.plot_episodes-1926"><span class="linenos">1926</span></a>                                        <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> metric was not tracked at </span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project.plot_episodes-1927"><a href="#Project.plot_episodes-1927"><span class="linenos">1927</span></a>                                    <span class="p">)</span>
</span><span id="Project.plot_episodes-1928"><a href="#Project.plot_episodes-1928"><span class="linenos">1928</span></a>                                <span class="n">arr</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project.plot_episodes-1929"><a href="#Project.plot_episodes-1929"><span class="linenos">1929</span></a>                                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1930"><a href="#Project.plot_episodes-1930"><span class="linenos">1930</span></a>                                    <span class="n">arr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1931"><a href="#Project.plot_episodes-1931"><span class="linenos">1931</span></a>                                <span class="n">arr</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1932"><a href="#Project.plot_episodes-1932"><span class="linenos">1932</span></a>                                <span class="n">log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
</span><span id="Project.plot_episodes-1933"><a href="#Project.plot_episodes-1933"><span class="linenos">1933</span></a>                        <span class="n">log</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1934"><a href="#Project.plot_episodes-1934"><span class="linenos">1934</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1935"><a href="#Project.plot_episodes-1935"><span class="linenos">1935</span></a>                            <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1936"><a href="#Project.plot_episodes-1936"><span class="linenos">1936</span></a>                                <span class="p">[</span>
</span><span id="Project.plot_episodes-1937"><a href="#Project.plot_episodes-1937"><span class="linenos">1937</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1938"><a href="#Project.plot_episodes-1938"><span class="linenos">1938</span></a>                                    <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span>
</span><span id="Project.plot_episodes-1939"><a href="#Project.plot_episodes-1939"><span class="linenos">1939</span></a>                                <span class="p">]</span>
</span><span id="Project.plot_episodes-1940"><a href="#Project.plot_episodes-1940"><span class="linenos">1940</span></a>                            <span class="p">)</span>
</span><span id="Project.plot_episodes-1941"><a href="#Project.plot_episodes-1941"><span class="linenos">1941</span></a>                        <span class="p">)</span>
</span><span id="Project.plot_episodes-1942"><a href="#Project.plot_episodes-1942"><span class="linenos">1942</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1943"><a href="#Project.plot_episodes-1943"><span class="linenos">1943</span></a>                        <span class="n">tracked_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">()</span>
</span><span id="Project.plot_episodes-1944"><a href="#Project.plot_episodes-1944"><span class="linenos">1944</span></a>                        <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1945"><a href="#Project.plot_episodes-1945"><span class="linenos">1945</span></a>                            <span class="n">log</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">metric</span><span class="p">))</span>
</span><span id="Project.plot_episodes-1946"><a href="#Project.plot_episodes-1946"><span class="linenos">1946</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1947"><a href="#Project.plot_episodes-1947"><span class="linenos">1947</span></a>                            <span class="n">relevant</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.plot_episodes-1948"><a href="#Project.plot_episodes-1948"><span class="linenos">1948</span></a>                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tracked_metrics</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1949"><a href="#Project.plot_episodes-1949"><span class="linenos">1949</span></a>                                <span class="n">m_split</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1950"><a href="#Project.plot_episodes-1950"><span class="linenos">1950</span></a>                                <span class="k">if</span> <span class="p">(</span>
</span><span id="Project.plot_episodes-1951"><a href="#Project.plot_episodes-1951"><span class="linenos">1951</span></a>                                    <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m_split</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">metric</span>
</span><span id="Project.plot_episodes-1952"><a href="#Project.plot_episodes-1952"><span class="linenos">1952</span></a>                                    <span class="ow">and</span> <span class="n">m_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span>
</span><span id="Project.plot_episodes-1953"><a href="#Project.plot_episodes-1953"><span class="linenos">1953</span></a>                                <span class="p">):</span>
</span><span id="Project.plot_episodes-1954"><a href="#Project.plot_episodes-1954"><span class="linenos">1954</span></a>                                    <span class="n">relevant</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1955"><a href="#Project.plot_episodes-1955"><span class="linenos">1955</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1956"><a href="#Project.plot_episodes-1956"><span class="linenos">1956</span></a>                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1957"><a href="#Project.plot_episodes-1957"><span class="linenos">1957</span></a>                                    <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> metric was not tracked at </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project.plot_episodes-1958"><a href="#Project.plot_episodes-1958"><span class="linenos">1958</span></a>                                <span class="p">)</span>
</span><span id="Project.plot_episodes-1959"><a href="#Project.plot_episodes-1959"><span class="linenos">1959</span></a>                            <span class="n">arr</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project.plot_episodes-1960"><a href="#Project.plot_episodes-1960"><span class="linenos">1960</span></a>                            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1961"><a href="#Project.plot_episodes-1961"><span class="linenos">1961</span></a>                                <span class="n">arr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1962"><a href="#Project.plot_episodes-1962"><span class="linenos">1962</span></a>                            <span class="n">arr</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1963"><a href="#Project.plot_episodes-1963"><span class="linenos">1963</span></a>                            <span class="n">log</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1964"><a href="#Project.plot_episodes-1964"><span class="linenos">1964</span></a>                        <span class="n">epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">get_epoch_list</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="Project.plot_episodes-1965"><a href="#Project.plot_episodes-1965"><span class="linenos">1965</span></a>                <span class="n">logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1966"><a href="#Project.plot_episodes-1966"><span class="linenos">1966</span></a>        <span class="c1"># if episode_labels is not None:</span>
</span><span id="Project.plot_episodes-1967"><a href="#Project.plot_episodes-1967"><span class="linenos">1967</span></a>        <span class="c1">#     print(f&#39;{len(episode_labels)=}, {len(logs)=}&#39;)</span>
</span><span id="Project.plot_episodes-1968"><a href="#Project.plot_episodes-1968"><span class="linenos">1968</span></a>        <span class="c1">#     if len(episode_labels) != len(logs):</span>
</span><span id="Project.plot_episodes-1969"><a href="#Project.plot_episodes-1969"><span class="linenos">1969</span></a>
</span><span id="Project.plot_episodes-1970"><a href="#Project.plot_episodes-1970"><span class="linenos">1970</span></a>        <span class="c1">#         raise ValueError(</span>
</span><span id="Project.plot_episodes-1971"><a href="#Project.plot_episodes-1971"><span class="linenos">1971</span></a>        <span class="c1">#             f&quot;The length of episode_labels ({len(episode_labels)}) has to be equal to the length of &quot;</span>
</span><span id="Project.plot_episodes-1972"><a href="#Project.plot_episodes-1972"><span class="linenos">1972</span></a>        <span class="c1">#             f&quot;curves ({len(logs)})!&quot;</span>
</span><span id="Project.plot_episodes-1973"><a href="#Project.plot_episodes-1973"><span class="linenos">1973</span></a>        <span class="c1">#         )</span>
</span><span id="Project.plot_episodes-1974"><a href="#Project.plot_episodes-1974"><span class="linenos">1974</span></a>        <span class="c1">#     else:</span>
</span><span id="Project.plot_episodes-1975"><a href="#Project.plot_episodes-1975"><span class="linenos">1975</span></a>        <span class="c1">#         labels = episode_labels</span>
</span><span id="Project.plot_episodes-1976"><a href="#Project.plot_episodes-1976"><span class="linenos">1976</span></a>        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1977"><a href="#Project.plot_episodes-1977"><span class="linenos">1977</span></a>            <span class="n">colors</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">logs</span><span class="p">)))</span>
</span><span id="Project.plot_episodes-1978"><a href="#Project.plot_episodes-1978"><span class="linenos">1978</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">logs</span><span class="p">):</span>
</span><span id="Project.plot_episodes-1979"><a href="#Project.plot_episodes-1979"><span class="linenos">1979</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1980"><a href="#Project.plot_episodes-1980"><span class="linenos">1980</span></a>                <span class="s2">&quot;The length of colors has to be equal to the length of curves (metrics * modes * episode_names)!&quot;</span>
</span><span id="Project.plot_episodes-1981"><a href="#Project.plot_episodes-1981"><span class="linenos">1981</span></a>            <span class="p">)</span>
</span><span id="Project.plot_episodes-1982"><a href="#Project.plot_episodes-1982"><span class="linenos">1982</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="Project.plot_episodes-1983"><a href="#Project.plot_episodes-1983"><span class="linenos">1983</span></a>        <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Project.plot_episodes-1984"><a href="#Project.plot_episodes-1984"><span class="linenos">1984</span></a>        <span class="k">for</span> <span class="n">log</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">epoch_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">logs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">epochs</span><span class="p">):</span>
</span><span id="Project.plot_episodes-1985"><a href="#Project.plot_episodes-1985"><span class="linenos">1985</span></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1986"><a href="#Project.plot_episodes-1986"><span class="linenos">1986</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1987"><a href="#Project.plot_episodes-1987"><span class="linenos">1987</span></a>                    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1988"><a href="#Project.plot_episodes-1988"><span class="linenos">1988</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Project.plot_episodes-1989"><a href="#Project.plot_episodes-1989"><span class="linenos">1989</span></a>                    <span class="n">epoch_list</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1990"><a href="#Project.plot_episodes-1990"><span class="linenos">1990</span></a>                    <span class="n">log</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1991"><a href="#Project.plot_episodes-1991"><span class="linenos">1991</span></a>                    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1992"><a href="#Project.plot_episodes-1992"><span class="linenos">1992</span></a>                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="Project.plot_episodes-1993"><a href="#Project.plot_episodes-1993"><span class="linenos">1993</span></a>                <span class="p">)</span>
</span><span id="Project.plot_episodes-1994"><a href="#Project.plot_episodes-1994"><span class="linenos">1994</span></a>                <span class="k">if</span> <span class="n">add_highpoint_hlines</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1995"><a href="#Project.plot_episodes-1995"><span class="linenos">1995</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">log</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span><span id="Project.plot_episodes-1996"><a href="#Project.plot_episodes-1996"><span class="linenos">1996</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1997"><a href="#Project.plot_episodes-1997"><span class="linenos">1997</span></a>                <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">xx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">epoch_list</span><span class="p">):</span>
</span><span id="Project.plot_episodes-1998"><a href="#Project.plot_episodes-1998"><span class="linenos">1998</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
</span><span id="Project.plot_episodes-1999"><a href="#Project.plot_episodes-1999"><span class="linenos">1999</span></a>                        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="Project.plot_episodes-2000"><a href="#Project.plot_episodes-2000"><span class="linenos">2000</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Project.plot_episodes-2001"><a href="#Project.plot_episodes-2001"><span class="linenos">2001</span></a>                        <span class="n">xx</span><span class="p">,</span>
</span><span id="Project.plot_episodes-2002"><a href="#Project.plot_episodes-2002"><span class="linenos">2002</span></a>                        <span class="n">l</span><span class="p">,</span>
</span><span id="Project.plot_episodes-2003"><a href="#Project.plot_episodes-2003"><span class="linenos">2003</span></a>                        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="Project.plot_episodes-2004"><a href="#Project.plot_episodes-2004"><span class="linenos">2004</span></a>                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="Project.plot_episodes-2005"><a href="#Project.plot_episodes-2005"><span class="linenos">2005</span></a>                    <span class="p">)</span>
</span><span id="Project.plot_episodes-2006"><a href="#Project.plot_episodes-2006"><span class="linenos">2006</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">log</span><span class="p">]):</span>
</span><span id="Project.plot_episodes-2007"><a href="#Project.plot_episodes-2007"><span class="linenos">2007</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Project.plot_episodes-2008"><a href="#Project.plot_episodes-2008"><span class="linenos">2008</span></a>                        <span class="sa">f</span><span class="s2">&quot;Got logs with unequal lengths in parallel runs for </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project.plot_episodes-2009"><a href="#Project.plot_episodes-2009"><span class="linenos">2009</span></a>                    <span class="p">)</span>
</span><span id="Project.plot_episodes-2010"><a href="#Project.plot_episodes-2010"><span class="linenos">2010</span></a>                    <span class="n">log</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="Project.plot_episodes-2011"><a href="#Project.plot_episodes-2011"><span class="linenos">2011</span></a>                    <span class="n">epoch_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">)</span>
</span><span id="Project.plot_episodes-2012"><a href="#Project.plot_episodes-2012"><span class="linenos">2012</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">epoch_list</span><span class="p">):</span>
</span><span id="Project.plot_episodes-2013"><a href="#Project.plot_episodes-2013"><span class="linenos">2013</span></a>                        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.plot_episodes-2014"><a href="#Project.plot_episodes-2014"><span class="linenos">2014</span></a>                        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
</span><span id="Project.plot_episodes-2015"><a href="#Project.plot_episodes-2015"><span class="linenos">2015</span></a>                            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="Project.plot_episodes-2016"><a href="#Project.plot_episodes-2016"><span class="linenos">2016</span></a>                                <span class="n">y_ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="Project.plot_episodes-2017"><a href="#Project.plot_episodes-2017"><span class="linenos">2017</span></a>                                <span class="n">to_remove</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">y_ind</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
</span><span id="Project.plot_episodes-2018"><a href="#Project.plot_episodes-2018"><span class="linenos">2018</span></a>                        <span class="n">epoch_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project.plot_episodes-2019"><a href="#Project.plot_episodes-2019"><span class="linenos">2019</span></a>                            <span class="n">y</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_remove</span>
</span><span id="Project.plot_episodes-2020"><a href="#Project.plot_episodes-2020"><span class="linenos">2020</span></a>                        <span class="p">]</span>
</span><span id="Project.plot_episodes-2021"><a href="#Project.plot_episodes-2021"><span class="linenos">2021</span></a>                        <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">]</span>
</span><span id="Project.plot_episodes-2022"><a href="#Project.plot_episodes-2022"><span class="linenos">2022</span></a>                    <span class="n">length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">log</span><span class="p">])</span>
</span><span id="Project.plot_episodes-2023"><a href="#Project.plot_episodes-2023"><span class="linenos">2023</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)):</span>
</span><span id="Project.plot_episodes-2024"><a href="#Project.plot_episodes-2024"><span class="linenos">2024</span></a>                        <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="n">length</span><span class="p">]</span>
</span><span id="Project.plot_episodes-2025"><a href="#Project.plot_episodes-2025"><span class="linenos">2025</span></a>                        <span class="n">epoch_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">epoch_list</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="n">length</span><span class="p">]</span>
</span><span id="Project.plot_episodes-2026"><a href="#Project.plot_episodes-2026"><span class="linenos">2026</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">==</span> <span class="n">epoch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">epoch_list</span><span class="p">]):</span>
</span><span id="Project.plot_episodes-2027"><a href="#Project.plot_episodes-2027"><span class="linenos">2027</span></a>                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Project.plot_episodes-2028"><a href="#Project.plot_episodes-2028"><span class="linenos">2028</span></a>                            <span class="sa">f</span><span class="s2">&quot;Got different epoch indices in parallel runs for </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project.plot_episodes-2029"><a href="#Project.plot_episodes-2029"><span class="linenos">2029</span></a>                        <span class="p">)</span>
</span><span id="Project.plot_episodes-2030"><a href="#Project.plot_episodes-2030"><span class="linenos">2030</span></a>                <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">log</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Project.plot_episodes-2031"><a href="#Project.plot_episodes-2031"><span class="linenos">2031</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="Project.plot_episodes-2032"><a href="#Project.plot_episodes-2032"><span class="linenos">2032</span></a>                    <span class="n">epoch_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Project.plot_episodes-2033"><a href="#Project.plot_episodes-2033"><span class="linenos">2033</span></a>                    <span class="n">mean</span><span class="p">,</span>
</span><span id="Project.plot_episodes-2034"><a href="#Project.plot_episodes-2034"><span class="linenos">2034</span></a>                    <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="Project.plot_episodes-2035"><a href="#Project.plot_episodes-2035"><span class="linenos">2035</span></a>                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="Project.plot_episodes-2036"><a href="#Project.plot_episodes-2036"><span class="linenos">2036</span></a>                <span class="p">)</span>
</span><span id="Project.plot_episodes-2037"><a href="#Project.plot_episodes-2037"><span class="linenos">2037</span></a>                <span class="k">if</span> <span class="n">add_highpoint_hlines</span><span class="p">:</span>
</span><span id="Project.plot_episodes-2038"><a href="#Project.plot_episodes-2038"><span class="linenos">2038</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mean</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</span><span id="Project.plot_episodes-2039"><a href="#Project.plot_episodes-2039"><span class="linenos">2039</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">add_hlines</span><span class="p">:</span>
</span><span id="Project.plot_episodes-2040"><a href="#Project.plot_episodes-2040"><span class="linenos">2040</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project.plot_episodes-2041"><a href="#Project.plot_episodes-2041"><span class="linenos">2041</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
</span><span id="Project.plot_episodes-2042"><a href="#Project.plot_episodes-2042"><span class="linenos">2042</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">x</span>
</span><span id="Project.plot_episodes-2043"><a href="#Project.plot_episodes-2043"><span class="linenos">2043</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
</span><span id="Project.plot_episodes-2044"><a href="#Project.plot_episodes-2044"><span class="linenos">2044</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
</span><span id="Project.plot_episodes-2045"><a href="#Project.plot_episodes-2045"><span class="linenos">2045</span></a>
</span><span id="Project.plot_episodes-2046"><a href="#Project.plot_episodes-2046"><span class="linenos">2046</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="Project.plot_episodes-2047"><a href="#Project.plot_episodes-2047"><span class="linenos">2047</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;epochs&quot;</span><span class="p">)</span>
</span><span id="Project.plot_episodes-2048"><a href="#Project.plot_episodes-2048"><span class="linenos">2048</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.plot_episodes-2049"><a href="#Project.plot_episodes-2049"><span class="linenos">2049</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Project.plot_episodes-2050"><a href="#Project.plot_episodes-2050"><span class="linenos">2050</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_episodes-2051"><a href="#Project.plot_episodes-2051"><span class="linenos">2051</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
</span><span id="Project.plot_episodes-2052"><a href="#Project.plot_episodes-2052"><span class="linenos">2052</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_episodes-2053"><a href="#Project.plot_episodes-2053"><span class="linenos">2053</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">episode_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.plot_episodes-2054"><a href="#Project.plot_episodes-2054"><span class="linenos">2054</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">episode_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project.plot_episodes-2055"><a href="#Project.plot_episodes-2055"><span class="linenos">2055</span></a>            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Project.plot_episodes-2056"><a href="#Project.plot_episodes-2056"><span class="linenos">2056</span></a>                <span class="n">title</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project.plot_episodes-2057"><a href="#Project.plot_episodes-2057"><span class="linenos">2057</span></a>        <span class="k">if</span> <span class="n">epoch_limits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_episodes-2058"><a href="#Project.plot_episodes-2058"><span class="linenos">2058</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">epoch_limits</span><span class="p">)</span>
</span><span id="Project.plot_episodes-2059"><a href="#Project.plot_episodes-2059"><span class="linenos">2059</span></a>        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_episodes-2060"><a href="#Project.plot_episodes-2060"><span class="linenos">2060</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="Project.plot_episodes-2061"><a href="#Project.plot_episodes-2061"><span class="linenos">2061</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Project.plot_episodes-2062"><a href="#Project.plot_episodes-2062"><span class="linenos">2062</span></a>        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_episodes-2063"><a href="#Project.plot_episodes-2063"><span class="linenos">2063</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Plot episode training curves</p>

<h2 id="parameters">Parameters</h2>

<p>episode_names : list
    a list of episode names to plot; to plot to episodes in one line combine them in a list
    (e.g. ['episode1', ['episode2', 'episode3']] to plot episode2 and episode3 as one experiment)
metrics : list
    a list of metric to plot
modes : list, optional
    a list of modes to plot ('train' and/or 'val'; <code>['val']</code> by default)
title : str, optional
    title for the plot
episode_labels : list, optional
    a list of strings used to label the curves (has to be the same length as episode_names)
save_path : str, optional
    the path to save the resulting plot
add_hlines : list, optional
    a list of float values (or (value, label) tuples) to mark with horizontal lines
colors: list, optional
    a list of matplotlib colors
add_highpoint_hlines : bool, default False
    if <code>True</code>, horizontal lines will be added at the highest value of each episode</p>
</div>


                            </div>
                            <div id="Project.update_parameters" class="classattr">
                                        <input id="Project.update_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_parameters</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">load_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.update_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.update_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.update_parameters-2065"><a href="#Project.update_parameters-2065"><span class="linenos">2065</span></a>    <span class="k">def</span> <span class="nf">update_parameters</span><span class="p">(</span>
</span><span id="Project.update_parameters-2066"><a href="#Project.update_parameters-2066"><span class="linenos">2066</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.update_parameters-2067"><a href="#Project.update_parameters-2067"><span class="linenos">2067</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.update_parameters-2068"><a href="#Project.update_parameters-2068"><span class="linenos">2068</span></a>        <span class="n">load_search</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.update_parameters-2069"><a href="#Project.update_parameters-2069"><span class="linenos">2069</span></a>        <span class="n">load_parameters</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.update_parameters-2070"><a href="#Project.update_parameters-2070"><span class="linenos">2070</span></a>        <span class="n">round_to_binary</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.update_parameters-2071"><a href="#Project.update_parameters-2071"><span class="linenos">2071</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.update_parameters-2072"><a href="#Project.update_parameters-2072"><span class="linenos">2072</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.update_parameters-2073"><a href="#Project.update_parameters-2073"><span class="linenos">2073</span></a><span class="sd">        Update the parameters in the project config files</span>
</span><span id="Project.update_parameters-2074"><a href="#Project.update_parameters-2074"><span class="linenos">2074</span></a>
</span><span id="Project.update_parameters-2075"><a href="#Project.update_parameters-2075"><span class="linenos">2075</span></a><span class="sd">        Parameters</span>
</span><span id="Project.update_parameters-2076"><a href="#Project.update_parameters-2076"><span class="linenos">2076</span></a><span class="sd">        ----------</span>
</span><span id="Project.update_parameters-2077"><a href="#Project.update_parameters-2077"><span class="linenos">2077</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project.update_parameters-2078"><a href="#Project.update_parameters-2078"><span class="linenos">2078</span></a><span class="sd">            a dictionary of parameter updates</span>
</span><span id="Project.update_parameters-2079"><a href="#Project.update_parameters-2079"><span class="linenos">2079</span></a><span class="sd">        load_search : str, optional</span>
</span><span id="Project.update_parameters-2080"><a href="#Project.update_parameters-2080"><span class="linenos">2080</span></a><span class="sd">            the name of hyperparameter search results to load to config</span>
</span><span id="Project.update_parameters-2081"><a href="#Project.update_parameters-2081"><span class="linenos">2081</span></a><span class="sd">        load_parameters : list, optional</span>
</span><span id="Project.update_parameters-2082"><a href="#Project.update_parameters-2082"><span class="linenos">2082</span></a><span class="sd">            a list of lists of string names of the parameters to load from the searches</span>
</span><span id="Project.update_parameters-2083"><a href="#Project.update_parameters-2083"><span class="linenos">2083</span></a><span class="sd">        round_to_binary : list, optional</span>
</span><span id="Project.update_parameters-2084"><a href="#Project.update_parameters-2084"><span class="linenos">2084</span></a><span class="sd">            a list of string names of the loaded parameters that should be rounded to the nearest power of two</span>
</span><span id="Project.update_parameters-2085"><a href="#Project.update_parameters-2085"><span class="linenos">2085</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.update_parameters-2086"><a href="#Project.update_parameters-2086"><span class="linenos">2086</span></a>
</span><span id="Project.update_parameters-2087"><a href="#Project.update_parameters-2087"><span class="linenos">2087</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project.update_parameters-2088"><a href="#Project.update_parameters-2088"><span class="linenos">2088</span></a>            <span class="s2">&quot;general&quot;</span><span class="p">,</span>
</span><span id="Project.update_parameters-2089"><a href="#Project.update_parameters-2089"><span class="linenos">2089</span></a>            <span class="s2">&quot;losses&quot;</span><span class="p">,</span>
</span><span id="Project.update_parameters-2090"><a href="#Project.update_parameters-2090"><span class="linenos">2090</span></a>            <span class="s2">&quot;metrics&quot;</span><span class="p">,</span>
</span><span id="Project.update_parameters-2091"><a href="#Project.update_parameters-2091"><span class="linenos">2091</span></a>            <span class="s2">&quot;ssl&quot;</span><span class="p">,</span>
</span><span id="Project.update_parameters-2092"><a href="#Project.update_parameters-2092"><span class="linenos">2092</span></a>            <span class="s2">&quot;training&quot;</span><span class="p">,</span>
</span><span id="Project.update_parameters-2093"><a href="#Project.update_parameters-2093"><span class="linenos">2093</span></a>            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
</span><span id="Project.update_parameters-2094"><a href="#Project.update_parameters-2094"><span class="linenos">2094</span></a>        <span class="p">]</span>
</span><span id="Project.update_parameters-2095"><a href="#Project.update_parameters-2095"><span class="linenos">2095</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">(</span><span class="n">catch_blanks</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Project.update_parameters-2096"><a href="#Project.update_parameters-2096"><span class="linenos">2096</span></a>        <span class="k">if</span> <span class="n">parameters_update</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.update_parameters-2097"><a href="#Project.update_parameters-2097"><span class="linenos">2097</span></a>            <span class="k">if</span> <span class="s2">&quot;model&quot;</span> <span class="ow">in</span> <span class="n">parameters_update</span><span class="p">:</span>
</span><span id="Project.update_parameters-2098"><a href="#Project.update_parameters-2098"><span class="linenos">2098</span></a>                <span class="n">model_params</span> <span class="o">=</span> <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="Project.update_parameters-2099"><a href="#Project.update_parameters-2099"><span class="linenos">2099</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project.update_parameters-2100"><a href="#Project.update_parameters-2100"><span class="linenos">2100</span></a>                <span class="n">model_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project.update_parameters-2101"><a href="#Project.update_parameters-2101"><span class="linenos">2101</span></a>            <span class="k">if</span> <span class="s2">&quot;features&quot;</span> <span class="ow">in</span> <span class="n">parameters_update</span><span class="p">:</span>
</span><span id="Project.update_parameters-2102"><a href="#Project.update_parameters-2102"><span class="linenos">2102</span></a>                <span class="n">feat_params</span> <span class="o">=</span> <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
</span><span id="Project.update_parameters-2103"><a href="#Project.update_parameters-2103"><span class="linenos">2103</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project.update_parameters-2104"><a href="#Project.update_parameters-2104"><span class="linenos">2104</span></a>                <span class="n">feat_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project.update_parameters-2105"><a href="#Project.update_parameters-2105"><span class="linenos">2105</span></a>            <span class="k">if</span> <span class="s2">&quot;augmentations&quot;</span> <span class="ow">in</span> <span class="n">parameters_update</span><span class="p">:</span>
</span><span id="Project.update_parameters-2106"><a href="#Project.update_parameters-2106"><span class="linenos">2106</span></a>                <span class="n">aug_params</span> <span class="o">=</span> <span class="n">parameters_update</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;augmentations&quot;</span><span class="p">)</span>
</span><span id="Project.update_parameters-2107"><a href="#Project.update_parameters-2107"><span class="linenos">2107</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project.update_parameters-2108"><a href="#Project.update_parameters-2108"><span class="linenos">2108</span></a>                <span class="n">aug_params</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project.update_parameters-2109"><a href="#Project.update_parameters-2109"><span class="linenos">2109</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">parameters_update</span><span class="p">)</span>
</span><span id="Project.update_parameters-2110"><a href="#Project.update_parameters-2110"><span class="linenos">2110</span></a>            <span class="n">model_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="Project.update_parameters-2111"><a href="#Project.update_parameters-2111"><span class="linenos">2111</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project.update_parameters-2112"><a href="#Project.update_parameters-2112"><span class="linenos">2112</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="Project.update_parameters-2113"><a href="#Project.update_parameters-2113"><span class="linenos">2113</span></a>            <span class="p">)</span>
</span><span id="Project.update_parameters-2114"><a href="#Project.update_parameters-2114"><span class="linenos">2114</span></a>            <span class="k">if</span> <span class="n">model_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.update_parameters-2115"><a href="#Project.update_parameters-2115"><span class="linenos">2115</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">model_params</span><span class="p">)</span>
</span><span id="Project.update_parameters-2116"><a href="#Project.update_parameters-2116"><span class="linenos">2116</span></a>            <span class="n">feat_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="Project.update_parameters-2117"><a href="#Project.update_parameters-2117"><span class="linenos">2117</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project.update_parameters-2118"><a href="#Project.update_parameters-2118"><span class="linenos">2118</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.update_parameters-2119"><a href="#Project.update_parameters-2119"><span class="linenos">2119</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feat_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project.update_parameters-2120"><a href="#Project.update_parameters-2120"><span class="linenos">2120</span></a>                <span class="p">)</span>
</span><span id="Project.update_parameters-2121"><a href="#Project.update_parameters-2121"><span class="linenos">2121</span></a>            <span class="p">)</span>
</span><span id="Project.update_parameters-2122"><a href="#Project.update_parameters-2122"><span class="linenos">2122</span></a>            <span class="k">if</span> <span class="n">feat_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.update_parameters-2123"><a href="#Project.update_parameters-2123"><span class="linenos">2123</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project.update_parameters-2124"><a href="#Project.update_parameters-2124"><span class="linenos">2124</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">feat_params</span>
</span><span id="Project.update_parameters-2125"><a href="#Project.update_parameters-2125"><span class="linenos">2125</span></a>                <span class="p">)</span>
</span><span id="Project.update_parameters-2126"><a href="#Project.update_parameters-2126"><span class="linenos">2126</span></a>            <span class="n">aug_name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">extractor_to_transformer</span><span class="p">[</span>
</span><span id="Project.update_parameters-2127"><a href="#Project.update_parameters-2127"><span class="linenos">2127</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="Project.update_parameters-2128"><a href="#Project.update_parameters-2128"><span class="linenos">2128</span></a>            <span class="p">]</span>
</span><span id="Project.update_parameters-2129"><a href="#Project.update_parameters-2129"><span class="linenos">2129</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project.update_parameters-2130"><a href="#Project.update_parameters-2130"><span class="linenos">2130</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.update_parameters-2131"><a href="#Project.update_parameters-2131"><span class="linenos">2131</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aug_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project.update_parameters-2132"><a href="#Project.update_parameters-2132"><span class="linenos">2132</span></a>                <span class="p">)</span>
</span><span id="Project.update_parameters-2133"><a href="#Project.update_parameters-2133"><span class="linenos">2133</span></a>            <span class="p">)</span>
</span><span id="Project.update_parameters-2134"><a href="#Project.update_parameters-2134"><span class="linenos">2134</span></a>            <span class="k">if</span> <span class="n">aug_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.update_parameters-2135"><a href="#Project.update_parameters-2135"><span class="linenos">2135</span></a>                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span>
</span><span id="Project.update_parameters-2136"><a href="#Project.update_parameters-2136"><span class="linenos">2136</span></a>                    <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">],</span> <span class="n">aug_params</span>
</span><span id="Project.update_parameters-2137"><a href="#Project.update_parameters-2137"><span class="linenos">2137</span></a>                <span class="p">)</span>
</span><span id="Project.update_parameters-2138"><a href="#Project.update_parameters-2138"><span class="linenos">2138</span></a>        <span class="k">if</span> <span class="n">load_search</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.update_parameters-2139"><a href="#Project.update_parameters-2139"><span class="linenos">2139</span></a>            <span class="n">parameters_update</span><span class="p">,</span> <span class="n">model_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">get_best_params</span><span class="p">(</span>
</span><span id="Project.update_parameters-2140"><a href="#Project.update_parameters-2140"><span class="linenos">2140</span></a>                <span class="n">load_search</span><span class="p">,</span> <span class="n">load_parameters</span><span class="p">,</span> <span class="n">round_to_binary</span>
</span><span id="Project.update_parameters-2141"><a href="#Project.update_parameters-2141"><span class="linenos">2141</span></a>            <span class="p">)</span>
</span><span id="Project.update_parameters-2142"><a href="#Project.update_parameters-2142"><span class="linenos">2142</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_name</span>
</span><span id="Project.update_parameters-2143"><a href="#Project.update_parameters-2143"><span class="linenos">2143</span></a>            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_yaml</span><span class="p">(</span>
</span><span id="Project.update_parameters-2144"><a href="#Project.update_parameters-2144"><span class="linenos">2144</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">)</span>
</span><span id="Project.update_parameters-2145"><a href="#Project.update_parameters-2145"><span class="linenos">2145</span></a>            <span class="p">)</span>
</span><span id="Project.update_parameters-2146"><a href="#Project.update_parameters-2146"><span class="linenos">2146</span></a>            <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">parameters_update</span><span class="p">)</span>
</span><span id="Project.update_parameters-2147"><a href="#Project.update_parameters-2147"><span class="linenos">2147</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="Project.update_parameters-2148"><a href="#Project.update_parameters-2148"><span class="linenos">2148</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
</span><span id="Project.update_parameters-2149"><a href="#Project.update_parameters-2149"><span class="linenos">2149</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
</span><span id="Project.update_parameters-2150"><a href="#Project.update_parameters-2150"><span class="linenos">2150</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project.update_parameters-2151"><a href="#Project.update_parameters-2151"><span class="linenos">2151</span></a>                <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project.update_parameters-2152"><a href="#Project.update_parameters-2152"><span class="linenos">2152</span></a>        <span class="n">model_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="Project.update_parameters-2153"><a href="#Project.update_parameters-2153"><span class="linenos">2153</span></a>        <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.update_parameters-2154"><a href="#Project.update_parameters-2154"><span class="linenos">2154</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project.update_parameters-2155"><a href="#Project.update_parameters-2155"><span class="linenos">2155</span></a>        <span class="p">)</span>
</span><span id="Project.update_parameters-2156"><a href="#Project.update_parameters-2156"><span class="linenos">2156</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project.update_parameters-2157"><a href="#Project.update_parameters-2157"><span class="linenos">2157</span></a>            <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project.update_parameters-2158"><a href="#Project.update_parameters-2158"><span class="linenos">2158</span></a>        <span class="n">features_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="Project.update_parameters-2159"><a href="#Project.update_parameters-2159"><span class="linenos">2159</span></a>        <span class="n">features_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.update_parameters-2160"><a href="#Project.update_parameters-2160"><span class="linenos">2160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">features_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project.update_parameters-2161"><a href="#Project.update_parameters-2161"><span class="linenos">2161</span></a>        <span class="p">)</span>
</span><span id="Project.update_parameters-2162"><a href="#Project.update_parameters-2162"><span class="linenos">2162</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">features_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project.update_parameters-2163"><a href="#Project.update_parameters-2163"><span class="linenos">2163</span></a>            <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span><span id="Project.update_parameters-2164"><a href="#Project.update_parameters-2164"><span class="linenos">2164</span></a>        <span class="n">aug_name</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">extractor_to_transformer</span><span class="p">[</span><span class="n">features_name</span><span class="p">]</span>
</span><span id="Project.update_parameters-2165"><a href="#Project.update_parameters-2165"><span class="linenos">2165</span></a>        <span class="n">aug_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.update_parameters-2166"><a href="#Project.update_parameters-2166"><span class="linenos">2166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="s2">&quot;augmentations&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aug_name</span><span class="si">}</span><span class="s2">.yaml&quot;</span>
</span><span id="Project.update_parameters-2167"><a href="#Project.update_parameters-2167"><span class="linenos">2167</span></a>        <span class="p">)</span>
</span><span id="Project.update_parameters-2168"><a href="#Project.update_parameters-2168"><span class="linenos">2168</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">aug_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Project.update_parameters-2169"><a href="#Project.update_parameters-2169"><span class="linenos">2169</span></a>            <span class="n">YAML</span><span class="p">()</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Update the parameters in the project config files</p>

<h2 id="parameters">Parameters</h2>

<p>parameters_update : dict, optional
    a dictionary of parameter updates
load_search : str, optional
    the name of hyperparameter search results to load to config
load_parameters : list, optional
    a list of lists of string names of the parameters to load from the searches
round_to_binary : list, optional
    a list of string names of the loaded parameters that should be rounded to the nearest power of two</p>
</div>


                            </div>
                            <div id="Project.get_summary" class="classattr">
                                        <input id="Project.get_summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_summary</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_names</span><span class="p">:</span> <span class="nb">list</span>,</span><span class="param">	<span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;last&#39;</span>,</span><span class="param">	<span class="n">average</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">metrics</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="Project.get_summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.get_summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.get_summary-2171"><a href="#Project.get_summary-2171"><span class="linenos">2171</span></a>    <span class="k">def</span> <span class="nf">get_summary</span><span class="p">(</span>
</span><span id="Project.get_summary-2172"><a href="#Project.get_summary-2172"><span class="linenos">2172</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.get_summary-2173"><a href="#Project.get_summary-2173"><span class="linenos">2173</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
</span><span id="Project.get_summary-2174"><a href="#Project.get_summary-2174"><span class="linenos">2174</span></a>        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span>
</span><span id="Project.get_summary-2175"><a href="#Project.get_summary-2175"><span class="linenos">2175</span></a>        <span class="n">average</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project.get_summary-2176"><a href="#Project.get_summary-2176"><span class="linenos">2176</span></a>        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.get_summary-2177"><a href="#Project.get_summary-2177"><span class="linenos">2177</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project.get_summary-2178"><a href="#Project.get_summary-2178"><span class="linenos">2178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.get_summary-2179"><a href="#Project.get_summary-2179"><span class="linenos">2179</span></a><span class="sd">        Get a summary of episode statistics</span>
</span><span id="Project.get_summary-2180"><a href="#Project.get_summary-2180"><span class="linenos">2180</span></a>
</span><span id="Project.get_summary-2181"><a href="#Project.get_summary-2181"><span class="linenos">2181</span></a><span class="sd">        If the episode has multiple runs, the statistics will be aggregated over all of them.</span>
</span><span id="Project.get_summary-2182"><a href="#Project.get_summary-2182"><span class="linenos">2182</span></a>
</span><span id="Project.get_summary-2183"><a href="#Project.get_summary-2183"><span class="linenos">2183</span></a><span class="sd">        Parameters</span>
</span><span id="Project.get_summary-2184"><a href="#Project.get_summary-2184"><span class="linenos">2184</span></a><span class="sd">        ----------</span>
</span><span id="Project.get_summary-2185"><a href="#Project.get_summary-2185"><span class="linenos">2185</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project.get_summary-2186"><a href="#Project.get_summary-2186"><span class="linenos">2186</span></a><span class="sd">            the name of the episode</span>
</span><span id="Project.get_summary-2187"><a href="#Project.get_summary-2187"><span class="linenos">2187</span></a><span class="sd">        method : [&quot;best&quot;, &quot;last&quot;]</span>
</span><span id="Project.get_summary-2188"><a href="#Project.get_summary-2188"><span class="linenos">2188</span></a><span class="sd">            the method for choosing the epochs</span>
</span><span id="Project.get_summary-2189"><a href="#Project.get_summary-2189"><span class="linenos">2189</span></a><span class="sd">        average : int, default 1</span>
</span><span id="Project.get_summary-2190"><a href="#Project.get_summary-2190"><span class="linenos">2190</span></a><span class="sd">            the number of epochs to average over (for each run)</span>
</span><span id="Project.get_summary-2191"><a href="#Project.get_summary-2191"><span class="linenos">2191</span></a><span class="sd">        metrics : list, optional</span>
</span><span id="Project.get_summary-2192"><a href="#Project.get_summary-2192"><span class="linenos">2192</span></a><span class="sd">            a list of metrics</span>
</span><span id="Project.get_summary-2193"><a href="#Project.get_summary-2193"><span class="linenos">2193</span></a>
</span><span id="Project.get_summary-2194"><a href="#Project.get_summary-2194"><span class="linenos">2194</span></a><span class="sd">        Returns</span>
</span><span id="Project.get_summary-2195"><a href="#Project.get_summary-2195"><span class="linenos">2195</span></a><span class="sd">        -------</span>
</span><span id="Project.get_summary-2196"><a href="#Project.get_summary-2196"><span class="linenos">2196</span></a><span class="sd">        statistics : dict</span>
</span><span id="Project.get_summary-2197"><a href="#Project.get_summary-2197"><span class="linenos">2197</span></a><span class="sd">            a nested dictionary where first-level keys are metric names and second-level keys are &#39;mean&#39; for the mean</span>
</span><span id="Project.get_summary-2198"><a href="#Project.get_summary-2198"><span class="linenos">2198</span></a><span class="sd">            and &#39;std&#39; for the standard deviation</span>
</span><span id="Project.get_summary-2199"><a href="#Project.get_summary-2199"><span class="linenos">2199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.get_summary-2200"><a href="#Project.get_summary-2200"><span class="linenos">2200</span></a>
</span><span id="Project.get_summary-2201"><a href="#Project.get_summary-2201"><span class="linenos">2201</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.get_summary-2202"><a href="#Project.get_summary-2202"><span class="linenos">2202</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="Project.get_summary-2203"><a href="#Project.get_summary-2203"><span class="linenos">2203</span></a>            <span class="n">runs_ep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project.get_summary-2204"><a href="#Project.get_summary-2204"><span class="linenos">2204</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs_ep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project.get_summary-2205"><a href="#Project.get_summary-2205"><span class="linenos">2205</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="Project.get_summary-2206"><a href="#Project.get_summary-2206"><span class="linenos">2206</span></a>                    <span class="sa">f</span><span class="s2">&quot;There is no </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> episode in the project memory&quot;</span>
</span><span id="Project.get_summary-2207"><a href="#Project.get_summary-2207"><span class="linenos">2207</span></a>                <span class="p">)</span>
</span><span id="Project.get_summary-2208"><a href="#Project.get_summary-2208"><span class="linenos">2208</span></a>            <span class="n">runs</span> <span class="o">+=</span> <span class="n">runs_ep</span>
</span><span id="Project.get_summary-2209"><a href="#Project.get_summary-2209"><span class="linenos">2209</span></a>        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.get_summary-2210"><a href="#Project.get_summary-2210"><span class="linenos">2210</span></a>            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">()</span>
</span><span id="Project.get_summary-2211"><a href="#Project.get_summary-2211"><span class="linenos">2211</span></a>
</span><span id="Project.get_summary-2212"><a href="#Project.get_summary-2212"><span class="linenos">2212</span></a>        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">}</span>
</span><span id="Project.get_summary-2213"><a href="#Project.get_summary-2213"><span class="linenos">2213</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project.get_summary-2214"><a href="#Project.get_summary-2214"><span class="linenos">2214</span></a>            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
</span><span id="Project.get_summary-2215"><a href="#Project.get_summary-2215"><span class="linenos">2215</span></a>                <span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_metric_log</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
</span><span id="Project.get_summary-2216"><a href="#Project.get_summary-2216"><span class="linenos">2216</span></a>                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;best&quot;</span><span class="p">:</span>
</span><span id="Project.get_summary-2217"><a href="#Project.get_summary-2217"><span class="linenos">2217</span></a>                    <span class="n">log</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
</span><span id="Project.get_summary-2218"><a href="#Project.get_summary-2218"><span class="linenos">2218</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="o">-</span><span class="n">average</span><span class="p">:])</span>
</span><span id="Project.get_summary-2219"><a href="#Project.get_summary-2219"><span class="linenos">2219</span></a>                <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
</span><span id="Project.get_summary-2220"><a href="#Project.get_summary-2220"><span class="linenos">2220</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">log</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project.get_summary-2221"><a href="#Project.get_summary-2221"><span class="linenos">2221</span></a>                        <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
</span><span id="Project.get_summary-2222"><a href="#Project.get_summary-2222"><span class="linenos">2222</span></a>                        <span class="k">if</span> <span class="n">average</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="Project.get_summary-2223"><a href="#Project.get_summary-2223"><span class="linenos">2223</span></a>                            <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">episodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">run</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">)]]</span>
</span><span id="Project.get_summary-2224"><a href="#Project.get_summary-2224"><span class="linenos">2224</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.get_summary-2225"><a href="#Project.get_summary-2225"><span class="linenos">2225</span></a>                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Did not find </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2"> metric for </span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2"> run&quot;</span><span class="p">)</span>
</span><span id="Project.get_summary-2226"><a href="#Project.get_summary-2226"><span class="linenos">2226</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="o">-</span><span class="n">average</span><span class="p">:])</span>
</span><span id="Project.get_summary-2227"><a href="#Project.get_summary-2227"><span class="linenos">2227</span></a>                <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;epoch&quot;</span><span class="p">):</span>
</span><span id="Project.get_summary-2228"><a href="#Project.get_summary-2228"><span class="linenos">2228</span></a>                    <span class="n">epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">method</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Project.get_summary-2229"><a href="#Project.get_summary-2229"><span class="linenos">2229</span></a>                    <span class="n">pars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">load_parameters</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="Project.get_summary-2230"><a href="#Project.get_summary-2230"><span class="linenos">2230</span></a>                    <span class="n">step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pars</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;validation_interval&quot;</span><span class="p">])</span>
</span><span id="Project.get_summary-2231"><a href="#Project.get_summary-2231"><span class="linenos">2231</span></a>                    <span class="n">values</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">log</span><span class="p">[</span><span class="n">epoch</span> <span class="o">//</span> <span class="n">step</span><span class="p">]]</span>
</span><span id="Project.get_summary-2232"><a href="#Project.get_summary-2232"><span class="linenos">2232</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Project.get_summary-2233"><a href="#Project.get_summary-2233"><span class="linenos">2233</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.get_summary-2234"><a href="#Project.get_summary-2234"><span class="linenos">2234</span></a>                        <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> method is not recognized! Please choose from [&#39;last&#39;, &#39;best&#39;, &#39;epoch...&#39;]&quot;</span>
</span><span id="Project.get_summary-2235"><a href="#Project.get_summary-2235"><span class="linenos">2235</span></a>                    <span class="p">)</span>
</span><span id="Project.get_summary-2236"><a href="#Project.get_summary-2236"><span class="linenos">2236</span></a>        <span class="n">statistics</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="Project.get_summary-2237"><a href="#Project.get_summary-2237"><span class="linenos">2237</span></a>        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.get_summary-2238"><a href="#Project.get_summary-2238"><span class="linenos">2238</span></a>            <span class="n">statistics</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="Project.get_summary-2239"><a href="#Project.get_summary-2239"><span class="linenos">2239</span></a>            <span class="n">statistics</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s2">&quot;std&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="Project.get_summary-2240"><a href="#Project.get_summary-2240"><span class="linenos">2240</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SUMMARY </span><span class="si">{</span><span class="n">episode_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.get_summary-2241"><a href="#Project.get_summary-2241"><span class="linenos">2241</span></a>        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">statistics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.get_summary-2242"><a href="#Project.get_summary-2242"><span class="linenos">2242</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">: mean </span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project.get_summary-2243"><a href="#Project.get_summary-2243"><span class="linenos">2243</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.get_summary-2244"><a href="#Project.get_summary-2244"><span class="linenos">2244</span></a>        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">statistics</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get a summary of episode statistics</p>

<p>If the episode has multiple runs, the statistics will be aggregated over all of them.</p>

<h2 id="parameters">Parameters</h2>

<p>episode_name : str
    the name of the episode
method : ["best", "last"]
    the method for choosing the epochs
average : int, default 1
    the number of epochs to average over (for each run)
metrics : list, optional
    a list of metrics</p>

<h2 id="returns">Returns</h2>

<p>statistics : dict
    a nested dictionary where first-level keys are metric names and second-level keys are 'mean' for the mean
    and 'std' for the standard deviation</p>
</div>


                            </div>
                            <div id="Project.remove_project" class="classattr">
                                        <input id="Project.remove_project-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">remove_project</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.remove_project-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.remove_project"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.remove_project-2246"><a href="#Project.remove_project-2246"><span class="linenos">2246</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Project.remove_project-2247"><a href="#Project.remove_project-2247"><span class="linenos">2247</span></a>    <span class="k">def</span> <span class="nf">remove_project</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.remove_project-2248"><a href="#Project.remove_project-2248"><span class="linenos">2248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.remove_project-2249"><a href="#Project.remove_project-2249"><span class="linenos">2249</span></a><span class="sd">        Remove all project files and experiment records and results</span>
</span><span id="Project.remove_project-2250"><a href="#Project.remove_project-2250"><span class="linenos">2250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.remove_project-2251"><a href="#Project.remove_project-2251"><span class="linenos">2251</span></a>
</span><span id="Project.remove_project-2252"><a href="#Project.remove_project-2252"><span class="linenos">2252</span></a>        <span class="k">if</span> <span class="n">projects_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.remove_project-2253"><a href="#Project.remove_project-2253"><span class="linenos">2253</span></a>            <span class="n">projects_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()),</span> <span class="s2">&quot;DLC2Action&quot;</span><span class="p">)</span>
</span><span id="Project.remove_project-2254"><a href="#Project.remove_project-2254"><span class="linenos">2254</span></a>        <span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="Project.remove_project-2255"><a href="#Project.remove_project-2255"><span class="linenos">2255</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
</span><span id="Project.remove_project-2256"><a href="#Project.remove_project-2256"><span class="linenos">2256</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove all project files and experiment records and results</p>
</div>


                            </div>
                            <div id="Project.remove_saved_features" class="classattr">
                                        <input id="Project.remove_saved_features-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_saved_features</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">dataset_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">remove_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.remove_saved_features-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.remove_saved_features"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.remove_saved_features-2258"><a href="#Project.remove_saved_features-2258"><span class="linenos">2258</span></a>    <span class="k">def</span> <span class="nf">remove_saved_features</span><span class="p">(</span>
</span><span id="Project.remove_saved_features-2259"><a href="#Project.remove_saved_features-2259"><span class="linenos">2259</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.remove_saved_features-2260"><a href="#Project.remove_saved_features-2260"><span class="linenos">2260</span></a>        <span class="n">dataset_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.remove_saved_features-2261"><a href="#Project.remove_saved_features-2261"><span class="linenos">2261</span></a>        <span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.remove_saved_features-2262"><a href="#Project.remove_saved_features-2262"><span class="linenos">2262</span></a>        <span class="n">remove_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.remove_saved_features-2263"><a href="#Project.remove_saved_features-2263"><span class="linenos">2263</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.remove_saved_features-2264"><a href="#Project.remove_saved_features-2264"><span class="linenos">2264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.remove_saved_features-2265"><a href="#Project.remove_saved_features-2265"><span class="linenos">2265</span></a><span class="sd">        Remove saved pre-computed dataset files</span>
</span><span id="Project.remove_saved_features-2266"><a href="#Project.remove_saved_features-2266"><span class="linenos">2266</span></a>
</span><span id="Project.remove_saved_features-2267"><a href="#Project.remove_saved_features-2267"><span class="linenos">2267</span></a><span class="sd">        By default, all pre-computed features will be deleted.</span>
</span><span id="Project.remove_saved_features-2268"><a href="#Project.remove_saved_features-2268"><span class="linenos">2268</span></a><span class="sd">        No essential information can get lost, storing them only saves time. Be careful with deleting datasets</span>
</span><span id="Project.remove_saved_features-2269"><a href="#Project.remove_saved_features-2269"><span class="linenos">2269</span></a><span class="sd">        while training or inference is happening though.</span>
</span><span id="Project.remove_saved_features-2270"><a href="#Project.remove_saved_features-2270"><span class="linenos">2270</span></a>
</span><span id="Project.remove_saved_features-2271"><a href="#Project.remove_saved_features-2271"><span class="linenos">2271</span></a><span class="sd">        Parameters</span>
</span><span id="Project.remove_saved_features-2272"><a href="#Project.remove_saved_features-2272"><span class="linenos">2272</span></a><span class="sd">        ----------</span>
</span><span id="Project.remove_saved_features-2273"><a href="#Project.remove_saved_features-2273"><span class="linenos">2273</span></a><span class="sd">        dataset_names : list, optional</span>
</span><span id="Project.remove_saved_features-2274"><a href="#Project.remove_saved_features-2274"><span class="linenos">2274</span></a><span class="sd">            a list of dataset names to delete (by default all names are added)</span>
</span><span id="Project.remove_saved_features-2275"><a href="#Project.remove_saved_features-2275"><span class="linenos">2275</span></a><span class="sd">        exceptions : list, optional</span>
</span><span id="Project.remove_saved_features-2276"><a href="#Project.remove_saved_features-2276"><span class="linenos">2276</span></a><span class="sd">            a list of dataset names to not be deleted</span>
</span><span id="Project.remove_saved_features-2277"><a href="#Project.remove_saved_features-2277"><span class="linenos">2277</span></a><span class="sd">        remove_active : bool, default False</span>
</span><span id="Project.remove_saved_features-2278"><a href="#Project.remove_saved_features-2278"><span class="linenos">2278</span></a><span class="sd">            if `False`, datasets used by unfinished episodes will not be deleted</span>
</span><span id="Project.remove_saved_features-2279"><a href="#Project.remove_saved_features-2279"><span class="linenos">2279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.remove_saved_features-2280"><a href="#Project.remove_saved_features-2280"><span class="linenos">2280</span></a>
</span><span id="Project.remove_saved_features-2281"><a href="#Project.remove_saved_features-2281"><span class="linenos">2281</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Removing datasets...&quot;</span><span class="p">)</span>
</span><span id="Project.remove_saved_features-2282"><a href="#Project.remove_saved_features-2282"><span class="linenos">2282</span></a>        <span class="k">if</span> <span class="n">dataset_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.remove_saved_features-2283"><a href="#Project.remove_saved_features-2283"><span class="linenos">2283</span></a>            <span class="n">dataset_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.remove_saved_features-2284"><a href="#Project.remove_saved_features-2284"><span class="linenos">2284</span></a>        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.remove_saved_features-2285"><a href="#Project.remove_saved_features-2285"><span class="linenos">2285</span></a>            <span class="n">exceptions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.remove_saved_features-2286"><a href="#Project.remove_saved_features-2286"><span class="linenos">2286</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">remove_active</span><span class="p">:</span>
</span><span id="Project.remove_saved_features-2287"><a href="#Project.remove_saved_features-2287"><span class="linenos">2287</span></a>            <span class="n">exceptions</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_active_datasets</span><span class="p">()</span>
</span><span id="Project.remove_saved_features-2288"><a href="#Project.remove_saved_features-2288"><span class="linenos">2288</span></a>        <span class="n">dataset_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;saved_datasets&quot;</span><span class="p">)</span>
</span><span id="Project.remove_saved_features-2289"><a href="#Project.remove_saved_features-2289"><span class="linenos">2289</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">):</span>
</span><span id="Project.remove_saved_features-2290"><a href="#Project.remove_saved_features-2290"><span class="linenos">2290</span></a>            <span class="k">if</span> <span class="n">dataset_names</span> <span class="o">==</span> <span class="p">[]:</span>
</span><span id="Project.remove_saved_features-2291"><a href="#Project.remove_saved_features-2291"><span class="linenos">2291</span></a>                <span class="n">dataset_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">)])</span>
</span><span id="Project.remove_saved_features-2292"><a href="#Project.remove_saved_features-2292"><span class="linenos">2292</span></a>
</span><span id="Project.remove_saved_features-2293"><a href="#Project.remove_saved_features-2293"><span class="linenos">2293</span></a>            <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project.remove_saved_features-2294"><a href="#Project.remove_saved_features-2294"><span class="linenos">2294</span></a>                <span class="n">x</span>
</span><span id="Project.remove_saved_features-2295"><a href="#Project.remove_saved_features-2295"><span class="linenos">2295</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset_names</span>
</span><span id="Project.remove_saved_features-2296"><a href="#Project.remove_saved_features-2296"><span class="linenos">2296</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span>
</span><span id="Project.remove_saved_features-2297"><a href="#Project.remove_saved_features-2297"><span class="linenos">2297</span></a>            <span class="p">]</span>
</span><span id="Project.remove_saved_features-2298"><a href="#Project.remove_saved_features-2298"><span class="linenos">2298</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_remove</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Project.remove_saved_features-2299"><a href="#Project.remove_saved_features-2299"><span class="linenos">2299</span></a>                <span class="n">to_remove</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">to_remove</span><span class="p">)</span>
</span><span id="Project.remove_saved_features-2300"><a href="#Project.remove_saved_features-2300"><span class="linenos">2300</span></a>            <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="Project.remove_saved_features-2301"><a href="#Project.remove_saved_features-2301"><span class="linenos">2301</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">dataset</span><span class="p">))</span>
</span><span id="Project.remove_saved_features-2302"><a href="#Project.remove_saved_features-2302"><span class="linenos">2302</span></a>            <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project.remove_saved_features-2303"><a href="#Project.remove_saved_features-2303"><span class="linenos">2303</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.pickle&quot;</span>
</span><span id="Project.remove_saved_features-2304"><a href="#Project.remove_saved_features-2304"><span class="linenos">2304</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset_names</span>
</span><span id="Project.remove_saved_features-2305"><a href="#Project.remove_saved_features-2305"><span class="linenos">2305</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">.pickle&quot;</span><span class="p">))</span>
</span><span id="Project.remove_saved_features-2306"><a href="#Project.remove_saved_features-2306"><span class="linenos">2306</span></a>                <span class="ow">and</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span>
</span><span id="Project.remove_saved_features-2307"><a href="#Project.remove_saved_features-2307"><span class="linenos">2307</span></a>            <span class="p">]</span>
</span><span id="Project.remove_saved_features-2308"><a href="#Project.remove_saved_features-2308"><span class="linenos">2308</span></a>            <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="Project.remove_saved_features-2309"><a href="#Project.remove_saved_features-2309"><span class="linenos">2309</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="n">dataset</span><span class="p">))</span>
</span><span id="Project.remove_saved_features-2310"><a href="#Project.remove_saved_features-2310"><span class="linenos">2310</span></a>            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets</span><span class="p">()</span><span class="o">.</span><span class="n">dataset_names</span><span class="p">()</span>
</span><span id="Project.remove_saved_features-2311"><a href="#Project.remove_saved_features-2311"><span class="linenos">2311</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_saved_datasets</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
</span><span id="Project.remove_saved_features-2312"><a href="#Project.remove_saved_features-2312"><span class="linenos">2312</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove saved pre-computed dataset files</p>

<p>By default, all pre-computed features will be deleted.
No essential information can get lost, storing them only saves time. Be careful with deleting datasets
while training or inference is happening though.</p>

<h2 id="parameters">Parameters</h2>

<p>dataset_names : list, optional
    a list of dataset names to delete (by default all names are added)
exceptions : list, optional
    a list of dataset names to not be deleted
remove_active : bool, default False
    if <code>False</code>, datasets used by unfinished episodes will not be deleted</p>
</div>


                            </div>
                            <div id="Project.remove_extra_checkpoints" class="classattr">
                                        <input id="Project.remove_extra_checkpoints-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_extra_checkpoints</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.remove_extra_checkpoints-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.remove_extra_checkpoints"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.remove_extra_checkpoints-2314"><a href="#Project.remove_extra_checkpoints-2314"><span class="linenos">2314</span></a>    <span class="k">def</span> <span class="nf">remove_extra_checkpoints</span><span class="p">(</span>
</span><span id="Project.remove_extra_checkpoints-2315"><a href="#Project.remove_extra_checkpoints-2315"><span class="linenos">2315</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project.remove_extra_checkpoints-2316"><a href="#Project.remove_extra_checkpoints-2316"><span class="linenos">2316</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.remove_extra_checkpoints-2317"><a href="#Project.remove_extra_checkpoints-2317"><span class="linenos">2317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.remove_extra_checkpoints-2318"><a href="#Project.remove_extra_checkpoints-2318"><span class="linenos">2318</span></a><span class="sd">        Remove intermediate model checkpoint files (only leave the results of the last epoch)</span>
</span><span id="Project.remove_extra_checkpoints-2319"><a href="#Project.remove_extra_checkpoints-2319"><span class="linenos">2319</span></a>
</span><span id="Project.remove_extra_checkpoints-2320"><a href="#Project.remove_extra_checkpoints-2320"><span class="linenos">2320</span></a><span class="sd">        By default, all intermediate checkpoints will be deleted.</span>
</span><span id="Project.remove_extra_checkpoints-2321"><a href="#Project.remove_extra_checkpoints-2321"><span class="linenos">2321</span></a><span class="sd">        Files in the model folder that are not associated with any record in the meta files are also deleted.</span>
</span><span id="Project.remove_extra_checkpoints-2322"><a href="#Project.remove_extra_checkpoints-2322"><span class="linenos">2322</span></a>
</span><span id="Project.remove_extra_checkpoints-2323"><a href="#Project.remove_extra_checkpoints-2323"><span class="linenos">2323</span></a><span class="sd">        Parameters</span>
</span><span id="Project.remove_extra_checkpoints-2324"><a href="#Project.remove_extra_checkpoints-2324"><span class="linenos">2324</span></a><span class="sd">        ----------</span>
</span><span id="Project.remove_extra_checkpoints-2325"><a href="#Project.remove_extra_checkpoints-2325"><span class="linenos">2325</span></a><span class="sd">        episode_names : list, optional</span>
</span><span id="Project.remove_extra_checkpoints-2326"><a href="#Project.remove_extra_checkpoints-2326"><span class="linenos">2326</span></a><span class="sd">            a list of episode names to clean (by default all names are added)</span>
</span><span id="Project.remove_extra_checkpoints-2327"><a href="#Project.remove_extra_checkpoints-2327"><span class="linenos">2327</span></a><span class="sd">        exceptions : list, optional</span>
</span><span id="Project.remove_extra_checkpoints-2328"><a href="#Project.remove_extra_checkpoints-2328"><span class="linenos">2328</span></a><span class="sd">            a list of episode names to not clean</span>
</span><span id="Project.remove_extra_checkpoints-2329"><a href="#Project.remove_extra_checkpoints-2329"><span class="linenos">2329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.remove_extra_checkpoints-2330"><a href="#Project.remove_extra_checkpoints-2330"><span class="linenos">2330</span></a>
</span><span id="Project.remove_extra_checkpoints-2331"><a href="#Project.remove_extra_checkpoints-2331"><span class="linenos">2331</span></a>        <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
</span><span id="Project.remove_extra_checkpoints-2332"><a href="#Project.remove_extra_checkpoints-2332"><span class="linenos">2332</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Project.remove_extra_checkpoints-2333"><a href="#Project.remove_extra_checkpoints-2333"><span class="linenos">2333</span></a>            <span class="n">all_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">index</span>
</span><span id="Project.remove_extra_checkpoints-2334"><a href="#Project.remove_extra_checkpoints-2334"><span class="linenos">2334</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="Project.remove_extra_checkpoints-2335"><a href="#Project.remove_extra_checkpoints-2335"><span class="linenos">2335</span></a>            <span class="n">all_names</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</span><span id="Project.remove_extra_checkpoints-2336"><a href="#Project.remove_extra_checkpoints-2336"><span class="linenos">2336</span></a>        <span class="k">if</span> <span class="n">episode_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.remove_extra_checkpoints-2337"><a href="#Project.remove_extra_checkpoints-2337"><span class="linenos">2337</span></a>            <span class="n">episode_names</span> <span class="o">=</span> <span class="n">all_names</span>
</span><span id="Project.remove_extra_checkpoints-2338"><a href="#Project.remove_extra_checkpoints-2338"><span class="linenos">2338</span></a>        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.remove_extra_checkpoints-2339"><a href="#Project.remove_extra_checkpoints-2339"><span class="linenos">2339</span></a>            <span class="n">exceptions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.remove_extra_checkpoints-2340"><a href="#Project.remove_extra_checkpoints-2340"><span class="linenos">2340</span></a>        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">episode_names</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">]</span>
</span><span id="Project.remove_extra_checkpoints-2341"><a href="#Project.remove_extra_checkpoints-2341"><span class="linenos">2341</span></a>        <span class="n">folders</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</span><span id="Project.remove_extra_checkpoints-2342"><a href="#Project.remove_extra_checkpoints-2342"><span class="linenos">2342</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
</span><span id="Project.remove_extra_checkpoints-2343"><a href="#Project.remove_extra_checkpoints-2343"><span class="linenos">2343</span></a>            <span class="k">if</span> <span class="n">folder</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_names</span><span class="p">:</span>
</span><span id="Project.remove_extra_checkpoints-2344"><a href="#Project.remove_extra_checkpoints-2344"><span class="linenos">2344</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>
</span><span id="Project.remove_extra_checkpoints-2345"><a href="#Project.remove_extra_checkpoints-2345"><span class="linenos">2345</span></a>            <span class="k">elif</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
</span><span id="Project.remove_extra_checkpoints-2346"><a href="#Project.remove_extra_checkpoints-2346"><span class="linenos">2346</span></a>                <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">))</span>
</span><span id="Project.remove_extra_checkpoints-2347"><a href="#Project.remove_extra_checkpoints-2347"><span class="linenos">2347</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Project.remove_extra_checkpoints-2348"><a href="#Project.remove_extra_checkpoints-2348"><span class="linenos">2348</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Remove intermediate model checkpoint files (only leave the results of the last epoch)</p>

<p>By default, all intermediate checkpoints will be deleted.
Files in the model folder that are not associated with any record in the meta files are also deleted.</p>

<h2 id="parameters">Parameters</h2>

<p>episode_names : list, optional
    a list of episode names to clean (by default all names are added)
exceptions : list, optional
    a list of episode names to not clean</p>
</div>


                            </div>
                            <div id="Project.remove_search" class="classattr">
                                        <input id="Project.remove_search-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_search</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.remove_search-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.remove_search"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.remove_search-2350"><a href="#Project.remove_search-2350"><span class="linenos">2350</span></a>    <span class="k">def</span> <span class="nf">remove_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.remove_search-2351"><a href="#Project.remove_search-2351"><span class="linenos">2351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.remove_search-2352"><a href="#Project.remove_search-2352"><span class="linenos">2352</span></a><span class="sd">        Remove a hyperparameter search record</span>
</span><span id="Project.remove_search-2353"><a href="#Project.remove_search-2353"><span class="linenos">2353</span></a>
</span><span id="Project.remove_search-2354"><a href="#Project.remove_search-2354"><span class="linenos">2354</span></a><span class="sd">        Parameters</span>
</span><span id="Project.remove_search-2355"><a href="#Project.remove_search-2355"><span class="linenos">2355</span></a><span class="sd">        ----------</span>
</span><span id="Project.remove_search-2356"><a href="#Project.remove_search-2356"><span class="linenos">2356</span></a><span class="sd">        search_name : str</span>
</span><span id="Project.remove_search-2357"><a href="#Project.remove_search-2357"><span class="linenos">2357</span></a><span class="sd">            the name of the search to remove</span>
</span><span id="Project.remove_search-2358"><a href="#Project.remove_search-2358"><span class="linenos">2358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.remove_search-2359"><a href="#Project.remove_search-2359"><span class="linenos">2359</span></a>
</span><span id="Project.remove_search-2360"><a href="#Project.remove_search-2360"><span class="linenos">2360</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span><span id="Project.remove_search-2361"><a href="#Project.remove_search-2361"><span class="linenos">2361</span></a>        <span class="n">graph_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;searches&quot;</span><span class="p">,</span> <span class="n">search_name</span><span class="p">)</span>
</span><span id="Project.remove_search-2362"><a href="#Project.remove_search-2362"><span class="linenos">2362</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">graph_path</span><span class="p">):</span>
</span><span id="Project.remove_search-2363"><a href="#Project.remove_search-2363"><span class="linenos">2363</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">graph_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove a hyperparameter search record</p>

<h2 id="parameters">Parameters</h2>

<p>search_name : str
    the name of the search to remove</p>
</div>


                            </div>
                            <div id="Project.remove_prediction" class="classattr">
                                        <input id="Project.remove_prediction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_prediction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.remove_prediction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.remove_prediction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.remove_prediction-2365"><a href="#Project.remove_prediction-2365"><span class="linenos">2365</span></a>    <span class="k">def</span> <span class="nf">remove_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.remove_prediction-2366"><a href="#Project.remove_prediction-2366"><span class="linenos">2366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.remove_prediction-2367"><a href="#Project.remove_prediction-2367"><span class="linenos">2367</span></a><span class="sd">        Remove a prediction record</span>
</span><span id="Project.remove_prediction-2368"><a href="#Project.remove_prediction-2368"><span class="linenos">2368</span></a>
</span><span id="Project.remove_prediction-2369"><a href="#Project.remove_prediction-2369"><span class="linenos">2369</span></a><span class="sd">        Parameters</span>
</span><span id="Project.remove_prediction-2370"><a href="#Project.remove_prediction-2370"><span class="linenos">2370</span></a><span class="sd">        ----------</span>
</span><span id="Project.remove_prediction-2371"><a href="#Project.remove_prediction-2371"><span class="linenos">2371</span></a><span class="sd">        prediction_name : str</span>
</span><span id="Project.remove_prediction-2372"><a href="#Project.remove_prediction-2372"><span class="linenos">2372</span></a><span class="sd">            the name of the prediction to remove</span>
</span><span id="Project.remove_prediction-2373"><a href="#Project.remove_prediction-2373"><span class="linenos">2373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.remove_prediction-2374"><a href="#Project.remove_prediction-2374"><span class="linenos">2374</span></a>
</span><span id="Project.remove_prediction-2375"><a href="#Project.remove_prediction-2375"><span class="linenos">2375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">)</span>
</span><span id="Project.remove_prediction-2376"><a href="#Project.remove_prediction-2376"><span class="linenos">2376</span></a>        <span class="n">prediction_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.remove_prediction-2377"><a href="#Project.remove_prediction-2377"><span class="linenos">2377</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;predictions&quot;</span><span class="p">,</span> <span class="n">prediction_name</span>
</span><span id="Project.remove_prediction-2378"><a href="#Project.remove_prediction-2378"><span class="linenos">2378</span></a>        <span class="p">)</span>
</span><span id="Project.remove_prediction-2379"><a href="#Project.remove_prediction-2379"><span class="linenos">2379</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">prediction_path</span><span class="p">):</span>
</span><span id="Project.remove_prediction-2380"><a href="#Project.remove_prediction-2380"><span class="linenos">2380</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">prediction_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove a prediction record</p>

<h2 id="parameters">Parameters</h2>

<p>prediction_name : str
    the name of the prediction to remove</p>
</div>


                            </div>
                            <div id="Project.remove_episode" class="classattr">
                                        <input id="Project.remove_episode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_episode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.remove_episode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.remove_episode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.remove_episode-2382"><a href="#Project.remove_episode-2382"><span class="linenos">2382</span></a>    <span class="k">def</span> <span class="nf">remove_episode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.remove_episode-2383"><a href="#Project.remove_episode-2383"><span class="linenos">2383</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.remove_episode-2384"><a href="#Project.remove_episode-2384"><span class="linenos">2384</span></a><span class="sd">        Remove all model, logs and metafile records related to an episode</span>
</span><span id="Project.remove_episode-2385"><a href="#Project.remove_episode-2385"><span class="linenos">2385</span></a>
</span><span id="Project.remove_episode-2386"><a href="#Project.remove_episode-2386"><span class="linenos">2386</span></a><span class="sd">        Parameters</span>
</span><span id="Project.remove_episode-2387"><a href="#Project.remove_episode-2387"><span class="linenos">2387</span></a><span class="sd">        ----------</span>
</span><span id="Project.remove_episode-2388"><a href="#Project.remove_episode-2388"><span class="linenos">2388</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project.remove_episode-2389"><a href="#Project.remove_episode-2389"><span class="linenos">2389</span></a><span class="sd">            the name of the episode to remove</span>
</span><span id="Project.remove_episode-2390"><a href="#Project.remove_episode-2390"><span class="linenos">2390</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.remove_episode-2391"><a href="#Project.remove_episode-2391"><span class="linenos">2391</span></a>
</span><span id="Project.remove_episode-2392"><a href="#Project.remove_episode-2392"><span class="linenos">2392</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project.remove_episode-2393"><a href="#Project.remove_episode-2393"><span class="linenos">2393</span></a>        <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project.remove_episode-2394"><a href="#Project.remove_episode-2394"><span class="linenos">2394</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project.remove_episode-2395"><a href="#Project.remove_episode-2395"><span class="linenos">2395</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="Project.remove_episode-2396"><a href="#Project.remove_episode-2396"><span class="linenos">2396</span></a>            <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>
</span><span id="Project.remove_episode-2397"><a href="#Project.remove_episode-2397"><span class="linenos">2397</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span><span class="p">):</span>
</span><span id="Project.remove_episode-2398"><a href="#Project.remove_episode-2398"><span class="linenos">2398</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
</span><span id="Project.remove_episode-2399"><a href="#Project.remove_episode-2399"><span class="linenos">2399</span></a>            <span class="n">log_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>
</span><span id="Project.remove_episode-2400"><a href="#Project.remove_episode-2400"><span class="linenos">2400</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">log_path</span><span class="p">):</span>
</span><span id="Project.remove_episode-2401"><a href="#Project.remove_episode-2401"><span class="linenos">2401</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">log_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove all model, logs and metafile records related to an episode</p>

<h2 id="parameters">Parameters</h2>

<p>episode_name : str
    the name of the episode to remove</p>
</div>


                            </div>
                            <div id="Project.prune_unfinished" class="classattr">
                                        <input id="Project.prune_unfinished-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prune_unfinished</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.prune_unfinished-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.prune_unfinished"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.prune_unfinished-2403"><a href="#Project.prune_unfinished-2403"><span class="linenos">2403</span></a>    <span class="k">def</span> <span class="nf">prune_unfinished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.prune_unfinished-2404"><a href="#Project.prune_unfinished-2404"><span class="linenos">2404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.prune_unfinished-2405"><a href="#Project.prune_unfinished-2405"><span class="linenos">2405</span></a><span class="sd">        Remove all interrupted episodes</span>
</span><span id="Project.prune_unfinished-2406"><a href="#Project.prune_unfinished-2406"><span class="linenos">2406</span></a>
</span><span id="Project.prune_unfinished-2407"><a href="#Project.prune_unfinished-2407"><span class="linenos">2407</span></a><span class="sd">        Remove all episodes that either don&#39;t have a log file or have less epochs in the log file than in</span>
</span><span id="Project.prune_unfinished-2408"><a href="#Project.prune_unfinished-2408"><span class="linenos">2408</span></a><span class="sd">        the training parameters or have a model folder but not a record. Note that it can remove episodes that are</span>
</span><span id="Project.prune_unfinished-2409"><a href="#Project.prune_unfinished-2409"><span class="linenos">2409</span></a><span class="sd">        currently running!</span>
</span><span id="Project.prune_unfinished-2410"><a href="#Project.prune_unfinished-2410"><span class="linenos">2410</span></a>
</span><span id="Project.prune_unfinished-2411"><a href="#Project.prune_unfinished-2411"><span class="linenos">2411</span></a><span class="sd">        Parameters</span>
</span><span id="Project.prune_unfinished-2412"><a href="#Project.prune_unfinished-2412"><span class="linenos">2412</span></a><span class="sd">        ----------</span>
</span><span id="Project.prune_unfinished-2413"><a href="#Project.prune_unfinished-2413"><span class="linenos">2413</span></a><span class="sd">        exceptions : list</span>
</span><span id="Project.prune_unfinished-2414"><a href="#Project.prune_unfinished-2414"><span class="linenos">2414</span></a><span class="sd">            the episodes to keep even if they are interrupted</span>
</span><span id="Project.prune_unfinished-2415"><a href="#Project.prune_unfinished-2415"><span class="linenos">2415</span></a>
</span><span id="Project.prune_unfinished-2416"><a href="#Project.prune_unfinished-2416"><span class="linenos">2416</span></a><span class="sd">        Returns</span>
</span><span id="Project.prune_unfinished-2417"><a href="#Project.prune_unfinished-2417"><span class="linenos">2417</span></a><span class="sd">        -------</span>
</span><span id="Project.prune_unfinished-2418"><a href="#Project.prune_unfinished-2418"><span class="linenos">2418</span></a><span class="sd">        pruned : list</span>
</span><span id="Project.prune_unfinished-2419"><a href="#Project.prune_unfinished-2419"><span class="linenos">2419</span></a><span class="sd">            a list of the episode names that were pruned</span>
</span><span id="Project.prune_unfinished-2420"><a href="#Project.prune_unfinished-2420"><span class="linenos">2420</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.prune_unfinished-2421"><a href="#Project.prune_unfinished-2421"><span class="linenos">2421</span></a>
</span><span id="Project.prune_unfinished-2422"><a href="#Project.prune_unfinished-2422"><span class="linenos">2422</span></a>        <span class="k">if</span> <span class="n">exceptions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.prune_unfinished-2423"><a href="#Project.prune_unfinished-2423"><span class="linenos">2423</span></a>            <span class="n">exceptions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.prune_unfinished-2424"><a href="#Project.prune_unfinished-2424"><span class="linenos">2424</span></a>        <span class="n">unfinished</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">unfinished_episodes</span><span class="p">()</span>
</span><span id="Project.prune_unfinished-2425"><a href="#Project.prune_unfinished-2425"><span class="linenos">2425</span></a>        <span class="n">unfinished</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unfinished</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">]</span>
</span><span id="Project.prune_unfinished-2426"><a href="#Project.prune_unfinished-2426"><span class="linenos">2426</span></a>        <span class="n">model_folders</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">))</span>
</span><span id="Project.prune_unfinished-2427"><a href="#Project.prune_unfinished-2427"><span class="linenos">2427</span></a>        <span class="n">unfinished</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="Project.prune_unfinished-2428"><a href="#Project.prune_unfinished-2428"><span class="linenos">2428</span></a>            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">model_folders</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>
</span><span id="Project.prune_unfinished-2429"><a href="#Project.prune_unfinished-2429"><span class="linenos">2429</span></a>        <span class="p">]</span>
</span><span id="Project.prune_unfinished-2430"><a href="#Project.prune_unfinished-2430"><span class="linenos">2430</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PRUNING </span><span class="si">{</span><span class="n">unfinished</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.prune_unfinished-2431"><a href="#Project.prune_unfinished-2431"><span class="linenos">2431</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">unfinished</span><span class="p">:</span>
</span><span id="Project.prune_unfinished-2432"><a href="#Project.prune_unfinished-2432"><span class="linenos">2432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project.prune_unfinished-2433"><a href="#Project.prune_unfinished-2433"><span class="linenos">2433</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.prune_unfinished-2434"><a href="#Project.prune_unfinished-2434"><span class="linenos">2434</span></a>        <span class="k">return</span> <span class="n">unfinished</span>
</span></pre></div>


            <div class="docstring"><p>Remove all interrupted episodes</p>

<p>Remove all episodes that either don't have a log file or have less epochs in the log file than in
the training parameters or have a model folder but not a record. Note that it can remove episodes that are
currently running!</p>

<h2 id="parameters">Parameters</h2>

<p>exceptions : list
    the episodes to keep even if they are interrupted</p>

<h2 id="returns">Returns</h2>

<p>pruned : list
    a list of the episode names that were pruned</p>
</div>


                            </div>
                            <div id="Project.prediction_path" class="classattr">
                                        <input id="Project.prediction_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prediction_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Project.prediction_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.prediction_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.prediction_path-2436"><a href="#Project.prediction_path-2436"><span class="linenos">2436</span></a>    <span class="k">def</span> <span class="nf">prediction_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Project.prediction_path-2437"><a href="#Project.prediction_path-2437"><span class="linenos">2437</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.prediction_path-2438"><a href="#Project.prediction_path-2438"><span class="linenos">2438</span></a><span class="sd">        Get the path where prediction files are saved</span>
</span><span id="Project.prediction_path-2439"><a href="#Project.prediction_path-2439"><span class="linenos">2439</span></a>
</span><span id="Project.prediction_path-2440"><a href="#Project.prediction_path-2440"><span class="linenos">2440</span></a><span class="sd">        Parameters</span>
</span><span id="Project.prediction_path-2441"><a href="#Project.prediction_path-2441"><span class="linenos">2441</span></a><span class="sd">        ----------</span>
</span><span id="Project.prediction_path-2442"><a href="#Project.prediction_path-2442"><span class="linenos">2442</span></a><span class="sd">        prediction_name : str</span>
</span><span id="Project.prediction_path-2443"><a href="#Project.prediction_path-2443"><span class="linenos">2443</span></a><span class="sd">            name of the prediction</span>
</span><span id="Project.prediction_path-2444"><a href="#Project.prediction_path-2444"><span class="linenos">2444</span></a>
</span><span id="Project.prediction_path-2445"><a href="#Project.prediction_path-2445"><span class="linenos">2445</span></a><span class="sd">        Returns</span>
</span><span id="Project.prediction_path-2446"><a href="#Project.prediction_path-2446"><span class="linenos">2446</span></a><span class="sd">        -------</span>
</span><span id="Project.prediction_path-2447"><a href="#Project.prediction_path-2447"><span class="linenos">2447</span></a><span class="sd">        prediction_path : str</span>
</span><span id="Project.prediction_path-2448"><a href="#Project.prediction_path-2448"><span class="linenos">2448</span></a><span class="sd">            the file path</span>
</span><span id="Project.prediction_path-2449"><a href="#Project.prediction_path-2449"><span class="linenos">2449</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.prediction_path-2450"><a href="#Project.prediction_path-2450"><span class="linenos">2450</span></a>
</span><span id="Project.prediction_path-2451"><a href="#Project.prediction_path-2451"><span class="linenos">2451</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.prediction_path-2452"><a href="#Project.prediction_path-2452"><span class="linenos">2452</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;predictions&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prediction_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project.prediction_path-2453"><a href="#Project.prediction_path-2453"><span class="linenos">2453</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get the path where prediction files are saved</p>

<h2 id="parameters">Parameters</h2>

<p>prediction_name : str
    name of the prediction</p>

<h2 id="returns">Returns</h2>

<p>prediction_path : str
    the file path</p>
</div>


                            </div>
                            <div id="Project.print_data_types" class="classattr">
                                        <input id="Project.print_data_types-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">print_data_types</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Project.print_data_types-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.print_data_types"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.print_data_types-2455"><a href="#Project.print_data_types-2455"><span class="linenos">2455</span></a>    <span class="nd">@classmethod</span>
</span><span id="Project.print_data_types-2456"><a href="#Project.print_data_types-2456"><span class="linenos">2456</span></a>    <span class="k">def</span> <span class="nf">print_data_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="Project.print_data_types-2457"><a href="#Project.print_data_types-2457"><span class="linenos">2457</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DATA TYPES:&quot;</span><span class="p">)</span>
</span><span id="Project.print_data_types-2458"><a href="#Project.print_data_types-2458"><span class="linenos">2458</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">data_types</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.print_data_types-2459"><a href="#Project.print_data_types-2459"><span class="linenos">2459</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project.print_data_types-2460"><a href="#Project.print_data_types-2460"><span class="linenos">2460</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Project.print_annotation_types" class="classattr">
                                        <input id="Project.print_annotation_types-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">print_annotation_types</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Project.print_annotation_types-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.print_annotation_types"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.print_annotation_types-2462"><a href="#Project.print_annotation_types-2462"><span class="linenos">2462</span></a>    <span class="nd">@classmethod</span>
</span><span id="Project.print_annotation_types-2463"><a href="#Project.print_annotation_types-2463"><span class="linenos">2463</span></a>    <span class="k">def</span> <span class="nf">print_annotation_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="Project.print_annotation_types-2464"><a href="#Project.print_annotation_types-2464"><span class="linenos">2464</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ANNOTATION TYPES:&quot;</span><span class="p">)</span>
</span><span id="Project.print_annotation_types-2465"><a href="#Project.print_annotation_types-2465"><span class="linenos">2465</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">annotation_types</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.print_annotation_types-2466"><a href="#Project.print_annotation_types-2466"><span class="linenos">2466</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project.print_annotation_types-2467"><a href="#Project.print_annotation_types-2467"><span class="linenos">2467</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Project.data_types" class="classattr">
                                        <input id="Project.data_types-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">data_types</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="n">List</span>:</span></span>

                <label class="view-source-button" for="Project.data_types-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.data_types"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.data_types-2469"><a href="#Project.data_types-2469"><span class="linenos">2469</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Project.data_types-2470"><a href="#Project.data_types-2470"><span class="linenos">2470</span></a>    <span class="k">def</span> <span class="nf">data_types</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="Project.data_types-2471"><a href="#Project.data_types-2471"><span class="linenos">2471</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.data_types-2472"><a href="#Project.data_types-2472"><span class="linenos">2472</span></a><span class="sd">        Get available data types</span>
</span><span id="Project.data_types-2473"><a href="#Project.data_types-2473"><span class="linenos">2473</span></a>
</span><span id="Project.data_types-2474"><a href="#Project.data_types-2474"><span class="linenos">2474</span></a><span class="sd">        Returns</span>
</span><span id="Project.data_types-2475"><a href="#Project.data_types-2475"><span class="linenos">2475</span></a><span class="sd">        -------</span>
</span><span id="Project.data_types-2476"><a href="#Project.data_types-2476"><span class="linenos">2476</span></a><span class="sd">        list</span>
</span><span id="Project.data_types-2477"><a href="#Project.data_types-2477"><span class="linenos">2477</span></a><span class="sd">            available data types</span>
</span><span id="Project.data_types-2478"><a href="#Project.data_types-2478"><span class="linenos">2478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.data_types-2479"><a href="#Project.data_types-2479"><span class="linenos">2479</span></a>
</span><span id="Project.data_types-2480"><a href="#Project.data_types-2480"><span class="linenos">2480</span></a>        <span class="k">return</span> <span class="n">options</span><span class="o">.</span><span class="n">input_stores</span>
</span></pre></div>


            <div class="docstring"><p>Get available data types</p>

<h2 id="returns">Returns</h2>

<p>list
    available data types</p>
</div>


                            </div>
                            <div id="Project.annotation_types" class="classattr">
                                        <input id="Project.annotation_types-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">annotation_types</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="n">List</span>:</span></span>

                <label class="view-source-button" for="Project.annotation_types-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.annotation_types"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.annotation_types-2482"><a href="#Project.annotation_types-2482"><span class="linenos">2482</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Project.annotation_types-2483"><a href="#Project.annotation_types-2483"><span class="linenos">2483</span></a>    <span class="k">def</span> <span class="nf">annotation_types</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="Project.annotation_types-2484"><a href="#Project.annotation_types-2484"><span class="linenos">2484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.annotation_types-2485"><a href="#Project.annotation_types-2485"><span class="linenos">2485</span></a><span class="sd">        Get available annotation types</span>
</span><span id="Project.annotation_types-2486"><a href="#Project.annotation_types-2486"><span class="linenos">2486</span></a>
</span><span id="Project.annotation_types-2487"><a href="#Project.annotation_types-2487"><span class="linenos">2487</span></a><span class="sd">        Returns</span>
</span><span id="Project.annotation_types-2488"><a href="#Project.annotation_types-2488"><span class="linenos">2488</span></a><span class="sd">        -------</span>
</span><span id="Project.annotation_types-2489"><a href="#Project.annotation_types-2489"><span class="linenos">2489</span></a><span class="sd">        list</span>
</span><span id="Project.annotation_types-2490"><a href="#Project.annotation_types-2490"><span class="linenos">2490</span></a><span class="sd">            available annotation types</span>
</span><span id="Project.annotation_types-2491"><a href="#Project.annotation_types-2491"><span class="linenos">2491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.annotation_types-2492"><a href="#Project.annotation_types-2492"><span class="linenos">2492</span></a>
</span><span id="Project.annotation_types-2493"><a href="#Project.annotation_types-2493"><span class="linenos">2493</span></a>        <span class="k">return</span> <span class="n">options</span><span class="o">.</span><span class="n">annotation_stores</span>
</span></pre></div>


            <div class="docstring"><p>Get available annotation types</p>

<h2 id="returns">Returns</h2>

<p>list
    available annotation types</p>
</div>


                            </div>
                            <div id="Project.set_main_parameters" class="classattr">
                                        <input id="Project.set_main_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_main_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Project.set_main_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.set_main_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.set_main_parameters-3075"><a href="#Project.set_main_parameters-3075"><span class="linenos">3075</span></a>    <span class="k">def</span> <span class="nf">set_main_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Project.set_main_parameters-3076"><a href="#Project.set_main_parameters-3076"><span class="linenos">3076</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.set_main_parameters-3077"><a href="#Project.set_main_parameters-3077"><span class="linenos">3077</span></a><span class="sd">        Select the model and the metrics</span>
</span><span id="Project.set_main_parameters-3078"><a href="#Project.set_main_parameters-3078"><span class="linenos">3078</span></a>
</span><span id="Project.set_main_parameters-3079"><a href="#Project.set_main_parameters-3079"><span class="linenos">3079</span></a><span class="sd">        Parameters</span>
</span><span id="Project.set_main_parameters-3080"><a href="#Project.set_main_parameters-3080"><span class="linenos">3080</span></a><span class="sd">        ----------</span>
</span><span id="Project.set_main_parameters-3081"><a href="#Project.set_main_parameters-3081"><span class="linenos">3081</span></a><span class="sd">        model_name : str, optional</span>
</span><span id="Project.set_main_parameters-3082"><a href="#Project.set_main_parameters-3082"><span class="linenos">3082</span></a><span class="sd">            model name; run `project.help(&quot;model&quot;) to find out more</span>
</span><span id="Project.set_main_parameters-3083"><a href="#Project.set_main_parameters-3083"><span class="linenos">3083</span></a><span class="sd">        metric_names : list, optional</span>
</span><span id="Project.set_main_parameters-3084"><a href="#Project.set_main_parameters-3084"><span class="linenos">3084</span></a><span class="sd">            a list of metric function names; run `project.help(&quot;metrics&quot;) to find out more</span>
</span><span id="Project.set_main_parameters-3085"><a href="#Project.set_main_parameters-3085"><span class="linenos">3085</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.set_main_parameters-3086"><a href="#Project.set_main_parameters-3086"><span class="linenos">3086</span></a>
</span><span id="Project.set_main_parameters-3087"><a href="#Project.set_main_parameters-3087"><span class="linenos">3087</span></a>        <span class="n">pars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="Project.set_main_parameters-3088"><a href="#Project.set_main_parameters-3088"><span class="linenos">3088</span></a>        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.set_main_parameters-3089"><a href="#Project.set_main_parameters-3089"><span class="linenos">3089</span></a>            <span class="k">assert</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">models</span>
</span><span id="Project.set_main_parameters-3090"><a href="#Project.set_main_parameters-3090"><span class="linenos">3090</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_name</span>
</span><span id="Project.set_main_parameters-3091"><a href="#Project.set_main_parameters-3091"><span class="linenos">3091</span></a>        <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.set_main_parameters-3092"><a href="#Project.set_main_parameters-3092"><span class="linenos">3092</span></a>            <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
</span><span id="Project.set_main_parameters-3093"><a href="#Project.set_main_parameters-3093"><span class="linenos">3093</span></a>                <span class="k">assert</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">metrics</span>
</span><span id="Project.set_main_parameters-3094"><a href="#Project.set_main_parameters-3094"><span class="linenos">3094</span></a>            <span class="n">pars</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;metric_functions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_names</span>
</span><span id="Project.set_main_parameters-3095"><a href="#Project.set_main_parameters-3095"><span class="linenos">3095</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Select the model and the metrics</p>

<h2 id="parameters">Parameters</h2>

<p>model_name : str, optional
    model name; run <code>project.help("model") to find out more
metric_names : list, optional
    a list of metric function names; run</code>project.help("metrics") to find out more</p>
</div>


                            </div>
                            <div id="Project.help" class="classattr">
                                        <input id="Project.help-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">help</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">keyword</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Project.help-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.help"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.help-3097"><a href="#Project.help-3097"><span class="linenos">3097</span></a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Project.help-3098"><a href="#Project.help-3098"><span class="linenos">3098</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.help-3099"><a href="#Project.help-3099"><span class="linenos">3099</span></a><span class="sd">        Get information on available options</span>
</span><span id="Project.help-3100"><a href="#Project.help-3100"><span class="linenos">3100</span></a>
</span><span id="Project.help-3101"><a href="#Project.help-3101"><span class="linenos">3101</span></a><span class="sd">        Parameters</span>
</span><span id="Project.help-3102"><a href="#Project.help-3102"><span class="linenos">3102</span></a><span class="sd">        ----------</span>
</span><span id="Project.help-3103"><a href="#Project.help-3103"><span class="linenos">3103</span></a><span class="sd">        keyword : str, optional</span>
</span><span id="Project.help-3104"><a href="#Project.help-3104"><span class="linenos">3104</span></a><span class="sd">            the keyword for options (run without arguments to see which keywords are available)</span>
</span><span id="Project.help-3105"><a href="#Project.help-3105"><span class="linenos">3105</span></a>
</span><span id="Project.help-3106"><a href="#Project.help-3106"><span class="linenos">3106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.help-3107"><a href="#Project.help-3107"><span class="linenos">3107</span></a>
</span><span id="Project.help-3108"><a href="#Project.help-3108"><span class="linenos">3108</span></a>        <span class="k">if</span> <span class="n">keyword</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.help-3109"><a href="#Project.help-3109"><span class="linenos">3109</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AVAILABLE HELP FUNCTIONS:&quot;</span><span class="p">)</span>
</span><span id="Project.help-3110"><a href="#Project.help-3110"><span class="linenos">3110</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Try running `project.help(keyword)` with the following keywords:&quot;</span><span class="p">)</span>
</span><span id="Project.help-3111"><a href="#Project.help-3111"><span class="linenos">3111</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - model: to get more information on available models,&quot;</span><span class="p">)</span>
</span><span id="Project.help-3112"><a href="#Project.help-3112"><span class="linenos">3112</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.help-3113"><a href="#Project.help-3113"><span class="linenos">3113</span></a>                <span class="s2">&quot;    - features: to get more information on available feature extraction modes,&quot;</span>
</span><span id="Project.help-3114"><a href="#Project.help-3114"><span class="linenos">3114</span></a>            <span class="p">)</span>
</span><span id="Project.help-3115"><a href="#Project.help-3115"><span class="linenos">3115</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.help-3116"><a href="#Project.help-3116"><span class="linenos">3116</span></a>                <span class="s2">&quot;    - partition_method: to get more information on available train/test/val partitioning methods,&quot;</span>
</span><span id="Project.help-3117"><a href="#Project.help-3117"><span class="linenos">3117</span></a>            <span class="p">)</span>
</span><span id="Project.help-3118"><a href="#Project.help-3118"><span class="linenos">3118</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - metrics: to see a list of available metric functions.&quot;</span><span class="p">)</span>
</span><span id="Project.help-3119"><a href="#Project.help-3119"><span class="linenos">3119</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    - data: to see help for expected data structure&quot;</span><span class="p">)</span>
</span><span id="Project.help-3120"><a href="#Project.help-3120"><span class="linenos">3120</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.help-3121"><a href="#Project.help-3121"><span class="linenos">3121</span></a>                <span class="s2">&quot;- To start working with this project, first run `project.list_blanks()` to check which parameters need to be filled in.&quot;</span>
</span><span id="Project.help-3122"><a href="#Project.help-3122"><span class="linenos">3122</span></a>            <span class="p">)</span>
</span><span id="Project.help-3123"><a href="#Project.help-3123"><span class="linenos">3123</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.help-3124"><a href="#Project.help-3124"><span class="linenos">3124</span></a>                <span class="s2">&quot;- After a model and metrics are set, run `project.list_basic_parameters()` to see a list of the most important parameters that you might want to modify&quot;</span>
</span><span id="Project.help-3125"><a href="#Project.help-3125"><span class="linenos">3125</span></a>            <span class="p">)</span>
</span><span id="Project.help-3126"><a href="#Project.help-3126"><span class="linenos">3126</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.help-3127"><a href="#Project.help-3127"><span class="linenos">3127</span></a>                <span class="sa">f</span><span class="s2">&quot;- If you want to dig deeper, get the full dictionary with project._read_parameters() (it is a `ruamel.yaml.comments.CommentedMap` instance).&quot;</span>
</span><span id="Project.help-3128"><a href="#Project.help-3128"><span class="linenos">3128</span></a>            <span class="p">)</span>
</span><span id="Project.help-3129"><a href="#Project.help-3129"><span class="linenos">3129</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span>
</span><span id="Project.help-3130"><a href="#Project.help-3130"><span class="linenos">3130</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MODELS:&quot;</span><span class="p">)</span>
</span><span id="Project.help-3131"><a href="#Project.help-3131"><span class="linenos">3131</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.help-3132"><a href="#Project.help-3132"><span class="linenos">3132</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project.help-3133"><a href="#Project.help-3133"><span class="linenos">3133</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project.help-3134"><a href="#Project.help-3134"><span class="linenos">3134</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;features&quot;</span><span class="p">:</span>
</span><span id="Project.help-3135"><a href="#Project.help-3135"><span class="linenos">3135</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FEATURE EXTRACTORS:&quot;</span><span class="p">)</span>
</span><span id="Project.help-3136"><a href="#Project.help-3136"><span class="linenos">3136</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">extractor</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">feature_extractors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.help-3137"><a href="#Project.help-3137"><span class="linenos">3137</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project.help-3138"><a href="#Project.help-3138"><span class="linenos">3138</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">extractor</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project.help-3139"><a href="#Project.help-3139"><span class="linenos">3139</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;partition_method&quot;</span><span class="p">:</span>
</span><span id="Project.help-3140"><a href="#Project.help-3140"><span class="linenos">3140</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PARTITION METHODS:&quot;</span><span class="p">)</span>
</span><span id="Project.help-3141"><a href="#Project.help-3141"><span class="linenos">3141</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.help-3142"><a href="#Project.help-3142"><span class="linenos">3142</span></a>                <span class="n">BehaviorDataset</span><span class="o">.</span><span class="n">partition_train_test_val</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
</span><span id="Project.help-3143"><a href="#Project.help-3143"><span class="linenos">3143</span></a>                    <span class="s2">&quot;The partitioning method:&quot;</span>
</span><span id="Project.help-3144"><a href="#Project.help-3144"><span class="linenos">3144</span></a>                <span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;val_frac :&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project.help-3145"><a href="#Project.help-3145"><span class="linenos">3145</span></a>            <span class="p">)</span>
</span><span id="Project.help-3146"><a href="#Project.help-3146"><span class="linenos">3146</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;metrics&quot;</span><span class="p">:</span>
</span><span id="Project.help-3147"><a href="#Project.help-3147"><span class="linenos">3147</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;METRICS:&quot;</span><span class="p">)</span>
</span><span id="Project.help-3148"><a href="#Project.help-3148"><span class="linenos">3148</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.help-3149"><a href="#Project.help-3149"><span class="linenos">3149</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project.help-3150"><a href="#Project.help-3150"><span class="linenos">3150</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project.help-3151"><a href="#Project.help-3151"><span class="linenos">3151</span></a>        <span class="k">elif</span> <span class="n">keyword</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
</span><span id="Project.help-3152"><a href="#Project.help-3152"><span class="linenos">3152</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DATA:&quot;</span><span class="p">)</span>
</span><span id="Project.help-3153"><a href="#Project.help-3153"><span class="linenos">3153</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video data: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.help-3154"><a href="#Project.help-3154"><span class="linenos">3154</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">input_stores</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">]</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project.help-3155"><a href="#Project.help-3155"><span class="linenos">3155</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Annotation data: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.help-3156"><a href="#Project.help-3156"><span class="linenos">3156</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">annotation_stores</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_type</span><span class="p">]</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</span><span id="Project.help-3157"><a href="#Project.help-3157"><span class="linenos">3157</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.help-3158"><a href="#Project.help-3158"><span class="linenos">3158</span></a>                <span class="s2">&quot;Annotation path and data path don&#39;t have to be separate, you can keep everything in one folder.&quot;</span>
</span><span id="Project.help-3159"><a href="#Project.help-3159"><span class="linenos">3159</span></a>            <span class="p">)</span>
</span><span id="Project.help-3160"><a href="#Project.help-3160"><span class="linenos">3160</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.help-3161"><a href="#Project.help-3161"><span class="linenos">3161</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">keyword</span><span class="si">}</span><span class="s2"> keyword is not recognized&quot;</span><span class="p">)</span>
</span><span id="Project.help-3162"><a href="#Project.help-3162"><span class="linenos">3162</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get information on available options</p>

<h2 id="parameters">Parameters</h2>

<p>keyword : str, optional
    the keyword for options (run without arguments to see which keywords are available)</p>
</div>


                            </div>
                            <div id="Project.list_blanks" class="classattr">
                                        <input id="Project.list_blanks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_blanks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">blanks</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Project.list_blanks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.list_blanks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.list_blanks-3182"><a href="#Project.list_blanks-3182"><span class="linenos">3182</span></a>    <span class="k">def</span> <span class="nf">list_blanks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blanks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Project.list_blanks-3183"><a href="#Project.list_blanks-3183"><span class="linenos">3183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.list_blanks-3184"><a href="#Project.list_blanks-3184"><span class="linenos">3184</span></a><span class="sd">        List parameters that need to be filled in</span>
</span><span id="Project.list_blanks-3185"><a href="#Project.list_blanks-3185"><span class="linenos">3185</span></a>
</span><span id="Project.list_blanks-3186"><a href="#Project.list_blanks-3186"><span class="linenos">3186</span></a><span class="sd">        Parameters</span>
</span><span id="Project.list_blanks-3187"><a href="#Project.list_blanks-3187"><span class="linenos">3187</span></a><span class="sd">        ----------</span>
</span><span id="Project.list_blanks-3188"><a href="#Project.list_blanks-3188"><span class="linenos">3188</span></a><span class="sd">        blanks : list, optional</span>
</span><span id="Project.list_blanks-3189"><a href="#Project.list_blanks-3189"><span class="linenos">3189</span></a><span class="sd">            a list of the parameters to list, if already known</span>
</span><span id="Project.list_blanks-3190"><a href="#Project.list_blanks-3190"><span class="linenos">3190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.list_blanks-3191"><a href="#Project.list_blanks-3191"><span class="linenos">3191</span></a>
</span><span id="Project.list_blanks-3192"><a href="#Project.list_blanks-3192"><span class="linenos">3192</span></a>        <span class="k">if</span> <span class="n">blanks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.list_blanks-3193"><a href="#Project.list_blanks-3193"><span class="linenos">3193</span></a>            <span class="n">blanks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_blanks</span><span class="p">()</span>
</span><span id="Project.list_blanks-3194"><a href="#Project.list_blanks-3194"><span class="linenos">3194</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blanks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project.list_blanks-3195"><a href="#Project.list_blanks-3195"><span class="linenos">3195</span></a>            <span class="n">to_update</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="Project.list_blanks-3196"><a href="#Project.list_blanks-3196"><span class="linenos">3196</span></a>            <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">blanks</span><span class="p">:</span>
</span><span id="Project.list_blanks-3197"><a href="#Project.list_blanks-3197"><span class="linenos">3197</span></a>                <span class="n">to_update</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
</span><span id="Project.list_blanks-3198"><a href="#Project.list_blanks-3198"><span class="linenos">3198</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Before running experiments, please update all the blanks.&quot;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3199"><a href="#Project.list_blanks-3199"><span class="linenos">3199</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To do that, you can run this.&quot;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3200"><a href="#Project.list_blanks-3200"><span class="linenos">3200</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3201"><a href="#Project.list_blanks-3201"><span class="linenos">3201</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;project.update_parameters(&quot;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3202"><a href="#Project.list_blanks-3202"><span class="linenos">3202</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="se">{{</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3203"><a href="#Project.list_blanks-3203"><span class="linenos">3203</span></a>            <span class="k">for</span> <span class="n">big_key</span><span class="p">,</span> <span class="n">keys</span> <span class="ow">in</span> <span class="n">to_update</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.list_blanks-3204"><a href="#Project.list_blanks-3204"><span class="linenos">3204</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;        &quot;</span><span class="si">{</span><span class="n">big_key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3205"><a href="#Project.list_blanks-3205"><span class="linenos">3205</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="Project.list_blanks-3206"><a href="#Project.list_blanks-3206"><span class="linenos">3206</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: ..., </span><span class="si">{</span><span class="n">comment</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3207"><a href="#Project.list_blanks-3207"><span class="linenos">3207</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        </span><span class="se">}}</span><span class="s2">,&quot;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3208"><a href="#Project.list_blanks-3208"><span class="linenos">3208</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="se">}}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3209"><a href="#Project.list_blanks-3209"><span class="linenos">3209</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3210"><a href="#Project.list_blanks-3210"><span class="linenos">3210</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3211"><a href="#Project.list_blanks-3211"><span class="linenos">3211</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Replace ... with relevant values.&quot;</span><span class="p">)</span>
</span><span id="Project.list_blanks-3212"><a href="#Project.list_blanks-3212"><span class="linenos">3212</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.list_blanks-3213"><a href="#Project.list_blanks-3213"><span class="linenos">3213</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There is no blanks left!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>List parameters that need to be filled in</p>

<h2 id="parameters">Parameters</h2>

<p>blanks : list, optional
    a list of the parameters to list, if already known</p>
</div>


                            </div>
                            <div id="Project.list_basic_parameters" class="classattr">
                                        <input id="Project.list_basic_parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_basic_parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Project.list_basic_parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.list_basic_parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.list_basic_parameters-3215"><a href="#Project.list_basic_parameters-3215"><span class="linenos">3215</span></a>    <span class="k">def</span> <span class="nf">list_basic_parameters</span><span class="p">(</span>
</span><span id="Project.list_basic_parameters-3216"><a href="#Project.list_basic_parameters-3216"><span class="linenos">3216</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.list_basic_parameters-3217"><a href="#Project.list_basic_parameters-3217"><span class="linenos">3217</span></a>    <span class="p">):</span>
</span><span id="Project.list_basic_parameters-3218"><a href="#Project.list_basic_parameters-3218"><span class="linenos">3218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.list_basic_parameters-3219"><a href="#Project.list_basic_parameters-3219"><span class="linenos">3219</span></a><span class="sd">        Get a list of most relevant parameters and code to modify them</span>
</span><span id="Project.list_basic_parameters-3220"><a href="#Project.list_basic_parameters-3220"><span class="linenos">3220</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.list_basic_parameters-3221"><a href="#Project.list_basic_parameters-3221"><span class="linenos">3221</span></a>
</span><span id="Project.list_basic_parameters-3222"><a href="#Project.list_basic_parameters-3222"><span class="linenos">3222</span></a>        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_parameters</span><span class="p">()</span>
</span><span id="Project.list_basic_parameters-3223"><a href="#Project.list_basic_parameters-3223"><span class="linenos">3223</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;BASIC PARAMETERS:&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3224"><a href="#Project.list_basic_parameters-3224"><span class="linenos">3224</span></a>        <span class="n">model_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
</span><span id="Project.list_basic_parameters-3225"><a href="#Project.list_basic_parameters-3225"><span class="linenos">3225</span></a>        <span class="n">metric_names</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;metric_functions&quot;</span><span class="p">]</span>
</span><span id="Project.list_basic_parameters-3226"><a href="#Project.list_basic_parameters-3226"><span class="linenos">3226</span></a>        <span class="n">loss_name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;loss_function&quot;</span><span class="p">]</span>
</span><span id="Project.list_basic_parameters-3227"><a href="#Project.list_basic_parameters-3227"><span class="linenos">3227</span></a>        <span class="n">feature_extraction</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;feature_extraction&quot;</span><span class="p">]</span>
</span><span id="Project.list_basic_parameters-3228"><a href="#Project.list_basic_parameters-3228"><span class="linenos">3228</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Here is a list of current parameters.&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3229"><a href="#Project.list_basic_parameters-3229"><span class="linenos">3229</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.list_basic_parameters-3230"><a href="#Project.list_basic_parameters-3230"><span class="linenos">3230</span></a>            <span class="s2">&quot;You can copy this code, change the parameters you want to set and run it to update the project config.&quot;</span>
</span><span id="Project.list_basic_parameters-3231"><a href="#Project.list_basic_parameters-3231"><span class="linenos">3231</span></a>        <span class="p">)</span>
</span><span id="Project.list_basic_parameters-3232"><a href="#Project.list_basic_parameters-3232"><span class="linenos">3232</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3233"><a href="#Project.list_basic_parameters-3233"><span class="linenos">3233</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;project.update_parameters(&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3234"><a href="#Project.list_basic_parameters-3234"><span class="linenos">3234</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    {&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3235"><a href="#Project.list_basic_parameters-3235"><span class="linenos">3235</span></a>        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;training&quot;</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3236"><a href="#Project.list_basic_parameters-3236"><span class="linenos">3236</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;        &quot;</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3237"><a href="#Project.list_basic_parameters-3237"><span class="linenos">3237</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3238"><a href="#Project.list_basic_parameters-3238"><span class="linenos">3238</span></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="n">group</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3239"><a href="#Project.list_basic_parameters-3239"><span class="linenos">3239</span></a>                    <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.list_basic_parameters-3240"><a href="#Project.list_basic_parameters-3240"><span class="linenos">3240</span></a>                        <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project.list_basic_parameters-3241"><a href="#Project.list_basic_parameters-3241"><span class="linenos">3241</span></a>                    <span class="p">)</span>
</span><span id="Project.list_basic_parameters-3242"><a href="#Project.list_basic_parameters-3242"><span class="linenos">3242</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3243"><a href="#Project.list_basic_parameters-3243"><span class="linenos">3243</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;losses&quot;: {&#39;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3244"><a href="#Project.list_basic_parameters-3244"><span class="linenos">3244</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">loss_name</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3245"><a href="#Project.list_basic_parameters-3245"><span class="linenos">3245</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3246"><a href="#Project.list_basic_parameters-3246"><span class="linenos">3246</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3247"><a href="#Project.list_basic_parameters-3247"><span class="linenos">3247</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.list_basic_parameters-3248"><a href="#Project.list_basic_parameters-3248"><span class="linenos">3248</span></a>                    <span class="sa">f</span><span class="s1">&#39;                &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;losses&quot;</span><span class="p">][</span><span class="n">loss_name</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project.list_basic_parameters-3249"><a href="#Project.list_basic_parameters-3249"><span class="linenos">3249</span></a>                <span class="p">)</span>
</span><span id="Project.list_basic_parameters-3250"><a href="#Project.list_basic_parameters-3250"><span class="linenos">3250</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;            },&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3251"><a href="#Project.list_basic_parameters-3251"><span class="linenos">3251</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3252"><a href="#Project.list_basic_parameters-3252"><span class="linenos">3252</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;metrics&quot;: {&#39;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3253"><a href="#Project.list_basic_parameters-3253"><span class="linenos">3253</span></a>        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
</span><span id="Project.list_basic_parameters-3254"><a href="#Project.list_basic_parameters-3254"><span class="linenos">3254</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&quot;: </span><span class="se">{{</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3255"><a href="#Project.list_basic_parameters-3255"><span class="linenos">3255</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3256"><a href="#Project.list_basic_parameters-3256"><span class="linenos">3256</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.list_basic_parameters-3257"><a href="#Project.list_basic_parameters-3257"><span class="linenos">3257</span></a>                    <span class="sa">f</span><span class="s1">&#39;                &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project.list_basic_parameters-3258"><a href="#Project.list_basic_parameters-3258"><span class="linenos">3258</span></a>                <span class="p">)</span>
</span><span id="Project.list_basic_parameters-3259"><a href="#Project.list_basic_parameters-3259"><span class="linenos">3259</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;            },&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3260"><a href="#Project.list_basic_parameters-3260"><span class="linenos">3260</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3261"><a href="#Project.list_basic_parameters-3261"><span class="linenos">3261</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;model&quot;: {&#39;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3262"><a href="#Project.list_basic_parameters-3262"><span class="linenos">3262</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="n">model_name</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3263"><a href="#Project.list_basic_parameters-3263"><span class="linenos">3263</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3264"><a href="#Project.list_basic_parameters-3264"><span class="linenos">3264</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.list_basic_parameters-3265"><a href="#Project.list_basic_parameters-3265"><span class="linenos">3265</span></a>                    <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project.list_basic_parameters-3266"><a href="#Project.list_basic_parameters-3266"><span class="linenos">3266</span></a>                <span class="p">)</span>
</span><span id="Project.list_basic_parameters-3267"><a href="#Project.list_basic_parameters-3267"><span class="linenos">3267</span></a>
</span><span id="Project.list_basic_parameters-3268"><a href="#Project.list_basic_parameters-3268"><span class="linenos">3268</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3269"><a href="#Project.list_basic_parameters-3269"><span class="linenos">3269</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;features&quot;: {&#39;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3270"><a href="#Project.list_basic_parameters-3270"><span class="linenos">3270</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="n">feature_extraction</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3271"><a href="#Project.list_basic_parameters-3271"><span class="linenos">3271</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3272"><a href="#Project.list_basic_parameters-3272"><span class="linenos">3272</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.list_basic_parameters-3273"><a href="#Project.list_basic_parameters-3273"><span class="linenos">3273</span></a>                    <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project.list_basic_parameters-3274"><a href="#Project.list_basic_parameters-3274"><span class="linenos">3274</span></a>                <span class="p">)</span>
</span><span id="Project.list_basic_parameters-3275"><a href="#Project.list_basic_parameters-3275"><span class="linenos">3275</span></a>
</span><span id="Project.list_basic_parameters-3276"><a href="#Project.list_basic_parameters-3276"><span class="linenos">3276</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3277"><a href="#Project.list_basic_parameters-3277"><span class="linenos">3277</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        &quot;augmentations&quot;: {&#39;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3278"><a href="#Project.list_basic_parameters-3278"><span class="linenos">3278</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">basic_parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">][</span><span class="n">feature_extraction</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3279"><a href="#Project.list_basic_parameters-3279"><span class="linenos">3279</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]:</span>
</span><span id="Project.list_basic_parameters-3280"><a href="#Project.list_basic_parameters-3280"><span class="linenos">3280</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="Project.list_basic_parameters-3281"><a href="#Project.list_basic_parameters-3281"><span class="linenos">3281</span></a>                    <span class="sa">f</span><span class="s1">&#39;            &quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_process_value</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comment</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;augmentations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">ca</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Project.list_basic_parameters-3282"><a href="#Project.list_basic_parameters-3282"><span class="linenos">3282</span></a>                <span class="p">)</span>
</span><span id="Project.list_basic_parameters-3283"><a href="#Project.list_basic_parameters-3283"><span class="linenos">3283</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        },&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3284"><a href="#Project.list_basic_parameters-3284"><span class="linenos">3284</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    },&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3285"><a href="#Project.list_basic_parameters-3285"><span class="linenos">3285</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3286"><a href="#Project.list_basic_parameters-3286"><span class="linenos">3286</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------&quot;</span><span class="p">)</span>
</span><span id="Project.list_basic_parameters-3287"><a href="#Project.list_basic_parameters-3287"><span class="linenos">3287</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get a list of most relevant parameters and code to modify them</p>
</div>


                            </div>
                            <div id="Project.count_classes" class="classattr">
                                        <input id="Project.count_classes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count_classes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="Project.count_classes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.count_classes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.count_classes-3787"><a href="#Project.count_classes-3787"><span class="linenos">3787</span></a>    <span class="k">def</span> <span class="nf">count_classes</span><span class="p">(</span>
</span><span id="Project.count_classes-3788"><a href="#Project.count_classes-3788"><span class="linenos">3788</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.count_classes-3789"><a href="#Project.count_classes-3789"><span class="linenos">3789</span></a>        <span class="n">load_episode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.count_classes-3790"><a href="#Project.count_classes-3790"><span class="linenos">3790</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.count_classes-3791"><a href="#Project.count_classes-3791"><span class="linenos">3791</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.count_classes-3792"><a href="#Project.count_classes-3792"><span class="linenos">3792</span></a>        <span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project.count_classes-3793"><a href="#Project.count_classes-3793"><span class="linenos">3793</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project.count_classes-3794"><a href="#Project.count_classes-3794"><span class="linenos">3794</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.count_classes-3795"><a href="#Project.count_classes-3795"><span class="linenos">3795</span></a><span class="sd">        Get a dictionary of class counts in different modes</span>
</span><span id="Project.count_classes-3796"><a href="#Project.count_classes-3796"><span class="linenos">3796</span></a>
</span><span id="Project.count_classes-3797"><a href="#Project.count_classes-3797"><span class="linenos">3797</span></a><span class="sd">        Parameters</span>
</span><span id="Project.count_classes-3798"><a href="#Project.count_classes-3798"><span class="linenos">3798</span></a><span class="sd">        ----------</span>
</span><span id="Project.count_classes-3799"><a href="#Project.count_classes-3799"><span class="linenos">3799</span></a><span class="sd">        load_episode : str, optional</span>
</span><span id="Project.count_classes-3800"><a href="#Project.count_classes-3800"><span class="linenos">3800</span></a><span class="sd">            the episode settings to load</span>
</span><span id="Project.count_classes-3801"><a href="#Project.count_classes-3801"><span class="linenos">3801</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project.count_classes-3802"><a href="#Project.count_classes-3802"><span class="linenos">3802</span></a><span class="sd">            a dictionary of parameter updates (only for &quot;data&quot; and &quot;general&quot; categories)</span>
</span><span id="Project.count_classes-3803"><a href="#Project.count_classes-3803"><span class="linenos">3803</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project.count_classes-3804"><a href="#Project.count_classes-3804"><span class="linenos">3804</span></a><span class="sd">            if `True`, the dataset that is used for computation is then deleted</span>
</span><span id="Project.count_classes-3805"><a href="#Project.count_classes-3805"><span class="linenos">3805</span></a><span class="sd">        bouts : bool, default False</span>
</span><span id="Project.count_classes-3806"><a href="#Project.count_classes-3806"><span class="linenos">3806</span></a><span class="sd">            if `True`, instead of frame counts segment counts are returned</span>
</span><span id="Project.count_classes-3807"><a href="#Project.count_classes-3807"><span class="linenos">3807</span></a>
</span><span id="Project.count_classes-3808"><a href="#Project.count_classes-3808"><span class="linenos">3808</span></a><span class="sd">        Returns</span>
</span><span id="Project.count_classes-3809"><a href="#Project.count_classes-3809"><span class="linenos">3809</span></a><span class="sd">        -------</span>
</span><span id="Project.count_classes-3810"><a href="#Project.count_classes-3810"><span class="linenos">3810</span></a><span class="sd">        class_counts : dict</span>
</span><span id="Project.count_classes-3811"><a href="#Project.count_classes-3811"><span class="linenos">3811</span></a><span class="sd">            a dictionary where first-level keys are &quot;train&quot;, &quot;val&quot; and &quot;test&quot;, second-level keys are</span>
</span><span id="Project.count_classes-3812"><a href="#Project.count_classes-3812"><span class="linenos">3812</span></a><span class="sd">            class names and values are class counts (in frames)</span>
</span><span id="Project.count_classes-3813"><a href="#Project.count_classes-3813"><span class="linenos">3813</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.count_classes-3814"><a href="#Project.count_classes-3814"><span class="linenos">3814</span></a>
</span><span id="Project.count_classes-3815"><a href="#Project.count_classes-3815"><span class="linenos">3815</span></a>        <span class="k">if</span> <span class="n">load_episode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.count_classes-3816"><a href="#Project.count_classes-3816"><span class="linenos">3816</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="Project.count_classes-3817"><a href="#Project.count_classes-3817"><span class="linenos">3817</span></a>                <span class="n">episode_name</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span> <span class="n">throwaway</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Project.count_classes-3818"><a href="#Project.count_classes-3818"><span class="linenos">3818</span></a>            <span class="p">)</span>
</span><span id="Project.count_classes-3819"><a href="#Project.count_classes-3819"><span class="linenos">3819</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.count_classes-3820"><a href="#Project.count_classes-3820"><span class="linenos">3820</span></a>            <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project.count_classes-3821"><a href="#Project.count_classes-3821"><span class="linenos">3821</span></a>                <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project.count_classes-3822"><a href="#Project.count_classes-3822"><span class="linenos">3822</span></a>                <span class="n">load_episode</span><span class="o">=</span><span class="n">load_episode</span><span class="p">,</span>
</span><span id="Project.count_classes-3823"><a href="#Project.count_classes-3823"><span class="linenos">3823</span></a>                <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.count_classes-3824"><a href="#Project.count_classes-3824"><span class="linenos">3824</span></a>            <span class="p">)</span>
</span><span id="Project.count_classes-3825"><a href="#Project.count_classes-3825"><span class="linenos">3825</span></a>        <span class="n">class_counts</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">count_classes</span><span class="p">(</span><span class="n">bouts</span><span class="o">=</span><span class="n">bouts</span><span class="p">)</span>
</span><span id="Project.count_classes-3826"><a href="#Project.count_classes-3826"><span class="linenos">3826</span></a>        <span class="n">behaviors</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span>
</span><span id="Project.count_classes-3827"><a href="#Project.count_classes-3827"><span class="linenos">3827</span></a>        <span class="n">class_counts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project.count_classes-3828"><a href="#Project.count_classes-3828"><span class="linenos">3828</span></a>            <span class="n">kk</span><span class="p">:</span> <span class="p">{</span><span class="n">behaviors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="Project.count_classes-3829"><a href="#Project.count_classes-3829"><span class="linenos">3829</span></a>            <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Project.count_classes-3830"><a href="#Project.count_classes-3830"><span class="linenos">3830</span></a>        <span class="p">}</span>
</span><span id="Project.count_classes-3831"><a href="#Project.count_classes-3831"><span class="linenos">3831</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project.count_classes-3832"><a href="#Project.count_classes-3832"><span class="linenos">3832</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project.count_classes-3833"><a href="#Project.count_classes-3833"><span class="linenos">3833</span></a>        <span class="k">return</span> <span class="n">class_counts</span>
</span></pre></div>


            <div class="docstring"><p>Get a dictionary of class counts in different modes</p>

<h2 id="parameters">Parameters</h2>

<p>load_episode : str, optional
    the episode settings to load
parameters_update : dict, optional
    a dictionary of parameter updates (only for "data" and "general" categories)
remove_saved_features : bool, default False
    if <code>True</code>, the dataset that is used for computation is then deleted
bouts : bool, default False
    if <code>True</code>, instead of frame counts segment counts are returned</p>

<h2 id="returns">Returns</h2>

<p>class_counts : dict
    a dictionary where first-level keys are "train", "val" and "test", second-level keys are
    class names and values are class counts (in frames)</p>
</div>


                            </div>
                            <div id="Project.plot_class_distribution" class="classattr">
                                        <input id="Project.plot_class_distribution-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_class_distribution</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">frame_cutoff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">bout_cutoff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">print_full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.plot_class_distribution-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.plot_class_distribution"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.plot_class_distribution-3835"><a href="#Project.plot_class_distribution-3835"><span class="linenos">3835</span></a>    <span class="k">def</span> <span class="nf">plot_class_distribution</span><span class="p">(</span>
</span><span id="Project.plot_class_distribution-3836"><a href="#Project.plot_class_distribution-3836"><span class="linenos">3836</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.plot_class_distribution-3837"><a href="#Project.plot_class_distribution-3837"><span class="linenos">3837</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_class_distribution-3838"><a href="#Project.plot_class_distribution-3838"><span class="linenos">3838</span></a>        <span class="n">frame_cutoff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project.plot_class_distribution-3839"><a href="#Project.plot_class_distribution-3839"><span class="linenos">3839</span></a>        <span class="n">bout_cutoff</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project.plot_class_distribution-3840"><a href="#Project.plot_class_distribution-3840"><span class="linenos">3840</span></a>        <span class="n">print_full</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.plot_class_distribution-3841"><a href="#Project.plot_class_distribution-3841"><span class="linenos">3841</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.plot_class_distribution-3842"><a href="#Project.plot_class_distribution-3842"><span class="linenos">3842</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_class_distribution-3843"><a href="#Project.plot_class_distribution-3843"><span class="linenos">3843</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.plot_class_distribution-3844"><a href="#Project.plot_class_distribution-3844"><span class="linenos">3844</span></a><span class="sd">        Make a class distribution plot</span>
</span><span id="Project.plot_class_distribution-3845"><a href="#Project.plot_class_distribution-3845"><span class="linenos">3845</span></a>
</span><span id="Project.plot_class_distribution-3846"><a href="#Project.plot_class_distribution-3846"><span class="linenos">3846</span></a><span class="sd">        You can either specify the parameters, choose an existing dataset or do neither (in that case a dataset</span>
</span><span id="Project.plot_class_distribution-3847"><a href="#Project.plot_class_distribution-3847"><span class="linenos">3847</span></a><span class="sd">        is created or laoded for the computation with the default parameters).</span>
</span><span id="Project.plot_class_distribution-3848"><a href="#Project.plot_class_distribution-3848"><span class="linenos">3848</span></a>
</span><span id="Project.plot_class_distribution-3849"><a href="#Project.plot_class_distribution-3849"><span class="linenos">3849</span></a><span class="sd">        Parameters</span>
</span><span id="Project.plot_class_distribution-3850"><a href="#Project.plot_class_distribution-3850"><span class="linenos">3850</span></a><span class="sd">        ----------</span>
</span><span id="Project.plot_class_distribution-3851"><a href="#Project.plot_class_distribution-3851"><span class="linenos">3851</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project.plot_class_distribution-3852"><a href="#Project.plot_class_distribution-3852"><span class="linenos">3852</span></a><span class="sd">            a dictionary of parameter updates (only for &quot;data&quot; and &quot;general&quot; categories)</span>
</span><span id="Project.plot_class_distribution-3853"><a href="#Project.plot_class_distribution-3853"><span class="linenos">3853</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project.plot_class_distribution-3854"><a href="#Project.plot_class_distribution-3854"><span class="linenos">3854</span></a><span class="sd">            if `True`, the dataset that is used for computation is then deleted</span>
</span><span id="Project.plot_class_distribution-3855"><a href="#Project.plot_class_distribution-3855"><span class="linenos">3855</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.plot_class_distribution-3856"><a href="#Project.plot_class_distribution-3856"><span class="linenos">3856</span></a>
</span><span id="Project.plot_class_distribution-3857"><a href="#Project.plot_class_distribution-3857"><span class="linenos">3857</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_training</span><span class="p">(</span>
</span><span id="Project.plot_class_distribution-3858"><a href="#Project.plot_class_distribution-3858"><span class="linenos">3858</span></a>            <span class="n">episode_name</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span> <span class="n">throwaway</span><span class="o">=</span><span class="kc">True</span>
</span><span id="Project.plot_class_distribution-3859"><a href="#Project.plot_class_distribution-3859"><span class="linenos">3859</span></a>        <span class="p">)</span>
</span><span id="Project.plot_class_distribution-3860"><a href="#Project.plot_class_distribution-3860"><span class="linenos">3860</span></a>        <span class="n">cutoff</span> <span class="o">=</span> <span class="p">{</span><span class="kc">True</span><span class="p">:</span> <span class="n">bout_cutoff</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="n">frame_cutoff</span><span class="p">}</span>
</span><span id="Project.plot_class_distribution-3861"><a href="#Project.plot_class_distribution-3861"><span class="linenos">3861</span></a>        <span class="k">for</span> <span class="n">bouts</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
</span><span id="Project.plot_class_distribution-3862"><a href="#Project.plot_class_distribution-3862"><span class="linenos">3862</span></a>            <span class="n">class_counts</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">count_classes</span><span class="p">(</span><span class="n">bouts</span><span class="o">=</span><span class="n">bouts</span><span class="p">)</span>
</span><span id="Project.plot_class_distribution-3863"><a href="#Project.plot_class_distribution-3863"><span class="linenos">3863</span></a>            <span class="k">if</span> <span class="n">print_full</span><span class="p">:</span>
</span><span id="Project.plot_class_distribution-3864"><a href="#Project.plot_class_distribution-3864"><span class="linenos">3864</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bouts:&quot;</span> <span class="k">if</span> <span class="n">bouts</span> <span class="k">else</span> <span class="s2">&quot;Frames:&quot;</span><span class="p">)</span>
</span><span id="Project.plot_class_distribution-3865"><a href="#Project.plot_class_distribution-3865"><span class="linenos">3865</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.plot_class_distribution-3866"><a href="#Project.plot_class_distribution-3866"><span class="linenos">3866</span></a>                    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project.plot_class_distribution-3867"><a href="#Project.plot_class_distribution-3867"><span class="linenos">3867</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
</span><span id="Project.plot_class_distribution-3868"><a href="#Project.plot_class_distribution-3868"><span class="linenos">3868</span></a>                        <span class="n">values</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Project.plot_class_distribution-3869"><a href="#Project.plot_class_distribution-3869"><span class="linenos">3869</span></a>                            <span class="o">*</span><span class="p">[</span>
</span><span id="Project.plot_class_distribution-3870"><a href="#Project.plot_class_distribution-3870"><span class="linenos">3870</span></a>                                <span class="n">x</span>
</span><span id="Project.plot_class_distribution-3871"><a href="#Project.plot_class_distribution-3871"><span class="linenos">3871</span></a>                                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Project.plot_class_distribution-3872"><a href="#Project.plot_class_distribution-3872"><span class="linenos">3872</span></a>                                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="Project.plot_class_distribution-3873"><a href="#Project.plot_class_distribution-3873"><span class="linenos">3873</span></a>                            <span class="p">]</span>
</span><span id="Project.plot_class_distribution-3874"><a href="#Project.plot_class_distribution-3874"><span class="linenos">3874</span></a>                        <span class="p">)</span>
</span><span id="Project.plot_class_distribution-3875"><a href="#Project.plot_class_distribution-3875"><span class="linenos">3875</span></a>                        <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
</span><span id="Project.plot_class_distribution-3876"><a href="#Project.plot_class_distribution-3876"><span class="linenos">3876</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">kk</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">vv</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.plot_class_distribution-3877"><a href="#Project.plot_class_distribution-3877"><span class="linenos">3877</span></a>            <span class="n">class_counts</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Project.plot_class_distribution-3878"><a href="#Project.plot_class_distribution-3878"><span class="linenos">3878</span></a>                <span class="n">kk</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="n">cutoff</span><span class="p">[</span><span class="n">bouts</span><span class="p">]}</span>
</span><span id="Project.plot_class_distribution-3879"><a href="#Project.plot_class_distribution-3879"><span class="linenos">3879</span></a>                <span class="k">for</span> <span class="n">kk</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Project.plot_class_distribution-3880"><a href="#Project.plot_class_distribution-3880"><span class="linenos">3880</span></a>            <span class="p">}</span>
</span><span id="Project.plot_class_distribution-3881"><a href="#Project.plot_class_distribution-3881"><span class="linenos">3881</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">class_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.plot_class_distribution-3882"><a href="#Project.plot_class_distribution-3882"><span class="linenos">3882</span></a>                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project.plot_class_distribution-3883"><a href="#Project.plot_class_distribution-3883"><span class="linenos">3883</span></a>                    <span class="n">values</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="Project.plot_class_distribution-3884"><a href="#Project.plot_class_distribution-3884"><span class="linenos">3884</span></a>                        <span class="o">*</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span>
</span><span id="Project.plot_class_distribution-3885"><a href="#Project.plot_class_distribution-3885"><span class="linenos">3885</span></a>                    <span class="p">)</span>
</span><span id="Project.plot_class_distribution-3886"><a href="#Project.plot_class_distribution-3886"><span class="linenos">3886</span></a>                    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
</span><span id="Project.plot_class_distribution-3887"><a href="#Project.plot_class_distribution-3887"><span class="linenos">3887</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</span><span id="Project.plot_class_distribution-3888"><a href="#Project.plot_class_distribution-3888"><span class="linenos">3888</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Project.plot_class_distribution-3889"><a href="#Project.plot_class_distribution-3889"><span class="linenos">3889</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="Project.plot_class_distribution-3890"><a href="#Project.plot_class_distribution-3890"><span class="linenos">3890</span></a>                    <span class="k">if</span> <span class="n">bouts</span><span class="p">:</span>
</span><span id="Project.plot_class_distribution-3891"><a href="#Project.plot_class_distribution-3891"><span class="linenos">3891</span></a>                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;bouts&quot;</span><span class="p">)</span>
</span><span id="Project.plot_class_distribution-3892"><a href="#Project.plot_class_distribution-3892"><span class="linenos">3892</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_class_distribution-3893"><a href="#Project.plot_class_distribution-3893"><span class="linenos">3893</span></a>                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;frames&quot;</span><span class="p">)</span>
</span><span id="Project.plot_class_distribution-3894"><a href="#Project.plot_class_distribution-3894"><span class="linenos">3894</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Project.plot_class_distribution-3895"><a href="#Project.plot_class_distribution-3895"><span class="linenos">3895</span></a>                    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Project.plot_class_distribution-3896"><a href="#Project.plot_class_distribution-3896"><span class="linenos">3896</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project.plot_class_distribution-3897"><a href="#Project.plot_class_distribution-3897"><span class="linenos">3897</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make a class distribution plot</p>

<p>You can either specify the parameters, choose an existing dataset or do neither (in that case a dataset
is created or laoded for the computation with the default parameters).</p>

<h2 id="parameters">Parameters</h2>

<p>parameters_update : dict, optional
    a dictionary of parameter updates (only for "data" and "general" categories)
remove_saved_features : bool, default False
    if <code>True</code>, the dataset that is used for computation is then deleted</p>
</div>


                            </div>
                            <div id="Project.plot_confusion_matrix" class="classattr">
                                        <input id="Project.plot_confusion_matrix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_confusion_matrix</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;recall&#39;</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;val&#39;</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Project.plot_confusion_matrix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.plot_confusion_matrix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.plot_confusion_matrix-4337"><a href="#Project.plot_confusion_matrix-4337"><span class="linenos">4337</span></a>    <span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span>
</span><span id="Project.plot_confusion_matrix-4338"><a href="#Project.plot_confusion_matrix-4338"><span class="linenos">4338</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4339"><a href="#Project.plot_confusion_matrix-4339"><span class="linenos">4339</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4340"><a href="#Project.plot_confusion_matrix-4340"><span class="linenos">4340</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4341"><a href="#Project.plot_confusion_matrix-4341"><span class="linenos">4341</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4342"><a href="#Project.plot_confusion_matrix-4342"><span class="linenos">4342</span></a>        <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4343"><a href="#Project.plot_confusion_matrix-4343"><span class="linenos">4343</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4344"><a href="#Project.plot_confusion_matrix-4344"><span class="linenos">4344</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4345"><a href="#Project.plot_confusion_matrix-4345"><span class="linenos">4345</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">]:</span>
</span><span id="Project.plot_confusion_matrix-4346"><a href="#Project.plot_confusion_matrix-4346"><span class="linenos">4346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.plot_confusion_matrix-4347"><a href="#Project.plot_confusion_matrix-4347"><span class="linenos">4347</span></a><span class="sd">        Make a confusion matrix plot and return the data</span>
</span><span id="Project.plot_confusion_matrix-4348"><a href="#Project.plot_confusion_matrix-4348"><span class="linenos">4348</span></a>
</span><span id="Project.plot_confusion_matrix-4349"><a href="#Project.plot_confusion_matrix-4349"><span class="linenos">4349</span></a><span class="sd">        If the annotation is non-exclusive, only false positive labels are considered.</span>
</span><span id="Project.plot_confusion_matrix-4350"><a href="#Project.plot_confusion_matrix-4350"><span class="linenos">4350</span></a>
</span><span id="Project.plot_confusion_matrix-4351"><a href="#Project.plot_confusion_matrix-4351"><span class="linenos">4351</span></a><span class="sd">        Parameters</span>
</span><span id="Project.plot_confusion_matrix-4352"><a href="#Project.plot_confusion_matrix-4352"><span class="linenos">4352</span></a><span class="sd">        ----------</span>
</span><span id="Project.plot_confusion_matrix-4353"><a href="#Project.plot_confusion_matrix-4353"><span class="linenos">4353</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project.plot_confusion_matrix-4354"><a href="#Project.plot_confusion_matrix-4354"><span class="linenos">4354</span></a><span class="sd">            the name of the episode to load</span>
</span><span id="Project.plot_confusion_matrix-4355"><a href="#Project.plot_confusion_matrix-4355"><span class="linenos">4355</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="Project.plot_confusion_matrix-4356"><a href="#Project.plot_confusion_matrix-4356"><span class="linenos">4356</span></a><span class="sd">            the index of the epoch to load (by default the last one is loaded)</span>
</span><span id="Project.plot_confusion_matrix-4357"><a href="#Project.plot_confusion_matrix-4357"><span class="linenos">4357</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project.plot_confusion_matrix-4358"><a href="#Project.plot_confusion_matrix-4358"><span class="linenos">4358</span></a><span class="sd">            a dictionary of parameter updates (only for &quot;data&quot; and &quot;general&quot; categories)</span>
</span><span id="Project.plot_confusion_matrix-4359"><a href="#Project.plot_confusion_matrix-4359"><span class="linenos">4359</span></a><span class="sd">        mode : {&#39;val&#39;, &#39;all&#39;, &#39;test&#39;, &#39;train&#39;}</span>
</span><span id="Project.plot_confusion_matrix-4360"><a href="#Project.plot_confusion_matrix-4360"><span class="linenos">4360</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None)</span>
</span><span id="Project.plot_confusion_matrix-4361"><a href="#Project.plot_confusion_matrix-4361"><span class="linenos">4361</span></a><span class="sd">        type : {&quot;recall&quot;, &quot;precision&quot;}</span>
</span><span id="Project.plot_confusion_matrix-4362"><a href="#Project.plot_confusion_matrix-4362"><span class="linenos">4362</span></a><span class="sd">            for datasets with non-exclusive annotation, if `type` is `&quot;recall&quot;`, only false positives are taken</span>
</span><span id="Project.plot_confusion_matrix-4363"><a href="#Project.plot_confusion_matrix-4363"><span class="linenos">4363</span></a><span class="sd">            into account, and if `type` is `&quot;precision&quot;`, only false negatives</span>
</span><span id="Project.plot_confusion_matrix-4364"><a href="#Project.plot_confusion_matrix-4364"><span class="linenos">4364</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project.plot_confusion_matrix-4365"><a href="#Project.plot_confusion_matrix-4365"><span class="linenos">4365</span></a><span class="sd">            if `True`, the dataset that is used for computation is then deleted</span>
</span><span id="Project.plot_confusion_matrix-4366"><a href="#Project.plot_confusion_matrix-4366"><span class="linenos">4366</span></a>
</span><span id="Project.plot_confusion_matrix-4367"><a href="#Project.plot_confusion_matrix-4367"><span class="linenos">4367</span></a><span class="sd">        Returns</span>
</span><span id="Project.plot_confusion_matrix-4368"><a href="#Project.plot_confusion_matrix-4368"><span class="linenos">4368</span></a><span class="sd">        -------</span>
</span><span id="Project.plot_confusion_matrix-4369"><a href="#Project.plot_confusion_matrix-4369"><span class="linenos">4369</span></a><span class="sd">        confusion_matrix : np.ndarray</span>
</span><span id="Project.plot_confusion_matrix-4370"><a href="#Project.plot_confusion_matrix-4370"><span class="linenos">4370</span></a><span class="sd">            a confusion matrix of shape `(#classes, #classes)` where `A[i, j] = F_ij/N_i`, `F_ij` is the number of</span>
</span><span id="Project.plot_confusion_matrix-4371"><a href="#Project.plot_confusion_matrix-4371"><span class="linenos">4371</span></a><span class="sd">            frames that have the i-th label in the ground truth and a false positive j-th label in the prediction,</span>
</span><span id="Project.plot_confusion_matrix-4372"><a href="#Project.plot_confusion_matrix-4372"><span class="linenos">4372</span></a><span class="sd">            `N_i` is the number of frames that have the i-th label in the ground truth</span>
</span><span id="Project.plot_confusion_matrix-4373"><a href="#Project.plot_confusion_matrix-4373"><span class="linenos">4373</span></a><span class="sd">        classes : list</span>
</span><span id="Project.plot_confusion_matrix-4374"><a href="#Project.plot_confusion_matrix-4374"><span class="linenos">4374</span></a><span class="sd">            a list of labels</span>
</span><span id="Project.plot_confusion_matrix-4375"><a href="#Project.plot_confusion_matrix-4375"><span class="linenos">4375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.plot_confusion_matrix-4376"><a href="#Project.plot_confusion_matrix-4376"><span class="linenos">4376</span></a>
</span><span id="Project.plot_confusion_matrix-4377"><a href="#Project.plot_confusion_matrix-4377"><span class="linenos">4377</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project.plot_confusion_matrix-4378"><a href="#Project.plot_confusion_matrix-4378"><span class="linenos">4378</span></a>            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4379"><a href="#Project.plot_confusion_matrix-4379"><span class="linenos">4379</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4380"><a href="#Project.plot_confusion_matrix-4380"><span class="linenos">4380</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4381"><a href="#Project.plot_confusion_matrix-4381"><span class="linenos">4381</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4382"><a href="#Project.plot_confusion_matrix-4382"><span class="linenos">4382</span></a>            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4383"><a href="#Project.plot_confusion_matrix-4383"><span class="linenos">4383</span></a>        <span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4384"><a href="#Project.plot_confusion_matrix-4384"><span class="linenos">4384</span></a>        <span class="n">dataset</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">dataset</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4385"><a href="#Project.plot_confusion_matrix-4385"><span class="linenos">4385</span></a>        <span class="n">prediction</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">raw_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4386"><a href="#Project.plot_confusion_matrix-4386"><span class="linenos">4386</span></a>        <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">get_confusion_matrix</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4387"><a href="#Project.plot_confusion_matrix-4387"><span class="linenos">4387</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project.plot_confusion_matrix-4388"><a href="#Project.plot_confusion_matrix-4388"><span class="linenos">4388</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4389"><a href="#Project.plot_confusion_matrix-4389"><span class="linenos">4389</span></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)))</span>
</span><span id="Project.plot_confusion_matrix-4390"><a href="#Project.plot_confusion_matrix-4390"><span class="linenos">4390</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4391"><a href="#Project.plot_confusion_matrix-4391"><span class="linenos">4391</span></a>        <span class="c1"># Show all ticks and label them with the respective list entries</span>
</span><span id="Project.plot_confusion_matrix-4392"><a href="#Project.plot_confusion_matrix-4392"><span class="linenos">4392</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)))</span>
</span><span id="Project.plot_confusion_matrix-4393"><a href="#Project.plot_confusion_matrix-4393"><span class="linenos">4393</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4394"><a href="#Project.plot_confusion_matrix-4394"><span class="linenos">4394</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)))</span>
</span><span id="Project.plot_confusion_matrix-4395"><a href="#Project.plot_confusion_matrix-4395"><span class="linenos">4395</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4396"><a href="#Project.plot_confusion_matrix-4396"><span class="linenos">4396</span></a>        <span class="c1"># Rotate the tick labels and set their alignment.</span>
</span><span id="Project.plot_confusion_matrix-4397"><a href="#Project.plot_confusion_matrix-4397"><span class="linenos">4397</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4398"><a href="#Project.plot_confusion_matrix-4398"><span class="linenos">4398</span></a>        <span class="c1"># Loop over data dimensions and create text annotations.</span>
</span><span id="Project.plot_confusion_matrix-4399"><a href="#Project.plot_confusion_matrix-4399"><span class="linenos">4399</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
</span><span id="Project.plot_confusion_matrix-4400"><a href="#Project.plot_confusion_matrix-4400"><span class="linenos">4400</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
</span><span id="Project.plot_confusion_matrix-4401"><a href="#Project.plot_confusion_matrix-4401"><span class="linenos">4401</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span id="Project.plot_confusion_matrix-4402"><a href="#Project.plot_confusion_matrix-4402"><span class="linenos">4402</span></a>                    <span class="n">j</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4403"><a href="#Project.plot_confusion_matrix-4403"><span class="linenos">4403</span></a>                    <span class="n">i</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4404"><a href="#Project.plot_confusion_matrix-4404"><span class="linenos">4404</span></a>                    <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Project.plot_confusion_matrix-4405"><a href="#Project.plot_confusion_matrix-4405"><span class="linenos">4405</span></a>                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4406"><a href="#Project.plot_confusion_matrix-4406"><span class="linenos">4406</span></a>                    <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4407"><a href="#Project.plot_confusion_matrix-4407"><span class="linenos">4407</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
</span><span id="Project.plot_confusion_matrix-4408"><a href="#Project.plot_confusion_matrix-4408"><span class="linenos">4408</span></a>                <span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4409"><a href="#Project.plot_confusion_matrix-4409"><span class="linenos">4409</span></a>        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_confusion_matrix-4410"><a href="#Project.plot_confusion_matrix-4410"><span class="linenos">4410</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4411"><a href="#Project.plot_confusion_matrix-4411"><span class="linenos">4411</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.plot_confusion_matrix-4412"><a href="#Project.plot_confusion_matrix-4412"><span class="linenos">4412</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project.plot_confusion_matrix-4413"><a href="#Project.plot_confusion_matrix-4413"><span class="linenos">4413</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="Project.plot_confusion_matrix-4414"><a href="#Project.plot_confusion_matrix-4414"><span class="linenos">4414</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="Project.plot_confusion_matrix-4415"><a href="#Project.plot_confusion_matrix-4415"><span class="linenos">4415</span></a>        <span class="k">return</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classes</span>
</span></pre></div>


            <div class="docstring"><p>Make a confusion matrix plot and return the data</p>

<p>If the annotation is non-exclusive, only false positive labels are considered.</p>

<h2 id="parameters">Parameters</h2>

<p>episode_name : str
    the name of the episode to load
load_epoch : int, optional
    the index of the epoch to load (by default the last one is loaded)
parameters_update : dict, optional
    a dictionary of parameter updates (only for "data" and "general" categories)
mode : {'val', 'all', 'test', 'train'}
    the subset of the data to make the prediction for (forced to 'all' if data_path is not None)
type : {"recall", "precision"}
    for datasets with non-exclusive annotation, if <code>type</code> is <code>"recall"</code>, only false positives are taken
    into account, and if <code>type</code> is <code>"precision"</code>, only false negatives
remove_saved_features : bool, default False
    if <code>True</code>, the dataset that is used for computation is then deleted</p>

<h2 id="returns">Returns</h2>

<p>confusion_matrix : np.ndarray
    a confusion matrix of shape <code>(#classes, #classes)</code> where <code>A[i, j] = F_ij/N_i</code>, <code>F_ij</code> is the number of
    frames that have the i-th label in the ground truth and a false positive j-th label in the prediction,
    <code>N_i</code> is the number of frames that have the i-th label in the ground truth
classes : list
    a list of labels</p>
</div>


                            </div>
                            <div id="Project.plot_predictions" class="classattr">
                                        <input id="Project.plot_predictions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_predictions</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">add_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">ground_truth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">colormap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span>,</span><span class="param">	<span class="n">hide_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">min_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span>,</span><span class="param">	<span class="n">whole_video</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">transparent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">drop_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">search_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">num_plots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">smooth_interval_prediction</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;val&#39;</span>,</span><span class="param">	<span class="n">behavior_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.plot_predictions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.plot_predictions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.plot_predictions-4417"><a href="#Project.plot_predictions-4417"><span class="linenos">4417</span></a>    <span class="k">def</span> <span class="nf">plot_predictions</span><span class="p">(</span>
</span><span id="Project.plot_predictions-4418"><a href="#Project.plot_predictions-4418"><span class="linenos">4418</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4419"><a href="#Project.plot_predictions-4419"><span class="linenos">4419</span></a>        <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4420"><a href="#Project.plot_predictions-4420"><span class="linenos">4420</span></a>        <span class="n">load_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4421"><a href="#Project.plot_predictions-4421"><span class="linenos">4421</span></a>        <span class="n">parameters_update</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4422"><a href="#Project.plot_predictions-4422"><span class="linenos">4422</span></a>        <span class="n">add_legend</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4423"><a href="#Project.plot_predictions-4423"><span class="linenos">4423</span></a>        <span class="n">ground_truth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4424"><a href="#Project.plot_predictions-4424"><span class="linenos">4424</span></a>        <span class="n">colormap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4425"><a href="#Project.plot_predictions-4425"><span class="linenos">4425</span></a>        <span class="n">hide_axes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4426"><a href="#Project.plot_predictions-4426"><span class="linenos">4426</span></a>        <span class="n">min_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4427"><a href="#Project.plot_predictions-4427"><span class="linenos">4427</span></a>        <span class="n">width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4428"><a href="#Project.plot_predictions-4428"><span class="linenos">4428</span></a>        <span class="n">whole_video</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4429"><a href="#Project.plot_predictions-4429"><span class="linenos">4429</span></a>        <span class="n">transparent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4430"><a href="#Project.plot_predictions-4430"><span class="linenos">4430</span></a>        <span class="n">drop_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4431"><a href="#Project.plot_predictions-4431"><span class="linenos">4431</span></a>        <span class="n">search_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4432"><a href="#Project.plot_predictions-4432"><span class="linenos">4432</span></a>        <span class="n">num_plots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4433"><a href="#Project.plot_predictions-4433"><span class="linenos">4433</span></a>        <span class="n">remove_saved_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4434"><a href="#Project.plot_predictions-4434"><span class="linenos">4434</span></a>        <span class="n">smooth_interval_prediction</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4435"><a href="#Project.plot_predictions-4435"><span class="linenos">4435</span></a>        <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4436"><a href="#Project.plot_predictions-4436"><span class="linenos">4436</span></a>        <span class="n">file_paths</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4437"><a href="#Project.plot_predictions-4437"><span class="linenos">4437</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4438"><a href="#Project.plot_predictions-4438"><span class="linenos">4438</span></a>        <span class="n">behavior_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4439"><a href="#Project.plot_predictions-4439"><span class="linenos">4439</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.plot_predictions-4440"><a href="#Project.plot_predictions-4440"><span class="linenos">4440</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.plot_predictions-4441"><a href="#Project.plot_predictions-4441"><span class="linenos">4441</span></a><span class="sd">        Visualize random predictions</span>
</span><span id="Project.plot_predictions-4442"><a href="#Project.plot_predictions-4442"><span class="linenos">4442</span></a>
</span><span id="Project.plot_predictions-4443"><a href="#Project.plot_predictions-4443"><span class="linenos">4443</span></a><span class="sd">        Parameters</span>
</span><span id="Project.plot_predictions-4444"><a href="#Project.plot_predictions-4444"><span class="linenos">4444</span></a><span class="sd">        ----------</span>
</span><span id="Project.plot_predictions-4445"><a href="#Project.plot_predictions-4445"><span class="linenos">4445</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project.plot_predictions-4446"><a href="#Project.plot_predictions-4446"><span class="linenos">4446</span></a><span class="sd">            the name of the episode to load</span>
</span><span id="Project.plot_predictions-4447"><a href="#Project.plot_predictions-4447"><span class="linenos">4447</span></a><span class="sd">        load_epoch : int, optional</span>
</span><span id="Project.plot_predictions-4448"><a href="#Project.plot_predictions-4448"><span class="linenos">4448</span></a><span class="sd">            the epoch to load (by default last)</span>
</span><span id="Project.plot_predictions-4449"><a href="#Project.plot_predictions-4449"><span class="linenos">4449</span></a><span class="sd">        parameters_update : dict, optional</span>
</span><span id="Project.plot_predictions-4450"><a href="#Project.plot_predictions-4450"><span class="linenos">4450</span></a><span class="sd">            parameter update dictionary</span>
</span><span id="Project.plot_predictions-4451"><a href="#Project.plot_predictions-4451"><span class="linenos">4451</span></a><span class="sd">        add_legend : bool, default True</span>
</span><span id="Project.plot_predictions-4452"><a href="#Project.plot_predictions-4452"><span class="linenos">4452</span></a><span class="sd">            if True, legend will be added to the plot</span>
</span><span id="Project.plot_predictions-4453"><a href="#Project.plot_predictions-4453"><span class="linenos">4453</span></a><span class="sd">        ground_truth : bool, default True</span>
</span><span id="Project.plot_predictions-4454"><a href="#Project.plot_predictions-4454"><span class="linenos">4454</span></a><span class="sd">            if True, ground truth will be added to the plot</span>
</span><span id="Project.plot_predictions-4455"><a href="#Project.plot_predictions-4455"><span class="linenos">4455</span></a><span class="sd">        colormap : str, default &#39;Accent&#39;</span>
</span><span id="Project.plot_predictions-4456"><a href="#Project.plot_predictions-4456"><span class="linenos">4456</span></a><span class="sd">            the `matplotlib` colormap to use</span>
</span><span id="Project.plot_predictions-4457"><a href="#Project.plot_predictions-4457"><span class="linenos">4457</span></a><span class="sd">        hide_axes : bool, default True</span>
</span><span id="Project.plot_predictions-4458"><a href="#Project.plot_predictions-4458"><span class="linenos">4458</span></a><span class="sd">            if `True`, the axes will be hidden on the plot</span>
</span><span id="Project.plot_predictions-4459"><a href="#Project.plot_predictions-4459"><span class="linenos">4459</span></a><span class="sd">        min_classes : int, default 1</span>
</span><span id="Project.plot_predictions-4460"><a href="#Project.plot_predictions-4460"><span class="linenos">4460</span></a><span class="sd">            the minimum number of classes in a displayed interval</span>
</span><span id="Project.plot_predictions-4461"><a href="#Project.plot_predictions-4461"><span class="linenos">4461</span></a><span class="sd">        width : float, default 10</span>
</span><span id="Project.plot_predictions-4462"><a href="#Project.plot_predictions-4462"><span class="linenos">4462</span></a><span class="sd">            the width of the plot</span>
</span><span id="Project.plot_predictions-4463"><a href="#Project.plot_predictions-4463"><span class="linenos">4463</span></a><span class="sd">        whole_video : bool, default False</span>
</span><span id="Project.plot_predictions-4464"><a href="#Project.plot_predictions-4464"><span class="linenos">4464</span></a><span class="sd">            if `True`, whole videos are plotted instead of segments</span>
</span><span id="Project.plot_predictions-4465"><a href="#Project.plot_predictions-4465"><span class="linenos">4465</span></a><span class="sd">        transparent : bool, default False</span>
</span><span id="Project.plot_predictions-4466"><a href="#Project.plot_predictions-4466"><span class="linenos">4466</span></a><span class="sd">            if `True`, the background on the plot is transparent</span>
</span><span id="Project.plot_predictions-4467"><a href="#Project.plot_predictions-4467"><span class="linenos">4467</span></a><span class="sd">        drop_classes : set, optional</span>
</span><span id="Project.plot_predictions-4468"><a href="#Project.plot_predictions-4468"><span class="linenos">4468</span></a><span class="sd">            a set of class names to not be displayed</span>
</span><span id="Project.plot_predictions-4469"><a href="#Project.plot_predictions-4469"><span class="linenos">4469</span></a><span class="sd">        search_classes : set, optional</span>
</span><span id="Project.plot_predictions-4470"><a href="#Project.plot_predictions-4470"><span class="linenos">4470</span></a><span class="sd">            if given, only intervals where at least one of the classes is in ground truth will be shown</span>
</span><span id="Project.plot_predictions-4471"><a href="#Project.plot_predictions-4471"><span class="linenos">4471</span></a><span class="sd">        num_plots : int, default 1</span>
</span><span id="Project.plot_predictions-4472"><a href="#Project.plot_predictions-4472"><span class="linenos">4472</span></a><span class="sd">            the number of plots to make</span>
</span><span id="Project.plot_predictions-4473"><a href="#Project.plot_predictions-4473"><span class="linenos">4473</span></a><span class="sd">        remove_saved_features : bool, default False</span>
</span><span id="Project.plot_predictions-4474"><a href="#Project.plot_predictions-4474"><span class="linenos">4474</span></a><span class="sd">            if `True`, the dataset will be deleted after computation</span>
</span><span id="Project.plot_predictions-4475"><a href="#Project.plot_predictions-4475"><span class="linenos">4475</span></a><span class="sd">        smooth_interval_prediction : int, default 0</span>
</span><span id="Project.plot_predictions-4476"><a href="#Project.plot_predictions-4476"><span class="linenos">4476</span></a><span class="sd">            if &gt;0, predictions shorter than this number of frames are removed (filled with prediction for the previous frame)</span>
</span><span id="Project.plot_predictions-4477"><a href="#Project.plot_predictions-4477"><span class="linenos">4477</span></a><span class="sd">        data_path : str, optional</span>
</span><span id="Project.plot_predictions-4478"><a href="#Project.plot_predictions-4478"><span class="linenos">4478</span></a><span class="sd">            the data path to run the prediction for</span>
</span><span id="Project.plot_predictions-4479"><a href="#Project.plot_predictions-4479"><span class="linenos">4479</span></a><span class="sd">        mode : {&#39;all&#39;, &#39;test&#39;, &#39;val&#39;, &#39;train&#39;}</span>
</span><span id="Project.plot_predictions-4480"><a href="#Project.plot_predictions-4480"><span class="linenos">4480</span></a><span class="sd">            the subset of the data to make the prediction for (forced to &#39;all&#39; if data_path is not None)</span>
</span><span id="Project.plot_predictions-4481"><a href="#Project.plot_predictions-4481"><span class="linenos">4481</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="Project.plot_predictions-4482"><a href="#Project.plot_predictions-4482"><span class="linenos">4482</span></a><span class="sd">            a set of string file paths (data with all prefixes + feature files, in any order) to run the prediction</span>
</span><span id="Project.plot_predictions-4483"><a href="#Project.plot_predictions-4483"><span class="linenos">4483</span></a><span class="sd">            for</span>
</span><span id="Project.plot_predictions-4484"><a href="#Project.plot_predictions-4484"><span class="linenos">4484</span></a><span class="sd">        behavior_name : str, optional</span>
</span><span id="Project.plot_predictions-4485"><a href="#Project.plot_predictions-4485"><span class="linenos">4485</span></a><span class="sd">            for non-exclusive classificaton datasets, choose which behavior to visualize (by default first in list)</span>
</span><span id="Project.plot_predictions-4486"><a href="#Project.plot_predictions-4486"><span class="linenos">4486</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.plot_predictions-4487"><a href="#Project.plot_predictions-4487"><span class="linenos">4487</span></a>
</span><span id="Project.plot_predictions-4488"><a href="#Project.plot_predictions-4488"><span class="linenos">4488</span></a>        <span class="n">other_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">)</span>
</span><span id="Project.plot_predictions-4489"><a href="#Project.plot_predictions-4489"><span class="linenos">4489</span></a>        <span class="n">task</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_task_prediction</span><span class="p">(</span>
</span><span id="Project.plot_predictions-4490"><a href="#Project.plot_predictions-4490"><span class="linenos">4490</span></a>            <span class="s2">&quot;_&quot;</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4491"><a href="#Project.plot_predictions-4491"><span class="linenos">4491</span></a>            <span class="n">load_episode</span><span class="o">=</span><span class="n">episode_name</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4492"><a href="#Project.plot_predictions-4492"><span class="linenos">4492</span></a>            <span class="n">parameters_update</span><span class="o">=</span><span class="n">parameters_update</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4493"><a href="#Project.plot_predictions-4493"><span class="linenos">4493</span></a>            <span class="n">load_epoch</span><span class="o">=</span><span class="n">load_epoch</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4494"><a href="#Project.plot_predictions-4494"><span class="linenos">4494</span></a>            <span class="n">data_path</span><span class="o">=</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4495"><a href="#Project.plot_predictions-4495"><span class="linenos">4495</span></a>            <span class="n">file_paths</span><span class="o">=</span><span class="n">file_paths</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4496"><a href="#Project.plot_predictions-4496"><span class="linenos">4496</span></a>            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4497"><a href="#Project.plot_predictions-4497"><span class="linenos">4497</span></a>        <span class="p">)</span>
</span><span id="Project.plot_predictions-4498"><a href="#Project.plot_predictions-4498"><span class="linenos">4498</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">other_path</span><span class="p">):</span>
</span><span id="Project.plot_predictions-4499"><a href="#Project.plot_predictions-4499"><span class="linenos">4499</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">other_path</span><span class="p">)</span>
</span><span id="Project.plot_predictions-4500"><a href="#Project.plot_predictions-4500"><span class="linenos">4500</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_plots</span><span class="p">):</span>
</span><span id="Project.plot_predictions-4501"><a href="#Project.plot_predictions-4501"><span class="linenos">4501</span></a>            <span class="n">task</span><span class="o">.</span><span class="n">visualize_results</span><span class="p">(</span>
</span><span id="Project.plot_predictions-4502"><a href="#Project.plot_predictions-4502"><span class="linenos">4502</span></a>                <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.plot_predictions-4503"><a href="#Project.plot_predictions-4503"><span class="linenos">4503</span></a>                    <span class="n">other_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">_prediction_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.jpg&quot;</span>
</span><span id="Project.plot_predictions-4504"><a href="#Project.plot_predictions-4504"><span class="linenos">4504</span></a>                <span class="p">),</span>
</span><span id="Project.plot_predictions-4505"><a href="#Project.plot_predictions-4505"><span class="linenos">4505</span></a>                <span class="n">add_legend</span><span class="o">=</span><span class="n">add_legend</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4506"><a href="#Project.plot_predictions-4506"><span class="linenos">4506</span></a>                <span class="n">ground_truth</span><span class="o">=</span><span class="n">ground_truth</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4507"><a href="#Project.plot_predictions-4507"><span class="linenos">4507</span></a>                <span class="n">colormap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4508"><a href="#Project.plot_predictions-4508"><span class="linenos">4508</span></a>                <span class="n">hide_axes</span><span class="o">=</span><span class="n">hide_axes</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4509"><a href="#Project.plot_predictions-4509"><span class="linenos">4509</span></a>                <span class="n">min_classes</span><span class="o">=</span><span class="n">min_classes</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4510"><a href="#Project.plot_predictions-4510"><span class="linenos">4510</span></a>                <span class="n">whole_video</span><span class="o">=</span><span class="n">whole_video</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4511"><a href="#Project.plot_predictions-4511"><span class="linenos">4511</span></a>                <span class="n">transparent</span><span class="o">=</span><span class="n">transparent</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4512"><a href="#Project.plot_predictions-4512"><span class="linenos">4512</span></a>                <span class="n">dataset</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4513"><a href="#Project.plot_predictions-4513"><span class="linenos">4513</span></a>                <span class="n">drop_classes</span><span class="o">=</span><span class="n">drop_classes</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4514"><a href="#Project.plot_predictions-4514"><span class="linenos">4514</span></a>                <span class="n">search_classes</span><span class="o">=</span><span class="n">search_classes</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4515"><a href="#Project.plot_predictions-4515"><span class="linenos">4515</span></a>                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4516"><a href="#Project.plot_predictions-4516"><span class="linenos">4516</span></a>                <span class="n">smooth_interval_prediction</span><span class="o">=</span><span class="n">smooth_interval_prediction</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4517"><a href="#Project.plot_predictions-4517"><span class="linenos">4517</span></a>                <span class="n">behavior_name</span><span class="o">=</span><span class="n">behavior_name</span><span class="p">,</span>
</span><span id="Project.plot_predictions-4518"><a href="#Project.plot_predictions-4518"><span class="linenos">4518</span></a>            <span class="p">)</span>
</span><span id="Project.plot_predictions-4519"><a href="#Project.plot_predictions-4519"><span class="linenos">4519</span></a>        <span class="k">if</span> <span class="n">remove_saved_features</span><span class="p">:</span>
</span><span id="Project.plot_predictions-4520"><a href="#Project.plot_predictions-4520"><span class="linenos">4520</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_remove_stores</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Visualize random predictions</p>

<h2 id="parameters">Parameters</h2>

<p>episode_name : str
    the name of the episode to load
load_epoch : int, optional
    the epoch to load (by default last)
parameters_update : dict, optional
    parameter update dictionary
add_legend : bool, default True
    if True, legend will be added to the plot
ground_truth : bool, default True
    if True, ground truth will be added to the plot
colormap : str, default 'Accent'
    the <code>matplotlib</code> colormap to use
hide_axes : bool, default True
    if <code>True</code>, the axes will be hidden on the plot
min_classes : int, default 1
    the minimum number of classes in a displayed interval
width : float, default 10
    the width of the plot
whole_video : bool, default False
    if <code>True</code>, whole videos are plotted instead of segments
transparent : bool, default False
    if <code>True</code>, the background on the plot is transparent
drop_classes : set, optional
    a set of class names to not be displayed
search_classes : set, optional
    if given, only intervals where at least one of the classes is in ground truth will be shown
num_plots : int, default 1
    the number of plots to make
remove_saved_features : bool, default False
    if <code>True</code>, the dataset will be deleted after computation
smooth_interval_prediction : int, default 0
    if &gt;0, predictions shorter than this number of frames are removed (filled with prediction for the previous frame)
data_path : str, optional
    the data path to run the prediction for
mode : {'all', 'test', 'val', 'train'}
    the subset of the data to make the prediction for (forced to 'all' if data_path is not None)
file_paths : set, optional
    a set of string file paths (data with all prefixes + feature files, in any order) to run the prediction
    for
behavior_name : str, optional
    for non-exclusive classificaton datasets, choose which behavior to visualize (by default first in list)</p>
</div>


                            </div>
                            <div id="Project.create_metadata_backup" class="classattr">
                                        <input id="Project.create_metadata_backup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_metadata_backup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.create_metadata_backup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.create_metadata_backup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.create_metadata_backup-4522"><a href="#Project.create_metadata_backup-4522"><span class="linenos">4522</span></a>    <span class="k">def</span> <span class="nf">create_metadata_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.create_metadata_backup-4523"><a href="#Project.create_metadata_backup-4523"><span class="linenos">4523</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.create_metadata_backup-4524"><a href="#Project.create_metadata_backup-4524"><span class="linenos">4524</span></a><span class="sd">        Create a copy of the meta files</span>
</span><span id="Project.create_metadata_backup-4525"><a href="#Project.create_metadata_backup-4525"><span class="linenos">4525</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.create_metadata_backup-4526"><a href="#Project.create_metadata_backup-4526"><span class="linenos">4526</span></a>
</span><span id="Project.create_metadata_backup-4527"><a href="#Project.create_metadata_backup-4527"><span class="linenos">4527</span></a>        <span class="n">meta_copy_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;backup&quot;</span><span class="p">)</span>
</span><span id="Project.create_metadata_backup-4528"><a href="#Project.create_metadata_backup-4528"><span class="linenos">4528</span></a>        <span class="n">meta_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">)</span>
</span><span id="Project.create_metadata_backup-4529"><a href="#Project.create_metadata_backup-4529"><span class="linenos">4529</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">):</span>
</span><span id="Project.create_metadata_backup-4530"><a href="#Project.create_metadata_backup-4530"><span class="linenos">4530</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">)</span>
</span><span id="Project.create_metadata_backup-4531"><a href="#Project.create_metadata_backup-4531"><span class="linenos">4531</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">)</span>
</span><span id="Project.create_metadata_backup-4532"><a href="#Project.create_metadata_backup-4532"><span class="linenos">4532</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">meta_path</span><span class="p">):</span>
</span><span id="Project.create_metadata_backup-4533"><a href="#Project.create_metadata_backup-4533"><span class="linenos">4533</span></a>            <span class="k">if</span> <span class="n">file</span> <span class="o">==</span> <span class="s2">&quot;backup&quot;</span><span class="p">:</span>
</span><span id="Project.create_metadata_backup-4534"><a href="#Project.create_metadata_backup-4534"><span class="linenos">4534</span></a>                <span class="k">continue</span>
</span><span id="Project.create_metadata_backup-4535"><a href="#Project.create_metadata_backup-4535"><span class="linenos">4535</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="Project.create_metadata_backup-4536"><a href="#Project.create_metadata_backup-4536"><span class="linenos">4536</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="Project.create_metadata_backup-4537"><a href="#Project.create_metadata_backup-4537"><span class="linenos">4537</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a copy of the meta files</p>
</div>


                            </div>
                            <div id="Project.load_metadata_backup" class="classattr">
                                        <input id="Project.load_metadata_backup-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_metadata_backup</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.load_metadata_backup-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.load_metadata_backup"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.load_metadata_backup-4539"><a href="#Project.load_metadata_backup-4539"><span class="linenos">4539</span></a>    <span class="k">def</span> <span class="nf">load_metadata_backup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.load_metadata_backup-4540"><a href="#Project.load_metadata_backup-4540"><span class="linenos">4540</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.load_metadata_backup-4541"><a href="#Project.load_metadata_backup-4541"><span class="linenos">4541</span></a><span class="sd">        Load from previously created meta data backup (in case of corruption)</span>
</span><span id="Project.load_metadata_backup-4542"><a href="#Project.load_metadata_backup-4542"><span class="linenos">4542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.load_metadata_backup-4543"><a href="#Project.load_metadata_backup-4543"><span class="linenos">4543</span></a>
</span><span id="Project.load_metadata_backup-4544"><a href="#Project.load_metadata_backup-4544"><span class="linenos">4544</span></a>        <span class="n">meta_copy_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">,</span> <span class="s2">&quot;backup&quot;</span><span class="p">)</span>
</span><span id="Project.load_metadata_backup-4545"><a href="#Project.load_metadata_backup-4545"><span class="linenos">4545</span></a>        <span class="n">meta_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">)</span>
</span><span id="Project.load_metadata_backup-4546"><a href="#Project.load_metadata_backup-4546"><span class="linenos">4546</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">):</span>
</span><span id="Project.load_metadata_backup-4547"><a href="#Project.load_metadata_backup-4547"><span class="linenos">4547</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="Project.load_metadata_backup-4548"><a href="#Project.load_metadata_backup-4548"><span class="linenos">4548</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_copy_path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">meta_path</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="Project.load_metadata_backup-4549"><a href="#Project.load_metadata_backup-4549"><span class="linenos">4549</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load from previously created meta data backup (in case of corruption)</p>
</div>


                            </div>
                            <div id="Project.get_behavior_dictionary" class="classattr">
                                        <input id="Project.get_behavior_dictionary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_behavior_dictionary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="Project.get_behavior_dictionary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.get_behavior_dictionary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.get_behavior_dictionary-4551"><a href="#Project.get_behavior_dictionary-4551"><span class="linenos">4551</span></a>    <span class="k">def</span> <span class="nf">get_behavior_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="Project.get_behavior_dictionary-4552"><a href="#Project.get_behavior_dictionary-4552"><span class="linenos">4552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.get_behavior_dictionary-4553"><a href="#Project.get_behavior_dictionary-4553"><span class="linenos">4553</span></a><span class="sd">        Get the behavior dictionary for an episode</span>
</span><span id="Project.get_behavior_dictionary-4554"><a href="#Project.get_behavior_dictionary-4554"><span class="linenos">4554</span></a>
</span><span id="Project.get_behavior_dictionary-4555"><a href="#Project.get_behavior_dictionary-4555"><span class="linenos">4555</span></a><span class="sd">        Parameters</span>
</span><span id="Project.get_behavior_dictionary-4556"><a href="#Project.get_behavior_dictionary-4556"><span class="linenos">4556</span></a><span class="sd">        ----------</span>
</span><span id="Project.get_behavior_dictionary-4557"><a href="#Project.get_behavior_dictionary-4557"><span class="linenos">4557</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project.get_behavior_dictionary-4558"><a href="#Project.get_behavior_dictionary-4558"><span class="linenos">4558</span></a><span class="sd">            the name of the episode</span>
</span><span id="Project.get_behavior_dictionary-4559"><a href="#Project.get_behavior_dictionary-4559"><span class="linenos">4559</span></a>
</span><span id="Project.get_behavior_dictionary-4560"><a href="#Project.get_behavior_dictionary-4560"><span class="linenos">4560</span></a><span class="sd">        Returns</span>
</span><span id="Project.get_behavior_dictionary-4561"><a href="#Project.get_behavior_dictionary-4561"><span class="linenos">4561</span></a><span class="sd">        -------</span>
</span><span id="Project.get_behavior_dictionary-4562"><a href="#Project.get_behavior_dictionary-4562"><span class="linenos">4562</span></a><span class="sd">        behaviors_dictionary : dict</span>
</span><span id="Project.get_behavior_dictionary-4563"><a href="#Project.get_behavior_dictionary-4563"><span class="linenos">4563</span></a><span class="sd">            a dictionary where keys are label indices and values are label names</span>
</span><span id="Project.get_behavior_dictionary-4564"><a href="#Project.get_behavior_dictionary-4564"><span class="linenos">4564</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.get_behavior_dictionary-4565"><a href="#Project.get_behavior_dictionary-4565"><span class="linenos">4565</span></a>
</span><span id="Project.get_behavior_dictionary-4566"><a href="#Project.get_behavior_dictionary-4566"><span class="linenos">4566</span></a>        <span class="n">run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Project.get_behavior_dictionary-4567"><a href="#Project.get_behavior_dictionary-4567"><span class="linenos">4567</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode</span><span class="p">(</span><span class="n">run</span><span class="p">)</span><span class="o">.</span><span class="n">get_behaviors_dict</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Get the behavior dictionary for an episode</p>

<h2 id="parameters">Parameters</h2>

<p>episode_name : str
    the name of the episode</p>

<h2 id="returns">Returns</h2>

<p>behaviors_dictionary : dict
    a dictionary where keys are label indices and values are label names</p>
</div>


                            </div>
                            <div id="Project.import_episodes" class="classattr">
                                        <input id="Project.import_episodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">import_episodes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episodes_directory</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">name_map</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">repeat_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.import_episodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.import_episodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.import_episodes-4569"><a href="#Project.import_episodes-4569"><span class="linenos">4569</span></a>    <span class="k">def</span> <span class="nf">import_episodes</span><span class="p">(</span>
</span><span id="Project.import_episodes-4570"><a href="#Project.import_episodes-4570"><span class="linenos">4570</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.import_episodes-4571"><a href="#Project.import_episodes-4571"><span class="linenos">4571</span></a>        <span class="n">episodes_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Project.import_episodes-4572"><a href="#Project.import_episodes-4572"><span class="linenos">4572</span></a>        <span class="n">name_map</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.import_episodes-4573"><a href="#Project.import_episodes-4573"><span class="linenos">4573</span></a>        <span class="n">repeat_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="Project.import_episodes-4574"><a href="#Project.import_episodes-4574"><span class="linenos">4574</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.import_episodes-4575"><a href="#Project.import_episodes-4575"><span class="linenos">4575</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.import_episodes-4576"><a href="#Project.import_episodes-4576"><span class="linenos">4576</span></a><span class="sd">        Import episodes exported with `Project.export_episodes`</span>
</span><span id="Project.import_episodes-4577"><a href="#Project.import_episodes-4577"><span class="linenos">4577</span></a>
</span><span id="Project.import_episodes-4578"><a href="#Project.import_episodes-4578"><span class="linenos">4578</span></a><span class="sd">        Parameters</span>
</span><span id="Project.import_episodes-4579"><a href="#Project.import_episodes-4579"><span class="linenos">4579</span></a><span class="sd">        ----------</span>
</span><span id="Project.import_episodes-4580"><a href="#Project.import_episodes-4580"><span class="linenos">4580</span></a><span class="sd">        episodes_directory : str</span>
</span><span id="Project.import_episodes-4581"><a href="#Project.import_episodes-4581"><span class="linenos">4581</span></a><span class="sd">            the path to the exported episodes directory</span>
</span><span id="Project.import_episodes-4582"><a href="#Project.import_episodes-4582"><span class="linenos">4582</span></a><span class="sd">        name_map : dict</span>
</span><span id="Project.import_episodes-4583"><a href="#Project.import_episodes-4583"><span class="linenos">4583</span></a><span class="sd">            a name change dictionary for the episodes: keys are old names, values are new names</span>
</span><span id="Project.import_episodes-4584"><a href="#Project.import_episodes-4584"><span class="linenos">4584</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.import_episodes-4585"><a href="#Project.import_episodes-4585"><span class="linenos">4585</span></a>
</span><span id="Project.import_episodes-4586"><a href="#Project.import_episodes-4586"><span class="linenos">4586</span></a>        <span class="k">if</span> <span class="n">name_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.import_episodes-4587"><a href="#Project.import_episodes-4587"><span class="linenos">4587</span></a>            <span class="n">name_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project.import_episodes-4588"><a href="#Project.import_episodes-4588"><span class="linenos">4588</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">episodes_directory</span><span class="p">,</span> <span class="s2">&quot;episodes.pickle&quot;</span><span class="p">))</span>
</span><span id="Project.import_episodes-4589"><a href="#Project.import_episodes-4589"><span class="linenos">4589</span></a>        <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.import_episodes-4590"><a href="#Project.import_episodes-4590"><span class="linenos">4590</span></a>        <span class="n">import_string</span> <span class="o">=</span> <span class="s2">&quot;Imported episodes: &quot;</span>
</span><span id="Project.import_episodes-4591"><a href="#Project.import_episodes-4591"><span class="linenos">4591</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="Project.import_episodes-4592"><a href="#Project.import_episodes-4592"><span class="linenos">4592</span></a>            <span class="k">if</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">name_map</span><span class="p">:</span>
</span><span id="Project.import_episodes-4593"><a href="#Project.import_episodes-4593"><span class="linenos">4593</span></a>                <span class="n">import_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="Project.import_episodes-4594"><a href="#Project.import_episodes-4594"><span class="linenos">4594</span></a>                <span class="n">episode_name</span> <span class="o">=</span> <span class="n">name_map</span><span class="p">[</span><span class="n">episode_name</span><span class="p">]</span>
</span><span id="Project.import_episodes-4595"><a href="#Project.import_episodes-4595"><span class="linenos">4595</span></a>                <span class="n">import_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">), &quot;</span>
</span><span id="Project.import_episodes-4596"><a href="#Project.import_episodes-4596"><span class="linenos">4596</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project.import_episodes-4597"><a href="#Project.import_episodes-4597"><span class="linenos">4597</span></a>                <span class="n">import_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="Project.import_episodes-4598"><a href="#Project.import_episodes-4598"><span class="linenos">4598</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Project.import_episodes-4599"><a href="#Project.import_episodes-4599"><span class="linenos">4599</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_check_episode_validity</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">allow_doublecolon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Project.import_episodes-4600"><a href="#Project.import_episodes-4600"><span class="linenos">4600</span></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Project.import_episodes-4601"><a href="#Project.import_episodes-4601"><span class="linenos">4601</span></a>                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;is already taken!&quot;</span><span class="p">):</span>
</span><span id="Project.import_episodes-4602"><a href="#Project.import_episodes-4602"><span class="linenos">4602</span></a>                    <span class="k">if</span> <span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;skip&quot;</span><span class="p">:</span>
</span><span id="Project.import_episodes-4603"><a href="#Project.import_episodes-4603"><span class="linenos">4603</span></a>                        <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project.import_episodes-4604"><a href="#Project.import_episodes-4604"><span class="linenos">4604</span></a>                    <span class="k">elif</span> <span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;force&quot;</span><span class="p">:</span>
</span><span id="Project.import_episodes-4605"><a href="#Project.import_episodes-4605"><span class="linenos">4605</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">remove_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project.import_episodes-4606"><a href="#Project.import_episodes-4606"><span class="linenos">4606</span></a>                    <span class="k">elif</span> <span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
</span><span id="Project.import_episodes-4607"><a href="#Project.import_episodes-4607"><span class="linenos">4607</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.import_episodes-4608"><a href="#Project.import_episodes-4608"><span class="linenos">4608</span></a>                            <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2"> episode name is already taken; please use the name_map parameter to rename it&quot;</span>
</span><span id="Project.import_episodes-4609"><a href="#Project.import_episodes-4609"><span class="linenos">4609</span></a>                        <span class="p">)</span>
</span><span id="Project.import_episodes-4610"><a href="#Project.import_episodes-4610"><span class="linenos">4610</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project.import_episodes-4611"><a href="#Project.import_episodes-4611"><span class="linenos">4611</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Project.import_episodes-4612"><a href="#Project.import_episodes-4612"><span class="linenos">4612</span></a>                            <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">repeat_policy</span><span class="si">}</span><span class="s2"> repeat policy is not recognized; please choose from [&#39;skip&#39;, &#39;force&#39; ans &#39;error&#39;]&quot;</span>
</span><span id="Project.import_episodes-4613"><a href="#Project.import_episodes-4613"><span class="linenos">4613</span></a>                        <span class="p">)</span>
</span><span id="Project.import_episodes-4614"><a href="#Project.import_episodes-4614"><span class="linenos">4614</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="n">episodes</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">to_remove</span><span class="p">)</span>
</span><span id="Project.import_episodes-4615"><a href="#Project.import_episodes-4615"><span class="linenos">4615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="Project.import_episodes-4616"><a href="#Project.import_episodes-4616"><span class="linenos">4616</span></a>            <span class="n">episodes</span><span class="p">,</span>
</span><span id="Project.import_episodes-4617"><a href="#Project.import_episodes-4617"><span class="linenos">4617</span></a>            <span class="n">name_map</span><span class="o">=</span><span class="n">name_map</span><span class="p">,</span>
</span><span id="Project.import_episodes-4618"><a href="#Project.import_episodes-4618"><span class="linenos">4618</span></a>            <span class="n">force</span><span class="o">=</span><span class="p">(</span><span class="n">repeat_policy</span> <span class="o">==</span> <span class="s2">&quot;force&quot;</span><span class="p">),</span>
</span><span id="Project.import_episodes-4619"><a href="#Project.import_episodes-4619"><span class="linenos">4619</span></a>            <span class="n">data_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="p">,</span>
</span><span id="Project.import_episodes-4620"><a href="#Project.import_episodes-4620"><span class="linenos">4620</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="Project.import_episodes-4621"><a href="#Project.import_episodes-4621"><span class="linenos">4621</span></a>        <span class="p">)</span>
</span><span id="Project.import_episodes-4622"><a href="#Project.import_episodes-4622"><span class="linenos">4622</span></a>        <span class="k">for</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
</span><span id="Project.import_episodes-4623"><a href="#Project.import_episodes-4623"><span class="linenos">4623</span></a>            <span class="k">if</span> <span class="n">episode_name</span> <span class="ow">in</span> <span class="n">name_map</span><span class="p">:</span>
</span><span id="Project.import_episodes-4624"><a href="#Project.import_episodes-4624"><span class="linenos">4624</span></a>                <span class="n">new_episode_name</span> <span class="o">=</span> <span class="n">name_map</span><span class="p">[</span><span class="n">episode_name</span><span class="p">]</span>
</span><span id="Project.import_episodes-4625"><a href="#Project.import_episodes-4625"><span class="linenos">4625</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Project.import_episodes-4626"><a href="#Project.import_episodes-4626"><span class="linenos">4626</span></a>                <span class="n">new_episode_name</span> <span class="o">=</span> <span class="n">episode_name</span>
</span><span id="Project.import_episodes-4627"><a href="#Project.import_episodes-4627"><span class="linenos">4627</span></a>            <span class="n">model_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.import_episodes-4628"><a href="#Project.import_episodes-4628"><span class="linenos">4628</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">new_episode_name</span>
</span><span id="Project.import_episodes-4629"><a href="#Project.import_episodes-4629"><span class="linenos">4629</span></a>            <span class="p">)</span>
</span><span id="Project.import_episodes-4630"><a href="#Project.import_episodes-4630"><span class="linenos">4630</span></a>            <span class="n">old_model_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">episodes_directory</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">)</span>
</span><span id="Project.import_episodes-4631"><a href="#Project.import_episodes-4631"><span class="linenos">4631</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_dir</span><span class="p">):</span>
</span><span id="Project.import_episodes-4632"><a href="#Project.import_episodes-4632"><span class="linenos">4632</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
</span><span id="Project.import_episodes-4633"><a href="#Project.import_episodes-4633"><span class="linenos">4633</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
</span><span id="Project.import_episodes-4634"><a href="#Project.import_episodes-4634"><span class="linenos">4634</span></a>            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">old_model_dir</span><span class="p">):</span>
</span><span id="Project.import_episodes-4635"><a href="#Project.import_episodes-4635"><span class="linenos">4635</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span>
</span><span id="Project.import_episodes-4636"><a href="#Project.import_episodes-4636"><span class="linenos">4636</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">old_model_dir</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="Project.import_episodes-4637"><a href="#Project.import_episodes-4637"><span class="linenos">4637</span></a>                <span class="p">)</span>
</span><span id="Project.import_episodes-4638"><a href="#Project.import_episodes-4638"><span class="linenos">4638</span></a>            <span class="n">log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.import_episodes-4639"><a href="#Project.import_episodes-4639"><span class="linenos">4639</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="Project.import_episodes-4640"><a href="#Project.import_episodes-4640"><span class="linenos">4640</span></a>            <span class="p">)</span>
</span><span id="Project.import_episodes-4641"><a href="#Project.import_episodes-4641"><span class="linenos">4641</span></a>            <span class="n">old_log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.import_episodes-4642"><a href="#Project.import_episodes-4642"><span class="linenos">4642</span></a>                <span class="n">episodes_directory</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="Project.import_episodes-4643"><a href="#Project.import_episodes-4643"><span class="linenos">4643</span></a>            <span class="p">)</span>
</span><span id="Project.import_episodes-4644"><a href="#Project.import_episodes-4644"><span class="linenos">4644</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">old_log_file</span><span class="p">,</span> <span class="n">log_file</span><span class="p">)</span>
</span><span id="Project.import_episodes-4645"><a href="#Project.import_episodes-4645"><span class="linenos">4645</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">import_string</span><span class="p">)</span>
</span><span id="Project.import_episodes-4646"><a href="#Project.import_episodes-4646"><span class="linenos">4646</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Import episodes exported with <code><a href="#Project.export_episodes">Project.export_episodes</a></code></p>

<h2 id="parameters">Parameters</h2>

<p>episodes_directory : str
    the path to the exported episodes directory
name_map : dict
    a name change dictionary for the episodes: keys are old names, values are new names</p>
</div>


                            </div>
                            <div id="Project.export_episodes" class="classattr">
                                        <input id="Project.export_episodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">export_episodes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">output_directory</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Project.export_episodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.export_episodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.export_episodes-4648"><a href="#Project.export_episodes-4648"><span class="linenos">4648</span></a>    <span class="k">def</span> <span class="nf">export_episodes</span><span class="p">(</span>
</span><span id="Project.export_episodes-4649"><a href="#Project.export_episodes-4649"><span class="linenos">4649</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">output_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Project.export_episodes-4650"><a href="#Project.export_episodes-4650"><span class="linenos">4650</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.export_episodes-4651"><a href="#Project.export_episodes-4651"><span class="linenos">4651</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.export_episodes-4652"><a href="#Project.export_episodes-4652"><span class="linenos">4652</span></a><span class="sd">        Save selected episodes as a file that can be imported into another project with `Project.import_episodes`</span>
</span><span id="Project.export_episodes-4653"><a href="#Project.export_episodes-4653"><span class="linenos">4653</span></a>
</span><span id="Project.export_episodes-4654"><a href="#Project.export_episodes-4654"><span class="linenos">4654</span></a><span class="sd">        Parameters</span>
</span><span id="Project.export_episodes-4655"><a href="#Project.export_episodes-4655"><span class="linenos">4655</span></a><span class="sd">        ----------</span>
</span><span id="Project.export_episodes-4656"><a href="#Project.export_episodes-4656"><span class="linenos">4656</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project.export_episodes-4657"><a href="#Project.export_episodes-4657"><span class="linenos">4657</span></a><span class="sd">            a list of string episode names</span>
</span><span id="Project.export_episodes-4658"><a href="#Project.export_episodes-4658"><span class="linenos">4658</span></a><span class="sd">        output_directory : str</span>
</span><span id="Project.export_episodes-4659"><a href="#Project.export_episodes-4659"><span class="linenos">4659</span></a><span class="sd">            the path to the directory where the episodes will be saved</span>
</span><span id="Project.export_episodes-4660"><a href="#Project.export_episodes-4660"><span class="linenos">4660</span></a><span class="sd">        name : str, optional</span>
</span><span id="Project.export_episodes-4661"><a href="#Project.export_episodes-4661"><span class="linenos">4661</span></a><span class="sd">            the name of the episodes directory (by default `exported_episodes`)</span>
</span><span id="Project.export_episodes-4662"><a href="#Project.export_episodes-4662"><span class="linenos">4662</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.export_episodes-4663"><a href="#Project.export_episodes-4663"><span class="linenos">4663</span></a>
</span><span id="Project.export_episodes-4664"><a href="#Project.export_episodes-4664"><span class="linenos">4664</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.export_episodes-4665"><a href="#Project.export_episodes-4665"><span class="linenos">4665</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;exported_episodes&quot;</span>
</span><span id="Project.export_episodes-4666"><a href="#Project.export_episodes-4666"><span class="linenos">4666</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="Project.export_episodes-4667"><a href="#Project.export_episodes-4667"><span class="linenos">4667</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span><span class="p">)</span>
</span><span id="Project.export_episodes-4668"><a href="#Project.export_episodes-4668"><span class="linenos">4668</span></a>        <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)):</span>
</span><span id="Project.export_episodes-4669"><a href="#Project.export_episodes-4669"><span class="linenos">4669</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Project.export_episodes-4670"><a href="#Project.export_episodes-4670"><span class="linenos">4670</span></a>            <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span>
</span><span id="Project.export_episodes-4671"><a href="#Project.export_episodes-4671"><span class="linenos">4671</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">)</span>
</span><span id="Project.export_episodes-4672"><a href="#Project.export_episodes-4672"><span class="linenos">4672</span></a>            <span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)):</span>
</span><span id="Project.export_episodes-4673"><a href="#Project.export_episodes-4673"><span class="linenos">4673</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Project.export_episodes-4674"><a href="#Project.export_episodes-4674"><span class="linenos">4674</span></a>            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Project.export_episodes-4675"><a href="#Project.export_episodes-4675"><span class="linenos">4675</span></a>        <span class="n">dest_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="Project.export_episodes-4676"><a href="#Project.export_episodes-4676"><span class="linenos">4676</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">)</span>
</span><span id="Project.export_episodes-4677"><a href="#Project.export_episodes-4677"><span class="linenos">4677</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">))</span>
</span><span id="Project.export_episodes-4678"><a href="#Project.export_episodes-4678"><span class="linenos">4678</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">))</span>
</span><span id="Project.export_episodes-4679"><a href="#Project.export_episodes-4679"><span class="linenos">4679</span></a>        <span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.export_episodes-4680"><a href="#Project.export_episodes-4680"><span class="linenos">4680</span></a>        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="Project.export_episodes-4681"><a href="#Project.export_episodes-4681"><span class="linenos">4681</span></a>            <span class="n">runs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode</span><span class="p">)</span>
</span><span id="Project.export_episodes-4682"><a href="#Project.export_episodes-4682"><span class="linenos">4682</span></a>        <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">:</span>
</span><span id="Project.export_episodes-4683"><a href="#Project.export_episodes-4683"><span class="linenos">4683</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span>
</span><span id="Project.export_episodes-4684"><a href="#Project.export_episodes-4684"><span class="linenos">4684</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">),</span>
</span><span id="Project.export_episodes-4685"><a href="#Project.export_episodes-4685"><span class="linenos">4685</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">run</span><span class="p">),</span>
</span><span id="Project.export_episodes-4686"><a href="#Project.export_episodes-4686"><span class="linenos">4686</span></a>            <span class="p">)</span>
</span><span id="Project.export_episodes-4687"><a href="#Project.export_episodes-4687"><span class="linenos">4687</span></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span>
</span><span id="Project.export_episodes-4688"><a href="#Project.export_episodes-4688"><span class="linenos">4688</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
</span><span id="Project.export_episodes-4689"><a href="#Project.export_episodes-4689"><span class="linenos">4689</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">run</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
</span><span id="Project.export_episodes-4690"><a href="#Project.export_episodes-4690"><span class="linenos">4690</span></a>            <span class="p">)</span>
</span><span id="Project.export_episodes-4691"><a href="#Project.export_episodes-4691"><span class="linenos">4691</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_subset</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span>
</span><span id="Project.export_episodes-4692"><a href="#Project.export_episodes-4692"><span class="linenos">4692</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">,</span> <span class="s2">&quot;episodes.pickle&quot;</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Save selected episodes as a file that can be imported into another project with <code><a href="#Project.import_episodes">Project.import_episodes</a></code></p>

<h2 id="parameters">Parameters</h2>

<p>episode_names : list
    a list of string episode names
output_directory : str
    the path to the directory where the episodes will be saved
name : str, optional
    the name of the episodes directory (by default <code>exported_episodes</code>)</p>
</div>


                            </div>
                            <div id="Project.get_results_table" class="classattr">
                                        <input id="Project.get_results_table-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_results_table</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span>,</span><span class="param">	<span class="n">metrics</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">include_std</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">classes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Project.get_results_table-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.get_results_table"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.get_results_table-4694"><a href="#Project.get_results_table-4694"><span class="linenos">4694</span></a>    <span class="k">def</span> <span class="nf">get_results_table</span><span class="p">(</span>
</span><span id="Project.get_results_table-4695"><a href="#Project.get_results_table-4695"><span class="linenos">4695</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Project.get_results_table-4696"><a href="#Project.get_results_table-4696"><span class="linenos">4696</span></a>        <span class="n">episode_names</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span>
</span><span id="Project.get_results_table-4697"><a href="#Project.get_results_table-4697"><span class="linenos">4697</span></a>        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.get_results_table-4698"><a href="#Project.get_results_table-4698"><span class="linenos">4698</span></a>        <span class="n">include_std</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Project.get_results_table-4699"><a href="#Project.get_results_table-4699"><span class="linenos">4699</span></a>        <span class="n">classes</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Project.get_results_table-4700"><a href="#Project.get_results_table-4700"><span class="linenos">4700</span></a>    <span class="p">):</span>
</span><span id="Project.get_results_table-4701"><a href="#Project.get_results_table-4701"><span class="linenos">4701</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.get_results_table-4702"><a href="#Project.get_results_table-4702"><span class="linenos">4702</span></a><span class="sd">        Genererate a `pandas` dataframe with a summary of episode results</span>
</span><span id="Project.get_results_table-4703"><a href="#Project.get_results_table-4703"><span class="linenos">4703</span></a>
</span><span id="Project.get_results_table-4704"><a href="#Project.get_results_table-4704"><span class="linenos">4704</span></a><span class="sd">        Parameters</span>
</span><span id="Project.get_results_table-4705"><a href="#Project.get_results_table-4705"><span class="linenos">4705</span></a><span class="sd">        ----------</span>
</span><span id="Project.get_results_table-4706"><a href="#Project.get_results_table-4706"><span class="linenos">4706</span></a><span class="sd">        episode_names : list</span>
</span><span id="Project.get_results_table-4707"><a href="#Project.get_results_table-4707"><span class="linenos">4707</span></a><span class="sd">            a list of names of episodes to include</span>
</span><span id="Project.get_results_table-4708"><a href="#Project.get_results_table-4708"><span class="linenos">4708</span></a><span class="sd">        metrics : list, optional</span>
</span><span id="Project.get_results_table-4709"><a href="#Project.get_results_table-4709"><span class="linenos">4709</span></a><span class="sd">            a list of metric names to include</span>
</span><span id="Project.get_results_table-4710"><a href="#Project.get_results_table-4710"><span class="linenos">4710</span></a><span class="sd">        include_std : bool, default False</span>
</span><span id="Project.get_results_table-4711"><a href="#Project.get_results_table-4711"><span class="linenos">4711</span></a><span class="sd">            if `True`, for episodes with multiple runs the mean and standard deviation will be displayed;</span>
</span><span id="Project.get_results_table-4712"><a href="#Project.get_results_table-4712"><span class="linenos">4712</span></a><span class="sd">            otherwise only mean</span>
</span><span id="Project.get_results_table-4713"><a href="#Project.get_results_table-4713"><span class="linenos">4713</span></a><span class="sd">        classes : list, optional</span>
</span><span id="Project.get_results_table-4714"><a href="#Project.get_results_table-4714"><span class="linenos">4714</span></a><span class="sd">            a list of names of classes to include (by default all are included)</span>
</span><span id="Project.get_results_table-4715"><a href="#Project.get_results_table-4715"><span class="linenos">4715</span></a>
</span><span id="Project.get_results_table-4716"><a href="#Project.get_results_table-4716"><span class="linenos">4716</span></a><span class="sd">        Returns</span>
</span><span id="Project.get_results_table-4717"><a href="#Project.get_results_table-4717"><span class="linenos">4717</span></a><span class="sd">        -------</span>
</span><span id="Project.get_results_table-4718"><a href="#Project.get_results_table-4718"><span class="linenos">4718</span></a><span class="sd">        results : pd.DataFrame</span>
</span><span id="Project.get_results_table-4719"><a href="#Project.get_results_table-4719"><span class="linenos">4719</span></a><span class="sd">            a table with the results</span>
</span><span id="Project.get_results_table-4720"><a href="#Project.get_results_table-4720"><span class="linenos">4720</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.get_results_table-4721"><a href="#Project.get_results_table-4721"><span class="linenos">4721</span></a>
</span><span id="Project.get_results_table-4722"><a href="#Project.get_results_table-4722"><span class="linenos">4722</span></a>        <span class="n">run_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.get_results_table-4723"><a href="#Project.get_results_table-4723"><span class="linenos">4723</span></a>        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="Project.get_results_table-4724"><a href="#Project.get_results_table-4724"><span class="linenos">4724</span></a>            <span class="n">run_names</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode</span><span class="p">)</span>
</span><span id="Project.get_results_table-4725"><a href="#Project.get_results_table-4725"><span class="linenos">4725</span></a>        <span class="n">episodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span><span class="n">run_names</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Project.get_results_table-4726"><a href="#Project.get_results_table-4726"><span class="linenos">4726</span></a>        <span class="n">metric_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">episodes</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;results&quot;</span><span class="p">]</span>
</span><span id="Project.get_results_table-4727"><a href="#Project.get_results_table-4727"><span class="linenos">4727</span></a>        <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="Project.get_results_table-4728"><a href="#Project.get_results_table-4728"><span class="linenos">4728</span></a>        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.get_results_table-4729"><a href="#Project.get_results_table-4729"><span class="linenos">4729</span></a>            <span class="n">metric_columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project.get_results_table-4730"><a href="#Project.get_results_table-4730"><span class="linenos">4730</span></a>                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">metric_columns</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">metrics</span>
</span><span id="Project.get_results_table-4731"><a href="#Project.get_results_table-4731"><span class="linenos">4731</span></a>            <span class="p">]</span>
</span><span id="Project.get_results_table-4732"><a href="#Project.get_results_table-4732"><span class="linenos">4732</span></a>        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">episode_names</span><span class="p">:</span>
</span><span id="Project.get_results_table-4733"><a href="#Project.get_results_table-4733"><span class="linenos">4733</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.get_results_table-4734"><a href="#Project.get_results_table-4734"><span class="linenos">4734</span></a>            <span class="n">metric_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Project.get_results_table-4735"><a href="#Project.get_results_table-4735"><span class="linenos">4735</span></a>            <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">get_runs</span><span class="p">(</span><span class="n">episode</span><span class="p">):</span>
</span><span id="Project.get_results_table-4736"><a href="#Project.get_results_table-4736"><span class="linenos">4736</span></a>                <span class="n">beh_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_behavior_dictionary</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</span><span id="Project.get_results_table-4737"><a href="#Project.get_results_table-4737"><span class="linenos">4737</span></a>                <span class="n">res_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="Project.get_results_table-4738"><a href="#Project.get_results_table-4738"><span class="linenos">4738</span></a>                <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">metric_columns</span><span class="p">:</span>
</span><span id="Project.get_results_table-4739"><a href="#Project.get_results_table-4739"><span class="linenos">4739</span></a>                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">episodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">run</span><span class="p">,</span> <span class="n">column</span><span class="p">]):</span>
</span><span id="Project.get_results_table-4740"><a href="#Project.get_results_table-4740"><span class="linenos">4740</span></a>                        <span class="k">continue</span>
</span><span id="Project.get_results_table-4741"><a href="#Project.get_results_table-4741"><span class="linenos">4741</span></a>                    <span class="n">split</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
</span><span id="Project.get_results_table-4742"><a href="#Project.get_results_table-4742"><span class="linenos">4742</span></a>                    <span class="k">if</span> <span class="n">split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
</span><span id="Project.get_results_table-4743"><a href="#Project.get_results_table-4743"><span class="linenos">4743</span></a>                        <span class="n">beh_ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Project.get_results_table-4744"><a href="#Project.get_results_table-4744"><span class="linenos">4744</span></a>                        <span class="n">metric_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Project.get_results_table-4745"><a href="#Project.get_results_table-4745"><span class="linenos">4745</span></a>                        <span class="n">beh</span> <span class="o">=</span> <span class="n">beh_dict</span><span class="p">[</span><span class="n">beh_ind</span><span class="p">]</span>
</span><span id="Project.get_results_table-4746"><a href="#Project.get_results_table-4746"><span class="linenos">4746</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Project.get_results_table-4747"><a href="#Project.get_results_table-4747"><span class="linenos">4747</span></a>                        <span class="n">beh</span> <span class="o">=</span> <span class="s2">&quot;average&quot;</span>
</span><span id="Project.get_results_table-4748"><a href="#Project.get_results_table-4748"><span class="linenos">4748</span></a>                        <span class="n">metric_name</span> <span class="o">=</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Project.get_results_table-4749"><a href="#Project.get_results_table-4749"><span class="linenos">4749</span></a>                    <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">episodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">run</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span>
</span><span id="Project.get_results_table-4750"><a href="#Project.get_results_table-4750"><span class="linenos">4750</span></a>                    <span class="n">metric_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">metric_name</span><span class="p">)</span>
</span><span id="Project.get_results_table-4751"><a href="#Project.get_results_table-4751"><span class="linenos">4751</span></a>                <span class="k">if</span> <span class="s2">&quot;average&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">:</span>
</span><span id="Project.get_results_table-4752"><a href="#Project.get_results_table-4752"><span class="linenos">4752</span></a>                    <span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project.get_results_table-4753"><a href="#Project.get_results_table-4753"><span class="linenos">4753</span></a>                <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_set</span><span class="p">:</span>
</span><span id="Project.get_results_table-4754"><a href="#Project.get_results_table-4754"><span class="linenos">4754</span></a>                    <span class="k">if</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">]:</span>
</span><span id="Project.get_results_table-4755"><a href="#Project.get_results_table-4755"><span class="linenos">4755</span></a>                        <span class="n">arr</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Project.get_results_table-4756"><a href="#Project.get_results_table-4756"><span class="linenos">4756</span></a>                            <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span>
</span><span id="Project.get_results_table-4757"><a href="#Project.get_results_table-4757"><span class="linenos">4757</span></a>                            <span class="k">for</span> <span class="n">beh</span> <span class="ow">in</span> <span class="n">res_dict</span>
</span><span id="Project.get_results_table-4758"><a href="#Project.get_results_table-4758"><span class="linenos">4758</span></a>                            <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">]</span>
</span><span id="Project.get_results_table-4759"><a href="#Project.get_results_table-4759"><span class="linenos">4759</span></a>                        <span class="p">]</span>
</span><span id="Project.get_results_table-4760"><a href="#Project.get_results_table-4760"><span class="linenos">4760</span></a>                        <span class="n">res_dict</span><span class="p">[</span><span class="s2">&quot;average&quot;</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="Project.get_results_table-4761"><a href="#Project.get_results_table-4761"><span class="linenos">4761</span></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_dict</span><span class="p">)</span>
</span><span id="Project.get_results_table-4762"><a href="#Project.get_results_table-4762"><span class="linenos">4762</span></a>            <span class="n">episode_results</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Project.get_results_table-4763"><a href="#Project.get_results_table-4763"><span class="linenos">4763</span></a>            <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metric_set</span><span class="p">:</span>
</span><span id="Project.get_results_table-4764"><a href="#Project.get_results_table-4764"><span class="linenos">4764</span></a>                <span class="k">for</span> <span class="n">beh</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="Project.get_results_table-4765"><a href="#Project.get_results_table-4765"><span class="linenos">4765</span></a>                    <span class="k">if</span> <span class="n">classes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">beh</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
</span><span id="Project.get_results_table-4766"><a href="#Project.get_results_table-4766"><span class="linenos">4766</span></a>                        <span class="k">continue</span>
</span><span id="Project.get_results_table-4767"><a href="#Project.get_results_table-4767"><span class="linenos">4767</span></a>                    <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Project.get_results_table-4768"><a href="#Project.get_results_table-4768"><span class="linenos">4768</span></a>                    <span class="k">for</span> <span class="n">res_dict</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span id="Project.get_results_table-4769"><a href="#Project.get_results_table-4769"><span class="linenos">4769</span></a>                        <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">]:</span>
</span><span id="Project.get_results_table-4770"><a href="#Project.get_results_table-4770"><span class="linenos">4770</span></a>                            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_dict</span><span class="p">[</span><span class="n">beh</span><span class="p">][</span><span class="n">metric</span><span class="p">])</span>
</span><span id="Project.get_results_table-4771"><a href="#Project.get_results_table-4771"><span class="linenos">4771</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Project.get_results_table-4772"><a href="#Project.get_results_table-4772"><span class="linenos">4772</span></a>                        <span class="k">if</span> <span class="n">include_std</span><span class="p">:</span>
</span><span id="Project.get_results_table-4773"><a href="#Project.get_results_table-4773"><span class="linenos">4773</span></a>                            <span class="n">episode_results</span><span class="p">[</span>
</span><span id="Project.get_results_table-4774"><a href="#Project.get_results_table-4774"><span class="linenos">4774</span></a>                                <span class="p">(</span><span class="n">beh</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> mean&quot;</span><span class="p">)</span>
</span><span id="Project.get_results_table-4775"><a href="#Project.get_results_table-4775"><span class="linenos">4775</span></a>                            <span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="Project.get_results_table-4776"><a href="#Project.get_results_table-4776"><span class="linenos">4776</span></a>                            <span class="n">episode_results</span><span class="p">[(</span><span class="n">beh</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> std&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span>
</span><span id="Project.get_results_table-4777"><a href="#Project.get_results_table-4777"><span class="linenos">4777</span></a>                                <span class="n">arr</span>
</span><span id="Project.get_results_table-4778"><a href="#Project.get_results_table-4778"><span class="linenos">4778</span></a>                            <span class="p">)</span>
</span><span id="Project.get_results_table-4779"><a href="#Project.get_results_table-4779"><span class="linenos">4779</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="Project.get_results_table-4780"><a href="#Project.get_results_table-4780"><span class="linenos">4780</span></a>                            <span class="n">episode_results</span><span class="p">[(</span><span class="n">beh</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="Project.get_results_table-4781"><a href="#Project.get_results_table-4781"><span class="linenos">4781</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">episode_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Project.get_results_table-4782"><a href="#Project.get_results_table-4782"><span class="linenos">4782</span></a>                <span class="n">results_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Project.get_results_table-4783"><a href="#Project.get_results_table-4783"><span class="linenos">4783</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RESULTS:&quot;</span><span class="p">)</span>
</span><span id="Project.get_results_table-4784"><a href="#Project.get_results_table-4784"><span class="linenos">4784</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">)</span>
</span><span id="Project.get_results_table-4785"><a href="#Project.get_results_table-4785"><span class="linenos">4785</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Project.get_results_table-4786"><a href="#Project.get_results_table-4786"><span class="linenos">4786</span></a>        <span class="k">return</span> <span class="n">results_df</span>
</span></pre></div>


            <div class="docstring"><p>Genererate a <code>pandas</code> dataframe with a summary of episode results</p>

<h2 id="parameters">Parameters</h2>

<p>episode_names : list
    a list of names of episodes to include
metrics : list, optional
    a list of metric names to include
include_std : bool, default False
    if <code>True</code>, for episodes with multiple runs the mean and standard deviation will be displayed;
    otherwise only mean
classes : list, optional
    a list of names of classes to include (by default all are included)</p>

<h2 id="returns">Returns</h2>

<p>results : pd.DataFrame
    a table with the results</p>
</div>


                            </div>
                            <div id="Project.episode_exists" class="classattr">
                                        <input id="Project.episode_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">episode_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Project.episode_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.episode_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.episode_exists-4788"><a href="#Project.episode_exists-4788"><span class="linenos">4788</span></a>    <span class="k">def</span> <span class="nf">episode_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Project.episode_exists-4789"><a href="#Project.episode_exists-4789"><span class="linenos">4789</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.episode_exists-4790"><a href="#Project.episode_exists-4790"><span class="linenos">4790</span></a><span class="sd">        Check if an episode already exists</span>
</span><span id="Project.episode_exists-4791"><a href="#Project.episode_exists-4791"><span class="linenos">4791</span></a>
</span><span id="Project.episode_exists-4792"><a href="#Project.episode_exists-4792"><span class="linenos">4792</span></a><span class="sd">        Parameters</span>
</span><span id="Project.episode_exists-4793"><a href="#Project.episode_exists-4793"><span class="linenos">4793</span></a><span class="sd">        ----------</span>
</span><span id="Project.episode_exists-4794"><a href="#Project.episode_exists-4794"><span class="linenos">4794</span></a><span class="sd">        episode_name : str</span>
</span><span id="Project.episode_exists-4795"><a href="#Project.episode_exists-4795"><span class="linenos">4795</span></a><span class="sd">            the episode name</span>
</span><span id="Project.episode_exists-4796"><a href="#Project.episode_exists-4796"><span class="linenos">4796</span></a>
</span><span id="Project.episode_exists-4797"><a href="#Project.episode_exists-4797"><span class="linenos">4797</span></a><span class="sd">        Returns</span>
</span><span id="Project.episode_exists-4798"><a href="#Project.episode_exists-4798"><span class="linenos">4798</span></a><span class="sd">        -------</span>
</span><span id="Project.episode_exists-4799"><a href="#Project.episode_exists-4799"><span class="linenos">4799</span></a><span class="sd">        exists : bool</span>
</span><span id="Project.episode_exists-4800"><a href="#Project.episode_exists-4800"><span class="linenos">4800</span></a><span class="sd">            `True` if the episode exists</span>
</span><span id="Project.episode_exists-4801"><a href="#Project.episode_exists-4801"><span class="linenos">4801</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.episode_exists-4802"><a href="#Project.episode_exists-4802"><span class="linenos">4802</span></a>
</span><span id="Project.episode_exists-4803"><a href="#Project.episode_exists-4803"><span class="linenos">4803</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">episode_name</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Check if an episode already exists</p>

<h2 id="parameters">Parameters</h2>

<p>episode_name : str
    the episode name</p>

<h2 id="returns">Returns</h2>

<p>exists : bool
    <code>True</code> if the episode exists</p>
</div>


                            </div>
                            <div id="Project.search_exists" class="classattr">
                                        <input id="Project.search_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">search_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Project.search_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.search_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.search_exists-4805"><a href="#Project.search_exists-4805"><span class="linenos">4805</span></a>    <span class="k">def</span> <span class="nf">search_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Project.search_exists-4806"><a href="#Project.search_exists-4806"><span class="linenos">4806</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.search_exists-4807"><a href="#Project.search_exists-4807"><span class="linenos">4807</span></a><span class="sd">        Check if a search already exists</span>
</span><span id="Project.search_exists-4808"><a href="#Project.search_exists-4808"><span class="linenos">4808</span></a>
</span><span id="Project.search_exists-4809"><a href="#Project.search_exists-4809"><span class="linenos">4809</span></a><span class="sd">        Parameters</span>
</span><span id="Project.search_exists-4810"><a href="#Project.search_exists-4810"><span class="linenos">4810</span></a><span class="sd">        ----------</span>
</span><span id="Project.search_exists-4811"><a href="#Project.search_exists-4811"><span class="linenos">4811</span></a><span class="sd">        search_name : str</span>
</span><span id="Project.search_exists-4812"><a href="#Project.search_exists-4812"><span class="linenos">4812</span></a><span class="sd">            the search name</span>
</span><span id="Project.search_exists-4813"><a href="#Project.search_exists-4813"><span class="linenos">4813</span></a>
</span><span id="Project.search_exists-4814"><a href="#Project.search_exists-4814"><span class="linenos">4814</span></a><span class="sd">        Returns</span>
</span><span id="Project.search_exists-4815"><a href="#Project.search_exists-4815"><span class="linenos">4815</span></a><span class="sd">        -------</span>
</span><span id="Project.search_exists-4816"><a href="#Project.search_exists-4816"><span class="linenos">4816</span></a><span class="sd">        exists : bool</span>
</span><span id="Project.search_exists-4817"><a href="#Project.search_exists-4817"><span class="linenos">4817</span></a><span class="sd">            `True` if the search exists</span>
</span><span id="Project.search_exists-4818"><a href="#Project.search_exists-4818"><span class="linenos">4818</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.search_exists-4819"><a href="#Project.search_exists-4819"><span class="linenos">4819</span></a>
</span><span id="Project.search_exists-4820"><a href="#Project.search_exists-4820"><span class="linenos">4820</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_searches</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">search_name</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Check if a search already exists</p>

<h2 id="parameters">Parameters</h2>

<p>search_name : str
    the search name</p>

<h2 id="returns">Returns</h2>

<p>exists : bool
    <code>True</code> if the search exists</p>
</div>


                            </div>
                            <div id="Project.prediction_exists" class="classattr">
                                        <input id="Project.prediction_exists-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prediction_exists</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Project.prediction_exists-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.prediction_exists"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.prediction_exists-4822"><a href="#Project.prediction_exists-4822"><span class="linenos">4822</span></a>    <span class="k">def</span> <span class="nf">prediction_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prediction_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Project.prediction_exists-4823"><a href="#Project.prediction_exists-4823"><span class="linenos">4823</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Project.prediction_exists-4824"><a href="#Project.prediction_exists-4824"><span class="linenos">4824</span></a><span class="sd">        Check if a prediction already exists</span>
</span><span id="Project.prediction_exists-4825"><a href="#Project.prediction_exists-4825"><span class="linenos">4825</span></a>
</span><span id="Project.prediction_exists-4826"><a href="#Project.prediction_exists-4826"><span class="linenos">4826</span></a><span class="sd">        Parameters</span>
</span><span id="Project.prediction_exists-4827"><a href="#Project.prediction_exists-4827"><span class="linenos">4827</span></a><span class="sd">        ----------</span>
</span><span id="Project.prediction_exists-4828"><a href="#Project.prediction_exists-4828"><span class="linenos">4828</span></a><span class="sd">        prediction_name : str</span>
</span><span id="Project.prediction_exists-4829"><a href="#Project.prediction_exists-4829"><span class="linenos">4829</span></a><span class="sd">            the prediction name</span>
</span><span id="Project.prediction_exists-4830"><a href="#Project.prediction_exists-4830"><span class="linenos">4830</span></a>
</span><span id="Project.prediction_exists-4831"><a href="#Project.prediction_exists-4831"><span class="linenos">4831</span></a><span class="sd">        Returns</span>
</span><span id="Project.prediction_exists-4832"><a href="#Project.prediction_exists-4832"><span class="linenos">4832</span></a><span class="sd">        -------</span>
</span><span id="Project.prediction_exists-4833"><a href="#Project.prediction_exists-4833"><span class="linenos">4833</span></a><span class="sd">        exists : bool</span>
</span><span id="Project.prediction_exists-4834"><a href="#Project.prediction_exists-4834"><span class="linenos">4834</span></a><span class="sd">            `True` if the prediction exists</span>
</span><span id="Project.prediction_exists-4835"><a href="#Project.prediction_exists-4835"><span class="linenos">4835</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Project.prediction_exists-4836"><a href="#Project.prediction_exists-4836"><span class="linenos">4836</span></a>
</span><span id="Project.prediction_exists-4837"><a href="#Project.prediction_exists-4837"><span class="linenos">4837</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions</span><span class="p">()</span><span class="o">.</span><span class="n">check_name_validity</span><span class="p">(</span><span class="n">prediction_name</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Check if a prediction already exists</p>

<h2 id="parameters">Parameters</h2>

<p>prediction_name : str
    the prediction name</p>

<h2 id="returns">Returns</h2>

<p>exists : bool
    <code>True</code> if the prediction exists</p>
</div>


                            </div>
                            <div id="Project.project_name_available" class="classattr">
                                        <input id="Project.project_name_available-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">project_name_available</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Project.project_name_available-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.project_name_available"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.project_name_available-4839"><a href="#Project.project_name_available-4839"><span class="linenos">4839</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Project.project_name_available-4840"><a href="#Project.project_name_available-4840"><span class="linenos">4840</span></a>    <span class="k">def</span> <span class="nf">project_name_available</span><span class="p">(</span><span class="n">projects_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Project.project_name_available-4841"><a href="#Project.project_name_available-4841"><span class="linenos">4841</span></a>        <span class="k">if</span> <span class="n">projects_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Project.project_name_available-4842"><a href="#Project.project_name_available-4842"><span class="linenos">4842</span></a>            <span class="n">projects_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()),</span> <span class="s2">&quot;DLC2Action&quot;</span><span class="p">)</span>
</span><span id="Project.project_name_available-4843"><a href="#Project.project_name_available-4843"><span class="linenos">4843</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">projects_path</span><span class="p">,</span> <span class="n">project_name</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="Project.rename_episode" class="classattr">
                                        <input id="Project.rename_episode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rename_episode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">new_episode_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Project.rename_episode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Project.rename_episode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Project.rename_episode-4852"><a href="#Project.rename_episode-4852"><span class="linenos">4852</span></a>    <span class="k">def</span> <span class="nf">rename_episode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_episode_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Project.rename_episode-4853"><a href="#Project.rename_episode-4853"><span class="linenos">4853</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
</span><span id="Project.rename_episode-4854"><a href="#Project.rename_episode-4854"><span class="linenos">4854</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">episode_name</span><span class="p">),</span>
</span><span id="Project.rename_episode-4855"><a href="#Project.rename_episode-4855"><span class="linenos">4855</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">new_episode_name</span><span class="p">),</span>
</span><span id="Project.rename_episode-4856"><a href="#Project.rename_episode-4856"><span class="linenos">4856</span></a>        <span class="p">)</span>
</span><span id="Project.rename_episode-4857"><a href="#Project.rename_episode-4857"><span class="linenos">4857</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span>
</span><span id="Project.rename_episode-4858"><a href="#Project.rename_episode-4858"><span class="linenos">4858</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
</span><span id="Project.rename_episode-4859"><a href="#Project.rename_episode-4859"><span class="linenos">4859</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Project.rename_episode-4860"><a href="#Project.rename_episode-4860"><span class="linenos">4860</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">project_path</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_episode_name</span><span class="si">}</span><span class="s2">.txt&quot;</span>
</span><span id="Project.rename_episode-4861"><a href="#Project.rename_episode-4861"><span class="linenos">4861</span></a>            <span class="p">),</span>
</span><span id="Project.rename_episode-4862"><a href="#Project.rename_episode-4862"><span class="linenos">4862</span></a>        <span class="p">)</span>
</span><span id="Project.rename_episode-4863"><a href="#Project.rename_episode-4863"><span class="linenos">4863</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_episodes</span><span class="p">()</span><span class="o">.</span><span class="n">rename_episode</span><span class="p">(</span><span class="n">episode_name</span><span class="p">,</span> <span class="n">new_episode_name</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>